<?xml version="1.0" encoding="UTF-8"?>
<custom_rules>
  <rule id="tools-1">
    <title>Information Gathering Priority</title>
    <description>Always use the most appropriate tool for gathering information.</description>
    <priority>
      <level>1. codebase_search - For semantic/meaning-based searches (MOST PREFERRED)</level>
      <level>2. list_files - For exploring directory structure</level>
      <level>3. search_files - For regex pattern matching only when needed</level>
      <level>4. read_file - For examining specific file contents</level>
    </priority>
    <note>codebase_search understands context and meaning better than regex search</note>
  </rule>

  <rule id="tools-2">
    <title>File Modification Workflow</title>
    <description>Follow the standard workflow for modifying files.</description>
    <workflow>
      <step name="read">
        <tool>read_file</tool>
        <purpose>Examine current file contents before modification</purpose>
        <note>Can read up to 5 files in a single call by passing an array</note>
      </step>
      <step name="modify">
        <tool>apply_diff</tool>
        <purpose>Surgical edits to existing files</purpose>
        <note>Multiple SEARCH/REPLACE blocks can be included in one call</note>
      </step>
      <step name="create">
        <tool>write_to_file</tool>
        <purpose>New files or complete rewrites only</purpose>
        <note>Overwrites existing files - use with caution</note>
      </step>
    </workflow>
  </rule>

  <rule id="tools-3">
    <title>When to Use Each Tool</title>
    <description>Guidelines for tool selection.</description>
    <usage>
      <tool name="codebase_search">
        <when>Finding code by meaning/semantic search</when>
        <when>Understanding implementations across codebase</when>
        <when>Exploring new code areas</when>
        <example>Find user authentication code</example>
      </tool>
      <tool name="search_files">
        <when>Finding specific patterns with regex</when>
        <when>Searching for TODO comments or specific strings</when>
        <when>Codebase search doesn't find what you need</when>
        <example>Find all console.log statements</example>
      </tool>
      <tool name="read_file">
        <when>Examining file contents before editing</when>
        <when>Understanding specific implementations</when>
        <when>Reading multiple related files together</when>
        <limit>Maximum 5 files per call</limit>
      </tool>
      <tool name="apply_diff">
        <when>Making surgical edits to existing files</when>
        <when>Multiple changes needed in same file</when>
        <requirement>Must match exact existing content including whitespace</requirement>
      </tool>
      <tool name="write_to_file">
        <when>Creating new files</when>
        <when>Complete file rewrites intentional</when>
        <warning>Overwrites existing content</warning>
      </tool>
      <tool name="list_files">
        <when>Exploring directory structure</when>
        <when>Finding files in a directory</when>
        <when>Understanding project organization</when>
      </tool>
      <tool name="execute_command">
        <when>Running system commands</when>
        <when>Installing dependencies</when>
        <when>Running build/test scripts</when>
      </tool>
    </usage>
  </rule>

  <rule id="tools-4">
    <title>Batch Operations</title>
    <description>Combine operations efficiently.</description>
    <patterns>
      <pattern>
        <name>Read Multiple Files</name>
        <code>read_file({ files: [{ path: 'file1.ts' }, { path: 'file2.ts' }] })</code>
        <benefit>Single call instead of multiple</benefit>
      </pattern>
      <pattern>
        <name>Multiple Edits in One apply_diff</name>
        <code>apply_diff({
  path: 'file.ts',
  diff: 'SEARCH...REPLACE...SEARCH...REPLACE'
})</code>
        <benefit>All changes applied atomically</benefit>
      </pattern>
      <pattern>
        <name>Search and Read</name>
        <code>// First find relevant files
codebase_search({ query: 'authentication logic' })
// Then read the specific files
read_file({ files: [{ path: 'found1.ts' }, { path: 'found2.ts' }] })</code>
      </pattern>
    </patterns>
  </rule>

  <rule id="tools-5">
    <title>Wait for Confirmation</title>
    <description>Always wait for user confirmation between operations.</description>
    <practices>
      <item>Wait for file creation confirmation before creating dependent files</item>
      <item>Wait for edit confirmation before subsequent edits</item>
      <item>Do not assume success - wait for explicit confirmation</item>
      <item>Use attempt_completion only when fully done</item>
    </practices>
  </rule>

  <rule id="tools-6">
    <title>Error Handling in Tool Usage</title>
    <description>Handle tool failures gracefully.</description>
    <strategies>
      <strategy>If apply_diff fails, re-read the file and try again with corrected content</strategy>
      <strategy>If search returns no results, try broader queries or alternative terms</strategy>
      <strategy>If execute_command fails, check output and adjust command</strategy>
      <strategy>Never proceed with dependent operations until confirming success</strategy>
    </strategies>
  </rule>

  <rule id="tools-7">
    <title>Path Conventions</title>
    <description>Use correct path conventions.</description>
    <conventions>
      <item>All paths are relative to workspace root</item>
      <item>Do not use ~ or $HOME</item>
      <item>Use forward slashes (/) regardless of OS</item>
      <item>Check environment_details for current workspace</item>
    </conventions>
  </rule>
</custom_rules>
