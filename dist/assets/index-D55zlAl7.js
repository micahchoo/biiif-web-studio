function jC(e,t){for(var n=0;n<t.length;n++){const i=t[n];if(typeof i!="string"&&!Array.isArray(i)){for(const l in i)if(l!=="default"&&!(l in e)){const o=Object.getOwnPropertyDescriptor(i,l);o&&Object.defineProperty(e,l,o.get?o:{enumerable:!0,get:()=>i[l]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function n(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(l){if(l.ep)return;l.ep=!0;const o=n(l);fetch(l.href,o)}})();var qa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wu(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Kf={exports:{}},Nl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eb;function EC(){if(eb)return Nl;eb=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(i,l,o){var u=null;if(o!==void 0&&(u=""+o),l.key!==void 0&&(u=""+l.key),"key"in l){o={};for(var d in l)d!=="key"&&(o[d]=l[d])}else o=l;return l=o.ref,{$$typeof:e,type:i,key:u,ref:l!==void 0?l:null,props:o}}return Nl.Fragment=t,Nl.jsx=n,Nl.jsxs=n,Nl}var tb;function AC(){return tb||(tb=1,Kf.exports=EC()),Kf.exports}var a=AC(),Xf={exports:{}},ot={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nb;function TC(){if(nb)return ot;nb=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),y=Symbol.iterator;function x(O){return O===null||typeof O!="object"?null:(O=y&&O[y]||O["@@iterator"],typeof O=="function"?O:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,j={};function C(O,B,Y){this.props=O,this.context=B,this.refs=j,this.updater=Y||v}C.prototype.isReactComponent={},C.prototype.setState=function(O,B){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,B,"setState")},C.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function A(){}A.prototype=C.prototype;function _(O,B,Y){this.props=O,this.context=B,this.refs=j,this.updater=Y||v}var T=_.prototype=new A;T.constructor=_,N(T,C.prototype),T.isPureReactComponent=!0;var L=Array.isArray;function H(){}var k={H:null,A:null,T:null,S:null},R=Object.prototype.hasOwnProperty;function z(O,B,Y){var X=Y.ref;return{$$typeof:e,type:O,key:B,ref:X!==void 0?X:null,props:Y}}function P(O,B){return z(O.type,B,O.props)}function K(O){return typeof O=="object"&&O!==null&&O.$$typeof===e}function I(O){var B={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(Y){return B[Y]})}var D=/\/+/g;function E(O,B){return typeof O=="object"&&O!==null&&O.key!=null?I(""+O.key):B.toString(36)}function q(O){switch(O.status){case"fulfilled":return O.value;case"rejected":throw O.reason;default:switch(typeof O.status=="string"?O.then(H,H):(O.status="pending",O.then(function(B){O.status==="pending"&&(O.status="fulfilled",O.value=B)},function(B){O.status==="pending"&&(O.status="rejected",O.reason=B)})),O.status){case"fulfilled":return O.value;case"rejected":throw O.reason}}throw O}function W(O,B,Y,X,Q){var ue=typeof O;(ue==="undefined"||ue==="boolean")&&(O=null);var be=!1;if(O===null)be=!0;else switch(ue){case"bigint":case"string":case"number":be=!0;break;case"object":switch(O.$$typeof){case e:case t:be=!0;break;case p:return be=O._init,W(be(O._payload),B,Y,X,Q)}}if(be)return Q=Q(O),be=X===""?"."+E(O,0):X,L(Q)?(Y="",be!=null&&(Y=be.replace(D,"$&/")+"/"),W(Q,B,Y,"",function(le){return le})):Q!=null&&(K(Q)&&(Q=P(Q,Y+(Q.key==null||O&&O.key===Q.key?"":(""+Q.key).replace(D,"$&/")+"/")+be)),B.push(Q)),1;be=0;var de=X===""?".":X+":";if(L(O))for(var ye=0;ye<O.length;ye++)X=O[ye],ue=de+E(X,ye),be+=W(X,B,Y,ue,Q);else if(ye=x(O),typeof ye=="function")for(O=ye.call(O),ye=0;!(X=O.next()).done;)X=X.value,ue=de+E(X,ye++),be+=W(X,B,Y,ue,Q);else if(ue==="object"){if(typeof O.then=="function")return W(q(O),B,Y,X,Q);throw B=String(O),Error("Objects are not valid as a React child (found: "+(B==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":B)+"). If you meant to render a collection of children, use an array instead.")}return be}function G(O,B,Y){if(O==null)return O;var X=[],Q=0;return W(O,X,"","",function(ue){return B.call(Y,ue,Q++)}),X}function te(O){if(O._status===-1){var B=O._result;B=B(),B.then(function(Y){(O._status===0||O._status===-1)&&(O._status=1,O._result=Y)},function(Y){(O._status===0||O._status===-1)&&(O._status=2,O._result=Y)}),O._status===-1&&(O._status=0,O._result=B)}if(O._status===1)return O._result.default;throw O._result}var U=typeof reportError=="function"?reportError:function(O){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var B=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof O=="object"&&O!==null&&typeof O.message=="string"?String(O.message):String(O),error:O});if(!window.dispatchEvent(B))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",O);return}console.error(O)},V={map:G,forEach:function(O,B,Y){G(O,function(){B.apply(this,arguments)},Y)},count:function(O){var B=0;return G(O,function(){B++}),B},toArray:function(O){return G(O,function(B){return B})||[]},only:function(O){if(!K(O))throw Error("React.Children.only expected to receive a single React element child.");return O}};return ot.Activity=g,ot.Children=V,ot.Component=C,ot.Fragment=n,ot.Profiler=l,ot.PureComponent=_,ot.StrictMode=i,ot.Suspense=m,ot.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,ot.__COMPILER_RUNTIME={__proto__:null,c:function(O){return k.H.useMemoCache(O)}},ot.cache=function(O){return function(){return O.apply(null,arguments)}},ot.cacheSignal=function(){return null},ot.cloneElement=function(O,B,Y){if(O==null)throw Error("The argument must be a React element, but you passed "+O+".");var X=N({},O.props),Q=O.key;if(B!=null)for(ue in B.key!==void 0&&(Q=""+B.key),B)!R.call(B,ue)||ue==="key"||ue==="__self"||ue==="__source"||ue==="ref"&&B.ref===void 0||(X[ue]=B[ue]);var ue=arguments.length-2;if(ue===1)X.children=Y;else if(1<ue){for(var be=Array(ue),de=0;de<ue;de++)be[de]=arguments[de+2];X.children=be}return z(O.type,Q,X)},ot.createContext=function(O){return O={$$typeof:u,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null},O.Provider=O,O.Consumer={$$typeof:o,_context:O},O},ot.createElement=function(O,B,Y){var X,Q={},ue=null;if(B!=null)for(X in B.key!==void 0&&(ue=""+B.key),B)R.call(B,X)&&X!=="key"&&X!=="__self"&&X!=="__source"&&(Q[X]=B[X]);var be=arguments.length-2;if(be===1)Q.children=Y;else if(1<be){for(var de=Array(be),ye=0;ye<be;ye++)de[ye]=arguments[ye+2];Q.children=de}if(O&&O.defaultProps)for(X in be=O.defaultProps,be)Q[X]===void 0&&(Q[X]=be[X]);return z(O,ue,Q)},ot.createRef=function(){return{current:null}},ot.forwardRef=function(O){return{$$typeof:d,render:O}},ot.isValidElement=K,ot.lazy=function(O){return{$$typeof:p,_payload:{_status:-1,_result:O},_init:te}},ot.memo=function(O,B){return{$$typeof:h,type:O,compare:B===void 0?null:B}},ot.startTransition=function(O){var B=k.T,Y={};k.T=Y;try{var X=O(),Q=k.S;Q!==null&&Q(Y,X),typeof X=="object"&&X!==null&&typeof X.then=="function"&&X.then(H,U)}catch(ue){U(ue)}finally{B!==null&&Y.types!==null&&(B.types=Y.types),k.T=B}},ot.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},ot.use=function(O){return k.H.use(O)},ot.useActionState=function(O,B,Y){return k.H.useActionState(O,B,Y)},ot.useCallback=function(O,B){return k.H.useCallback(O,B)},ot.useContext=function(O){return k.H.useContext(O)},ot.useDebugValue=function(){},ot.useDeferredValue=function(O,B){return k.H.useDeferredValue(O,B)},ot.useEffect=function(O,B){return k.H.useEffect(O,B)},ot.useEffectEvent=function(O){return k.H.useEffectEvent(O)},ot.useId=function(){return k.H.useId()},ot.useImperativeHandle=function(O,B,Y){return k.H.useImperativeHandle(O,B,Y)},ot.useInsertionEffect=function(O,B){return k.H.useInsertionEffect(O,B)},ot.useLayoutEffect=function(O,B){return k.H.useLayoutEffect(O,B)},ot.useMemo=function(O,B){return k.H.useMemo(O,B)},ot.useOptimistic=function(O,B){return k.H.useOptimistic(O,B)},ot.useReducer=function(O,B,Y){return k.H.useReducer(O,B,Y)},ot.useRef=function(O){return k.H.useRef(O)},ot.useState=function(O){return k.H.useState(O)},ot.useSyncExternalStore=function(O,B,Y){return k.H.useSyncExternalStore(O,B,Y)},ot.useTransition=function(){return k.H.useTransition()},ot.version="19.2.3",ot}var sb;function Ym(){return sb||(sb=1,Xf.exports=TC()),Xf.exports}var S=Ym();const An=wu(S);var Zf={exports:{}},Sl={},Jf={exports:{}},Qf={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ab;function _C(){return ab||(ab=1,(function(e){function t(W,G){var te=W.length;W.push(G);e:for(;0<te;){var U=te-1>>>1,V=W[U];if(0<l(V,G))W[U]=G,W[te]=V,te=U;else break e}}function n(W){return W.length===0?null:W[0]}function i(W){if(W.length===0)return null;var G=W[0],te=W.pop();if(te!==G){W[0]=te;e:for(var U=0,V=W.length,O=V>>>1;U<O;){var B=2*(U+1)-1,Y=W[B],X=B+1,Q=W[X];if(0>l(Y,te))X<V&&0>l(Q,Y)?(W[U]=Q,W[X]=te,U=X):(W[U]=Y,W[B]=te,U=B);else if(X<V&&0>l(Q,te))W[U]=Q,W[X]=te,U=X;else break e}}return G}function l(W,G){var te=W.sortIndex-G.sortIndex;return te!==0?te:W.id-G.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var u=Date,d=u.now();e.unstable_now=function(){return u.now()-d}}var m=[],h=[],p=1,g=null,y=3,x=!1,v=!1,N=!1,j=!1,C=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;function T(W){for(var G=n(h);G!==null;){if(G.callback===null)i(h);else if(G.startTime<=W)i(h),G.sortIndex=G.expirationTime,t(m,G);else break;G=n(h)}}function L(W){if(N=!1,T(W),!v)if(n(m)!==null)v=!0,H||(H=!0,I());else{var G=n(h);G!==null&&q(L,G.startTime-W)}}var H=!1,k=-1,R=5,z=-1;function P(){return j?!0:!(e.unstable_now()-z<R)}function K(){if(j=!1,H){var W=e.unstable_now();z=W;var G=!0;try{e:{v=!1,N&&(N=!1,A(k),k=-1),x=!0;var te=y;try{t:{for(T(W),g=n(m);g!==null&&!(g.expirationTime>W&&P());){var U=g.callback;if(typeof U=="function"){g.callback=null,y=g.priorityLevel;var V=U(g.expirationTime<=W);if(W=e.unstable_now(),typeof V=="function"){g.callback=V,T(W),G=!0;break t}g===n(m)&&i(m),T(W)}else i(m);g=n(m)}if(g!==null)G=!0;else{var O=n(h);O!==null&&q(L,O.startTime-W),G=!1}}break e}finally{g=null,y=te,x=!1}G=void 0}}finally{G?I():H=!1}}}var I;if(typeof _=="function")I=function(){_(K)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,E=D.port2;D.port1.onmessage=K,I=function(){E.postMessage(null)}}else I=function(){C(K,0)};function q(W,G){k=C(function(){W(e.unstable_now())},G)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(W){W.callback=null},e.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<W?Math.floor(1e3/W):5},e.unstable_getCurrentPriorityLevel=function(){return y},e.unstable_next=function(W){switch(y){case 1:case 2:case 3:var G=3;break;default:G=y}var te=y;y=G;try{return W()}finally{y=te}},e.unstable_requestPaint=function(){j=!0},e.unstable_runWithPriority=function(W,G){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var te=y;y=W;try{return G()}finally{y=te}},e.unstable_scheduleCallback=function(W,G,te){var U=e.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?U+te:U):te=U,W){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=te+V,W={id:p++,callback:G,priorityLevel:W,startTime:te,expirationTime:V,sortIndex:-1},te>U?(W.sortIndex=te,t(h,W),n(m)===null&&W===n(h)&&(N?(A(k),k=-1):N=!0,q(L,te-U))):(W.sortIndex=V,t(m,W),v||x||(v=!0,H||(H=!0,I()))),W},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(W){var G=y;return function(){var te=y;y=G;try{return W.apply(this,arguments)}finally{y=te}}}})(Qf)),Qf}var ib;function kC(){return ib||(ib=1,Jf.exports=_C()),Jf.exports}var eh={exports:{}},Tn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rb;function OC(){if(rb)return Tn;rb=1;var e=Ym();function t(m){var h="https://react.dev/errors/"+m;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)h+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+m+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var i={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},l=Symbol.for("react.portal");function o(m,h,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:g==null?null:""+g,children:m,containerInfo:h,implementation:p}}var u=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(m,h){if(m==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Tn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Tn.createPortal=function(m,h){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(t(299));return o(m,h,null,p)},Tn.flushSync=function(m){var h=u.T,p=i.p;try{if(u.T=null,i.p=2,m)return m()}finally{u.T=h,i.p=p,i.d.f()}},Tn.preconnect=function(m,h){typeof m=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,i.d.C(m,h))},Tn.prefetchDNS=function(m){typeof m=="string"&&i.d.D(m)},Tn.preinit=function(m,h){if(typeof m=="string"&&h&&typeof h.as=="string"){var p=h.as,g=d(p,h.crossOrigin),y=typeof h.integrity=="string"?h.integrity:void 0,x=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;p==="style"?i.d.S(m,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:g,integrity:y,fetchPriority:x}):p==="script"&&i.d.X(m,{crossOrigin:g,integrity:y,fetchPriority:x,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Tn.preinitModule=function(m,h){if(typeof m=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var p=d(h.as,h.crossOrigin);i.d.M(m,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&i.d.M(m)},Tn.preload=function(m,h){if(typeof m=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var p=h.as,g=d(p,h.crossOrigin);i.d.L(m,p,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Tn.preloadModule=function(m,h){if(typeof m=="string")if(h){var p=d(h.as,h.crossOrigin);i.d.m(m,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else i.d.m(m)},Tn.requestFormReset=function(m){i.d.r(m)},Tn.unstable_batchedUpdates=function(m,h){return m(h)},Tn.useFormState=function(m,h,p){return u.H.useFormState(m,h,p)},Tn.useFormStatus=function(){return u.H.useHostTransitionStatus()},Tn.version="19.2.3",Tn}var lb;function IC(){if(lb)return eh.exports;lb=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),eh.exports=OC(),eh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ob;function DC(){if(ob)return Sl;ob=1;var e=kC(),t=Ym(),n=IC();function i(s){var r="https://react.dev/errors/"+s;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)r+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var r=s,c=s;if(s.alternate)for(;r.return;)r=r.return;else{s=r;do r=s,(r.flags&4098)!==0&&(c=r.return),s=r.return;while(s)}return r.tag===3?c:null}function u(s){if(s.tag===13){var r=s.memoizedState;if(r===null&&(s=s.alternate,s!==null&&(r=s.memoizedState)),r!==null)return r.dehydrated}return null}function d(s){if(s.tag===31){var r=s.memoizedState;if(r===null&&(s=s.alternate,s!==null&&(r=s.memoizedState)),r!==null)return r.dehydrated}return null}function m(s){if(o(s)!==s)throw Error(i(188))}function h(s){var r=s.alternate;if(!r){if(r=o(s),r===null)throw Error(i(188));return r!==s?null:s}for(var c=s,f=r;;){var b=c.return;if(b===null)break;var w=b.alternate;if(w===null){if(f=b.return,f!==null){c=f;continue}break}if(b.child===w.child){for(w=b.child;w;){if(w===c)return m(b),s;if(w===f)return m(b),r;w=w.sibling}throw Error(i(188))}if(c.return!==f.return)c=b,f=w;else{for(var M=!1,J=b.child;J;){if(J===c){M=!0,c=b,f=w;break}if(J===f){M=!0,f=b,c=w;break}J=J.sibling}if(!M){for(J=w.child;J;){if(J===c){M=!0,c=w,f=b;break}if(J===f){M=!0,f=w,c=b;break}J=J.sibling}if(!M)throw Error(i(189))}}if(c.alternate!==f)throw Error(i(190))}if(c.tag!==3)throw Error(i(188));return c.stateNode.current===c?s:r}function p(s){var r=s.tag;if(r===5||r===26||r===27||r===6)return s;for(s=s.child;s!==null;){if(r=p(s),r!==null)return r;s=s.sibling}return null}var g=Object.assign,y=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),A=Symbol.for("react.consumer"),_=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),z=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),K=Symbol.iterator;function I(s){return s===null||typeof s!="object"?null:(s=K&&s[K]||s["@@iterator"],typeof s=="function"?s:null)}var D=Symbol.for("react.client.reference");function E(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===D?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case N:return"Fragment";case C:return"Profiler";case j:return"StrictMode";case L:return"Suspense";case H:return"SuspenseList";case z:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case v:return"Portal";case _:return s.displayName||"Context";case A:return(s._context.displayName||"Context")+".Consumer";case T:var r=s.render;return s=s.displayName,s||(s=r.displayName||r.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case k:return r=s.displayName||null,r!==null?r:E(s.type)||"Memo";case R:r=s._payload,s=s._init;try{return E(s(r))}catch{}}return null}var q=Array.isArray,W=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},U=[],V=-1;function O(s){return{current:s}}function B(s){0>V||(s.current=U[V],U[V]=null,V--)}function Y(s,r){V++,U[V]=s.current,s.current=r}var X=O(null),Q=O(null),ue=O(null),be=O(null);function de(s,r){switch(Y(ue,r),Y(Q,s),Y(X,null),r.nodeType){case 9:case 11:s=(s=r.documentElement)&&(s=s.namespaceURI)?S0(s):0;break;default:if(s=r.tagName,r=r.namespaceURI)r=S0(r),s=C0(r,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}B(X),Y(X,s)}function ye(){B(X),B(Q),B(ue)}function le(s){s.memoizedState!==null&&Y(be,s);var r=X.current,c=C0(r,s.type);r!==c&&(Y(Q,s),Y(X,c))}function we(s){Q.current===s&&(B(X),B(Q)),be.current===s&&(B(be),bl._currentValue=te)}var He,Ke;function F(s){if(He===void 0)try{throw Error()}catch(c){var r=c.stack.trim().match(/\n( *(at )?)/);He=r&&r[1]||"",Ke=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+He+s+Ke}var me=!1;function he(s,r){if(!s||me)return"";me=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(r){var De=function(){throw Error()};if(Object.defineProperty(De.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(De,[])}catch(Ee){var Ne=Ee}Reflect.construct(s,[],De)}else{try{De.call()}catch(Ee){Ne=Ee}s.call(De.prototype)}}else{try{throw Error()}catch(Ee){Ne=Ee}(De=s())&&typeof De.catch=="function"&&De.catch(function(){})}}catch(Ee){if(Ee&&Ne&&typeof Ee.stack=="string")return[Ee.stack,Ne.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=f.DetermineComponentFrameRoot(),M=w[0],J=w[1];if(M&&J){var re=M.split(`
`),xe=J.split(`
`);for(b=f=0;f<re.length&&!re[f].includes("DetermineComponentFrameRoot");)f++;for(;b<xe.length&&!xe[b].includes("DetermineComponentFrameRoot");)b++;if(f===re.length||b===xe.length)for(f=re.length-1,b=xe.length-1;1<=f&&0<=b&&re[f]!==xe[b];)b--;for(;1<=f&&0<=b;f--,b--)if(re[f]!==xe[b]){if(f!==1||b!==1)do if(f--,b--,0>b||re[f]!==xe[b]){var ke=`
`+re[f].replace(" at new "," at ");return s.displayName&&ke.includes("<anonymous>")&&(ke=ke.replace("<anonymous>",s.displayName)),ke}while(1<=f&&0<=b);break}}}finally{me=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?F(c):""}function ee(s,r){switch(s.tag){case 26:case 27:case 5:return F(s.type);case 16:return F("Lazy");case 13:return s.child!==r&&r!==null?F("Suspense Fallback"):F("Suspense");case 19:return F("SuspenseList");case 0:case 15:return he(s.type,!1);case 11:return he(s.type.render,!1);case 1:return he(s.type,!0);case 31:return F("Activity");default:return""}}function Z(s){try{var r="",c=null;do r+=ee(s,c),c=s,s=s.return;while(s);return r}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var se=Object.prototype.hasOwnProperty,Te=e.unstable_scheduleCallback,_e=e.unstable_cancelCallback,ne=e.unstable_shouldYield,ge=e.unstable_requestPaint,Se=e.unstable_now,Ce=e.unstable_getCurrentPriorityLevel,Me=e.unstable_ImmediatePriority,Be=e.unstable_UserBlockingPriority,We=e.unstable_NormalPriority,qe=e.unstable_LowPriority,Ae=e.unstable_IdlePriority,$e=e.log,Qe=e.unstable_setDisableYieldValue,Ge=null,ve=null;function je(s){if(typeof $e=="function"&&Qe(s),ve&&typeof ve.setStrictMode=="function")try{ve.setStrictMode(Ge,s)}catch{}}var Ue=Math.clz32?Math.clz32:Oe,ft=Math.log,ie=Math.LN2;function Oe(s){return s>>>=0,s===0?32:31-(ft(s)/ie|0)|0}var ae=256,Fe=262144,Pe=4194304;function it(s){var r=s&42;if(r!==0)return r;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function rt(s,r,c){var f=s.pendingLanes;if(f===0)return 0;var b=0,w=s.suspendedLanes,M=s.pingedLanes;s=s.warmLanes;var J=f&134217727;return J!==0?(f=J&~w,f!==0?b=it(f):(M&=J,M!==0?b=it(M):c||(c=J&~s,c!==0&&(b=it(c))))):(J=f&~w,J!==0?b=it(J):M!==0?b=it(M):c||(c=f&~s,c!==0&&(b=it(c)))),b===0?0:r!==0&&r!==b&&(r&w)===0&&(w=b&-b,c=r&-r,w>=c||w===32&&(c&4194048)!==0)?r:b}function Ot(s,r){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&r)===0}function et(s,r){switch(s){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Et(){var s=Pe;return Pe<<=1,(Pe&62914560)===0&&(Pe=4194304),s}function Vt(s){for(var r=[],c=0;31>c;c++)r.push(s);return r}function pn(s,r){s.pendingLanes|=r,r!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function gn(s,r,c,f,b,w){var M=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var J=s.entanglements,re=s.expirationTimes,xe=s.hiddenUpdates;for(c=M&~c;0<c;){var ke=31-Ue(c),De=1<<ke;J[ke]=0,re[ke]=-1;var Ne=xe[ke];if(Ne!==null)for(xe[ke]=null,ke=0;ke<Ne.length;ke++){var Ee=Ne[ke];Ee!==null&&(Ee.lane&=-536870913)}c&=~De}f!==0&&an(s,f,0),w!==0&&b===0&&s.tag!==0&&(s.suspendedLanes|=w&~(M&~r))}function an(s,r,c){s.pendingLanes|=r,s.suspendedLanes&=~r;var f=31-Ue(r);s.entangledLanes|=r,s.entanglements[f]=s.entanglements[f]|1073741824|c&261930}function Kt(s,r){var c=s.entangledLanes|=r;for(s=s.entanglements;c;){var f=31-Ue(c),b=1<<f;b&r|s[f]&r&&(s[f]|=r),c&=~b}}function Je(s,r){var c=r&-r;return c=(c&42)!==0?1:Gt(c),(c&(s.suspendedLanes|r))!==0?0:c}function Gt(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function en(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Ut(){var s=G.p;return s!==0?s:(s=window.event,s===void 0?32:q0(s.type))}function Pn(s,r){var c=G.p;try{return G.p=s,r()}finally{G.p=c}}var rn=Math.random().toString(36).slice(2),Xt="__reactFiber$"+rn,It="__reactProps$"+rn,Ws="__reactContainer$"+rn,Ii="__reactEvents$"+rn,io="__reactListeners$"+rn,ro="__reactHandles$"+rn,lo="__reactResources$"+rn,Xe="__reactMarker$"+rn;function oe(s){delete s[Xt],delete s[It],delete s[Ii],delete s[io],delete s[ro]}function Re(s){var r=s[Xt];if(r)return r;for(var c=s.parentNode;c;){if(r=c[Ws]||c[Xt]){if(c=r.alternate,r.child!==null||c!==null&&c.child!==null)for(s=O0(s);s!==null;){if(c=s[Xt])return c;s=O0(s)}return r}s=c,c=s.parentNode}return null}function Ye(s){if(s=s[Xt]||s[Ws]){var r=s.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return s}return null}function At(s){var r=s.tag;if(r===5||r===26||r===27||r===6)return s.stateNode;throw Error(i(33))}function Yt(s){var r=s[lo];return r||(r=s[lo]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function mt(s){s[Xe]=!0}var wn=new Set,rs={};function $n(s,r){Is(s,r),Is(s+"Capture",r)}function Is(s,r){for(rs[s]=r,s=0;s<r.length;s++)wn.add(r[s])}var xn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Dr={},Lr={};function xN(s){return se.call(Lr,s)?!0:se.call(Dr,s)?!1:xn.test(s)?Lr[s]=!0:(Dr[s]=!0,!1)}function oo(s,r,c){if(xN(r))if(c===null)s.removeAttribute(r);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(r);return;case"boolean":var f=r.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){s.removeAttribute(r);return}}s.setAttribute(r,""+c)}}function co(s,r,c){if(c===null)s.removeAttribute(r);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(r);return}s.setAttribute(r,""+c)}}function Gs(s,r,c,f){if(f===null)s.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(r,c,""+f)}}function ls(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function pp(s){var r=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function bN(s,r,c){var f=Object.getOwnPropertyDescriptor(s.constructor.prototype,r);if(!s.hasOwnProperty(r)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var b=f.get,w=f.set;return Object.defineProperty(s,r,{configurable:!0,get:function(){return b.call(this)},set:function(M){c=""+M,w.call(this,M)}}),Object.defineProperty(s,r,{enumerable:f.enumerable}),{getValue:function(){return c},setValue:function(M){c=""+M},stopTracking:function(){s._valueTracker=null,delete s[r]}}}}function Uu(s){if(!s._valueTracker){var r=pp(s)?"checked":"value";s._valueTracker=bN(s,r,""+s[r])}}function gp(s){if(!s)return!1;var r=s._valueTracker;if(!r)return!0;var c=r.getValue(),f="";return s&&(f=pp(s)?s.checked?"true":"false":s.value),s=f,s!==c?(r.setValue(s),!0):!1}function uo(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var yN=/[\n"\\]/g;function os(s){return s.replace(yN,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function Bu(s,r,c,f,b,w,M,J){s.name="",M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?s.type=M:s.removeAttribute("type"),r!=null?M==="number"?(r===0&&s.value===""||s.value!=r)&&(s.value=""+ls(r)):s.value!==""+ls(r)&&(s.value=""+ls(r)):M!=="submit"&&M!=="reset"||s.removeAttribute("value"),r!=null?Hu(s,M,ls(r)):c!=null?Hu(s,M,ls(c)):f!=null&&s.removeAttribute("value"),b==null&&w!=null&&(s.defaultChecked=!!w),b!=null&&(s.checked=b&&typeof b!="function"&&typeof b!="symbol"),J!=null&&typeof J!="function"&&typeof J!="symbol"&&typeof J!="boolean"?s.name=""+ls(J):s.removeAttribute("name")}function xp(s,r,c,f,b,w,M,J){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(s.type=w),r!=null||c!=null){if(!(w!=="submit"&&w!=="reset"||r!=null)){Uu(s);return}c=c!=null?""+ls(c):"",r=r!=null?""+ls(r):c,J||r===s.value||(s.value=r),s.defaultValue=r}f=f??b,f=typeof f!="function"&&typeof f!="symbol"&&!!f,s.checked=J?s.checked:!!f,s.defaultChecked=!!f,M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(s.name=M),Uu(s)}function Hu(s,r,c){r==="number"&&uo(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function Di(s,r,c,f){if(s=s.options,r){r={};for(var b=0;b<c.length;b++)r["$"+c[b]]=!0;for(c=0;c<s.length;c++)b=r.hasOwnProperty("$"+s[c].value),s[c].selected!==b&&(s[c].selected=b),b&&f&&(s[c].defaultSelected=!0)}else{for(c=""+ls(c),r=null,b=0;b<s.length;b++){if(s[b].value===c){s[b].selected=!0,f&&(s[b].defaultSelected=!0);return}r!==null||s[b].disabled||(r=s[b])}r!==null&&(r.selected=!0)}}function bp(s,r,c){if(r!=null&&(r=""+ls(r),r!==s.value&&(s.value=r),c==null)){s.defaultValue!==r&&(s.defaultValue=r);return}s.defaultValue=c!=null?""+ls(c):""}function yp(s,r,c,f){if(r==null){if(f!=null){if(c!=null)throw Error(i(92));if(q(f)){if(1<f.length)throw Error(i(93));f=f[0]}c=f}c==null&&(c=""),r=c}c=ls(r),s.defaultValue=c,f=s.textContent,f===c&&f!==""&&f!==null&&(s.value=f),Uu(s)}function Li(s,r){if(r){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=r;return}}s.textContent=r}var vN=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function vp(s,r,c){var f=r.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?s.setProperty(r,""):r==="float"?s.cssFloat="":s[r]="":f?s.setProperty(r,c):typeof c!="number"||c===0||vN.has(r)?r==="float"?s.cssFloat=c:s[r]=(""+c).trim():s[r]=c+"px"}function wp(s,r,c){if(r!=null&&typeof r!="object")throw Error(i(62));if(s=s.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||r!=null&&r.hasOwnProperty(f)||(f.indexOf("--")===0?s.setProperty(f,""):f==="float"?s.cssFloat="":s[f]="");for(var b in r)f=r[b],r.hasOwnProperty(b)&&c[b]!==f&&vp(s,b,f)}else for(var w in r)r.hasOwnProperty(w)&&vp(s,w,r[w])}function Wu(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wN=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),NN=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function fo(s){return NN.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Ys(){}var Gu=null;function Yu(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Ri=null,Mi=null;function Np(s){var r=Ye(s);if(r&&(s=r.stateNode)){var c=s[It]||null;e:switch(s=r.stateNode,r.type){case"input":if(Bu(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),r=c.name,c.type==="radio"&&r!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+os(""+r)+'"][type="radio"]'),r=0;r<c.length;r++){var f=c[r];if(f!==s&&f.form===s.form){var b=f[It]||null;if(!b)throw Error(i(90));Bu(f,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(r=0;r<c.length;r++)f=c[r],f.form===s.form&&gp(f)}break e;case"textarea":bp(s,c.value,c.defaultValue);break e;case"select":r=c.value,r!=null&&Di(s,!!c.multiple,r,!1)}}}var qu=!1;function Sp(s,r,c){if(qu)return s(r,c);qu=!0;try{var f=s(r);return f}finally{if(qu=!1,(Ri!==null||Mi!==null)&&(Qo(),Ri&&(r=Ri,s=Mi,Mi=Ri=null,Np(r),s)))for(r=0;r<s.length;r++)Np(s[r])}}function Rr(s,r){var c=s.stateNode;if(c===null)return null;var f=c[It]||null;if(f===null)return null;c=f[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(s=s.type,f=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!f;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(i(231,r,typeof c));return c}var qs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Vu=!1;if(qs)try{var Mr={};Object.defineProperty(Mr,"passive",{get:function(){Vu=!0}}),window.addEventListener("test",Mr,Mr),window.removeEventListener("test",Mr,Mr)}catch{Vu=!1}var va=null,Ku=null,ho=null;function Cp(){if(ho)return ho;var s,r=Ku,c=r.length,f,b="value"in va?va.value:va.textContent,w=b.length;for(s=0;s<c&&r[s]===b[s];s++);var M=c-s;for(f=1;f<=M&&r[c-f]===b[w-f];f++);return ho=b.slice(s,1<f?1-f:void 0)}function mo(s){var r=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&r===13&&(s=13)):s=r,s===10&&(s=13),32<=s||s===13?s:0}function po(){return!0}function jp(){return!1}function zn(s){function r(c,f,b,w,M){this._reactName=c,this._targetInst=b,this.type=f,this.nativeEvent=w,this.target=M,this.currentTarget=null;for(var J in s)s.hasOwnProperty(J)&&(c=s[J],this[J]=c?c(w):w[J]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?po:jp,this.isPropagationStopped=jp,this}return g(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=po)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=po)},persist:function(){},isPersistent:po}),r}var si={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},go=zn(si),Fr=g({},si,{view:0,detail:0}),SN=zn(Fr),Xu,Zu,Pr,xo=g({},Fr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qu,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Pr&&(Pr&&s.type==="mousemove"?(Xu=s.screenX-Pr.screenX,Zu=s.screenY-Pr.screenY):Zu=Xu=0,Pr=s),Xu)},movementY:function(s){return"movementY"in s?s.movementY:Zu}}),Ep=zn(xo),CN=g({},xo,{dataTransfer:0}),jN=zn(CN),EN=g({},Fr,{relatedTarget:0}),Ju=zn(EN),AN=g({},si,{animationName:0,elapsedTime:0,pseudoElement:0}),TN=zn(AN),_N=g({},si,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),kN=zn(_N),ON=g({},si,{data:0}),Ap=zn(ON),IN={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},DN={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},LN={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function RN(s){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(s):(s=LN[s])?!!r[s]:!1}function Qu(){return RN}var MN=g({},Fr,{key:function(s){if(s.key){var r=IN[s.key]||s.key;if(r!=="Unidentified")return r}return s.type==="keypress"?(s=mo(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?DN[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qu,charCode:function(s){return s.type==="keypress"?mo(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?mo(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),FN=zn(MN),PN=g({},xo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tp=zn(PN),$N=g({},Fr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qu}),zN=zn($N),UN=g({},si,{propertyName:0,elapsedTime:0,pseudoElement:0}),BN=zn(UN),HN=g({},xo,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),WN=zn(HN),GN=g({},si,{newState:0,oldState:0}),YN=zn(GN),qN=[9,13,27,32],ed=qs&&"CompositionEvent"in window,$r=null;qs&&"documentMode"in document&&($r=document.documentMode);var VN=qs&&"TextEvent"in window&&!$r,_p=qs&&(!ed||$r&&8<$r&&11>=$r),kp=" ",Op=!1;function Ip(s,r){switch(s){case"keyup":return qN.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Dp(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Fi=!1;function KN(s,r){switch(s){case"compositionend":return Dp(r);case"keypress":return r.which!==32?null:(Op=!0,kp);case"textInput":return s=r.data,s===kp&&Op?null:s;default:return null}}function XN(s,r){if(Fi)return s==="compositionend"||!ed&&Ip(s,r)?(s=Cp(),ho=Ku=va=null,Fi=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return _p&&r.locale!=="ko"?null:r.data;default:return null}}var ZN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lp(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r==="input"?!!ZN[s.type]:r==="textarea"}function Rp(s,r,c,f){Ri?Mi?Mi.push(f):Mi=[f]:Ri=f,r=rc(r,"onChange"),0<r.length&&(c=new go("onChange","change",null,c,f),s.push({event:c,listeners:r}))}var zr=null,Ur=null;function JN(s){x0(s,0)}function bo(s){var r=At(s);if(gp(r))return s}function Mp(s,r){if(s==="change")return r}var Fp=!1;if(qs){var td;if(qs){var nd="oninput"in document;if(!nd){var Pp=document.createElement("div");Pp.setAttribute("oninput","return;"),nd=typeof Pp.oninput=="function"}td=nd}else td=!1;Fp=td&&(!document.documentMode||9<document.documentMode)}function $p(){zr&&(zr.detachEvent("onpropertychange",zp),Ur=zr=null)}function zp(s){if(s.propertyName==="value"&&bo(Ur)){var r=[];Rp(r,Ur,s,Yu(s)),Sp(JN,r)}}function QN(s,r,c){s==="focusin"?($p(),zr=r,Ur=c,zr.attachEvent("onpropertychange",zp)):s==="focusout"&&$p()}function eS(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return bo(Ur)}function tS(s,r){if(s==="click")return bo(r)}function nS(s,r){if(s==="input"||s==="change")return bo(r)}function sS(s,r){return s===r&&(s!==0||1/s===1/r)||s!==s&&r!==r}var Jn=typeof Object.is=="function"?Object.is:sS;function Br(s,r){if(Jn(s,r))return!0;if(typeof s!="object"||s===null||typeof r!="object"||r===null)return!1;var c=Object.keys(s),f=Object.keys(r);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var b=c[f];if(!se.call(r,b)||!Jn(s[b],r[b]))return!1}return!0}function Up(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Bp(s,r){var c=Up(s);s=0;for(var f;c;){if(c.nodeType===3){if(f=s+c.textContent.length,s<=r&&f>=r)return{node:c,offset:r-s};s=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Up(c)}}function Hp(s,r){return s&&r?s===r?!0:s&&s.nodeType===3?!1:r&&r.nodeType===3?Hp(s,r.parentNode):"contains"in s?s.contains(r):s.compareDocumentPosition?!!(s.compareDocumentPosition(r)&16):!1:!1}function Wp(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var r=uo(s.document);r instanceof s.HTMLIFrameElement;){try{var c=typeof r.contentWindow.location.href=="string"}catch{c=!1}if(c)s=r.contentWindow;else break;r=uo(s.document)}return r}function sd(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r&&(r==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||r==="textarea"||s.contentEditable==="true")}var aS=qs&&"documentMode"in document&&11>=document.documentMode,Pi=null,ad=null,Hr=null,id=!1;function Gp(s,r,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;id||Pi==null||Pi!==uo(f)||(f=Pi,"selectionStart"in f&&sd(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Hr&&Br(Hr,f)||(Hr=f,f=rc(ad,"onSelect"),0<f.length&&(r=new go("onSelect","select",null,r,c),s.push({event:r,listeners:f}),r.target=Pi)))}function ai(s,r){var c={};return c[s.toLowerCase()]=r.toLowerCase(),c["Webkit"+s]="webkit"+r,c["Moz"+s]="moz"+r,c}var $i={animationend:ai("Animation","AnimationEnd"),animationiteration:ai("Animation","AnimationIteration"),animationstart:ai("Animation","AnimationStart"),transitionrun:ai("Transition","TransitionRun"),transitionstart:ai("Transition","TransitionStart"),transitioncancel:ai("Transition","TransitionCancel"),transitionend:ai("Transition","TransitionEnd")},rd={},Yp={};qs&&(Yp=document.createElement("div").style,"AnimationEvent"in window||(delete $i.animationend.animation,delete $i.animationiteration.animation,delete $i.animationstart.animation),"TransitionEvent"in window||delete $i.transitionend.transition);function ii(s){if(rd[s])return rd[s];if(!$i[s])return s;var r=$i[s],c;for(c in r)if(r.hasOwnProperty(c)&&c in Yp)return rd[s]=r[c];return s}var qp=ii("animationend"),Vp=ii("animationiteration"),Kp=ii("animationstart"),iS=ii("transitionrun"),rS=ii("transitionstart"),lS=ii("transitioncancel"),Xp=ii("transitionend"),Zp=new Map,ld="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ld.push("scrollEnd");function Ns(s,r){Zp.set(s,r),$n(r,[s])}var yo=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},cs=[],zi=0,od=0;function vo(){for(var s=zi,r=od=zi=0;r<s;){var c=cs[r];cs[r++]=null;var f=cs[r];cs[r++]=null;var b=cs[r];cs[r++]=null;var w=cs[r];if(cs[r++]=null,f!==null&&b!==null){var M=f.pending;M===null?b.next=b:(b.next=M.next,M.next=b),f.pending=b}w!==0&&Jp(c,b,w)}}function wo(s,r,c,f){cs[zi++]=s,cs[zi++]=r,cs[zi++]=c,cs[zi++]=f,od|=f,s.lanes|=f,s=s.alternate,s!==null&&(s.lanes|=f)}function cd(s,r,c,f){return wo(s,r,c,f),No(s)}function ri(s,r){return wo(s,null,null,r),No(s)}function Jp(s,r,c){s.lanes|=c;var f=s.alternate;f!==null&&(f.lanes|=c);for(var b=!1,w=s.return;w!==null;)w.childLanes|=c,f=w.alternate,f!==null&&(f.childLanes|=c),w.tag===22&&(s=w.stateNode,s===null||s._visibility&1||(b=!0)),s=w,w=w.return;return s.tag===3?(w=s.stateNode,b&&r!==null&&(b=31-Ue(c),s=w.hiddenUpdates,f=s[b],f===null?s[b]=[r]:f.push(r),r.lane=c|536870912),w):null}function No(s){if(50<dl)throw dl=0,yf=null,Error(i(185));for(var r=s.return;r!==null;)s=r,r=s.return;return s.tag===3?s.stateNode:null}var Ui={};function oS(s,r,c,f){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qn(s,r,c,f){return new oS(s,r,c,f)}function ud(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Vs(s,r){var c=s.alternate;return c===null?(c=Qn(s.tag,r,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=r,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,r=s.dependencies,c.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function Qp(s,r){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=r,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,r=c.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),s}function So(s,r,c,f,b,w){var M=0;if(f=s,typeof s=="function")ud(s)&&(M=1);else if(typeof s=="string")M=hC(s,c,X.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case z:return s=Qn(31,c,r,b),s.elementType=z,s.lanes=w,s;case N:return li(c.children,b,w,r);case j:M=8,b|=24;break;case C:return s=Qn(12,c,r,b|2),s.elementType=C,s.lanes=w,s;case L:return s=Qn(13,c,r,b),s.elementType=L,s.lanes=w,s;case H:return s=Qn(19,c,r,b),s.elementType=H,s.lanes=w,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case _:M=10;break e;case A:M=9;break e;case T:M=11;break e;case k:M=14;break e;case R:M=16,f=null;break e}M=29,c=Error(i(130,s===null?"null":typeof s,"")),f=null}return r=Qn(M,c,r,b),r.elementType=s,r.type=f,r.lanes=w,r}function li(s,r,c,f){return s=Qn(7,s,f,r),s.lanes=c,s}function dd(s,r,c){return s=Qn(6,s,null,r),s.lanes=c,s}function eg(s){var r=Qn(18,null,null,0);return r.stateNode=s,r}function fd(s,r,c){return r=Qn(4,s.children!==null?s.children:[],s.key,r),r.lanes=c,r.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},r}var tg=new WeakMap;function us(s,r){if(typeof s=="object"&&s!==null){var c=tg.get(s);return c!==void 0?c:(r={value:s,source:r,stack:Z(r)},tg.set(s,r),r)}return{value:s,source:r,stack:Z(r)}}var Bi=[],Hi=0,Co=null,Wr=0,ds=[],fs=0,wa=null,Ds=1,Ls="";function Ks(s,r){Bi[Hi++]=Wr,Bi[Hi++]=Co,Co=s,Wr=r}function ng(s,r,c){ds[fs++]=Ds,ds[fs++]=Ls,ds[fs++]=wa,wa=s;var f=Ds;s=Ls;var b=32-Ue(f)-1;f&=~(1<<b),c+=1;var w=32-Ue(r)+b;if(30<w){var M=b-b%5;w=(f&(1<<M)-1).toString(32),f>>=M,b-=M,Ds=1<<32-Ue(r)+b|c<<b|f,Ls=w+s}else Ds=1<<w|c<<b|f,Ls=s}function hd(s){s.return!==null&&(Ks(s,1),ng(s,1,0))}function md(s){for(;s===Co;)Co=Bi[--Hi],Bi[Hi]=null,Wr=Bi[--Hi],Bi[Hi]=null;for(;s===wa;)wa=ds[--fs],ds[fs]=null,Ls=ds[--fs],ds[fs]=null,Ds=ds[--fs],ds[fs]=null}function sg(s,r){ds[fs++]=Ds,ds[fs++]=Ls,ds[fs++]=wa,Ds=r.id,Ls=r.overflow,wa=s}var Nn=null,Pt=null,vt=!1,Na=null,hs=!1,pd=Error(i(519));function Sa(s){var r=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Gr(us(r,s)),pd}function ag(s){var r=s.stateNode,c=s.type,f=s.memoizedProps;switch(r[Xt]=s,r[It]=f,c){case"dialog":xt("cancel",r),xt("close",r);break;case"iframe":case"object":case"embed":xt("load",r);break;case"video":case"audio":for(c=0;c<hl.length;c++)xt(hl[c],r);break;case"source":xt("error",r);break;case"img":case"image":case"link":xt("error",r),xt("load",r);break;case"details":xt("toggle",r);break;case"input":xt("invalid",r),xp(r,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":xt("invalid",r);break;case"textarea":xt("invalid",r),yp(r,f.value,f.defaultValue,f.children)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||r.textContent===""+c||f.suppressHydrationWarning===!0||w0(r.textContent,c)?(f.popover!=null&&(xt("beforetoggle",r),xt("toggle",r)),f.onScroll!=null&&xt("scroll",r),f.onScrollEnd!=null&&xt("scrollend",r),f.onClick!=null&&(r.onclick=Ys),r=!0):r=!1,r||Sa(s,!0)}function ig(s){for(Nn=s.return;Nn;)switch(Nn.tag){case 5:case 31:case 13:hs=!1;return;case 27:case 3:hs=!0;return;default:Nn=Nn.return}}function Wi(s){if(s!==Nn)return!1;if(!vt)return ig(s),vt=!0,!1;var r=s.tag,c;if((c=r!==3&&r!==27)&&((c=r===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||Lf(s.type,s.memoizedProps)),c=!c),c&&Pt&&Sa(s),ig(s),r===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));Pt=k0(s)}else if(r===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));Pt=k0(s)}else r===27?(r=Pt,Fa(s.type)?(s=$f,$f=null,Pt=s):Pt=r):Pt=Nn?ps(s.stateNode.nextSibling):null;return!0}function oi(){Pt=Nn=null,vt=!1}function gd(){var s=Na;return s!==null&&(Wn===null?Wn=s:Wn.push.apply(Wn,s),Na=null),s}function Gr(s){Na===null?Na=[s]:Na.push(s)}var xd=O(null),ci=null,Xs=null;function Ca(s,r,c){Y(xd,r._currentValue),r._currentValue=c}function Zs(s){s._currentValue=xd.current,B(xd)}function bd(s,r,c){for(;s!==null;){var f=s.alternate;if((s.childLanes&r)!==r?(s.childLanes|=r,f!==null&&(f.childLanes|=r)):f!==null&&(f.childLanes&r)!==r&&(f.childLanes|=r),s===c)break;s=s.return}}function yd(s,r,c,f){var b=s.child;for(b!==null&&(b.return=s);b!==null;){var w=b.dependencies;if(w!==null){var M=b.child;w=w.firstContext;e:for(;w!==null;){var J=w;w=b;for(var re=0;re<r.length;re++)if(J.context===r[re]){w.lanes|=c,J=w.alternate,J!==null&&(J.lanes|=c),bd(w.return,c,s),f||(M=null);break e}w=J.next}}else if(b.tag===18){if(M=b.return,M===null)throw Error(i(341));M.lanes|=c,w=M.alternate,w!==null&&(w.lanes|=c),bd(M,c,s),M=null}else M=b.child;if(M!==null)M.return=b;else for(M=b;M!==null;){if(M===s){M=null;break}if(b=M.sibling,b!==null){b.return=M.return,M=b;break}M=M.return}b=M}}function Gi(s,r,c,f){s=null;for(var b=r,w=!1;b!==null;){if(!w){if((b.flags&524288)!==0)w=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var M=b.alternate;if(M===null)throw Error(i(387));if(M=M.memoizedProps,M!==null){var J=b.type;Jn(b.pendingProps.value,M.value)||(s!==null?s.push(J):s=[J])}}else if(b===be.current){if(M=b.alternate,M===null)throw Error(i(387));M.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(s!==null?s.push(bl):s=[bl])}b=b.return}s!==null&&yd(r,s,c,f),r.flags|=262144}function jo(s){for(s=s.firstContext;s!==null;){if(!Jn(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function ui(s){ci=s,Xs=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Sn(s){return rg(ci,s)}function Eo(s,r){return ci===null&&ui(s),rg(s,r)}function rg(s,r){var c=r._currentValue;if(r={context:r,memoizedValue:c,next:null},Xs===null){if(s===null)throw Error(i(308));Xs=r,s.dependencies={lanes:0,firstContext:r},s.flags|=524288}else Xs=Xs.next=r;return c}var cS=typeof AbortController<"u"?AbortController:function(){var s=[],r=this.signal={aborted:!1,addEventListener:function(c,f){s.push(f)}};this.abort=function(){r.aborted=!0,s.forEach(function(c){return c()})}},uS=e.unstable_scheduleCallback,dS=e.unstable_NormalPriority,ln={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function vd(){return{controller:new cS,data:new Map,refCount:0}}function Yr(s){s.refCount--,s.refCount===0&&uS(dS,function(){s.controller.abort()})}var qr=null,wd=0,Yi=0,qi=null;function fS(s,r){if(qr===null){var c=qr=[];wd=0,Yi=jf(),qi={status:"pending",value:void 0,then:function(f){c.push(f)}}}return wd++,r.then(lg,lg),r}function lg(){if(--wd===0&&qr!==null){qi!==null&&(qi.status="fulfilled");var s=qr;qr=null,Yi=0,qi=null;for(var r=0;r<s.length;r++)(0,s[r])()}}function hS(s,r){var c=[],f={status:"pending",value:null,reason:null,then:function(b){c.push(b)}};return s.then(function(){f.status="fulfilled",f.value=r;for(var b=0;b<c.length;b++)(0,c[b])(r)},function(b){for(f.status="rejected",f.reason=b,b=0;b<c.length;b++)(0,c[b])(void 0)}),f}var og=W.S;W.S=function(s,r){Gx=Se(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&fS(s,r),og!==null&&og(s,r)};var di=O(null);function Nd(){var s=di.current;return s!==null?s:Ft.pooledCache}function Ao(s,r){r===null?Y(di,di.current):Y(di,r.pool)}function cg(){var s=Nd();return s===null?null:{parent:ln._currentValue,pool:s}}var Vi=Error(i(460)),Sd=Error(i(474)),To=Error(i(542)),_o={then:function(){}};function ug(s){return s=s.status,s==="fulfilled"||s==="rejected"}function dg(s,r,c){switch(c=s[c],c===void 0?s.push(r):c!==r&&(r.then(Ys,Ys),r=c),r.status){case"fulfilled":return r.value;case"rejected":throw s=r.reason,hg(s),s;default:if(typeof r.status=="string")r.then(Ys,Ys);else{if(s=Ft,s!==null&&100<s.shellSuspendCounter)throw Error(i(482));s=r,s.status="pending",s.then(function(f){if(r.status==="pending"){var b=r;b.status="fulfilled",b.value=f}},function(f){if(r.status==="pending"){var b=r;b.status="rejected",b.reason=f}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw s=r.reason,hg(s),s}throw hi=r,Vi}}function fi(s){try{var r=s._init;return r(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(hi=c,Vi):c}}var hi=null;function fg(){if(hi===null)throw Error(i(459));var s=hi;return hi=null,s}function hg(s){if(s===Vi||s===To)throw Error(i(483))}var Ki=null,Vr=0;function ko(s){var r=Vr;return Vr+=1,Ki===null&&(Ki=[]),dg(Ki,s,r)}function Kr(s,r){r=r.props.ref,s.ref=r!==void 0?r:null}function Oo(s,r){throw r.$$typeof===y?Error(i(525)):(s=Object.prototype.toString.call(r),Error(i(31,s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)))}function mg(s){function r(fe,ce){if(s){var pe=fe.deletions;pe===null?(fe.deletions=[ce],fe.flags|=16):pe.push(ce)}}function c(fe,ce){if(!s)return null;for(;ce!==null;)r(fe,ce),ce=ce.sibling;return null}function f(fe){for(var ce=new Map;fe!==null;)fe.key!==null?ce.set(fe.key,fe):ce.set(fe.index,fe),fe=fe.sibling;return ce}function b(fe,ce){return fe=Vs(fe,ce),fe.index=0,fe.sibling=null,fe}function w(fe,ce,pe){return fe.index=pe,s?(pe=fe.alternate,pe!==null?(pe=pe.index,pe<ce?(fe.flags|=67108866,ce):pe):(fe.flags|=67108866,ce)):(fe.flags|=1048576,ce)}function M(fe){return s&&fe.alternate===null&&(fe.flags|=67108866),fe}function J(fe,ce,pe,Ie){return ce===null||ce.tag!==6?(ce=dd(pe,fe.mode,Ie),ce.return=fe,ce):(ce=b(ce,pe),ce.return=fe,ce)}function re(fe,ce,pe,Ie){var nt=pe.type;return nt===N?ke(fe,ce,pe.props.children,Ie,pe.key):ce!==null&&(ce.elementType===nt||typeof nt=="object"&&nt!==null&&nt.$$typeof===R&&fi(nt)===ce.type)?(ce=b(ce,pe.props),Kr(ce,pe),ce.return=fe,ce):(ce=So(pe.type,pe.key,pe.props,null,fe.mode,Ie),Kr(ce,pe),ce.return=fe,ce)}function xe(fe,ce,pe,Ie){return ce===null||ce.tag!==4||ce.stateNode.containerInfo!==pe.containerInfo||ce.stateNode.implementation!==pe.implementation?(ce=fd(pe,fe.mode,Ie),ce.return=fe,ce):(ce=b(ce,pe.children||[]),ce.return=fe,ce)}function ke(fe,ce,pe,Ie,nt){return ce===null||ce.tag!==7?(ce=li(pe,fe.mode,Ie,nt),ce.return=fe,ce):(ce=b(ce,pe),ce.return=fe,ce)}function De(fe,ce,pe){if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return ce=dd(""+ce,fe.mode,pe),ce.return=fe,ce;if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case x:return pe=So(ce.type,ce.key,ce.props,null,fe.mode,pe),Kr(pe,ce),pe.return=fe,pe;case v:return ce=fd(ce,fe.mode,pe),ce.return=fe,ce;case R:return ce=fi(ce),De(fe,ce,pe)}if(q(ce)||I(ce))return ce=li(ce,fe.mode,pe,null),ce.return=fe,ce;if(typeof ce.then=="function")return De(fe,ko(ce),pe);if(ce.$$typeof===_)return De(fe,Eo(fe,ce),pe);Oo(fe,ce)}return null}function Ne(fe,ce,pe,Ie){var nt=ce!==null?ce.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return nt!==null?null:J(fe,ce,""+pe,Ie);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case x:return pe.key===nt?re(fe,ce,pe,Ie):null;case v:return pe.key===nt?xe(fe,ce,pe,Ie):null;case R:return pe=fi(pe),Ne(fe,ce,pe,Ie)}if(q(pe)||I(pe))return nt!==null?null:ke(fe,ce,pe,Ie,null);if(typeof pe.then=="function")return Ne(fe,ce,ko(pe),Ie);if(pe.$$typeof===_)return Ne(fe,ce,Eo(fe,pe),Ie);Oo(fe,pe)}return null}function Ee(fe,ce,pe,Ie,nt){if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return fe=fe.get(pe)||null,J(ce,fe,""+Ie,nt);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case x:return fe=fe.get(Ie.key===null?pe:Ie.key)||null,re(ce,fe,Ie,nt);case v:return fe=fe.get(Ie.key===null?pe:Ie.key)||null,xe(ce,fe,Ie,nt);case R:return Ie=fi(Ie),Ee(fe,ce,pe,Ie,nt)}if(q(Ie)||I(Ie))return fe=fe.get(pe)||null,ke(ce,fe,Ie,nt,null);if(typeof Ie.then=="function")return Ee(fe,ce,pe,ko(Ie),nt);if(Ie.$$typeof===_)return Ee(fe,ce,pe,Eo(ce,Ie),nt);Oo(ce,Ie)}return null}function Ve(fe,ce,pe,Ie){for(var nt=null,St=null,Ze=ce,ht=ce=0,yt=null;Ze!==null&&ht<pe.length;ht++){Ze.index>ht?(yt=Ze,Ze=null):yt=Ze.sibling;var Ct=Ne(fe,Ze,pe[ht],Ie);if(Ct===null){Ze===null&&(Ze=yt);break}s&&Ze&&Ct.alternate===null&&r(fe,Ze),ce=w(Ct,ce,ht),St===null?nt=Ct:St.sibling=Ct,St=Ct,Ze=yt}if(ht===pe.length)return c(fe,Ze),vt&&Ks(fe,ht),nt;if(Ze===null){for(;ht<pe.length;ht++)Ze=De(fe,pe[ht],Ie),Ze!==null&&(ce=w(Ze,ce,ht),St===null?nt=Ze:St.sibling=Ze,St=Ze);return vt&&Ks(fe,ht),nt}for(Ze=f(Ze);ht<pe.length;ht++)yt=Ee(Ze,fe,ht,pe[ht],Ie),yt!==null&&(s&&yt.alternate!==null&&Ze.delete(yt.key===null?ht:yt.key),ce=w(yt,ce,ht),St===null?nt=yt:St.sibling=yt,St=yt);return s&&Ze.forEach(function(Ba){return r(fe,Ba)}),vt&&Ks(fe,ht),nt}function st(fe,ce,pe,Ie){if(pe==null)throw Error(i(151));for(var nt=null,St=null,Ze=ce,ht=ce=0,yt=null,Ct=pe.next();Ze!==null&&!Ct.done;ht++,Ct=pe.next()){Ze.index>ht?(yt=Ze,Ze=null):yt=Ze.sibling;var Ba=Ne(fe,Ze,Ct.value,Ie);if(Ba===null){Ze===null&&(Ze=yt);break}s&&Ze&&Ba.alternate===null&&r(fe,Ze),ce=w(Ba,ce,ht),St===null?nt=Ba:St.sibling=Ba,St=Ba,Ze=yt}if(Ct.done)return c(fe,Ze),vt&&Ks(fe,ht),nt;if(Ze===null){for(;!Ct.done;ht++,Ct=pe.next())Ct=De(fe,Ct.value,Ie),Ct!==null&&(ce=w(Ct,ce,ht),St===null?nt=Ct:St.sibling=Ct,St=Ct);return vt&&Ks(fe,ht),nt}for(Ze=f(Ze);!Ct.done;ht++,Ct=pe.next())Ct=Ee(Ze,fe,ht,Ct.value,Ie),Ct!==null&&(s&&Ct.alternate!==null&&Ze.delete(Ct.key===null?ht:Ct.key),ce=w(Ct,ce,ht),St===null?nt=Ct:St.sibling=Ct,St=Ct);return s&&Ze.forEach(function(CC){return r(fe,CC)}),vt&&Ks(fe,ht),nt}function Rt(fe,ce,pe,Ie){if(typeof pe=="object"&&pe!==null&&pe.type===N&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case x:e:{for(var nt=pe.key;ce!==null;){if(ce.key===nt){if(nt=pe.type,nt===N){if(ce.tag===7){c(fe,ce.sibling),Ie=b(ce,pe.props.children),Ie.return=fe,fe=Ie;break e}}else if(ce.elementType===nt||typeof nt=="object"&&nt!==null&&nt.$$typeof===R&&fi(nt)===ce.type){c(fe,ce.sibling),Ie=b(ce,pe.props),Kr(Ie,pe),Ie.return=fe,fe=Ie;break e}c(fe,ce);break}else r(fe,ce);ce=ce.sibling}pe.type===N?(Ie=li(pe.props.children,fe.mode,Ie,pe.key),Ie.return=fe,fe=Ie):(Ie=So(pe.type,pe.key,pe.props,null,fe.mode,Ie),Kr(Ie,pe),Ie.return=fe,fe=Ie)}return M(fe);case v:e:{for(nt=pe.key;ce!==null;){if(ce.key===nt)if(ce.tag===4&&ce.stateNode.containerInfo===pe.containerInfo&&ce.stateNode.implementation===pe.implementation){c(fe,ce.sibling),Ie=b(ce,pe.children||[]),Ie.return=fe,fe=Ie;break e}else{c(fe,ce);break}else r(fe,ce);ce=ce.sibling}Ie=fd(pe,fe.mode,Ie),Ie.return=fe,fe=Ie}return M(fe);case R:return pe=fi(pe),Rt(fe,ce,pe,Ie)}if(q(pe))return Ve(fe,ce,pe,Ie);if(I(pe)){if(nt=I(pe),typeof nt!="function")throw Error(i(150));return pe=nt.call(pe),st(fe,ce,pe,Ie)}if(typeof pe.then=="function")return Rt(fe,ce,ko(pe),Ie);if(pe.$$typeof===_)return Rt(fe,ce,Eo(fe,pe),Ie);Oo(fe,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint"?(pe=""+pe,ce!==null&&ce.tag===6?(c(fe,ce.sibling),Ie=b(ce,pe),Ie.return=fe,fe=Ie):(c(fe,ce),Ie=dd(pe,fe.mode,Ie),Ie.return=fe,fe=Ie),M(fe)):c(fe,ce)}return function(fe,ce,pe,Ie){try{Vr=0;var nt=Rt(fe,ce,pe,Ie);return Ki=null,nt}catch(Ze){if(Ze===Vi||Ze===To)throw Ze;var St=Qn(29,Ze,null,fe.mode);return St.lanes=Ie,St.return=fe,St}finally{}}}var mi=mg(!0),pg=mg(!1),ja=!1;function Cd(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function jd(s,r){s=s.updateQueue,r.updateQueue===s&&(r.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Ea(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Aa(s,r,c){var f=s.updateQueue;if(f===null)return null;if(f=f.shared,(jt&2)!==0){var b=f.pending;return b===null?r.next=r:(r.next=b.next,b.next=r),f.pending=r,r=No(s),Jp(s,null,c),r}return wo(s,f,r,c),No(s)}function Xr(s,r,c){if(r=r.updateQueue,r!==null&&(r=r.shared,(c&4194048)!==0)){var f=r.lanes;f&=s.pendingLanes,c|=f,r.lanes=c,Kt(s,c)}}function Ed(s,r){var c=s.updateQueue,f=s.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var b=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var M={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};w===null?b=w=M:w=w.next=M,c=c.next}while(c!==null);w===null?b=w=r:w=w.next=r}else b=w=r;c={baseState:f.baseState,firstBaseUpdate:b,lastBaseUpdate:w,shared:f.shared,callbacks:f.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=r:s.next=r,c.lastBaseUpdate=r}var Ad=!1;function Zr(){if(Ad){var s=qi;if(s!==null)throw s}}function Jr(s,r,c,f){Ad=!1;var b=s.updateQueue;ja=!1;var w=b.firstBaseUpdate,M=b.lastBaseUpdate,J=b.shared.pending;if(J!==null){b.shared.pending=null;var re=J,xe=re.next;re.next=null,M===null?w=xe:M.next=xe,M=re;var ke=s.alternate;ke!==null&&(ke=ke.updateQueue,J=ke.lastBaseUpdate,J!==M&&(J===null?ke.firstBaseUpdate=xe:J.next=xe,ke.lastBaseUpdate=re))}if(w!==null){var De=b.baseState;M=0,ke=xe=re=null,J=w;do{var Ne=J.lane&-536870913,Ee=Ne!==J.lane;if(Ee?(bt&Ne)===Ne:(f&Ne)===Ne){Ne!==0&&Ne===Yi&&(Ad=!0),ke!==null&&(ke=ke.next={lane:0,tag:J.tag,payload:J.payload,callback:null,next:null});e:{var Ve=s,st=J;Ne=r;var Rt=c;switch(st.tag){case 1:if(Ve=st.payload,typeof Ve=="function"){De=Ve.call(Rt,De,Ne);break e}De=Ve;break e;case 3:Ve.flags=Ve.flags&-65537|128;case 0:if(Ve=st.payload,Ne=typeof Ve=="function"?Ve.call(Rt,De,Ne):Ve,Ne==null)break e;De=g({},De,Ne);break e;case 2:ja=!0}}Ne=J.callback,Ne!==null&&(s.flags|=64,Ee&&(s.flags|=8192),Ee=b.callbacks,Ee===null?b.callbacks=[Ne]:Ee.push(Ne))}else Ee={lane:Ne,tag:J.tag,payload:J.payload,callback:J.callback,next:null},ke===null?(xe=ke=Ee,re=De):ke=ke.next=Ee,M|=Ne;if(J=J.next,J===null){if(J=b.shared.pending,J===null)break;Ee=J,J=Ee.next,Ee.next=null,b.lastBaseUpdate=Ee,b.shared.pending=null}}while(!0);ke===null&&(re=De),b.baseState=re,b.firstBaseUpdate=xe,b.lastBaseUpdate=ke,w===null&&(b.shared.lanes=0),Ia|=M,s.lanes=M,s.memoizedState=De}}function gg(s,r){if(typeof s!="function")throw Error(i(191,s));s.call(r)}function xg(s,r){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)gg(c[s],r)}var Xi=O(null),Io=O(0);function bg(s,r){s=ra,Y(Io,s),Y(Xi,r),ra=s|r.baseLanes}function Td(){Y(Io,ra),Y(Xi,Xi.current)}function _d(){ra=Io.current,B(Xi),B(Io)}var es=O(null),ms=null;function Ta(s){var r=s.alternate;Y(tn,tn.current&1),Y(es,s),ms===null&&(r===null||Xi.current!==null||r.memoizedState!==null)&&(ms=s)}function kd(s){Y(tn,tn.current),Y(es,s),ms===null&&(ms=s)}function yg(s){s.tag===22?(Y(tn,tn.current),Y(es,s),ms===null&&(ms=s)):_a()}function _a(){Y(tn,tn.current),Y(es,es.current)}function ts(s){B(es),ms===s&&(ms=null),B(tn)}var tn=O(0);function Do(s){for(var r=s;r!==null;){if(r.tag===13){var c=r.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Ff(c)||Pf(c)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Js=0,dt=null,Dt=null,on=null,Lo=!1,Zi=!1,pi=!1,Ro=0,Qr=0,Ji=null,mS=0;function Zt(){throw Error(i(321))}function Od(s,r){if(r===null)return!1;for(var c=0;c<r.length&&c<s.length;c++)if(!Jn(s[c],r[c]))return!1;return!0}function Id(s,r,c,f,b,w){return Js=w,dt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,W.H=s===null||s.memoizedState===null?nx:qd,pi=!1,w=c(f,b),pi=!1,Zi&&(w=wg(r,c,f,b)),vg(s),w}function vg(s){W.H=nl;var r=Dt!==null&&Dt.next!==null;if(Js=0,on=Dt=dt=null,Lo=!1,Qr=0,Ji=null,r)throw Error(i(300));s===null||cn||(s=s.dependencies,s!==null&&jo(s)&&(cn=!0))}function wg(s,r,c,f){dt=s;var b=0;do{if(Zi&&(Ji=null),Qr=0,Zi=!1,25<=b)throw Error(i(301));if(b+=1,on=Dt=null,s.updateQueue!=null){var w=s.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}W.H=sx,w=r(c,f)}while(Zi);return w}function pS(){var s=W.H,r=s.useState()[0];return r=typeof r.then=="function"?el(r):r,s=s.useState()[0],(Dt!==null?Dt.memoizedState:null)!==s&&(dt.flags|=1024),r}function Dd(){var s=Ro!==0;return Ro=0,s}function Ld(s,r,c){r.updateQueue=s.updateQueue,r.flags&=-2053,s.lanes&=~c}function Rd(s){if(Lo){for(s=s.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}Lo=!1}Js=0,on=Dt=dt=null,Zi=!1,Qr=Ro=0,Ji=null}function In(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return on===null?dt.memoizedState=on=s:on=on.next=s,on}function nn(){if(Dt===null){var s=dt.alternate;s=s!==null?s.memoizedState:null}else s=Dt.next;var r=on===null?dt.memoizedState:on.next;if(r!==null)on=r,Dt=s;else{if(s===null)throw dt.alternate===null?Error(i(467)):Error(i(310));Dt=s,s={memoizedState:Dt.memoizedState,baseState:Dt.baseState,baseQueue:Dt.baseQueue,queue:Dt.queue,next:null},on===null?dt.memoizedState=on=s:on=on.next=s}return on}function Mo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function el(s){var r=Qr;return Qr+=1,Ji===null&&(Ji=[]),s=dg(Ji,s,r),r=dt,(on===null?r.memoizedState:on.next)===null&&(r=r.alternate,W.H=r===null||r.memoizedState===null?nx:qd),s}function Fo(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return el(s);if(s.$$typeof===_)return Sn(s)}throw Error(i(438,String(s)))}function Md(s){var r=null,c=dt.updateQueue;if(c!==null&&(r=c.memoCache),r==null){var f=dt.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(r={data:f.data.map(function(b){return b.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),c===null&&(c=Mo(),dt.updateQueue=c),c.memoCache=r,c=r.data[r.index],c===void 0)for(c=r.data[r.index]=Array(s),f=0;f<s;f++)c[f]=P;return r.index++,c}function Qs(s,r){return typeof r=="function"?r(s):r}function Po(s){var r=nn();return Fd(r,Dt,s)}function Fd(s,r,c){var f=s.queue;if(f===null)throw Error(i(311));f.lastRenderedReducer=c;var b=s.baseQueue,w=f.pending;if(w!==null){if(b!==null){var M=b.next;b.next=w.next,w.next=M}r.baseQueue=b=w,f.pending=null}if(w=s.baseState,b===null)s.memoizedState=w;else{r=b.next;var J=M=null,re=null,xe=r,ke=!1;do{var De=xe.lane&-536870913;if(De!==xe.lane?(bt&De)===De:(Js&De)===De){var Ne=xe.revertLane;if(Ne===0)re!==null&&(re=re.next={lane:0,revertLane:0,gesture:null,action:xe.action,hasEagerState:xe.hasEagerState,eagerState:xe.eagerState,next:null}),De===Yi&&(ke=!0);else if((Js&Ne)===Ne){xe=xe.next,Ne===Yi&&(ke=!0);continue}else De={lane:0,revertLane:xe.revertLane,gesture:null,action:xe.action,hasEagerState:xe.hasEagerState,eagerState:xe.eagerState,next:null},re===null?(J=re=De,M=w):re=re.next=De,dt.lanes|=Ne,Ia|=Ne;De=xe.action,pi&&c(w,De),w=xe.hasEagerState?xe.eagerState:c(w,De)}else Ne={lane:De,revertLane:xe.revertLane,gesture:xe.gesture,action:xe.action,hasEagerState:xe.hasEagerState,eagerState:xe.eagerState,next:null},re===null?(J=re=Ne,M=w):re=re.next=Ne,dt.lanes|=De,Ia|=De;xe=xe.next}while(xe!==null&&xe!==r);if(re===null?M=w:re.next=J,!Jn(w,s.memoizedState)&&(cn=!0,ke&&(c=qi,c!==null)))throw c;s.memoizedState=w,s.baseState=M,s.baseQueue=re,f.lastRenderedState=w}return b===null&&(f.lanes=0),[s.memoizedState,f.dispatch]}function Pd(s){var r=nn(),c=r.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=s;var f=c.dispatch,b=c.pending,w=r.memoizedState;if(b!==null){c.pending=null;var M=b=b.next;do w=s(w,M.action),M=M.next;while(M!==b);Jn(w,r.memoizedState)||(cn=!0),r.memoizedState=w,r.baseQueue===null&&(r.baseState=w),c.lastRenderedState=w}return[w,f]}function Ng(s,r,c){var f=dt,b=nn(),w=vt;if(w){if(c===void 0)throw Error(i(407));c=c()}else c=r();var M=!Jn((Dt||b).memoizedState,c);if(M&&(b.memoizedState=c,cn=!0),b=b.queue,Ud(jg.bind(null,f,b,s),[s]),b.getSnapshot!==r||M||on!==null&&on.memoizedState.tag&1){if(f.flags|=2048,Qi(9,{destroy:void 0},Cg.bind(null,f,b,c,r),null),Ft===null)throw Error(i(349));w||(Js&127)!==0||Sg(f,r,c)}return c}function Sg(s,r,c){s.flags|=16384,s={getSnapshot:r,value:c},r=dt.updateQueue,r===null?(r=Mo(),dt.updateQueue=r,r.stores=[s]):(c=r.stores,c===null?r.stores=[s]:c.push(s))}function Cg(s,r,c,f){r.value=c,r.getSnapshot=f,Eg(r)&&Ag(s)}function jg(s,r,c){return c(function(){Eg(r)&&Ag(s)})}function Eg(s){var r=s.getSnapshot;s=s.value;try{var c=r();return!Jn(s,c)}catch{return!0}}function Ag(s){var r=ri(s,2);r!==null&&Gn(r,s,2)}function $d(s){var r=In();if(typeof s=="function"){var c=s;if(s=c(),pi){je(!0);try{c()}finally{je(!1)}}}return r.memoizedState=r.baseState=s,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:s},r}function Tg(s,r,c,f){return s.baseState=c,Fd(s,Dt,typeof f=="function"?f:Qs)}function gS(s,r,c,f,b){if(Uo(s))throw Error(i(485));if(s=r.action,s!==null){var w={payload:b,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(M){w.listeners.push(M)}};W.T!==null?c(!0):w.isTransition=!1,f(w),c=r.pending,c===null?(w.next=r.pending=w,_g(r,w)):(w.next=c.next,r.pending=c.next=w)}}function _g(s,r){var c=r.action,f=r.payload,b=s.state;if(r.isTransition){var w=W.T,M={};W.T=M;try{var J=c(b,f),re=W.S;re!==null&&re(M,J),kg(s,r,J)}catch(xe){zd(s,r,xe)}finally{w!==null&&M.types!==null&&(w.types=M.types),W.T=w}}else try{w=c(b,f),kg(s,r,w)}catch(xe){zd(s,r,xe)}}function kg(s,r,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){Og(s,r,f)},function(f){return zd(s,r,f)}):Og(s,r,c)}function Og(s,r,c){r.status="fulfilled",r.value=c,Ig(r),s.state=c,r=s.pending,r!==null&&(c=r.next,c===r?s.pending=null:(c=c.next,r.next=c,_g(s,c)))}function zd(s,r,c){var f=s.pending;if(s.pending=null,f!==null){f=f.next;do r.status="rejected",r.reason=c,Ig(r),r=r.next;while(r!==f)}s.action=null}function Ig(s){s=s.listeners;for(var r=0;r<s.length;r++)(0,s[r])()}function Dg(s,r){return r}function Lg(s,r){if(vt){var c=Ft.formState;if(c!==null){e:{var f=dt;if(vt){if(Pt){t:{for(var b=Pt,w=hs;b.nodeType!==8;){if(!w){b=null;break t}if(b=ps(b.nextSibling),b===null){b=null;break t}}w=b.data,b=w==="F!"||w==="F"?b:null}if(b){Pt=ps(b.nextSibling),f=b.data==="F!";break e}}Sa(f)}f=!1}f&&(r=c[0])}}return c=In(),c.memoizedState=c.baseState=r,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dg,lastRenderedState:r},c.queue=f,c=Qg.bind(null,dt,f),f.dispatch=c,f=$d(!1),w=Yd.bind(null,dt,!1,f.queue),f=In(),b={state:r,dispatch:null,action:s,pending:null},f.queue=b,c=gS.bind(null,dt,b,w,c),b.dispatch=c,f.memoizedState=s,[r,c,!1]}function Rg(s){var r=nn();return Mg(r,Dt,s)}function Mg(s,r,c){if(r=Fd(s,r,Dg)[0],s=Po(Qs)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var f=el(r)}catch(M){throw M===Vi?To:M}else f=r;r=nn();var b=r.queue,w=b.dispatch;return c!==r.memoizedState&&(dt.flags|=2048,Qi(9,{destroy:void 0},xS.bind(null,b,c),null)),[f,w,s]}function xS(s,r){s.action=r}function Fg(s){var r=nn(),c=Dt;if(c!==null)return Mg(r,c,s);nn(),r=r.memoizedState,c=nn();var f=c.queue.dispatch;return c.memoizedState=s,[r,f,!1]}function Qi(s,r,c,f){return s={tag:s,create:c,deps:f,inst:r,next:null},r=dt.updateQueue,r===null&&(r=Mo(),dt.updateQueue=r),c=r.lastEffect,c===null?r.lastEffect=s.next=s:(f=c.next,c.next=s,s.next=f,r.lastEffect=s),s}function Pg(){return nn().memoizedState}function $o(s,r,c,f){var b=In();dt.flags|=s,b.memoizedState=Qi(1|r,{destroy:void 0},c,f===void 0?null:f)}function zo(s,r,c,f){var b=nn();f=f===void 0?null:f;var w=b.memoizedState.inst;Dt!==null&&f!==null&&Od(f,Dt.memoizedState.deps)?b.memoizedState=Qi(r,w,c,f):(dt.flags|=s,b.memoizedState=Qi(1|r,w,c,f))}function $g(s,r){$o(8390656,8,s,r)}function Ud(s,r){zo(2048,8,s,r)}function bS(s){dt.flags|=4;var r=dt.updateQueue;if(r===null)r=Mo(),dt.updateQueue=r,r.events=[s];else{var c=r.events;c===null?r.events=[s]:c.push(s)}}function zg(s){var r=nn().memoizedState;return bS({ref:r,nextImpl:s}),function(){if((jt&2)!==0)throw Error(i(440));return r.impl.apply(void 0,arguments)}}function Ug(s,r){return zo(4,2,s,r)}function Bg(s,r){return zo(4,4,s,r)}function Hg(s,r){if(typeof r=="function"){s=s();var c=r(s);return function(){typeof c=="function"?c():r(null)}}if(r!=null)return s=s(),r.current=s,function(){r.current=null}}function Wg(s,r,c){c=c!=null?c.concat([s]):null,zo(4,4,Hg.bind(null,r,s),c)}function Bd(){}function Gg(s,r){var c=nn();r=r===void 0?null:r;var f=c.memoizedState;return r!==null&&Od(r,f[1])?f[0]:(c.memoizedState=[s,r],s)}function Yg(s,r){var c=nn();r=r===void 0?null:r;var f=c.memoizedState;if(r!==null&&Od(r,f[1]))return f[0];if(f=s(),pi){je(!0);try{s()}finally{je(!1)}}return c.memoizedState=[f,r],f}function Hd(s,r,c){return c===void 0||(Js&1073741824)!==0&&(bt&261930)===0?s.memoizedState=r:(s.memoizedState=c,s=qx(),dt.lanes|=s,Ia|=s,c)}function qg(s,r,c,f){return Jn(c,r)?c:Xi.current!==null?(s=Hd(s,c,f),Jn(s,r)||(cn=!0),s):(Js&42)===0||(Js&1073741824)!==0&&(bt&261930)===0?(cn=!0,s.memoizedState=c):(s=qx(),dt.lanes|=s,Ia|=s,r)}function Vg(s,r,c,f,b){var w=G.p;G.p=w!==0&&8>w?w:8;var M=W.T,J={};W.T=J,Yd(s,!1,r,c);try{var re=b(),xe=W.S;if(xe!==null&&xe(J,re),re!==null&&typeof re=="object"&&typeof re.then=="function"){var ke=hS(re,f);tl(s,r,ke,as(s))}else tl(s,r,f,as(s))}catch(De){tl(s,r,{then:function(){},status:"rejected",reason:De},as())}finally{G.p=w,M!==null&&J.types!==null&&(M.types=J.types),W.T=M}}function yS(){}function Wd(s,r,c,f){if(s.tag!==5)throw Error(i(476));var b=Kg(s).queue;Vg(s,b,r,te,c===null?yS:function(){return Xg(s),c(f)})}function Kg(s){var r=s.memoizedState;if(r!==null)return r;r={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:te},next:null};var c={};return r.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:c},next:null},s.memoizedState=r,s=s.alternate,s!==null&&(s.memoizedState=r),r}function Xg(s){var r=Kg(s);r.next===null&&(r=s.alternate.memoizedState),tl(s,r.next.queue,{},as())}function Gd(){return Sn(bl)}function Zg(){return nn().memoizedState}function Jg(){return nn().memoizedState}function vS(s){for(var r=s.return;r!==null;){switch(r.tag){case 24:case 3:var c=as();s=Ea(c);var f=Aa(r,s,c);f!==null&&(Gn(f,r,c),Xr(f,r,c)),r={cache:vd()},s.payload=r;return}r=r.return}}function wS(s,r,c){var f=as();c={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Uo(s)?ex(r,c):(c=cd(s,r,c,f),c!==null&&(Gn(c,s,f),tx(c,r,f)))}function Qg(s,r,c){var f=as();tl(s,r,c,f)}function tl(s,r,c,f){var b={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Uo(s))ex(r,b);else{var w=s.alternate;if(s.lanes===0&&(w===null||w.lanes===0)&&(w=r.lastRenderedReducer,w!==null))try{var M=r.lastRenderedState,J=w(M,c);if(b.hasEagerState=!0,b.eagerState=J,Jn(J,M))return wo(s,r,b,0),Ft===null&&vo(),!1}catch{}finally{}if(c=cd(s,r,b,f),c!==null)return Gn(c,s,f),tx(c,r,f),!0}return!1}function Yd(s,r,c,f){if(f={lane:2,revertLane:jf(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Uo(s)){if(r)throw Error(i(479))}else r=cd(s,c,f,2),r!==null&&Gn(r,s,2)}function Uo(s){var r=s.alternate;return s===dt||r!==null&&r===dt}function ex(s,r){Zi=Lo=!0;var c=s.pending;c===null?r.next=r:(r.next=c.next,c.next=r),s.pending=r}function tx(s,r,c){if((c&4194048)!==0){var f=r.lanes;f&=s.pendingLanes,c|=f,r.lanes=c,Kt(s,c)}}var nl={readContext:Sn,use:Fo,useCallback:Zt,useContext:Zt,useEffect:Zt,useImperativeHandle:Zt,useLayoutEffect:Zt,useInsertionEffect:Zt,useMemo:Zt,useReducer:Zt,useRef:Zt,useState:Zt,useDebugValue:Zt,useDeferredValue:Zt,useTransition:Zt,useSyncExternalStore:Zt,useId:Zt,useHostTransitionStatus:Zt,useFormState:Zt,useActionState:Zt,useOptimistic:Zt,useMemoCache:Zt,useCacheRefresh:Zt};nl.useEffectEvent=Zt;var nx={readContext:Sn,use:Fo,useCallback:function(s,r){return In().memoizedState=[s,r===void 0?null:r],s},useContext:Sn,useEffect:$g,useImperativeHandle:function(s,r,c){c=c!=null?c.concat([s]):null,$o(4194308,4,Hg.bind(null,r,s),c)},useLayoutEffect:function(s,r){return $o(4194308,4,s,r)},useInsertionEffect:function(s,r){$o(4,2,s,r)},useMemo:function(s,r){var c=In();r=r===void 0?null:r;var f=s();if(pi){je(!0);try{s()}finally{je(!1)}}return c.memoizedState=[f,r],f},useReducer:function(s,r,c){var f=In();if(c!==void 0){var b=c(r);if(pi){je(!0);try{c(r)}finally{je(!1)}}}else b=r;return f.memoizedState=f.baseState=b,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:b},f.queue=s,s=s.dispatch=wS.bind(null,dt,s),[f.memoizedState,s]},useRef:function(s){var r=In();return s={current:s},r.memoizedState=s},useState:function(s){s=$d(s);var r=s.queue,c=Qg.bind(null,dt,r);return r.dispatch=c,[s.memoizedState,c]},useDebugValue:Bd,useDeferredValue:function(s,r){var c=In();return Hd(c,s,r)},useTransition:function(){var s=$d(!1);return s=Vg.bind(null,dt,s.queue,!0,!1),In().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,r,c){var f=dt,b=In();if(vt){if(c===void 0)throw Error(i(407));c=c()}else{if(c=r(),Ft===null)throw Error(i(349));(bt&127)!==0||Sg(f,r,c)}b.memoizedState=c;var w={value:c,getSnapshot:r};return b.queue=w,$g(jg.bind(null,f,w,s),[s]),f.flags|=2048,Qi(9,{destroy:void 0},Cg.bind(null,f,w,c,r),null),c},useId:function(){var s=In(),r=Ft.identifierPrefix;if(vt){var c=Ls,f=Ds;c=(f&~(1<<32-Ue(f)-1)).toString(32)+c,r="_"+r+"R_"+c,c=Ro++,0<c&&(r+="H"+c.toString(32)),r+="_"}else c=mS++,r="_"+r+"r_"+c.toString(32)+"_";return s.memoizedState=r},useHostTransitionStatus:Gd,useFormState:Lg,useActionState:Lg,useOptimistic:function(s){var r=In();r.memoizedState=r.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=c,r=Yd.bind(null,dt,!0,c),c.dispatch=r,[s,r]},useMemoCache:Md,useCacheRefresh:function(){return In().memoizedState=vS.bind(null,dt)},useEffectEvent:function(s){var r=In(),c={impl:s};return r.memoizedState=c,function(){if((jt&2)!==0)throw Error(i(440));return c.impl.apply(void 0,arguments)}}},qd={readContext:Sn,use:Fo,useCallback:Gg,useContext:Sn,useEffect:Ud,useImperativeHandle:Wg,useInsertionEffect:Ug,useLayoutEffect:Bg,useMemo:Yg,useReducer:Po,useRef:Pg,useState:function(){return Po(Qs)},useDebugValue:Bd,useDeferredValue:function(s,r){var c=nn();return qg(c,Dt.memoizedState,s,r)},useTransition:function(){var s=Po(Qs)[0],r=nn().memoizedState;return[typeof s=="boolean"?s:el(s),r]},useSyncExternalStore:Ng,useId:Zg,useHostTransitionStatus:Gd,useFormState:Rg,useActionState:Rg,useOptimistic:function(s,r){var c=nn();return Tg(c,Dt,s,r)},useMemoCache:Md,useCacheRefresh:Jg};qd.useEffectEvent=zg;var sx={readContext:Sn,use:Fo,useCallback:Gg,useContext:Sn,useEffect:Ud,useImperativeHandle:Wg,useInsertionEffect:Ug,useLayoutEffect:Bg,useMemo:Yg,useReducer:Pd,useRef:Pg,useState:function(){return Pd(Qs)},useDebugValue:Bd,useDeferredValue:function(s,r){var c=nn();return Dt===null?Hd(c,s,r):qg(c,Dt.memoizedState,s,r)},useTransition:function(){var s=Pd(Qs)[0],r=nn().memoizedState;return[typeof s=="boolean"?s:el(s),r]},useSyncExternalStore:Ng,useId:Zg,useHostTransitionStatus:Gd,useFormState:Fg,useActionState:Fg,useOptimistic:function(s,r){var c=nn();return Dt!==null?Tg(c,Dt,s,r):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:Md,useCacheRefresh:Jg};sx.useEffectEvent=zg;function Vd(s,r,c,f){r=s.memoizedState,c=c(f,r),c=c==null?r:g({},r,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var Kd={enqueueSetState:function(s,r,c){s=s._reactInternals;var f=as(),b=Ea(f);b.payload=r,c!=null&&(b.callback=c),r=Aa(s,b,f),r!==null&&(Gn(r,s,f),Xr(r,s,f))},enqueueReplaceState:function(s,r,c){s=s._reactInternals;var f=as(),b=Ea(f);b.tag=1,b.payload=r,c!=null&&(b.callback=c),r=Aa(s,b,f),r!==null&&(Gn(r,s,f),Xr(r,s,f))},enqueueForceUpdate:function(s,r){s=s._reactInternals;var c=as(),f=Ea(c);f.tag=2,r!=null&&(f.callback=r),r=Aa(s,f,c),r!==null&&(Gn(r,s,c),Xr(r,s,c))}};function ax(s,r,c,f,b,w,M){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(f,w,M):r.prototype&&r.prototype.isPureReactComponent?!Br(c,f)||!Br(b,w):!0}function ix(s,r,c,f){s=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(c,f),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(c,f),r.state!==s&&Kd.enqueueReplaceState(r,r.state,null)}function gi(s,r){var c=r;if("ref"in r){c={};for(var f in r)f!=="ref"&&(c[f]=r[f])}if(s=s.defaultProps){c===r&&(c=g({},c));for(var b in s)c[b]===void 0&&(c[b]=s[b])}return c}function rx(s){yo(s)}function lx(s){console.error(s)}function ox(s){yo(s)}function Bo(s,r){try{var c=s.onUncaughtError;c(r.value,{componentStack:r.stack})}catch(f){setTimeout(function(){throw f})}}function cx(s,r,c){try{var f=s.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function Xd(s,r,c){return c=Ea(c),c.tag=3,c.payload={element:null},c.callback=function(){Bo(s,r)},c}function ux(s){return s=Ea(s),s.tag=3,s}function dx(s,r,c,f){var b=c.type.getDerivedStateFromError;if(typeof b=="function"){var w=f.value;s.payload=function(){return b(w)},s.callback=function(){cx(r,c,f)}}var M=c.stateNode;M!==null&&typeof M.componentDidCatch=="function"&&(s.callback=function(){cx(r,c,f),typeof b!="function"&&(Da===null?Da=new Set([this]):Da.add(this));var J=f.stack;this.componentDidCatch(f.value,{componentStack:J!==null?J:""})})}function NS(s,r,c,f,b){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(r=c.alternate,r!==null&&Gi(r,c,b,!0),c=es.current,c!==null){switch(c.tag){case 31:case 13:return ms===null?ec():c.alternate===null&&Jt===0&&(Jt=3),c.flags&=-257,c.flags|=65536,c.lanes=b,f===_o?c.flags|=16384:(r=c.updateQueue,r===null?c.updateQueue=new Set([f]):r.add(f),Nf(s,f,b)),!1;case 22:return c.flags|=65536,f===_o?c.flags|=16384:(r=c.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=r):(c=r.retryQueue,c===null?r.retryQueue=new Set([f]):c.add(f)),Nf(s,f,b)),!1}throw Error(i(435,c.tag))}return Nf(s,f,b),ec(),!1}if(vt)return r=es.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=b,f!==pd&&(s=Error(i(422),{cause:f}),Gr(us(s,c)))):(f!==pd&&(r=Error(i(423),{cause:f}),Gr(us(r,c))),s=s.current.alternate,s.flags|=65536,b&=-b,s.lanes|=b,f=us(f,c),b=Xd(s.stateNode,f,b),Ed(s,b),Jt!==4&&(Jt=2)),!1;var w=Error(i(520),{cause:f});if(w=us(w,c),ul===null?ul=[w]:ul.push(w),Jt!==4&&(Jt=2),r===null)return!0;f=us(f,c),c=r;do{switch(c.tag){case 3:return c.flags|=65536,s=b&-b,c.lanes|=s,s=Xd(c.stateNode,f,s),Ed(c,s),!1;case 1:if(r=c.type,w=c.stateNode,(c.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Da===null||!Da.has(w))))return c.flags|=65536,b&=-b,c.lanes|=b,b=ux(b),dx(b,s,c,f),Ed(c,b),!1}c=c.return}while(c!==null);return!1}var Zd=Error(i(461)),cn=!1;function Cn(s,r,c,f){r.child=s===null?pg(r,null,c,f):mi(r,s.child,c,f)}function fx(s,r,c,f,b){c=c.render;var w=r.ref;if("ref"in f){var M={};for(var J in f)J!=="ref"&&(M[J]=f[J])}else M=f;return ui(r),f=Id(s,r,c,M,w,b),J=Dd(),s!==null&&!cn?(Ld(s,r,b),ea(s,r,b)):(vt&&J&&hd(r),r.flags|=1,Cn(s,r,f,b),r.child)}function hx(s,r,c,f,b){if(s===null){var w=c.type;return typeof w=="function"&&!ud(w)&&w.defaultProps===void 0&&c.compare===null?(r.tag=15,r.type=w,mx(s,r,w,f,b)):(s=So(c.type,null,f,r,r.mode,b),s.ref=r.ref,s.return=r,r.child=s)}if(w=s.child,!rf(s,b)){var M=w.memoizedProps;if(c=c.compare,c=c!==null?c:Br,c(M,f)&&s.ref===r.ref)return ea(s,r,b)}return r.flags|=1,s=Vs(w,f),s.ref=r.ref,s.return=r,r.child=s}function mx(s,r,c,f,b){if(s!==null){var w=s.memoizedProps;if(Br(w,f)&&s.ref===r.ref)if(cn=!1,r.pendingProps=f=w,rf(s,b))(s.flags&131072)!==0&&(cn=!0);else return r.lanes=s.lanes,ea(s,r,b)}return Jd(s,r,c,f,b)}function px(s,r,c,f){var b=f.children,w=s!==null?s.memoizedState:null;if(s===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((r.flags&128)!==0){if(w=w!==null?w.baseLanes|c:c,s!==null){for(f=r.child=s.child,b=0;f!==null;)b=b|f.lanes|f.childLanes,f=f.sibling;f=b&~w}else f=0,r.child=null;return gx(s,r,w,c,f)}if((c&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},s!==null&&Ao(r,w!==null?w.cachePool:null),w!==null?bg(r,w):Td(),yg(r);else return f=r.lanes=536870912,gx(s,r,w!==null?w.baseLanes|c:c,c,f)}else w!==null?(Ao(r,w.cachePool),bg(r,w),_a(),r.memoizedState=null):(s!==null&&Ao(r,null),Td(),_a());return Cn(s,r,b,c),r.child}function sl(s,r){return s!==null&&s.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function gx(s,r,c,f,b){var w=Nd();return w=w===null?null:{parent:ln._currentValue,pool:w},r.memoizedState={baseLanes:c,cachePool:w},s!==null&&Ao(r,null),Td(),yg(r),s!==null&&Gi(s,r,f,!0),r.childLanes=b,null}function Ho(s,r){return r=Go({mode:r.mode,children:r.children},s.mode),r.ref=s.ref,s.child=r,r.return=s,r}function xx(s,r,c){return mi(r,s.child,null,c),s=Ho(r,r.pendingProps),s.flags|=2,ts(r),r.memoizedState=null,s}function SS(s,r,c){var f=r.pendingProps,b=(r.flags&128)!==0;if(r.flags&=-129,s===null){if(vt){if(f.mode==="hidden")return s=Ho(r,f),r.lanes=536870912,sl(null,s);if(kd(r),(s=Pt)?(s=_0(s,hs),s=s!==null&&s.data==="&"?s:null,s!==null&&(r.memoizedState={dehydrated:s,treeContext:wa!==null?{id:Ds,overflow:Ls}:null,retryLane:536870912,hydrationErrors:null},c=eg(s),c.return=r,r.child=c,Nn=r,Pt=null)):s=null,s===null)throw Sa(r);return r.lanes=536870912,null}return Ho(r,f)}var w=s.memoizedState;if(w!==null){var M=w.dehydrated;if(kd(r),b)if(r.flags&256)r.flags&=-257,r=xx(s,r,c);else if(r.memoizedState!==null)r.child=s.child,r.flags|=128,r=null;else throw Error(i(558));else if(cn||Gi(s,r,c,!1),b=(c&s.childLanes)!==0,cn||b){if(f=Ft,f!==null&&(M=Je(f,c),M!==0&&M!==w.retryLane))throw w.retryLane=M,ri(s,M),Gn(f,s,M),Zd;ec(),r=xx(s,r,c)}else s=w.treeContext,Pt=ps(M.nextSibling),Nn=r,vt=!0,Na=null,hs=!1,s!==null&&sg(r,s),r=Ho(r,f),r.flags|=4096;return r}return s=Vs(s.child,{mode:f.mode,children:f.children}),s.ref=r.ref,r.child=s,s.return=r,s}function Wo(s,r){var c=r.ref;if(c===null)s!==null&&s.ref!==null&&(r.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(i(284));(s===null||s.ref!==c)&&(r.flags|=4194816)}}function Jd(s,r,c,f,b){return ui(r),c=Id(s,r,c,f,void 0,b),f=Dd(),s!==null&&!cn?(Ld(s,r,b),ea(s,r,b)):(vt&&f&&hd(r),r.flags|=1,Cn(s,r,c,b),r.child)}function bx(s,r,c,f,b,w){return ui(r),r.updateQueue=null,c=wg(r,f,c,b),vg(s),f=Dd(),s!==null&&!cn?(Ld(s,r,w),ea(s,r,w)):(vt&&f&&hd(r),r.flags|=1,Cn(s,r,c,w),r.child)}function yx(s,r,c,f,b){if(ui(r),r.stateNode===null){var w=Ui,M=c.contextType;typeof M=="object"&&M!==null&&(w=Sn(M)),w=new c(f,w),r.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=Kd,r.stateNode=w,w._reactInternals=r,w=r.stateNode,w.props=f,w.state=r.memoizedState,w.refs={},Cd(r),M=c.contextType,w.context=typeof M=="object"&&M!==null?Sn(M):Ui,w.state=r.memoizedState,M=c.getDerivedStateFromProps,typeof M=="function"&&(Vd(r,c,M,f),w.state=r.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(M=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),M!==w.state&&Kd.enqueueReplaceState(w,w.state,null),Jr(r,f,w,b),Zr(),w.state=r.memoizedState),typeof w.componentDidMount=="function"&&(r.flags|=4194308),f=!0}else if(s===null){w=r.stateNode;var J=r.memoizedProps,re=gi(c,J);w.props=re;var xe=w.context,ke=c.contextType;M=Ui,typeof ke=="object"&&ke!==null&&(M=Sn(ke));var De=c.getDerivedStateFromProps;ke=typeof De=="function"||typeof w.getSnapshotBeforeUpdate=="function",J=r.pendingProps!==J,ke||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(J||xe!==M)&&ix(r,w,f,M),ja=!1;var Ne=r.memoizedState;w.state=Ne,Jr(r,f,w,b),Zr(),xe=r.memoizedState,J||Ne!==xe||ja?(typeof De=="function"&&(Vd(r,c,De,f),xe=r.memoizedState),(re=ja||ax(r,c,re,f,Ne,xe,M))?(ke||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(r.flags|=4194308)):(typeof w.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=f,r.memoizedState=xe),w.props=f,w.state=xe,w.context=M,f=re):(typeof w.componentDidMount=="function"&&(r.flags|=4194308),f=!1)}else{w=r.stateNode,jd(s,r),M=r.memoizedProps,ke=gi(c,M),w.props=ke,De=r.pendingProps,Ne=w.context,xe=c.contextType,re=Ui,typeof xe=="object"&&xe!==null&&(re=Sn(xe)),J=c.getDerivedStateFromProps,(xe=typeof J=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(M!==De||Ne!==re)&&ix(r,w,f,re),ja=!1,Ne=r.memoizedState,w.state=Ne,Jr(r,f,w,b),Zr();var Ee=r.memoizedState;M!==De||Ne!==Ee||ja||s!==null&&s.dependencies!==null&&jo(s.dependencies)?(typeof J=="function"&&(Vd(r,c,J,f),Ee=r.memoizedState),(ke=ja||ax(r,c,ke,f,Ne,Ee,re)||s!==null&&s.dependencies!==null&&jo(s.dependencies))?(xe||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(f,Ee,re),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(f,Ee,re)),typeof w.componentDidUpdate=="function"&&(r.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof w.componentDidUpdate!="function"||M===s.memoizedProps&&Ne===s.memoizedState||(r.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||M===s.memoizedProps&&Ne===s.memoizedState||(r.flags|=1024),r.memoizedProps=f,r.memoizedState=Ee),w.props=f,w.state=Ee,w.context=re,f=ke):(typeof w.componentDidUpdate!="function"||M===s.memoizedProps&&Ne===s.memoizedState||(r.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||M===s.memoizedProps&&Ne===s.memoizedState||(r.flags|=1024),f=!1)}return w=f,Wo(s,r),f=(r.flags&128)!==0,w||f?(w=r.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:w.render(),r.flags|=1,s!==null&&f?(r.child=mi(r,s.child,null,b),r.child=mi(r,null,c,b)):Cn(s,r,c,b),r.memoizedState=w.state,s=r.child):s=ea(s,r,b),s}function vx(s,r,c,f){return oi(),r.flags|=256,Cn(s,r,c,f),r.child}var Qd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ef(s){return{baseLanes:s,cachePool:cg()}}function tf(s,r,c){return s=s!==null?s.childLanes&~c:0,r&&(s|=ss),s}function wx(s,r,c){var f=r.pendingProps,b=!1,w=(r.flags&128)!==0,M;if((M=w)||(M=s!==null&&s.memoizedState===null?!1:(tn.current&2)!==0),M&&(b=!0,r.flags&=-129),M=(r.flags&32)!==0,r.flags&=-33,s===null){if(vt){if(b?Ta(r):_a(),(s=Pt)?(s=_0(s,hs),s=s!==null&&s.data!=="&"?s:null,s!==null&&(r.memoizedState={dehydrated:s,treeContext:wa!==null?{id:Ds,overflow:Ls}:null,retryLane:536870912,hydrationErrors:null},c=eg(s),c.return=r,r.child=c,Nn=r,Pt=null)):s=null,s===null)throw Sa(r);return Pf(s)?r.lanes=32:r.lanes=536870912,null}var J=f.children;return f=f.fallback,b?(_a(),b=r.mode,J=Go({mode:"hidden",children:J},b),f=li(f,b,c,null),J.return=r,f.return=r,J.sibling=f,r.child=J,f=r.child,f.memoizedState=ef(c),f.childLanes=tf(s,M,c),r.memoizedState=Qd,sl(null,f)):(Ta(r),nf(r,J))}var re=s.memoizedState;if(re!==null&&(J=re.dehydrated,J!==null)){if(w)r.flags&256?(Ta(r),r.flags&=-257,r=sf(s,r,c)):r.memoizedState!==null?(_a(),r.child=s.child,r.flags|=128,r=null):(_a(),J=f.fallback,b=r.mode,f=Go({mode:"visible",children:f.children},b),J=li(J,b,c,null),J.flags|=2,f.return=r,J.return=r,f.sibling=J,r.child=f,mi(r,s.child,null,c),f=r.child,f.memoizedState=ef(c),f.childLanes=tf(s,M,c),r.memoizedState=Qd,r=sl(null,f));else if(Ta(r),Pf(J)){if(M=J.nextSibling&&J.nextSibling.dataset,M)var xe=M.dgst;M=xe,f=Error(i(419)),f.stack="",f.digest=M,Gr({value:f,source:null,stack:null}),r=sf(s,r,c)}else if(cn||Gi(s,r,c,!1),M=(c&s.childLanes)!==0,cn||M){if(M=Ft,M!==null&&(f=Je(M,c),f!==0&&f!==re.retryLane))throw re.retryLane=f,ri(s,f),Gn(M,s,f),Zd;Ff(J)||ec(),r=sf(s,r,c)}else Ff(J)?(r.flags|=192,r.child=s.child,r=null):(s=re.treeContext,Pt=ps(J.nextSibling),Nn=r,vt=!0,Na=null,hs=!1,s!==null&&sg(r,s),r=nf(r,f.children),r.flags|=4096);return r}return b?(_a(),J=f.fallback,b=r.mode,re=s.child,xe=re.sibling,f=Vs(re,{mode:"hidden",children:f.children}),f.subtreeFlags=re.subtreeFlags&65011712,xe!==null?J=Vs(xe,J):(J=li(J,b,c,null),J.flags|=2),J.return=r,f.return=r,f.sibling=J,r.child=f,sl(null,f),f=r.child,J=s.child.memoizedState,J===null?J=ef(c):(b=J.cachePool,b!==null?(re=ln._currentValue,b=b.parent!==re?{parent:re,pool:re}:b):b=cg(),J={baseLanes:J.baseLanes|c,cachePool:b}),f.memoizedState=J,f.childLanes=tf(s,M,c),r.memoizedState=Qd,sl(s.child,f)):(Ta(r),c=s.child,s=c.sibling,c=Vs(c,{mode:"visible",children:f.children}),c.return=r,c.sibling=null,s!==null&&(M=r.deletions,M===null?(r.deletions=[s],r.flags|=16):M.push(s)),r.child=c,r.memoizedState=null,c)}function nf(s,r){return r=Go({mode:"visible",children:r},s.mode),r.return=s,s.child=r}function Go(s,r){return s=Qn(22,s,null,r),s.lanes=0,s}function sf(s,r,c){return mi(r,s.child,null,c),s=nf(r,r.pendingProps.children),s.flags|=2,r.memoizedState=null,s}function Nx(s,r,c){s.lanes|=r;var f=s.alternate;f!==null&&(f.lanes|=r),bd(s.return,r,c)}function af(s,r,c,f,b,w){var M=s.memoizedState;M===null?s.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:b,treeForkCount:w}:(M.isBackwards=r,M.rendering=null,M.renderingStartTime=0,M.last=f,M.tail=c,M.tailMode=b,M.treeForkCount=w)}function Sx(s,r,c){var f=r.pendingProps,b=f.revealOrder,w=f.tail;f=f.children;var M=tn.current,J=(M&2)!==0;if(J?(M=M&1|2,r.flags|=128):M&=1,Y(tn,M),Cn(s,r,f,c),f=vt?Wr:0,!J&&s!==null&&(s.flags&128)!==0)e:for(s=r.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Nx(s,c,r);else if(s.tag===19)Nx(s,c,r);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(b){case"forwards":for(c=r.child,b=null;c!==null;)s=c.alternate,s!==null&&Do(s)===null&&(b=c),c=c.sibling;c=b,c===null?(b=r.child,r.child=null):(b=c.sibling,c.sibling=null),af(r,!1,b,c,w,f);break;case"backwards":case"unstable_legacy-backwards":for(c=null,b=r.child,r.child=null;b!==null;){if(s=b.alternate,s!==null&&Do(s)===null){r.child=b;break}s=b.sibling,b.sibling=c,c=b,b=s}af(r,!0,c,null,w,f);break;case"together":af(r,!1,null,null,void 0,f);break;default:r.memoizedState=null}return r.child}function ea(s,r,c){if(s!==null&&(r.dependencies=s.dependencies),Ia|=r.lanes,(c&r.childLanes)===0)if(s!==null){if(Gi(s,r,c,!1),(c&r.childLanes)===0)return null}else return null;if(s!==null&&r.child!==s.child)throw Error(i(153));if(r.child!==null){for(s=r.child,c=Vs(s,s.pendingProps),r.child=c,c.return=r;s.sibling!==null;)s=s.sibling,c=c.sibling=Vs(s,s.pendingProps),c.return=r;c.sibling=null}return r.child}function rf(s,r){return(s.lanes&r)!==0?!0:(s=s.dependencies,!!(s!==null&&jo(s)))}function CS(s,r,c){switch(r.tag){case 3:de(r,r.stateNode.containerInfo),Ca(r,ln,s.memoizedState.cache),oi();break;case 27:case 5:le(r);break;case 4:de(r,r.stateNode.containerInfo);break;case 10:Ca(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,kd(r),null;break;case 13:var f=r.memoizedState;if(f!==null)return f.dehydrated!==null?(Ta(r),r.flags|=128,null):(c&r.child.childLanes)!==0?wx(s,r,c):(Ta(r),s=ea(s,r,c),s!==null?s.sibling:null);Ta(r);break;case 19:var b=(s.flags&128)!==0;if(f=(c&r.childLanes)!==0,f||(Gi(s,r,c,!1),f=(c&r.childLanes)!==0),b){if(f)return Sx(s,r,c);r.flags|=128}if(b=r.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Y(tn,tn.current),f)break;return null;case 22:return r.lanes=0,px(s,r,c,r.pendingProps);case 24:Ca(r,ln,s.memoizedState.cache)}return ea(s,r,c)}function Cx(s,r,c){if(s!==null)if(s.memoizedProps!==r.pendingProps)cn=!0;else{if(!rf(s,c)&&(r.flags&128)===0)return cn=!1,CS(s,r,c);cn=(s.flags&131072)!==0}else cn=!1,vt&&(r.flags&1048576)!==0&&ng(r,Wr,r.index);switch(r.lanes=0,r.tag){case 16:e:{var f=r.pendingProps;if(s=fi(r.elementType),r.type=s,typeof s=="function")ud(s)?(f=gi(s,f),r.tag=1,r=yx(null,r,s,f,c)):(r.tag=0,r=Jd(null,r,s,f,c));else{if(s!=null){var b=s.$$typeof;if(b===T){r.tag=11,r=fx(null,r,s,f,c);break e}else if(b===k){r.tag=14,r=hx(null,r,s,f,c);break e}}throw r=E(s)||s,Error(i(306,r,""))}}return r;case 0:return Jd(s,r,r.type,r.pendingProps,c);case 1:return f=r.type,b=gi(f,r.pendingProps),yx(s,r,f,b,c);case 3:e:{if(de(r,r.stateNode.containerInfo),s===null)throw Error(i(387));f=r.pendingProps;var w=r.memoizedState;b=w.element,jd(s,r),Jr(r,f,null,c);var M=r.memoizedState;if(f=M.cache,Ca(r,ln,f),f!==w.cache&&yd(r,[ln],c,!0),Zr(),f=M.element,w.isDehydrated)if(w={element:f,isDehydrated:!1,cache:M.cache},r.updateQueue.baseState=w,r.memoizedState=w,r.flags&256){r=vx(s,r,f,c);break e}else if(f!==b){b=us(Error(i(424)),r),Gr(b),r=vx(s,r,f,c);break e}else{switch(s=r.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(Pt=ps(s.firstChild),Nn=r,vt=!0,Na=null,hs=!0,c=pg(r,null,f,c),r.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(oi(),f===b){r=ea(s,r,c);break e}Cn(s,r,f,c)}r=r.child}return r;case 26:return Wo(s,r),s===null?(c=R0(r.type,null,r.pendingProps,null))?r.memoizedState=c:vt||(c=r.type,s=r.pendingProps,f=lc(ue.current).createElement(c),f[Xt]=r,f[It]=s,jn(f,c,s),mt(f),r.stateNode=f):r.memoizedState=R0(r.type,s.memoizedProps,r.pendingProps,s.memoizedState),null;case 27:return le(r),s===null&&vt&&(f=r.stateNode=I0(r.type,r.pendingProps,ue.current),Nn=r,hs=!0,b=Pt,Fa(r.type)?($f=b,Pt=ps(f.firstChild)):Pt=b),Cn(s,r,r.pendingProps.children,c),Wo(s,r),s===null&&(r.flags|=4194304),r.child;case 5:return s===null&&vt&&((b=f=Pt)&&(f=eC(f,r.type,r.pendingProps,hs),f!==null?(r.stateNode=f,Nn=r,Pt=ps(f.firstChild),hs=!1,b=!0):b=!1),b||Sa(r)),le(r),b=r.type,w=r.pendingProps,M=s!==null?s.memoizedProps:null,f=w.children,Lf(b,w)?f=null:M!==null&&Lf(b,M)&&(r.flags|=32),r.memoizedState!==null&&(b=Id(s,r,pS,null,null,c),bl._currentValue=b),Wo(s,r),Cn(s,r,f,c),r.child;case 6:return s===null&&vt&&((s=c=Pt)&&(c=tC(c,r.pendingProps,hs),c!==null?(r.stateNode=c,Nn=r,Pt=null,s=!0):s=!1),s||Sa(r)),null;case 13:return wx(s,r,c);case 4:return de(r,r.stateNode.containerInfo),f=r.pendingProps,s===null?r.child=mi(r,null,f,c):Cn(s,r,f,c),r.child;case 11:return fx(s,r,r.type,r.pendingProps,c);case 7:return Cn(s,r,r.pendingProps,c),r.child;case 8:return Cn(s,r,r.pendingProps.children,c),r.child;case 12:return Cn(s,r,r.pendingProps.children,c),r.child;case 10:return f=r.pendingProps,Ca(r,r.type,f.value),Cn(s,r,f.children,c),r.child;case 9:return b=r.type._context,f=r.pendingProps.children,ui(r),b=Sn(b),f=f(b),r.flags|=1,Cn(s,r,f,c),r.child;case 14:return hx(s,r,r.type,r.pendingProps,c);case 15:return mx(s,r,r.type,r.pendingProps,c);case 19:return Sx(s,r,c);case 31:return SS(s,r,c);case 22:return px(s,r,c,r.pendingProps);case 24:return ui(r),f=Sn(ln),s===null?(b=Nd(),b===null&&(b=Ft,w=vd(),b.pooledCache=w,w.refCount++,w!==null&&(b.pooledCacheLanes|=c),b=w),r.memoizedState={parent:f,cache:b},Cd(r),Ca(r,ln,b)):((s.lanes&c)!==0&&(jd(s,r),Jr(r,null,null,c),Zr()),b=s.memoizedState,w=r.memoizedState,b.parent!==f?(b={parent:f,cache:f},r.memoizedState=b,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=b),Ca(r,ln,f)):(f=w.cache,Ca(r,ln,f),f!==b.cache&&yd(r,[ln],c,!0))),Cn(s,r,r.pendingProps.children,c),r.child;case 29:throw r.pendingProps}throw Error(i(156,r.tag))}function ta(s){s.flags|=4}function lf(s,r,c,f,b){if((r=(s.mode&32)!==0)&&(r=!1),r){if(s.flags|=16777216,(b&335544128)===b)if(s.stateNode.complete)s.flags|=8192;else if(Zx())s.flags|=8192;else throw hi=_o,Sd}else s.flags&=-16777217}function jx(s,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!z0(r))if(Zx())s.flags|=8192;else throw hi=_o,Sd}function Yo(s,r){r!==null&&(s.flags|=4),s.flags&16384&&(r=s.tag!==22?Et():536870912,s.lanes|=r,sr|=r)}function al(s,r){if(!vt)switch(s.tailMode){case"hidden":r=s.tail;for(var c=null;r!==null;)r.alternate!==null&&(c=r),r=r.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?r||s.tail===null?s.tail=null:s.tail.sibling=null:f.sibling=null}}function $t(s){var r=s.alternate!==null&&s.alternate.child===s.child,c=0,f=0;if(r)for(var b=s.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags&65011712,f|=b.flags&65011712,b.return=s,b=b.sibling;else for(b=s.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags,f|=b.flags,b.return=s,b=b.sibling;return s.subtreeFlags|=f,s.childLanes=c,r}function jS(s,r,c){var f=r.pendingProps;switch(md(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $t(r),null;case 1:return $t(r),null;case 3:return c=r.stateNode,f=null,s!==null&&(f=s.memoizedState.cache),r.memoizedState.cache!==f&&(r.flags|=2048),Zs(ln),ye(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(Wi(r)?ta(r):s===null||s.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,gd())),$t(r),null;case 26:var b=r.type,w=r.memoizedState;return s===null?(ta(r),w!==null?($t(r),jx(r,w)):($t(r),lf(r,b,null,f,c))):w?w!==s.memoizedState?(ta(r),$t(r),jx(r,w)):($t(r),r.flags&=-16777217):(s=s.memoizedProps,s!==f&&ta(r),$t(r),lf(r,b,s,f,c)),null;case 27:if(we(r),c=ue.current,b=r.type,s!==null&&r.stateNode!=null)s.memoizedProps!==f&&ta(r);else{if(!f){if(r.stateNode===null)throw Error(i(166));return $t(r),null}s=X.current,Wi(r)?ag(r):(s=I0(b,f,c),r.stateNode=s,ta(r))}return $t(r),null;case 5:if(we(r),b=r.type,s!==null&&r.stateNode!=null)s.memoizedProps!==f&&ta(r);else{if(!f){if(r.stateNode===null)throw Error(i(166));return $t(r),null}if(w=X.current,Wi(r))ag(r);else{var M=lc(ue.current);switch(w){case 1:w=M.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:w=M.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":w=M.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":w=M.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":w=M.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof f.is=="string"?M.createElement("select",{is:f.is}):M.createElement("select"),f.multiple?w.multiple=!0:f.size&&(w.size=f.size);break;default:w=typeof f.is=="string"?M.createElement(b,{is:f.is}):M.createElement(b)}}w[Xt]=r,w[It]=f;e:for(M=r.child;M!==null;){if(M.tag===5||M.tag===6)w.appendChild(M.stateNode);else if(M.tag!==4&&M.tag!==27&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===r)break e;for(;M.sibling===null;){if(M.return===null||M.return===r)break e;M=M.return}M.sibling.return=M.return,M=M.sibling}r.stateNode=w;e:switch(jn(w,b,f),b){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&ta(r)}}return $t(r),lf(r,r.type,s===null?null:s.memoizedProps,r.pendingProps,c),null;case 6:if(s&&r.stateNode!=null)s.memoizedProps!==f&&ta(r);else{if(typeof f!="string"&&r.stateNode===null)throw Error(i(166));if(s=ue.current,Wi(r)){if(s=r.stateNode,c=r.memoizedProps,f=null,b=Nn,b!==null)switch(b.tag){case 27:case 5:f=b.memoizedProps}s[Xt]=r,s=!!(s.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||w0(s.nodeValue,c)),s||Sa(r,!0)}else s=lc(s).createTextNode(f),s[Xt]=r,r.stateNode=s}return $t(r),null;case 31:if(c=r.memoizedState,s===null||s.memoizedState!==null){if(f=Wi(r),c!==null){if(s===null){if(!f)throw Error(i(318));if(s=r.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(557));s[Xt]=r}else oi(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;$t(r),s=!1}else c=gd(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return r.flags&256?(ts(r),r):(ts(r),null);if((r.flags&128)!==0)throw Error(i(558))}return $t(r),null;case 13:if(f=r.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(b=Wi(r),f!==null&&f.dehydrated!==null){if(s===null){if(!b)throw Error(i(318));if(b=r.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(i(317));b[Xt]=r}else oi(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;$t(r),b=!1}else b=gd(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=b),b=!0;if(!b)return r.flags&256?(ts(r),r):(ts(r),null)}return ts(r),(r.flags&128)!==0?(r.lanes=c,r):(c=f!==null,s=s!==null&&s.memoizedState!==null,c&&(f=r.child,b=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(b=f.alternate.memoizedState.cachePool.pool),w=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(w=f.memoizedState.cachePool.pool),w!==b&&(f.flags|=2048)),c!==s&&c&&(r.child.flags|=8192),Yo(r,r.updateQueue),$t(r),null);case 4:return ye(),s===null&&_f(r.stateNode.containerInfo),$t(r),null;case 10:return Zs(r.type),$t(r),null;case 19:if(B(tn),f=r.memoizedState,f===null)return $t(r),null;if(b=(r.flags&128)!==0,w=f.rendering,w===null)if(b)al(f,!1);else{if(Jt!==0||s!==null&&(s.flags&128)!==0)for(s=r.child;s!==null;){if(w=Do(s),w!==null){for(r.flags|=128,al(f,!1),s=w.updateQueue,r.updateQueue=s,Yo(r,s),r.subtreeFlags=0,s=c,c=r.child;c!==null;)Qp(c,s),c=c.sibling;return Y(tn,tn.current&1|2),vt&&Ks(r,f.treeForkCount),r.child}s=s.sibling}f.tail!==null&&Se()>Zo&&(r.flags|=128,b=!0,al(f,!1),r.lanes=4194304)}else{if(!b)if(s=Do(w),s!==null){if(r.flags|=128,b=!0,s=s.updateQueue,r.updateQueue=s,Yo(r,s),al(f,!0),f.tail===null&&f.tailMode==="hidden"&&!w.alternate&&!vt)return $t(r),null}else 2*Se()-f.renderingStartTime>Zo&&c!==536870912&&(r.flags|=128,b=!0,al(f,!1),r.lanes=4194304);f.isBackwards?(w.sibling=r.child,r.child=w):(s=f.last,s!==null?s.sibling=w:r.child=w,f.last=w)}return f.tail!==null?(s=f.tail,f.rendering=s,f.tail=s.sibling,f.renderingStartTime=Se(),s.sibling=null,c=tn.current,Y(tn,b?c&1|2:c&1),vt&&Ks(r,f.treeForkCount),s):($t(r),null);case 22:case 23:return ts(r),_d(),f=r.memoizedState!==null,s!==null?s.memoizedState!==null!==f&&(r.flags|=8192):f&&(r.flags|=8192),f?(c&536870912)!==0&&(r.flags&128)===0&&($t(r),r.subtreeFlags&6&&(r.flags|=8192)):$t(r),c=r.updateQueue,c!==null&&Yo(r,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),f=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(f=r.memoizedState.cachePool.pool),f!==c&&(r.flags|=2048),s!==null&&B(di),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),Zs(ln),$t(r),null;case 25:return null;case 30:return null}throw Error(i(156,r.tag))}function ES(s,r){switch(md(r),r.tag){case 1:return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 3:return Zs(ln),ye(),s=r.flags,(s&65536)!==0&&(s&128)===0?(r.flags=s&-65537|128,r):null;case 26:case 27:case 5:return we(r),null;case 31:if(r.memoizedState!==null){if(ts(r),r.alternate===null)throw Error(i(340));oi()}return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 13:if(ts(r),s=r.memoizedState,s!==null&&s.dehydrated!==null){if(r.alternate===null)throw Error(i(340));oi()}return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 19:return B(tn),null;case 4:return ye(),null;case 10:return Zs(r.type),null;case 22:case 23:return ts(r),_d(),s!==null&&B(di),s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 24:return Zs(ln),null;case 25:return null;default:return null}}function Ex(s,r){switch(md(r),r.tag){case 3:Zs(ln),ye();break;case 26:case 27:case 5:we(r);break;case 4:ye();break;case 31:r.memoizedState!==null&&ts(r);break;case 13:ts(r);break;case 19:B(tn);break;case 10:Zs(r.type);break;case 22:case 23:ts(r),_d(),s!==null&&B(di);break;case 24:Zs(ln)}}function il(s,r){try{var c=r.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var b=f.next;c=b;do{if((c.tag&s)===s){f=void 0;var w=c.create,M=c.inst;f=w(),M.destroy=f}c=c.next}while(c!==b)}}catch(J){_t(r,r.return,J)}}function ka(s,r,c){try{var f=r.updateQueue,b=f!==null?f.lastEffect:null;if(b!==null){var w=b.next;f=w;do{if((f.tag&s)===s){var M=f.inst,J=M.destroy;if(J!==void 0){M.destroy=void 0,b=r;var re=c,xe=J;try{xe()}catch(ke){_t(b,re,ke)}}}f=f.next}while(f!==w)}}catch(ke){_t(r,r.return,ke)}}function Ax(s){var r=s.updateQueue;if(r!==null){var c=s.stateNode;try{xg(r,c)}catch(f){_t(s,s.return,f)}}}function Tx(s,r,c){c.props=gi(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(f){_t(s,r,f)}}function rl(s,r){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var f=s.stateNode;break;case 30:f=s.stateNode;break;default:f=s.stateNode}typeof c=="function"?s.refCleanup=c(f):c.current=f}}catch(b){_t(s,r,b)}}function Rs(s,r){var c=s.ref,f=s.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(b){_t(s,r,b)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(b){_t(s,r,b)}else c.current=null}function _x(s){var r=s.type,c=s.memoizedProps,f=s.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(b){_t(s,s.return,b)}}function of(s,r,c){try{var f=s.stateNode;VS(f,s.type,c,r),f[It]=r}catch(b){_t(s,s.return,b)}}function kx(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Fa(s.type)||s.tag===4}function cf(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||kx(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Fa(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function uf(s,r,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,r?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,r):(r=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,r.appendChild(s),c=c._reactRootContainer,c!=null||r.onclick!==null||(r.onclick=Ys));else if(f!==4&&(f===27&&Fa(s.type)&&(c=s.stateNode,r=null),s=s.child,s!==null))for(uf(s,r,c),s=s.sibling;s!==null;)uf(s,r,c),s=s.sibling}function qo(s,r,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,r?c.insertBefore(s,r):c.appendChild(s);else if(f!==4&&(f===27&&Fa(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(qo(s,r,c),s=s.sibling;s!==null;)qo(s,r,c),s=s.sibling}function Ox(s){var r=s.stateNode,c=s.memoizedProps;try{for(var f=s.type,b=r.attributes;b.length;)r.removeAttributeNode(b[0]);jn(r,f,c),r[Xt]=s,r[It]=c}catch(w){_t(s,s.return,w)}}var na=!1,un=!1,df=!1,Ix=typeof WeakSet=="function"?WeakSet:Set,yn=null;function AS(s,r){if(s=s.containerInfo,If=mc,s=Wp(s),sd(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var b=f.anchorOffset,w=f.focusNode;f=f.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var M=0,J=-1,re=-1,xe=0,ke=0,De=s,Ne=null;t:for(;;){for(var Ee;De!==c||b!==0&&De.nodeType!==3||(J=M+b),De!==w||f!==0&&De.nodeType!==3||(re=M+f),De.nodeType===3&&(M+=De.nodeValue.length),(Ee=De.firstChild)!==null;)Ne=De,De=Ee;for(;;){if(De===s)break t;if(Ne===c&&++xe===b&&(J=M),Ne===w&&++ke===f&&(re=M),(Ee=De.nextSibling)!==null)break;De=Ne,Ne=De.parentNode}De=Ee}c=J===-1||re===-1?null:{start:J,end:re}}else c=null}c=c||{start:0,end:0}}else c=null;for(Df={focusedElem:s,selectionRange:c},mc=!1,yn=r;yn!==null;)if(r=yn,s=r.child,(r.subtreeFlags&1028)!==0&&s!==null)s.return=r,yn=s;else for(;yn!==null;){switch(r=yn,w=r.alternate,s=r.flags,r.tag){case 0:if((s&4)!==0&&(s=r.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)b=s[c],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&w!==null){s=void 0,c=r,b=w.memoizedProps,w=w.memoizedState,f=c.stateNode;try{var Ve=gi(c.type,b);s=f.getSnapshotBeforeUpdate(Ve,w),f.__reactInternalSnapshotBeforeUpdate=s}catch(st){_t(c,c.return,st)}}break;case 3:if((s&1024)!==0){if(s=r.stateNode.containerInfo,c=s.nodeType,c===9)Mf(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Mf(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(i(163))}if(s=r.sibling,s!==null){s.return=r.return,yn=s;break}yn=r.return}}function Dx(s,r,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:aa(s,c),f&4&&il(5,c);break;case 1:if(aa(s,c),f&4)if(s=c.stateNode,r===null)try{s.componentDidMount()}catch(M){_t(c,c.return,M)}else{var b=gi(c.type,r.memoizedProps);r=r.memoizedState;try{s.componentDidUpdate(b,r,s.__reactInternalSnapshotBeforeUpdate)}catch(M){_t(c,c.return,M)}}f&64&&Ax(c),f&512&&rl(c,c.return);break;case 3:if(aa(s,c),f&64&&(s=c.updateQueue,s!==null)){if(r=null,c.child!==null)switch(c.child.tag){case 27:case 5:r=c.child.stateNode;break;case 1:r=c.child.stateNode}try{xg(s,r)}catch(M){_t(c,c.return,M)}}break;case 27:r===null&&f&4&&Ox(c);case 26:case 5:aa(s,c),r===null&&f&4&&_x(c),f&512&&rl(c,c.return);break;case 12:aa(s,c);break;case 31:aa(s,c),f&4&&Mx(s,c);break;case 13:aa(s,c),f&4&&Fx(s,c),f&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=MS.bind(null,c),nC(s,c))));break;case 22:if(f=c.memoizedState!==null||na,!f){r=r!==null&&r.memoizedState!==null||un,b=na;var w=un;na=f,(un=r)&&!w?ia(s,c,(c.subtreeFlags&8772)!==0):aa(s,c),na=b,un=w}break;case 30:break;default:aa(s,c)}}function Lx(s){var r=s.alternate;r!==null&&(s.alternate=null,Lx(r)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(r=s.stateNode,r!==null&&oe(r)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Bt=null,Un=!1;function sa(s,r,c){for(c=c.child;c!==null;)Rx(s,r,c),c=c.sibling}function Rx(s,r,c){if(ve&&typeof ve.onCommitFiberUnmount=="function")try{ve.onCommitFiberUnmount(Ge,c)}catch{}switch(c.tag){case 26:un||Rs(c,r),sa(s,r,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:un||Rs(c,r);var f=Bt,b=Un;Fa(c.type)&&(Bt=c.stateNode,Un=!1),sa(s,r,c),pl(c.stateNode),Bt=f,Un=b;break;case 5:un||Rs(c,r);case 6:if(f=Bt,b=Un,Bt=null,sa(s,r,c),Bt=f,Un=b,Bt!==null)if(Un)try{(Bt.nodeType===9?Bt.body:Bt.nodeName==="HTML"?Bt.ownerDocument.body:Bt).removeChild(c.stateNode)}catch(w){_t(c,r,w)}else try{Bt.removeChild(c.stateNode)}catch(w){_t(c,r,w)}break;case 18:Bt!==null&&(Un?(s=Bt,A0(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),dr(s)):A0(Bt,c.stateNode));break;case 4:f=Bt,b=Un,Bt=c.stateNode.containerInfo,Un=!0,sa(s,r,c),Bt=f,Un=b;break;case 0:case 11:case 14:case 15:ka(2,c,r),un||ka(4,c,r),sa(s,r,c);break;case 1:un||(Rs(c,r),f=c.stateNode,typeof f.componentWillUnmount=="function"&&Tx(c,r,f)),sa(s,r,c);break;case 21:sa(s,r,c);break;case 22:un=(f=un)||c.memoizedState!==null,sa(s,r,c),un=f;break;default:sa(s,r,c)}}function Mx(s,r){if(r.memoizedState===null&&(s=r.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{dr(s)}catch(c){_t(r,r.return,c)}}}function Fx(s,r){if(r.memoizedState===null&&(s=r.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{dr(s)}catch(c){_t(r,r.return,c)}}function TS(s){switch(s.tag){case 31:case 13:case 19:var r=s.stateNode;return r===null&&(r=s.stateNode=new Ix),r;case 22:return s=s.stateNode,r=s._retryCache,r===null&&(r=s._retryCache=new Ix),r;default:throw Error(i(435,s.tag))}}function Vo(s,r){var c=TS(s);r.forEach(function(f){if(!c.has(f)){c.add(f);var b=FS.bind(null,s,f);f.then(b,b)}})}function Bn(s,r){var c=r.deletions;if(c!==null)for(var f=0;f<c.length;f++){var b=c[f],w=s,M=r,J=M;e:for(;J!==null;){switch(J.tag){case 27:if(Fa(J.type)){Bt=J.stateNode,Un=!1;break e}break;case 5:Bt=J.stateNode,Un=!1;break e;case 3:case 4:Bt=J.stateNode.containerInfo,Un=!0;break e}J=J.return}if(Bt===null)throw Error(i(160));Rx(w,M,b),Bt=null,Un=!1,w=b.alternate,w!==null&&(w.return=null),b.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)Px(r,s),r=r.sibling}var Ss=null;function Px(s,r){var c=s.alternate,f=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Bn(r,s),Hn(s),f&4&&(ka(3,s,s.return),il(3,s),ka(5,s,s.return));break;case 1:Bn(r,s),Hn(s),f&512&&(un||c===null||Rs(c,c.return)),f&64&&na&&(s=s.updateQueue,s!==null&&(f=s.callbacks,f!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var b=Ss;if(Bn(r,s),Hn(s),f&512&&(un||c===null||Rs(c,c.return)),f&4){var w=c!==null?c.memoizedState:null;if(f=s.memoizedState,c===null)if(f===null)if(s.stateNode===null){e:{f=s.type,c=s.memoizedProps,b=b.ownerDocument||b;t:switch(f){case"title":w=b.getElementsByTagName("title")[0],(!w||w[Xe]||w[Xt]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=b.createElement(f),b.head.insertBefore(w,b.querySelector("head > title"))),jn(w,f,c),w[Xt]=s,mt(w),f=w;break e;case"link":var M=P0("link","href",b).get(f+(c.href||""));if(M){for(var J=0;J<M.length;J++)if(w=M[J],w.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&w.getAttribute("rel")===(c.rel==null?null:c.rel)&&w.getAttribute("title")===(c.title==null?null:c.title)&&w.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){M.splice(J,1);break t}}w=b.createElement(f),jn(w,f,c),b.head.appendChild(w);break;case"meta":if(M=P0("meta","content",b).get(f+(c.content||""))){for(J=0;J<M.length;J++)if(w=M[J],w.getAttribute("content")===(c.content==null?null:""+c.content)&&w.getAttribute("name")===(c.name==null?null:c.name)&&w.getAttribute("property")===(c.property==null?null:c.property)&&w.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&w.getAttribute("charset")===(c.charSet==null?null:c.charSet)){M.splice(J,1);break t}}w=b.createElement(f),jn(w,f,c),b.head.appendChild(w);break;default:throw Error(i(468,f))}w[Xt]=s,mt(w),f=w}s.stateNode=f}else $0(b,s.type,s.stateNode);else s.stateNode=F0(b,f,s.memoizedProps);else w!==f?(w===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):w.count--,f===null?$0(b,s.type,s.stateNode):F0(b,f,s.memoizedProps)):f===null&&s.stateNode!==null&&of(s,s.memoizedProps,c.memoizedProps)}break;case 27:Bn(r,s),Hn(s),f&512&&(un||c===null||Rs(c,c.return)),c!==null&&f&4&&of(s,s.memoizedProps,c.memoizedProps);break;case 5:if(Bn(r,s),Hn(s),f&512&&(un||c===null||Rs(c,c.return)),s.flags&32){b=s.stateNode;try{Li(b,"")}catch(Ve){_t(s,s.return,Ve)}}f&4&&s.stateNode!=null&&(b=s.memoizedProps,of(s,b,c!==null?c.memoizedProps:b)),f&1024&&(df=!0);break;case 6:if(Bn(r,s),Hn(s),f&4){if(s.stateNode===null)throw Error(i(162));f=s.memoizedProps,c=s.stateNode;try{c.nodeValue=f}catch(Ve){_t(s,s.return,Ve)}}break;case 3:if(uc=null,b=Ss,Ss=oc(r.containerInfo),Bn(r,s),Ss=b,Hn(s),f&4&&c!==null&&c.memoizedState.isDehydrated)try{dr(r.containerInfo)}catch(Ve){_t(s,s.return,Ve)}df&&(df=!1,$x(s));break;case 4:f=Ss,Ss=oc(s.stateNode.containerInfo),Bn(r,s),Hn(s),Ss=f;break;case 12:Bn(r,s),Hn(s);break;case 31:Bn(r,s),Hn(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,Vo(s,f)));break;case 13:Bn(r,s),Hn(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Xo=Se()),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,Vo(s,f)));break;case 22:b=s.memoizedState!==null;var re=c!==null&&c.memoizedState!==null,xe=na,ke=un;if(na=xe||b,un=ke||re,Bn(r,s),un=ke,na=xe,Hn(s),f&8192)e:for(r=s.stateNode,r._visibility=b?r._visibility&-2:r._visibility|1,b&&(c===null||re||na||un||xi(s)),c=null,r=s;;){if(r.tag===5||r.tag===26){if(c===null){re=c=r;try{if(w=re.stateNode,b)M=w.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none";else{J=re.stateNode;var De=re.memoizedProps.style,Ne=De!=null&&De.hasOwnProperty("display")?De.display:null;J.style.display=Ne==null||typeof Ne=="boolean"?"":(""+Ne).trim()}}catch(Ve){_t(re,re.return,Ve)}}}else if(r.tag===6){if(c===null){re=r;try{re.stateNode.nodeValue=b?"":re.memoizedProps}catch(Ve){_t(re,re.return,Ve)}}}else if(r.tag===18){if(c===null){re=r;try{var Ee=re.stateNode;b?T0(Ee,!0):T0(re.stateNode,!1)}catch(Ve){_t(re,re.return,Ve)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===s)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;c===r&&(c=null),r=r.return}c===r&&(c=null),r.sibling.return=r.return,r=r.sibling}f&4&&(f=s.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,Vo(s,c))));break;case 19:Bn(r,s),Hn(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,Vo(s,f)));break;case 30:break;case 21:break;default:Bn(r,s),Hn(s)}}function Hn(s){var r=s.flags;if(r&2){try{for(var c,f=s.return;f!==null;){if(kx(f)){c=f;break}f=f.return}if(c==null)throw Error(i(160));switch(c.tag){case 27:var b=c.stateNode,w=cf(s);qo(s,w,b);break;case 5:var M=c.stateNode;c.flags&32&&(Li(M,""),c.flags&=-33);var J=cf(s);qo(s,J,M);break;case 3:case 4:var re=c.stateNode.containerInfo,xe=cf(s);uf(s,xe,re);break;default:throw Error(i(161))}}catch(ke){_t(s,s.return,ke)}s.flags&=-3}r&4096&&(s.flags&=-4097)}function $x(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var r=s;$x(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),s=s.sibling}}function aa(s,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)Dx(s,r.alternate,r),r=r.sibling}function xi(s){for(s=s.child;s!==null;){var r=s;switch(r.tag){case 0:case 11:case 14:case 15:ka(4,r,r.return),xi(r);break;case 1:Rs(r,r.return);var c=r.stateNode;typeof c.componentWillUnmount=="function"&&Tx(r,r.return,c),xi(r);break;case 27:pl(r.stateNode);case 26:case 5:Rs(r,r.return),xi(r);break;case 22:r.memoizedState===null&&xi(r);break;case 30:xi(r);break;default:xi(r)}s=s.sibling}}function ia(s,r,c){for(c=c&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var f=r.alternate,b=s,w=r,M=w.flags;switch(w.tag){case 0:case 11:case 15:ia(b,w,c),il(4,w);break;case 1:if(ia(b,w,c),f=w,b=f.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(xe){_t(f,f.return,xe)}if(f=w,b=f.updateQueue,b!==null){var J=f.stateNode;try{var re=b.shared.hiddenCallbacks;if(re!==null)for(b.shared.hiddenCallbacks=null,b=0;b<re.length;b++)gg(re[b],J)}catch(xe){_t(f,f.return,xe)}}c&&M&64&&Ax(w),rl(w,w.return);break;case 27:Ox(w);case 26:case 5:ia(b,w,c),c&&f===null&&M&4&&_x(w),rl(w,w.return);break;case 12:ia(b,w,c);break;case 31:ia(b,w,c),c&&M&4&&Mx(b,w);break;case 13:ia(b,w,c),c&&M&4&&Fx(b,w);break;case 22:w.memoizedState===null&&ia(b,w,c),rl(w,w.return);break;case 30:break;default:ia(b,w,c)}r=r.sibling}}function ff(s,r){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(s=r.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Yr(c))}function hf(s,r){s=null,r.alternate!==null&&(s=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==s&&(r.refCount++,s!=null&&Yr(s))}function Cs(s,r,c,f){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)zx(s,r,c,f),r=r.sibling}function zx(s,r,c,f){var b=r.flags;switch(r.tag){case 0:case 11:case 15:Cs(s,r,c,f),b&2048&&il(9,r);break;case 1:Cs(s,r,c,f);break;case 3:Cs(s,r,c,f),b&2048&&(s=null,r.alternate!==null&&(s=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==s&&(r.refCount++,s!=null&&Yr(s)));break;case 12:if(b&2048){Cs(s,r,c,f),s=r.stateNode;try{var w=r.memoizedProps,M=w.id,J=w.onPostCommit;typeof J=="function"&&J(M,r.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(re){_t(r,r.return,re)}}else Cs(s,r,c,f);break;case 31:Cs(s,r,c,f);break;case 13:Cs(s,r,c,f);break;case 23:break;case 22:w=r.stateNode,M=r.alternate,r.memoizedState!==null?w._visibility&2?Cs(s,r,c,f):ll(s,r):w._visibility&2?Cs(s,r,c,f):(w._visibility|=2,er(s,r,c,f,(r.subtreeFlags&10256)!==0||!1)),b&2048&&ff(M,r);break;case 24:Cs(s,r,c,f),b&2048&&hf(r.alternate,r);break;default:Cs(s,r,c,f)}}function er(s,r,c,f,b){for(b=b&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var w=s,M=r,J=c,re=f,xe=M.flags;switch(M.tag){case 0:case 11:case 15:er(w,M,J,re,b),il(8,M);break;case 23:break;case 22:var ke=M.stateNode;M.memoizedState!==null?ke._visibility&2?er(w,M,J,re,b):ll(w,M):(ke._visibility|=2,er(w,M,J,re,b)),b&&xe&2048&&ff(M.alternate,M);break;case 24:er(w,M,J,re,b),b&&xe&2048&&hf(M.alternate,M);break;default:er(w,M,J,re,b)}r=r.sibling}}function ll(s,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var c=s,f=r,b=f.flags;switch(f.tag){case 22:ll(c,f),b&2048&&ff(f.alternate,f);break;case 24:ll(c,f),b&2048&&hf(f.alternate,f);break;default:ll(c,f)}r=r.sibling}}var ol=8192;function tr(s,r,c){if(s.subtreeFlags&ol)for(s=s.child;s!==null;)Ux(s,r,c),s=s.sibling}function Ux(s,r,c){switch(s.tag){case 26:tr(s,r,c),s.flags&ol&&s.memoizedState!==null&&mC(c,Ss,s.memoizedState,s.memoizedProps);break;case 5:tr(s,r,c);break;case 3:case 4:var f=Ss;Ss=oc(s.stateNode.containerInfo),tr(s,r,c),Ss=f;break;case 22:s.memoizedState===null&&(f=s.alternate,f!==null&&f.memoizedState!==null?(f=ol,ol=16777216,tr(s,r,c),ol=f):tr(s,r,c));break;default:tr(s,r,c)}}function Bx(s){var r=s.alternate;if(r!==null&&(s=r.child,s!==null)){r.child=null;do r=s.sibling,s.sibling=null,s=r;while(s!==null)}}function cl(s){var r=s.deletions;if((s.flags&16)!==0){if(r!==null)for(var c=0;c<r.length;c++){var f=r[c];yn=f,Wx(f,s)}Bx(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Hx(s),s=s.sibling}function Hx(s){switch(s.tag){case 0:case 11:case 15:cl(s),s.flags&2048&&ka(9,s,s.return);break;case 3:cl(s);break;case 12:cl(s);break;case 22:var r=s.stateNode;s.memoizedState!==null&&r._visibility&2&&(s.return===null||s.return.tag!==13)?(r._visibility&=-3,Ko(s)):cl(s);break;default:cl(s)}}function Ko(s){var r=s.deletions;if((s.flags&16)!==0){if(r!==null)for(var c=0;c<r.length;c++){var f=r[c];yn=f,Wx(f,s)}Bx(s)}for(s=s.child;s!==null;){switch(r=s,r.tag){case 0:case 11:case 15:ka(8,r,r.return),Ko(r);break;case 22:c=r.stateNode,c._visibility&2&&(c._visibility&=-3,Ko(r));break;default:Ko(r)}s=s.sibling}}function Wx(s,r){for(;yn!==null;){var c=yn;switch(c.tag){case 0:case 11:case 15:ka(8,c,r);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Yr(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,yn=f;else e:for(c=s;yn!==null;){f=yn;var b=f.sibling,w=f.return;if(Lx(f),f===c){yn=null;break e}if(b!==null){b.return=w,yn=b;break e}yn=w}}}var _S={getCacheForType:function(s){var r=Sn(ln),c=r.data.get(s);return c===void 0&&(c=s(),r.data.set(s,c)),c},cacheSignal:function(){return Sn(ln).controller.signal}},kS=typeof WeakMap=="function"?WeakMap:Map,jt=0,Ft=null,gt=null,bt=0,Tt=0,ns=null,Oa=!1,nr=!1,mf=!1,ra=0,Jt=0,Ia=0,bi=0,pf=0,ss=0,sr=0,ul=null,Wn=null,gf=!1,Xo=0,Gx=0,Zo=1/0,Jo=null,Da=null,bn=0,La=null,ar=null,la=0,xf=0,bf=null,Yx=null,dl=0,yf=null;function as(){return(jt&2)!==0&&bt!==0?bt&-bt:W.T!==null?jf():Ut()}function qx(){if(ss===0)if((bt&536870912)===0||vt){var s=Fe;Fe<<=1,(Fe&3932160)===0&&(Fe=262144),ss=s}else ss=536870912;return s=es.current,s!==null&&(s.flags|=32),ss}function Gn(s,r,c){(s===Ft&&(Tt===2||Tt===9)||s.cancelPendingCommit!==null)&&(ir(s,0),Ra(s,bt,ss,!1)),pn(s,c),((jt&2)===0||s!==Ft)&&(s===Ft&&((jt&2)===0&&(bi|=c),Jt===4&&Ra(s,bt,ss,!1)),Ms(s))}function Vx(s,r,c){if((jt&6)!==0)throw Error(i(327));var f=!c&&(r&127)===0&&(r&s.expiredLanes)===0||Ot(s,r),b=f?DS(s,r):wf(s,r,!0),w=f;do{if(b===0){nr&&!f&&Ra(s,r,0,!1);break}else{if(c=s.current.alternate,w&&!OS(c)){b=wf(s,r,!1),w=!1;continue}if(b===2){if(w=r,s.errorRecoveryDisabledLanes&w)var M=0;else M=s.pendingLanes&-536870913,M=M!==0?M:M&536870912?536870912:0;if(M!==0){r=M;e:{var J=s;b=ul;var re=J.current.memoizedState.isDehydrated;if(re&&(ir(J,M).flags|=256),M=wf(J,M,!1),M!==2){if(mf&&!re){J.errorRecoveryDisabledLanes|=w,bi|=w,b=4;break e}w=Wn,Wn=b,w!==null&&(Wn===null?Wn=w:Wn.push.apply(Wn,w))}b=M}if(w=!1,b!==2)continue}}if(b===1){ir(s,0),Ra(s,r,0,!0);break}e:{switch(f=s,w=b,w){case 0:case 1:throw Error(i(345));case 4:if((r&4194048)!==r)break;case 6:Ra(f,r,ss,!Oa);break e;case 2:Wn=null;break;case 3:case 5:break;default:throw Error(i(329))}if((r&62914560)===r&&(b=Xo+300-Se(),10<b)){if(Ra(f,r,ss,!Oa),rt(f,0,!0)!==0)break e;la=r,f.timeoutHandle=j0(Kx.bind(null,f,c,Wn,Jo,gf,r,ss,bi,sr,Oa,w,"Throttled",-0,0),b);break e}Kx(f,c,Wn,Jo,gf,r,ss,bi,sr,Oa,w,null,-0,0)}}break}while(!0);Ms(s)}function Kx(s,r,c,f,b,w,M,J,re,xe,ke,De,Ne,Ee){if(s.timeoutHandle=-1,De=r.subtreeFlags,De&8192||(De&16785408)===16785408){De={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ys},Ux(r,w,De);var Ve=(w&62914560)===w?Xo-Se():(w&4194048)===w?Gx-Se():0;if(Ve=pC(De,Ve),Ve!==null){la=w,s.cancelPendingCommit=Ve(s0.bind(null,s,r,w,c,f,b,M,J,re,ke,De,null,Ne,Ee)),Ra(s,w,M,!xe);return}}s0(s,r,w,c,f,b,M,J,re)}function OS(s){for(var r=s;;){var c=r.tag;if((c===0||c===11||c===15)&&r.flags&16384&&(c=r.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var b=c[f],w=b.getSnapshot;b=b.value;try{if(!Jn(w(),b))return!1}catch{return!1}}if(c=r.child,r.subtreeFlags&16384&&c!==null)c.return=r,r=c;else{if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Ra(s,r,c,f){r&=~pf,r&=~bi,s.suspendedLanes|=r,s.pingedLanes&=~r,f&&(s.warmLanes|=r),f=s.expirationTimes;for(var b=r;0<b;){var w=31-Ue(b),M=1<<w;f[w]=-1,b&=~M}c!==0&&an(s,c,r)}function Qo(){return(jt&6)===0?(fl(0),!1):!0}function vf(){if(gt!==null){if(Tt===0)var s=gt.return;else s=gt,Xs=ci=null,Rd(s),Ki=null,Vr=0,s=gt;for(;s!==null;)Ex(s.alternate,s),s=s.return;gt=null}}function ir(s,r){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,ZS(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),la=0,vf(),Ft=s,gt=c=Vs(s.current,null),bt=r,Tt=0,ns=null,Oa=!1,nr=Ot(s,r),mf=!1,sr=ss=pf=bi=Ia=Jt=0,Wn=ul=null,gf=!1,(r&8)!==0&&(r|=r&32);var f=s.entangledLanes;if(f!==0)for(s=s.entanglements,f&=r;0<f;){var b=31-Ue(f),w=1<<b;r|=s[b],f&=~w}return ra=r,vo(),c}function Xx(s,r){dt=null,W.H=nl,r===Vi||r===To?(r=fg(),Tt=3):r===Sd?(r=fg(),Tt=4):Tt=r===Zd?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,ns=r,gt===null&&(Jt=1,Bo(s,us(r,s.current)))}function Zx(){var s=es.current;return s===null?!0:(bt&4194048)===bt?ms===null:(bt&62914560)===bt||(bt&536870912)!==0?s===ms:!1}function Jx(){var s=W.H;return W.H=nl,s===null?nl:s}function Qx(){var s=W.A;return W.A=_S,s}function ec(){Jt=4,Oa||(bt&4194048)!==bt&&es.current!==null||(nr=!0),(Ia&134217727)===0&&(bi&134217727)===0||Ft===null||Ra(Ft,bt,ss,!1)}function wf(s,r,c){var f=jt;jt|=2;var b=Jx(),w=Qx();(Ft!==s||bt!==r)&&(Jo=null,ir(s,r)),r=!1;var M=Jt;e:do try{if(Tt!==0&&gt!==null){var J=gt,re=ns;switch(Tt){case 8:vf(),M=6;break e;case 3:case 2:case 9:case 6:es.current===null&&(r=!0);var xe=Tt;if(Tt=0,ns=null,rr(s,J,re,xe),c&&nr){M=0;break e}break;default:xe=Tt,Tt=0,ns=null,rr(s,J,re,xe)}}IS(),M=Jt;break}catch(ke){Xx(s,ke)}while(!0);return r&&s.shellSuspendCounter++,Xs=ci=null,jt=f,W.H=b,W.A=w,gt===null&&(Ft=null,bt=0,vo()),M}function IS(){for(;gt!==null;)e0(gt)}function DS(s,r){var c=jt;jt|=2;var f=Jx(),b=Qx();Ft!==s||bt!==r?(Jo=null,Zo=Se()+500,ir(s,r)):nr=Ot(s,r);e:do try{if(Tt!==0&&gt!==null){r=gt;var w=ns;t:switch(Tt){case 1:Tt=0,ns=null,rr(s,r,w,1);break;case 2:case 9:if(ug(w)){Tt=0,ns=null,t0(r);break}r=function(){Tt!==2&&Tt!==9||Ft!==s||(Tt=7),Ms(s)},w.then(r,r);break e;case 3:Tt=7;break e;case 4:Tt=5;break e;case 7:ug(w)?(Tt=0,ns=null,t0(r)):(Tt=0,ns=null,rr(s,r,w,7));break;case 5:var M=null;switch(gt.tag){case 26:M=gt.memoizedState;case 5:case 27:var J=gt;if(M?z0(M):J.stateNode.complete){Tt=0,ns=null;var re=J.sibling;if(re!==null)gt=re;else{var xe=J.return;xe!==null?(gt=xe,tc(xe)):gt=null}break t}}Tt=0,ns=null,rr(s,r,w,5);break;case 6:Tt=0,ns=null,rr(s,r,w,6);break;case 8:vf(),Jt=6;break e;default:throw Error(i(462))}}LS();break}catch(ke){Xx(s,ke)}while(!0);return Xs=ci=null,W.H=f,W.A=b,jt=c,gt!==null?0:(Ft=null,bt=0,vo(),Jt)}function LS(){for(;gt!==null&&!ne();)e0(gt)}function e0(s){var r=Cx(s.alternate,s,ra);s.memoizedProps=s.pendingProps,r===null?tc(s):gt=r}function t0(s){var r=s,c=r.alternate;switch(r.tag){case 15:case 0:r=bx(c,r,r.pendingProps,r.type,void 0,bt);break;case 11:r=bx(c,r,r.pendingProps,r.type.render,r.ref,bt);break;case 5:Rd(r);default:Ex(c,r),r=gt=Qp(r,ra),r=Cx(c,r,ra)}s.memoizedProps=s.pendingProps,r===null?tc(s):gt=r}function rr(s,r,c,f){Xs=ci=null,Rd(r),Ki=null,Vr=0;var b=r.return;try{if(NS(s,b,r,c,bt)){Jt=1,Bo(s,us(c,s.current)),gt=null;return}}catch(w){if(b!==null)throw gt=b,w;Jt=1,Bo(s,us(c,s.current)),gt=null;return}r.flags&32768?(vt||f===1?s=!0:nr||(bt&536870912)!==0?s=!1:(Oa=s=!0,(f===2||f===9||f===3||f===6)&&(f=es.current,f!==null&&f.tag===13&&(f.flags|=16384))),n0(r,s)):tc(r)}function tc(s){var r=s;do{if((r.flags&32768)!==0){n0(r,Oa);return}s=r.return;var c=jS(r.alternate,r,ra);if(c!==null){gt=c;return}if(r=r.sibling,r!==null){gt=r;return}gt=r=s}while(r!==null);Jt===0&&(Jt=5)}function n0(s,r){do{var c=ES(s.alternate,s);if(c!==null){c.flags&=32767,gt=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!r&&(s=s.sibling,s!==null)){gt=s;return}gt=s=c}while(s!==null);Jt=6,gt=null}function s0(s,r,c,f,b,w,M,J,re){s.cancelPendingCommit=null;do nc();while(bn!==0);if((jt&6)!==0)throw Error(i(327));if(r!==null){if(r===s.current)throw Error(i(177));if(w=r.lanes|r.childLanes,w|=od,gn(s,c,w,M,J,re),s===Ft&&(gt=Ft=null,bt=0),ar=r,La=s,la=c,xf=w,bf=b,Yx=f,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,PS(We,function(){return o0(),null})):(s.callbackNode=null,s.callbackPriority=0),f=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||f){f=W.T,W.T=null,b=G.p,G.p=2,M=jt,jt|=4;try{AS(s,r,c)}finally{jt=M,G.p=b,W.T=f}}bn=1,a0(),i0(),r0()}}function a0(){if(bn===1){bn=0;var s=La,r=ar,c=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||c){c=W.T,W.T=null;var f=G.p;G.p=2;var b=jt;jt|=4;try{Px(r,s);var w=Df,M=Wp(s.containerInfo),J=w.focusedElem,re=w.selectionRange;if(M!==J&&J&&J.ownerDocument&&Hp(J.ownerDocument.documentElement,J)){if(re!==null&&sd(J)){var xe=re.start,ke=re.end;if(ke===void 0&&(ke=xe),"selectionStart"in J)J.selectionStart=xe,J.selectionEnd=Math.min(ke,J.value.length);else{var De=J.ownerDocument||document,Ne=De&&De.defaultView||window;if(Ne.getSelection){var Ee=Ne.getSelection(),Ve=J.textContent.length,st=Math.min(re.start,Ve),Rt=re.end===void 0?st:Math.min(re.end,Ve);!Ee.extend&&st>Rt&&(M=Rt,Rt=st,st=M);var fe=Bp(J,st),ce=Bp(J,Rt);if(fe&&ce&&(Ee.rangeCount!==1||Ee.anchorNode!==fe.node||Ee.anchorOffset!==fe.offset||Ee.focusNode!==ce.node||Ee.focusOffset!==ce.offset)){var pe=De.createRange();pe.setStart(fe.node,fe.offset),Ee.removeAllRanges(),st>Rt?(Ee.addRange(pe),Ee.extend(ce.node,ce.offset)):(pe.setEnd(ce.node,ce.offset),Ee.addRange(pe))}}}}for(De=[],Ee=J;Ee=Ee.parentNode;)Ee.nodeType===1&&De.push({element:Ee,left:Ee.scrollLeft,top:Ee.scrollTop});for(typeof J.focus=="function"&&J.focus(),J=0;J<De.length;J++){var Ie=De[J];Ie.element.scrollLeft=Ie.left,Ie.element.scrollTop=Ie.top}}mc=!!If,Df=If=null}finally{jt=b,G.p=f,W.T=c}}s.current=r,bn=2}}function i0(){if(bn===2){bn=0;var s=La,r=ar,c=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||c){c=W.T,W.T=null;var f=G.p;G.p=2;var b=jt;jt|=4;try{Dx(s,r.alternate,r)}finally{jt=b,G.p=f,W.T=c}}bn=3}}function r0(){if(bn===4||bn===3){bn=0,ge();var s=La,r=ar,c=la,f=Yx;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?bn=5:(bn=0,ar=La=null,l0(s,s.pendingLanes));var b=s.pendingLanes;if(b===0&&(Da=null),en(c),r=r.stateNode,ve&&typeof ve.onCommitFiberRoot=="function")try{ve.onCommitFiberRoot(Ge,r,void 0,(r.current.flags&128)===128)}catch{}if(f!==null){r=W.T,b=G.p,G.p=2,W.T=null;try{for(var w=s.onRecoverableError,M=0;M<f.length;M++){var J=f[M];w(J.value,{componentStack:J.stack})}}finally{W.T=r,G.p=b}}(la&3)!==0&&nc(),Ms(s),b=s.pendingLanes,(c&261930)!==0&&(b&42)!==0?s===yf?dl++:(dl=0,yf=s):dl=0,fl(0)}}function l0(s,r){(s.pooledCacheLanes&=r)===0&&(r=s.pooledCache,r!=null&&(s.pooledCache=null,Yr(r)))}function nc(){return a0(),i0(),r0(),o0()}function o0(){if(bn!==5)return!1;var s=La,r=xf;xf=0;var c=en(la),f=W.T,b=G.p;try{G.p=32>c?32:c,W.T=null,c=bf,bf=null;var w=La,M=la;if(bn=0,ar=La=null,la=0,(jt&6)!==0)throw Error(i(331));var J=jt;if(jt|=4,Hx(w.current),zx(w,w.current,M,c),jt=J,fl(0,!1),ve&&typeof ve.onPostCommitFiberRoot=="function")try{ve.onPostCommitFiberRoot(Ge,w)}catch{}return!0}finally{G.p=b,W.T=f,l0(s,r)}}function c0(s,r,c){r=us(c,r),r=Xd(s.stateNode,r,2),s=Aa(s,r,2),s!==null&&(pn(s,2),Ms(s))}function _t(s,r,c){if(s.tag===3)c0(s,s,c);else for(;r!==null;){if(r.tag===3){c0(r,s,c);break}else if(r.tag===1){var f=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Da===null||!Da.has(f))){s=us(c,s),c=ux(2),f=Aa(r,c,2),f!==null&&(dx(c,f,r,s),pn(f,2),Ms(f));break}}r=r.return}}function Nf(s,r,c){var f=s.pingCache;if(f===null){f=s.pingCache=new kS;var b=new Set;f.set(r,b)}else b=f.get(r),b===void 0&&(b=new Set,f.set(r,b));b.has(c)||(mf=!0,b.add(c),s=RS.bind(null,s,r,c),r.then(s,s))}function RS(s,r,c){var f=s.pingCache;f!==null&&f.delete(r),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,Ft===s&&(bt&c)===c&&(Jt===4||Jt===3&&(bt&62914560)===bt&&300>Se()-Xo?(jt&2)===0&&ir(s,0):pf|=c,sr===bt&&(sr=0)),Ms(s)}function u0(s,r){r===0&&(r=Et()),s=ri(s,r),s!==null&&(pn(s,r),Ms(s))}function MS(s){var r=s.memoizedState,c=0;r!==null&&(c=r.retryLane),u0(s,c)}function FS(s,r){var c=0;switch(s.tag){case 31:case 13:var f=s.stateNode,b=s.memoizedState;b!==null&&(c=b.retryLane);break;case 19:f=s.stateNode;break;case 22:f=s.stateNode._retryCache;break;default:throw Error(i(314))}f!==null&&f.delete(r),u0(s,c)}function PS(s,r){return Te(s,r)}var sc=null,lr=null,Sf=!1,ac=!1,Cf=!1,Ma=0;function Ms(s){s!==lr&&s.next===null&&(lr===null?sc=lr=s:lr=lr.next=s),ac=!0,Sf||(Sf=!0,zS())}function fl(s,r){if(!Cf&&ac){Cf=!0;do for(var c=!1,f=sc;f!==null;){if(s!==0){var b=f.pendingLanes;if(b===0)var w=0;else{var M=f.suspendedLanes,J=f.pingedLanes;w=(1<<31-Ue(42|s)+1)-1,w&=b&~(M&~J),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(c=!0,m0(f,w))}else w=bt,w=rt(f,f===Ft?w:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(w&3)===0||Ot(f,w)||(c=!0,m0(f,w));f=f.next}while(c);Cf=!1}}function $S(){d0()}function d0(){ac=Sf=!1;var s=0;Ma!==0&&XS()&&(s=Ma);for(var r=Se(),c=null,f=sc;f!==null;){var b=f.next,w=f0(f,r);w===0?(f.next=null,c===null?sc=b:c.next=b,b===null&&(lr=c)):(c=f,(s!==0||(w&3)!==0)&&(ac=!0)),f=b}bn!==0&&bn!==5||fl(s),Ma!==0&&(Ma=0)}function f0(s,r){for(var c=s.suspendedLanes,f=s.pingedLanes,b=s.expirationTimes,w=s.pendingLanes&-62914561;0<w;){var M=31-Ue(w),J=1<<M,re=b[M];re===-1?((J&c)===0||(J&f)!==0)&&(b[M]=et(J,r)):re<=r&&(s.expiredLanes|=J),w&=~J}if(r=Ft,c=bt,c=rt(s,s===r?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f=s.callbackNode,c===0||s===r&&(Tt===2||Tt===9)||s.cancelPendingCommit!==null)return f!==null&&f!==null&&_e(f),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Ot(s,c)){if(r=c&-c,r===s.callbackPriority)return r;switch(f!==null&&_e(f),en(c)){case 2:case 8:c=Be;break;case 32:c=We;break;case 268435456:c=Ae;break;default:c=We}return f=h0.bind(null,s),c=Te(c,f),s.callbackPriority=r,s.callbackNode=c,r}return f!==null&&f!==null&&_e(f),s.callbackPriority=2,s.callbackNode=null,2}function h0(s,r){if(bn!==0&&bn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(nc()&&s.callbackNode!==c)return null;var f=bt;return f=rt(s,s===Ft?f:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f===0?null:(Vx(s,f,r),f0(s,Se()),s.callbackNode!=null&&s.callbackNode===c?h0.bind(null,s):null)}function m0(s,r){if(nc())return null;Vx(s,r,!0)}function zS(){JS(function(){(jt&6)!==0?Te(Me,$S):d0()})}function jf(){if(Ma===0){var s=Yi;s===0&&(s=ae,ae<<=1,(ae&261888)===0&&(ae=256)),Ma=s}return Ma}function p0(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:fo(""+s)}function g0(s,r){var c=r.ownerDocument.createElement("input");return c.name=r.name,c.value=r.value,s.id&&c.setAttribute("form",s.id),r.parentNode.insertBefore(c,r),s=new FormData(s),c.parentNode.removeChild(c),s}function US(s,r,c,f,b){if(r==="submit"&&c&&c.stateNode===b){var w=p0((b[It]||null).action),M=f.submitter;M&&(r=(r=M[It]||null)?p0(r.formAction):M.getAttribute("formAction"),r!==null&&(w=r,M=null));var J=new go("action","action",null,f,b);s.push({event:J,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Ma!==0){var re=M?g0(b,M):new FormData(b);Wd(c,{pending:!0,data:re,method:b.method,action:w},null,re)}}else typeof w=="function"&&(J.preventDefault(),re=M?g0(b,M):new FormData(b),Wd(c,{pending:!0,data:re,method:b.method,action:w},w,re))},currentTarget:b}]})}}for(var Ef=0;Ef<ld.length;Ef++){var Af=ld[Ef],BS=Af.toLowerCase(),HS=Af[0].toUpperCase()+Af.slice(1);Ns(BS,"on"+HS)}Ns(qp,"onAnimationEnd"),Ns(Vp,"onAnimationIteration"),Ns(Kp,"onAnimationStart"),Ns("dblclick","onDoubleClick"),Ns("focusin","onFocus"),Ns("focusout","onBlur"),Ns(iS,"onTransitionRun"),Ns(rS,"onTransitionStart"),Ns(lS,"onTransitionCancel"),Ns(Xp,"onTransitionEnd"),Is("onMouseEnter",["mouseout","mouseover"]),Is("onMouseLeave",["mouseout","mouseover"]),Is("onPointerEnter",["pointerout","pointerover"]),Is("onPointerLeave",["pointerout","pointerover"]),$n("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),$n("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),$n("onBeforeInput",["compositionend","keypress","textInput","paste"]),$n("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),$n("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),$n("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),WS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(hl));function x0(s,r){r=(r&4)!==0;for(var c=0;c<s.length;c++){var f=s[c],b=f.event;f=f.listeners;e:{var w=void 0;if(r)for(var M=f.length-1;0<=M;M--){var J=f[M],re=J.instance,xe=J.currentTarget;if(J=J.listener,re!==w&&b.isPropagationStopped())break e;w=J,b.currentTarget=xe;try{w(b)}catch(ke){yo(ke)}b.currentTarget=null,w=re}else for(M=0;M<f.length;M++){if(J=f[M],re=J.instance,xe=J.currentTarget,J=J.listener,re!==w&&b.isPropagationStopped())break e;w=J,b.currentTarget=xe;try{w(b)}catch(ke){yo(ke)}b.currentTarget=null,w=re}}}}function xt(s,r){var c=r[Ii];c===void 0&&(c=r[Ii]=new Set);var f=s+"__bubble";c.has(f)||(b0(r,s,2,!1),c.add(f))}function Tf(s,r,c){var f=0;r&&(f|=4),b0(c,s,f,r)}var ic="_reactListening"+Math.random().toString(36).slice(2);function _f(s){if(!s[ic]){s[ic]=!0,wn.forEach(function(c){c!=="selectionchange"&&(WS.has(c)||Tf(c,!1,s),Tf(c,!0,s))});var r=s.nodeType===9?s:s.ownerDocument;r===null||r[ic]||(r[ic]=!0,Tf("selectionchange",!1,r))}}function b0(s,r,c,f){switch(q0(r)){case 2:var b=bC;break;case 8:b=yC;break;default:b=Wf}c=b.bind(null,r,c,s),b=void 0,!Vu||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(b=!0),f?b!==void 0?s.addEventListener(r,c,{capture:!0,passive:b}):s.addEventListener(r,c,!0):b!==void 0?s.addEventListener(r,c,{passive:b}):s.addEventListener(r,c,!1)}function kf(s,r,c,f,b){var w=f;if((r&1)===0&&(r&2)===0&&f!==null)e:for(;;){if(f===null)return;var M=f.tag;if(M===3||M===4){var J=f.stateNode.containerInfo;if(J===b)break;if(M===4)for(M=f.return;M!==null;){var re=M.tag;if((re===3||re===4)&&M.stateNode.containerInfo===b)return;M=M.return}for(;J!==null;){if(M=Re(J),M===null)return;if(re=M.tag,re===5||re===6||re===26||re===27){f=w=M;continue e}J=J.parentNode}}f=f.return}Sp(function(){var xe=w,ke=Yu(c),De=[];e:{var Ne=Zp.get(s);if(Ne!==void 0){var Ee=go,Ve=s;switch(s){case"keypress":if(mo(c)===0)break e;case"keydown":case"keyup":Ee=FN;break;case"focusin":Ve="focus",Ee=Ju;break;case"focusout":Ve="blur",Ee=Ju;break;case"beforeblur":case"afterblur":Ee=Ju;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ee=Ep;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ee=jN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ee=zN;break;case qp:case Vp:case Kp:Ee=TN;break;case Xp:Ee=BN;break;case"scroll":case"scrollend":Ee=SN;break;case"wheel":Ee=WN;break;case"copy":case"cut":case"paste":Ee=kN;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ee=Tp;break;case"toggle":case"beforetoggle":Ee=YN}var st=(r&4)!==0,Rt=!st&&(s==="scroll"||s==="scrollend"),fe=st?Ne!==null?Ne+"Capture":null:Ne;st=[];for(var ce=xe,pe;ce!==null;){var Ie=ce;if(pe=Ie.stateNode,Ie=Ie.tag,Ie!==5&&Ie!==26&&Ie!==27||pe===null||fe===null||(Ie=Rr(ce,fe),Ie!=null&&st.push(ml(ce,Ie,pe))),Rt)break;ce=ce.return}0<st.length&&(Ne=new Ee(Ne,Ve,null,c,ke),De.push({event:Ne,listeners:st}))}}if((r&7)===0){e:{if(Ne=s==="mouseover"||s==="pointerover",Ee=s==="mouseout"||s==="pointerout",Ne&&c!==Gu&&(Ve=c.relatedTarget||c.fromElement)&&(Re(Ve)||Ve[Ws]))break e;if((Ee||Ne)&&(Ne=ke.window===ke?ke:(Ne=ke.ownerDocument)?Ne.defaultView||Ne.parentWindow:window,Ee?(Ve=c.relatedTarget||c.toElement,Ee=xe,Ve=Ve?Re(Ve):null,Ve!==null&&(Rt=o(Ve),st=Ve.tag,Ve!==Rt||st!==5&&st!==27&&st!==6)&&(Ve=null)):(Ee=null,Ve=xe),Ee!==Ve)){if(st=Ep,Ie="onMouseLeave",fe="onMouseEnter",ce="mouse",(s==="pointerout"||s==="pointerover")&&(st=Tp,Ie="onPointerLeave",fe="onPointerEnter",ce="pointer"),Rt=Ee==null?Ne:At(Ee),pe=Ve==null?Ne:At(Ve),Ne=new st(Ie,ce+"leave",Ee,c,ke),Ne.target=Rt,Ne.relatedTarget=pe,Ie=null,Re(ke)===xe&&(st=new st(fe,ce+"enter",Ve,c,ke),st.target=pe,st.relatedTarget=Rt,Ie=st),Rt=Ie,Ee&&Ve)t:{for(st=GS,fe=Ee,ce=Ve,pe=0,Ie=fe;Ie;Ie=st(Ie))pe++;Ie=0;for(var nt=ce;nt;nt=st(nt))Ie++;for(;0<pe-Ie;)fe=st(fe),pe--;for(;0<Ie-pe;)ce=st(ce),Ie--;for(;pe--;){if(fe===ce||ce!==null&&fe===ce.alternate){st=fe;break t}fe=st(fe),ce=st(ce)}st=null}else st=null;Ee!==null&&y0(De,Ne,Ee,st,!1),Ve!==null&&Rt!==null&&y0(De,Rt,Ve,st,!0)}}e:{if(Ne=xe?At(xe):window,Ee=Ne.nodeName&&Ne.nodeName.toLowerCase(),Ee==="select"||Ee==="input"&&Ne.type==="file")var St=Mp;else if(Lp(Ne))if(Fp)St=nS;else{St=eS;var Ze=QN}else Ee=Ne.nodeName,!Ee||Ee.toLowerCase()!=="input"||Ne.type!=="checkbox"&&Ne.type!=="radio"?xe&&Wu(xe.elementType)&&(St=Mp):St=tS;if(St&&(St=St(s,xe))){Rp(De,St,c,ke);break e}Ze&&Ze(s,Ne,xe),s==="focusout"&&xe&&Ne.type==="number"&&xe.memoizedProps.value!=null&&Hu(Ne,"number",Ne.value)}switch(Ze=xe?At(xe):window,s){case"focusin":(Lp(Ze)||Ze.contentEditable==="true")&&(Pi=Ze,ad=xe,Hr=null);break;case"focusout":Hr=ad=Pi=null;break;case"mousedown":id=!0;break;case"contextmenu":case"mouseup":case"dragend":id=!1,Gp(De,c,ke);break;case"selectionchange":if(aS)break;case"keydown":case"keyup":Gp(De,c,ke)}var ht;if(ed)e:{switch(s){case"compositionstart":var yt="onCompositionStart";break e;case"compositionend":yt="onCompositionEnd";break e;case"compositionupdate":yt="onCompositionUpdate";break e}yt=void 0}else Fi?Ip(s,c)&&(yt="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(yt="onCompositionStart");yt&&(_p&&c.locale!=="ko"&&(Fi||yt!=="onCompositionStart"?yt==="onCompositionEnd"&&Fi&&(ht=Cp()):(va=ke,Ku="value"in va?va.value:va.textContent,Fi=!0)),Ze=rc(xe,yt),0<Ze.length&&(yt=new Ap(yt,s,null,c,ke),De.push({event:yt,listeners:Ze}),ht?yt.data=ht:(ht=Dp(c),ht!==null&&(yt.data=ht)))),(ht=VN?KN(s,c):XN(s,c))&&(yt=rc(xe,"onBeforeInput"),0<yt.length&&(Ze=new Ap("onBeforeInput","beforeinput",null,c,ke),De.push({event:Ze,listeners:yt}),Ze.data=ht)),US(De,s,xe,c,ke)}x0(De,r)})}function ml(s,r,c){return{instance:s,listener:r,currentTarget:c}}function rc(s,r){for(var c=r+"Capture",f=[];s!==null;){var b=s,w=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||w===null||(b=Rr(s,c),b!=null&&f.unshift(ml(s,b,w)),b=Rr(s,r),b!=null&&f.push(ml(s,b,w))),s.tag===3)return f;s=s.return}return[]}function GS(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function y0(s,r,c,f,b){for(var w=r._reactName,M=[];c!==null&&c!==f;){var J=c,re=J.alternate,xe=J.stateNode;if(J=J.tag,re!==null&&re===f)break;J!==5&&J!==26&&J!==27||xe===null||(re=xe,b?(xe=Rr(c,w),xe!=null&&M.unshift(ml(c,xe,re))):b||(xe=Rr(c,w),xe!=null&&M.push(ml(c,xe,re)))),c=c.return}M.length!==0&&s.push({event:r,listeners:M})}var YS=/\r\n?/g,qS=/\u0000|\uFFFD/g;function v0(s){return(typeof s=="string"?s:""+s).replace(YS,`
`).replace(qS,"")}function w0(s,r){return r=v0(r),v0(s)===r}function Lt(s,r,c,f,b,w){switch(c){case"children":typeof f=="string"?r==="body"||r==="textarea"&&f===""||Li(s,f):(typeof f=="number"||typeof f=="bigint")&&r!=="body"&&Li(s,""+f);break;case"className":co(s,"class",f);break;case"tabIndex":co(s,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":co(s,c,f);break;case"style":wp(s,f,w);break;case"data":if(r!=="object"){co(s,"data",f);break}case"src":case"href":if(f===""&&(r!=="a"||c!=="href")){s.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=fo(""+f),s.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(c==="formAction"?(r!=="input"&&Lt(s,r,"name",b.name,b,null),Lt(s,r,"formEncType",b.formEncType,b,null),Lt(s,r,"formMethod",b.formMethod,b,null),Lt(s,r,"formTarget",b.formTarget,b,null)):(Lt(s,r,"encType",b.encType,b,null),Lt(s,r,"method",b.method,b,null),Lt(s,r,"target",b.target,b,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=fo(""+f),s.setAttribute(c,f);break;case"onClick":f!=null&&(s.onclick=Ys);break;case"onScroll":f!=null&&xt("scroll",s);break;case"onScrollEnd":f!=null&&xt("scrollend",s);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(i(60));s.innerHTML=c}}break;case"multiple":s.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":s.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){s.removeAttribute("xlink:href");break}c=fo(""+f),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""+f):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":f===!0?s.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,f):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?s.setAttribute(c,f):s.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?s.removeAttribute(c):s.setAttribute(c,f);break;case"popover":xt("beforetoggle",s),xt("toggle",s),oo(s,"popover",f);break;case"xlinkActuate":Gs(s,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Gs(s,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Gs(s,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Gs(s,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Gs(s,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Gs(s,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Gs(s,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Gs(s,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Gs(s,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":oo(s,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=wN.get(c)||c,oo(s,c,f))}}function Of(s,r,c,f,b,w){switch(c){case"style":wp(s,f,w);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(i(60));s.innerHTML=c}}break;case"children":typeof f=="string"?Li(s,f):(typeof f=="number"||typeof f=="bigint")&&Li(s,""+f);break;case"onScroll":f!=null&&xt("scroll",s);break;case"onScrollEnd":f!=null&&xt("scrollend",s);break;case"onClick":f!=null&&(s.onclick=Ys);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!rs.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(b=c.endsWith("Capture"),r=c.slice(2,b?c.length-7:void 0),w=s[It]||null,w=w!=null?w[c]:null,typeof w=="function"&&s.removeEventListener(r,w,b),typeof f=="function")){typeof w!="function"&&w!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(r,f,b);break e}c in s?s[c]=f:f===!0?s.setAttribute(c,""):oo(s,c,f)}}}function jn(s,r,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":xt("error",s),xt("load",s);var f=!1,b=!1,w;for(w in c)if(c.hasOwnProperty(w)){var M=c[w];if(M!=null)switch(w){case"src":f=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:Lt(s,r,w,M,c,null)}}b&&Lt(s,r,"srcSet",c.srcSet,c,null),f&&Lt(s,r,"src",c.src,c,null);return;case"input":xt("invalid",s);var J=w=M=b=null,re=null,xe=null;for(f in c)if(c.hasOwnProperty(f)){var ke=c[f];if(ke!=null)switch(f){case"name":b=ke;break;case"type":M=ke;break;case"checked":re=ke;break;case"defaultChecked":xe=ke;break;case"value":w=ke;break;case"defaultValue":J=ke;break;case"children":case"dangerouslySetInnerHTML":if(ke!=null)throw Error(i(137,r));break;default:Lt(s,r,f,ke,c,null)}}xp(s,w,J,re,xe,M,b,!1);return;case"select":xt("invalid",s),f=M=w=null;for(b in c)if(c.hasOwnProperty(b)&&(J=c[b],J!=null))switch(b){case"value":w=J;break;case"defaultValue":M=J;break;case"multiple":f=J;default:Lt(s,r,b,J,c,null)}r=w,c=M,s.multiple=!!f,r!=null?Di(s,!!f,r,!1):c!=null&&Di(s,!!f,c,!0);return;case"textarea":xt("invalid",s),w=b=f=null;for(M in c)if(c.hasOwnProperty(M)&&(J=c[M],J!=null))switch(M){case"value":f=J;break;case"defaultValue":b=J;break;case"children":w=J;break;case"dangerouslySetInnerHTML":if(J!=null)throw Error(i(91));break;default:Lt(s,r,M,J,c,null)}yp(s,f,b,w);return;case"option":for(re in c)if(c.hasOwnProperty(re)&&(f=c[re],f!=null))switch(re){case"selected":s.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:Lt(s,r,re,f,c,null)}return;case"dialog":xt("beforetoggle",s),xt("toggle",s),xt("cancel",s),xt("close",s);break;case"iframe":case"object":xt("load",s);break;case"video":case"audio":for(f=0;f<hl.length;f++)xt(hl[f],s);break;case"image":xt("error",s),xt("load",s);break;case"details":xt("toggle",s);break;case"embed":case"source":case"link":xt("error",s),xt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(xe in c)if(c.hasOwnProperty(xe)&&(f=c[xe],f!=null))switch(xe){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:Lt(s,r,xe,f,c,null)}return;default:if(Wu(r)){for(ke in c)c.hasOwnProperty(ke)&&(f=c[ke],f!==void 0&&Of(s,r,ke,f,c,void 0));return}}for(J in c)c.hasOwnProperty(J)&&(f=c[J],f!=null&&Lt(s,r,J,f,c,null))}function VS(s,r,c,f){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,w=null,M=null,J=null,re=null,xe=null,ke=null;for(Ee in c){var De=c[Ee];if(c.hasOwnProperty(Ee)&&De!=null)switch(Ee){case"checked":break;case"value":break;case"defaultValue":re=De;default:f.hasOwnProperty(Ee)||Lt(s,r,Ee,null,f,De)}}for(var Ne in f){var Ee=f[Ne];if(De=c[Ne],f.hasOwnProperty(Ne)&&(Ee!=null||De!=null))switch(Ne){case"type":w=Ee;break;case"name":b=Ee;break;case"checked":xe=Ee;break;case"defaultChecked":ke=Ee;break;case"value":M=Ee;break;case"defaultValue":J=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(i(137,r));break;default:Ee!==De&&Lt(s,r,Ne,Ee,f,De)}}Bu(s,M,J,re,xe,ke,w,b);return;case"select":Ee=M=J=Ne=null;for(w in c)if(re=c[w],c.hasOwnProperty(w)&&re!=null)switch(w){case"value":break;case"multiple":Ee=re;default:f.hasOwnProperty(w)||Lt(s,r,w,null,f,re)}for(b in f)if(w=f[b],re=c[b],f.hasOwnProperty(b)&&(w!=null||re!=null))switch(b){case"value":Ne=w;break;case"defaultValue":J=w;break;case"multiple":M=w;default:w!==re&&Lt(s,r,b,w,f,re)}r=J,c=M,f=Ee,Ne!=null?Di(s,!!c,Ne,!1):!!f!=!!c&&(r!=null?Di(s,!!c,r,!0):Di(s,!!c,c?[]:"",!1));return;case"textarea":Ee=Ne=null;for(J in c)if(b=c[J],c.hasOwnProperty(J)&&b!=null&&!f.hasOwnProperty(J))switch(J){case"value":break;case"children":break;default:Lt(s,r,J,null,f,b)}for(M in f)if(b=f[M],w=c[M],f.hasOwnProperty(M)&&(b!=null||w!=null))switch(M){case"value":Ne=b;break;case"defaultValue":Ee=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(i(91));break;default:b!==w&&Lt(s,r,M,b,f,w)}bp(s,Ne,Ee);return;case"option":for(var Ve in c)if(Ne=c[Ve],c.hasOwnProperty(Ve)&&Ne!=null&&!f.hasOwnProperty(Ve))switch(Ve){case"selected":s.selected=!1;break;default:Lt(s,r,Ve,null,f,Ne)}for(re in f)if(Ne=f[re],Ee=c[re],f.hasOwnProperty(re)&&Ne!==Ee&&(Ne!=null||Ee!=null))switch(re){case"selected":s.selected=Ne&&typeof Ne!="function"&&typeof Ne!="symbol";break;default:Lt(s,r,re,Ne,f,Ee)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var st in c)Ne=c[st],c.hasOwnProperty(st)&&Ne!=null&&!f.hasOwnProperty(st)&&Lt(s,r,st,null,f,Ne);for(xe in f)if(Ne=f[xe],Ee=c[xe],f.hasOwnProperty(xe)&&Ne!==Ee&&(Ne!=null||Ee!=null))switch(xe){case"children":case"dangerouslySetInnerHTML":if(Ne!=null)throw Error(i(137,r));break;default:Lt(s,r,xe,Ne,f,Ee)}return;default:if(Wu(r)){for(var Rt in c)Ne=c[Rt],c.hasOwnProperty(Rt)&&Ne!==void 0&&!f.hasOwnProperty(Rt)&&Of(s,r,Rt,void 0,f,Ne);for(ke in f)Ne=f[ke],Ee=c[ke],!f.hasOwnProperty(ke)||Ne===Ee||Ne===void 0&&Ee===void 0||Of(s,r,ke,Ne,f,Ee);return}}for(var fe in c)Ne=c[fe],c.hasOwnProperty(fe)&&Ne!=null&&!f.hasOwnProperty(fe)&&Lt(s,r,fe,null,f,Ne);for(De in f)Ne=f[De],Ee=c[De],!f.hasOwnProperty(De)||Ne===Ee||Ne==null&&Ee==null||Lt(s,r,De,Ne,f,Ee)}function N0(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function KS(){if(typeof performance.getEntriesByType=="function"){for(var s=0,r=0,c=performance.getEntriesByType("resource"),f=0;f<c.length;f++){var b=c[f],w=b.transferSize,M=b.initiatorType,J=b.duration;if(w&&J&&N0(M)){for(M=0,J=b.responseEnd,f+=1;f<c.length;f++){var re=c[f],xe=re.startTime;if(xe>J)break;var ke=re.transferSize,De=re.initiatorType;ke&&N0(De)&&(re=re.responseEnd,M+=ke*(re<J?1:(J-xe)/(re-xe)))}if(--f,r+=8*(w+M)/(b.duration/1e3),s++,10<s)break}}if(0<s)return r/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var If=null,Df=null;function lc(s){return s.nodeType===9?s:s.ownerDocument}function S0(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function C0(s,r){if(s===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&r==="foreignObject"?0:s}function Lf(s,r){return s==="textarea"||s==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Rf=null;function XS(){var s=window.event;return s&&s.type==="popstate"?s===Rf?!1:(Rf=s,!0):(Rf=null,!1)}var j0=typeof setTimeout=="function"?setTimeout:void 0,ZS=typeof clearTimeout=="function"?clearTimeout:void 0,E0=typeof Promise=="function"?Promise:void 0,JS=typeof queueMicrotask=="function"?queueMicrotask:typeof E0<"u"?function(s){return E0.resolve(null).then(s).catch(QS)}:j0;function QS(s){setTimeout(function(){throw s})}function Fa(s){return s==="head"}function A0(s,r){var c=r,f=0;do{var b=c.nextSibling;if(s.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"||c==="/&"){if(f===0){s.removeChild(b),dr(r);return}f--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")f++;else if(c==="html")pl(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,pl(c);for(var w=c.firstChild;w;){var M=w.nextSibling,J=w.nodeName;w[Xe]||J==="SCRIPT"||J==="STYLE"||J==="LINK"&&w.rel.toLowerCase()==="stylesheet"||c.removeChild(w),w=M}}else c==="body"&&pl(s.ownerDocument.body);c=b}while(c);dr(r)}function T0(s,r){var c=s;s=0;do{var f=c.nextSibling;if(c.nodeType===1?r?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(r?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),f&&f.nodeType===8)if(c=f.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=f}while(c)}function Mf(s){var r=s.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var c=r;switch(r=r.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Mf(c),oe(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function eC(s,r,c,f){for(;s.nodeType===1;){var b=c;if(s.nodeName.toLowerCase()!==r.toLowerCase()){if(!f&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(f){if(!s[Xe])switch(r){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(w=s.getAttribute("rel"),w==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(w!==b.rel||s.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||s.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||s.getAttribute("title")!==(b.title==null?null:b.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(w=s.getAttribute("src"),(w!==(b.src==null?null:b.src)||s.getAttribute("type")!==(b.type==null?null:b.type)||s.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&w&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(r==="input"&&s.type==="hidden"){var w=b.name==null?null:""+b.name;if(b.type==="hidden"&&s.getAttribute("name")===w)return s}else return s;if(s=ps(s.nextSibling),s===null)break}return null}function tC(s,r,c){if(r==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=ps(s.nextSibling),s===null))return null;return s}function _0(s,r){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!r||(s=ps(s.nextSibling),s===null))return null;return s}function Ff(s){return s.data==="$?"||s.data==="$~"}function Pf(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function nC(s,r){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=r;else if(s.data!=="$?"||c.readyState!=="loading")r();else{var f=function(){r(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),s._reactRetry=f}}function ps(s){for(;s!=null;s=s.nextSibling){var r=s.nodeType;if(r===1||r===3)break;if(r===8){if(r=s.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return s}var $f=null;function k0(s){s=s.nextSibling;for(var r=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(r===0)return ps(s.nextSibling);r--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||r++}s=s.nextSibling}return null}function O0(s){s=s.previousSibling;for(var r=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(r===0)return s;r--}else c!=="/$"&&c!=="/&"||r++}s=s.previousSibling}return null}function I0(s,r,c){switch(r=lc(c),s){case"html":if(s=r.documentElement,!s)throw Error(i(452));return s;case"head":if(s=r.head,!s)throw Error(i(453));return s;case"body":if(s=r.body,!s)throw Error(i(454));return s;default:throw Error(i(451))}}function pl(s){for(var r=s.attributes;r.length;)s.removeAttributeNode(r[0]);oe(s)}var gs=new Map,D0=new Set;function oc(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var oa=G.d;G.d={f:sC,r:aC,D:iC,C:rC,L:lC,m:oC,X:uC,S:cC,M:dC};function sC(){var s=oa.f(),r=Qo();return s||r}function aC(s){var r=Ye(s);r!==null&&r.tag===5&&r.type==="form"?Xg(r):oa.r(s)}var or=typeof document>"u"?null:document;function L0(s,r,c){var f=or;if(f&&typeof r=="string"&&r){var b=os(r);b='link[rel="'+s+'"][href="'+b+'"]',typeof c=="string"&&(b+='[crossorigin="'+c+'"]'),D0.has(b)||(D0.add(b),s={rel:s,crossOrigin:c,href:r},f.querySelector(b)===null&&(r=f.createElement("link"),jn(r,"link",s),mt(r),f.head.appendChild(r)))}}function iC(s){oa.D(s),L0("dns-prefetch",s,null)}function rC(s,r){oa.C(s,r),L0("preconnect",s,r)}function lC(s,r,c){oa.L(s,r,c);var f=or;if(f&&s&&r){var b='link[rel="preload"][as="'+os(r)+'"]';r==="image"&&c&&c.imageSrcSet?(b+='[imagesrcset="'+os(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(b+='[imagesizes="'+os(c.imageSizes)+'"]')):b+='[href="'+os(s)+'"]';var w=b;switch(r){case"style":w=cr(s);break;case"script":w=ur(s)}gs.has(w)||(s=g({rel:"preload",href:r==="image"&&c&&c.imageSrcSet?void 0:s,as:r},c),gs.set(w,s),f.querySelector(b)!==null||r==="style"&&f.querySelector(gl(w))||r==="script"&&f.querySelector(xl(w))||(r=f.createElement("link"),jn(r,"link",s),mt(r),f.head.appendChild(r)))}}function oC(s,r){oa.m(s,r);var c=or;if(c&&s){var f=r&&typeof r.as=="string"?r.as:"script",b='link[rel="modulepreload"][as="'+os(f)+'"][href="'+os(s)+'"]',w=b;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=ur(s)}if(!gs.has(w)&&(s=g({rel:"modulepreload",href:s},r),gs.set(w,s),c.querySelector(b)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(xl(w)))return}f=c.createElement("link"),jn(f,"link",s),mt(f),c.head.appendChild(f)}}}function cC(s,r,c){oa.S(s,r,c);var f=or;if(f&&s){var b=Yt(f).hoistableStyles,w=cr(s);r=r||"default";var M=b.get(w);if(!M){var J={loading:0,preload:null};if(M=f.querySelector(gl(w)))J.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":r},c),(c=gs.get(w))&&zf(s,c);var re=M=f.createElement("link");mt(re),jn(re,"link",s),re._p=new Promise(function(xe,ke){re.onload=xe,re.onerror=ke}),re.addEventListener("load",function(){J.loading|=1}),re.addEventListener("error",function(){J.loading|=2}),J.loading|=4,cc(M,r,f)}M={type:"stylesheet",instance:M,count:1,state:J},b.set(w,M)}}}function uC(s,r){oa.X(s,r);var c=or;if(c&&s){var f=Yt(c).hoistableScripts,b=ur(s),w=f.get(b);w||(w=c.querySelector(xl(b)),w||(s=g({src:s,async:!0},r),(r=gs.get(b))&&Uf(s,r),w=c.createElement("script"),mt(w),jn(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(b,w))}}function dC(s,r){oa.M(s,r);var c=or;if(c&&s){var f=Yt(c).hoistableScripts,b=ur(s),w=f.get(b);w||(w=c.querySelector(xl(b)),w||(s=g({src:s,async:!0,type:"module"},r),(r=gs.get(b))&&Uf(s,r),w=c.createElement("script"),mt(w),jn(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(b,w))}}function R0(s,r,c,f){var b=(b=ue.current)?oc(b):null;if(!b)throw Error(i(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(r=cr(c.href),c=Yt(b).hoistableStyles,f=c.get(r),f||(f={type:"style",instance:null,count:0,state:null},c.set(r,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=cr(c.href);var w=Yt(b).hoistableStyles,M=w.get(s);if(M||(b=b.ownerDocument||b,M={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(s,M),(w=b.querySelector(gl(s)))&&!w._p&&(M.instance=w,M.state.loading=5),gs.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},gs.set(s,c),w||fC(b,s,c,M.state))),r&&f===null)throw Error(i(528,""));return M}if(r&&f!==null)throw Error(i(529,""));return null;case"script":return r=c.async,c=c.src,typeof c=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=ur(c),c=Yt(b).hoistableScripts,f=c.get(r),f||(f={type:"script",instance:null,count:0,state:null},c.set(r,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,s))}}function cr(s){return'href="'+os(s)+'"'}function gl(s){return'link[rel="stylesheet"]['+s+"]"}function M0(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function fC(s,r,c,f){s.querySelector('link[rel="preload"][as="style"]['+r+"]")?f.loading=1:(r=s.createElement("link"),f.preload=r,r.addEventListener("load",function(){return f.loading|=1}),r.addEventListener("error",function(){return f.loading|=2}),jn(r,"link",c),mt(r),s.head.appendChild(r))}function ur(s){return'[src="'+os(s)+'"]'}function xl(s){return"script[async]"+s}function F0(s,r,c){if(r.count++,r.instance===null)switch(r.type){case"style":var f=s.querySelector('style[data-href~="'+os(c.href)+'"]');if(f)return r.instance=f,mt(f),f;var b=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(s.ownerDocument||s).createElement("style"),mt(f),jn(f,"style",b),cc(f,c.precedence,s),r.instance=f;case"stylesheet":b=cr(c.href);var w=s.querySelector(gl(b));if(w)return r.state.loading|=4,r.instance=w,mt(w),w;f=M0(c),(b=gs.get(b))&&zf(f,b),w=(s.ownerDocument||s).createElement("link"),mt(w);var M=w;return M._p=new Promise(function(J,re){M.onload=J,M.onerror=re}),jn(w,"link",f),r.state.loading|=4,cc(w,c.precedence,s),r.instance=w;case"script":return w=ur(c.src),(b=s.querySelector(xl(w)))?(r.instance=b,mt(b),b):(f=c,(b=gs.get(w))&&(f=g({},c),Uf(f,b)),s=s.ownerDocument||s,b=s.createElement("script"),mt(b),jn(b,"link",f),s.head.appendChild(b),r.instance=b);case"void":return null;default:throw Error(i(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(f=r.instance,r.state.loading|=4,cc(f,c.precedence,s));return r.instance}function cc(s,r,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=f.length?f[f.length-1]:null,w=b,M=0;M<f.length;M++){var J=f[M];if(J.dataset.precedence===r)w=J;else if(w!==b)break}w?w.parentNode.insertBefore(s,w.nextSibling):(r=c.nodeType===9?c.head:c,r.insertBefore(s,r.firstChild))}function zf(s,r){s.crossOrigin==null&&(s.crossOrigin=r.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=r.referrerPolicy),s.title==null&&(s.title=r.title)}function Uf(s,r){s.crossOrigin==null&&(s.crossOrigin=r.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=r.referrerPolicy),s.integrity==null&&(s.integrity=r.integrity)}var uc=null;function P0(s,r,c){if(uc===null){var f=new Map,b=uc=new Map;b.set(c,f)}else b=uc,f=b.get(c),f||(f=new Map,b.set(c,f));if(f.has(s))return f;for(f.set(s,null),c=c.getElementsByTagName(s),b=0;b<c.length;b++){var w=c[b];if(!(w[Xe]||w[Xt]||s==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var M=w.getAttribute(r)||"";M=s+M;var J=f.get(M);J?J.push(w):f.set(M,[w])}}return f}function $0(s,r,c){s=s.ownerDocument||s,s.head.insertBefore(c,r==="title"?s.querySelector("head > title"):null)}function hC(s,r,c){if(c===1||r.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return s=r.disabled,typeof r.precedence=="string"&&s==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function z0(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function mC(s,r,c,f){if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=cr(f.href),w=r.querySelector(gl(b));if(w){r=w._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(s.count++,s=dc.bind(s),r.then(s,s)),c.state.loading|=4,c.instance=w,mt(w);return}w=r.ownerDocument||r,f=M0(f),(b=gs.get(b))&&zf(f,b),w=w.createElement("link"),mt(w);var M=w;M._p=new Promise(function(J,re){M.onload=J,M.onerror=re}),jn(w,"link",f),c.instance=w}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,r),(r=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=dc.bind(s),r.addEventListener("load",c),r.addEventListener("error",c))}}var Bf=0;function pC(s,r){return s.stylesheets&&s.count===0&&hc(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var f=setTimeout(function(){if(s.stylesheets&&hc(s,s.stylesheets),s.unsuspend){var w=s.unsuspend;s.unsuspend=null,w()}},6e4+r);0<s.imgBytes&&Bf===0&&(Bf=62500*KS());var b=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&hc(s,s.stylesheets),s.unsuspend)){var w=s.unsuspend;s.unsuspend=null,w()}},(s.imgBytes>Bf?50:800)+r);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(f),clearTimeout(b)}}:null}function dc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)hc(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var fc=null;function hc(s,r){s.stylesheets=null,s.unsuspend!==null&&(s.count++,fc=new Map,r.forEach(gC,s),fc=null,dc.call(s))}function gC(s,r){if(!(r.state.loading&4)){var c=fc.get(s);if(c)var f=c.get(null);else{c=new Map,fc.set(s,c);for(var b=s.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<b.length;w++){var M=b[w];(M.nodeName==="LINK"||M.getAttribute("media")!=="not all")&&(c.set(M.dataset.precedence,M),f=M)}f&&c.set(null,f)}b=r.instance,M=b.getAttribute("data-precedence"),w=c.get(M)||f,w===f&&c.set(null,b),c.set(M,b),this.count++,f=dc.bind(this),b.addEventListener("load",f),b.addEventListener("error",f),w?w.parentNode.insertBefore(b,w.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(b,s.firstChild)),r.state.loading|=4}}var bl={$$typeof:_,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function xC(s,r,c,f,b,w,M,J,re){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Vt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vt(0),this.hiddenUpdates=Vt(null),this.identifierPrefix=f,this.onUncaughtError=b,this.onCaughtError=w,this.onRecoverableError=M,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=re,this.incompleteTransitions=new Map}function U0(s,r,c,f,b,w,M,J,re,xe,ke,De){return s=new xC(s,r,c,M,re,xe,ke,De,J),r=1,w===!0&&(r|=24),w=Qn(3,null,null,r),s.current=w,w.stateNode=s,r=vd(),r.refCount++,s.pooledCache=r,r.refCount++,w.memoizedState={element:f,isDehydrated:c,cache:r},Cd(w),s}function B0(s){return s?(s=Ui,s):Ui}function H0(s,r,c,f,b,w){b=B0(b),f.context===null?f.context=b:f.pendingContext=b,f=Ea(r),f.payload={element:c},w=w===void 0?null:w,w!==null&&(f.callback=w),c=Aa(s,f,r),c!==null&&(Gn(c,s,r),Xr(c,s,r))}function W0(s,r){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<r?c:r}}function Hf(s,r){W0(s,r),(s=s.alternate)&&W0(s,r)}function G0(s){if(s.tag===13||s.tag===31){var r=ri(s,67108864);r!==null&&Gn(r,s,67108864),Hf(s,67108864)}}function Y0(s){if(s.tag===13||s.tag===31){var r=as();r=Gt(r);var c=ri(s,r);c!==null&&Gn(c,s,r),Hf(s,r)}}var mc=!0;function bC(s,r,c,f){var b=W.T;W.T=null;var w=G.p;try{G.p=2,Wf(s,r,c,f)}finally{G.p=w,W.T=b}}function yC(s,r,c,f){var b=W.T;W.T=null;var w=G.p;try{G.p=8,Wf(s,r,c,f)}finally{G.p=w,W.T=b}}function Wf(s,r,c,f){if(mc){var b=Gf(f);if(b===null)kf(s,r,f,pc,c),V0(s,f);else if(wC(b,s,r,c,f))f.stopPropagation();else if(V0(s,f),r&4&&-1<vC.indexOf(s)){for(;b!==null;){var w=Ye(b);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var M=it(w.pendingLanes);if(M!==0){var J=w;for(J.pendingLanes|=2,J.entangledLanes|=2;M;){var re=1<<31-Ue(M);J.entanglements[1]|=re,M&=~re}Ms(w),(jt&6)===0&&(Zo=Se()+500,fl(0))}}break;case 31:case 13:J=ri(w,2),J!==null&&Gn(J,w,2),Qo(),Hf(w,2)}if(w=Gf(f),w===null&&kf(s,r,f,pc,c),w===b)break;b=w}b!==null&&f.stopPropagation()}else kf(s,r,f,null,c)}}function Gf(s){return s=Yu(s),Yf(s)}var pc=null;function Yf(s){if(pc=null,s=Re(s),s!==null){var r=o(s);if(r===null)s=null;else{var c=r.tag;if(c===13){if(s=u(r),s!==null)return s;s=null}else if(c===31){if(s=d(r),s!==null)return s;s=null}else if(c===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;s=null}else r!==s&&(s=null)}}return pc=s,null}function q0(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ce()){case Me:return 2;case Be:return 8;case We:case qe:return 32;case Ae:return 268435456;default:return 32}default:return 32}}var qf=!1,Pa=null,$a=null,za=null,yl=new Map,vl=new Map,Ua=[],vC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function V0(s,r){switch(s){case"focusin":case"focusout":Pa=null;break;case"dragenter":case"dragleave":$a=null;break;case"mouseover":case"mouseout":za=null;break;case"pointerover":case"pointerout":yl.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":vl.delete(r.pointerId)}}function wl(s,r,c,f,b,w){return s===null||s.nativeEvent!==w?(s={blockedOn:r,domEventName:c,eventSystemFlags:f,nativeEvent:w,targetContainers:[b]},r!==null&&(r=Ye(r),r!==null&&G0(r)),s):(s.eventSystemFlags|=f,r=s.targetContainers,b!==null&&r.indexOf(b)===-1&&r.push(b),s)}function wC(s,r,c,f,b){switch(r){case"focusin":return Pa=wl(Pa,s,r,c,f,b),!0;case"dragenter":return $a=wl($a,s,r,c,f,b),!0;case"mouseover":return za=wl(za,s,r,c,f,b),!0;case"pointerover":var w=b.pointerId;return yl.set(w,wl(yl.get(w)||null,s,r,c,f,b)),!0;case"gotpointercapture":return w=b.pointerId,vl.set(w,wl(vl.get(w)||null,s,r,c,f,b)),!0}return!1}function K0(s){var r=Re(s.target);if(r!==null){var c=o(r);if(c!==null){if(r=c.tag,r===13){if(r=u(c),r!==null){s.blockedOn=r,Pn(s.priority,function(){Y0(c)});return}}else if(r===31){if(r=d(c),r!==null){s.blockedOn=r,Pn(s.priority,function(){Y0(c)});return}}else if(r===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function gc(s){if(s.blockedOn!==null)return!1;for(var r=s.targetContainers;0<r.length;){var c=Gf(s.nativeEvent);if(c===null){c=s.nativeEvent;var f=new c.constructor(c.type,c);Gu=f,c.target.dispatchEvent(f),Gu=null}else return r=Ye(c),r!==null&&G0(r),s.blockedOn=c,!1;r.shift()}return!0}function X0(s,r,c){gc(s)&&c.delete(r)}function NC(){qf=!1,Pa!==null&&gc(Pa)&&(Pa=null),$a!==null&&gc($a)&&($a=null),za!==null&&gc(za)&&(za=null),yl.forEach(X0),vl.forEach(X0)}function xc(s,r){s.blockedOn===r&&(s.blockedOn=null,qf||(qf=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,NC)))}var bc=null;function Z0(s){bc!==s&&(bc=s,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){bc===s&&(bc=null);for(var r=0;r<s.length;r+=3){var c=s[r],f=s[r+1],b=s[r+2];if(typeof f!="function"){if(Yf(f||c)===null)continue;break}var w=Ye(c);w!==null&&(s.splice(r,3),r-=3,Wd(w,{pending:!0,data:b,method:c.method,action:f},f,b))}}))}function dr(s){function r(re){return xc(re,s)}Pa!==null&&xc(Pa,s),$a!==null&&xc($a,s),za!==null&&xc(za,s),yl.forEach(r),vl.forEach(r);for(var c=0;c<Ua.length;c++){var f=Ua[c];f.blockedOn===s&&(f.blockedOn=null)}for(;0<Ua.length&&(c=Ua[0],c.blockedOn===null);)K0(c),c.blockedOn===null&&Ua.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var b=c[f],w=c[f+1],M=b[It]||null;if(typeof w=="function")M||Z0(c);else if(M){var J=null;if(w&&w.hasAttribute("formAction")){if(b=w,M=w[It]||null)J=M.formAction;else if(Yf(b)!==null)continue}else J=M.action;typeof J=="function"?c[f+1]=J:(c.splice(f,3),f-=3),Z0(c)}}}function J0(){function s(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(M){return b=M})},focusReset:"manual",scroll:"manual"})}function r(){b!==null&&(b(),b=null),f||setTimeout(c,20)}function c(){if(!f&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,b=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(c,100),function(){f=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),b!==null&&(b(),b=null)}}}function Vf(s){this._internalRoot=s}yc.prototype.render=Vf.prototype.render=function(s){var r=this._internalRoot;if(r===null)throw Error(i(409));var c=r.current,f=as();H0(c,f,s,r,null,null)},yc.prototype.unmount=Vf.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var r=s.containerInfo;H0(s.current,2,null,s,null,null),Qo(),r[Ws]=null}};function yc(s){this._internalRoot=s}yc.prototype.unstable_scheduleHydration=function(s){if(s){var r=Ut();s={blockedOn:null,target:s,priority:r};for(var c=0;c<Ua.length&&r!==0&&r<Ua[c].priority;c++);Ua.splice(c,0,s),c===0&&K0(s)}};var Q0=t.version;if(Q0!=="19.2.3")throw Error(i(527,Q0,"19.2.3"));G.findDOMNode=function(s){var r=s._reactInternals;if(r===void 0)throw typeof s.render=="function"?Error(i(188)):(s=Object.keys(s).join(","),Error(i(268,s)));return s=h(r),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var SC={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:W,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vc.isDisabled&&vc.supportsFiber)try{Ge=vc.inject(SC),ve=vc}catch{}}return Sl.createRoot=function(s,r){if(!l(s))throw Error(i(299));var c=!1,f="",b=rx,w=lx,M=ox;return r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onUncaughtError!==void 0&&(b=r.onUncaughtError),r.onCaughtError!==void 0&&(w=r.onCaughtError),r.onRecoverableError!==void 0&&(M=r.onRecoverableError)),r=U0(s,1,!1,null,null,c,f,null,b,w,M,J0),s[Ws]=r.current,_f(s),new Vf(r)},Sl.hydrateRoot=function(s,r,c){if(!l(s))throw Error(i(299));var f=!1,b="",w=rx,M=lx,J=ox,re=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onUncaughtError!==void 0&&(w=c.onUncaughtError),c.onCaughtError!==void 0&&(M=c.onCaughtError),c.onRecoverableError!==void 0&&(J=c.onRecoverableError),c.formState!==void 0&&(re=c.formState)),r=U0(s,1,!0,r,c??null,f,b,re,w,M,J,J0),r.context=B0(null),c=r.current,f=as(),f=Gt(f),b=Ea(f),b.callback=null,Aa(c,b,f),c=f,r.current.lanes=c,pn(r,c),Ms(r),s[Ws]=r.current,_f(s),new yc(r)},Sl.version="19.2.3",Sl}var cb;function LC(){if(cb)return Zf.exports;cb=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Zf.exports=DC(),Zf.exports}var RC=LC();const MC=wu(RC),$=({name:e,className:t="",onClick:n,title:i})=>a.jsx("span",{className:`material-icons select-none ${t}`,onClick:n,title:i,style:{fontSize:"inherit"},children:e}),em={APP_NAME:"IIIF Field Archive Studio",VERSION:"3.0.0",TOAST_DURATION:3e3},Hv={USE_SIMPLIFIED_UI:!1,USE_KEYBOARD_DND:!1},FC=[{code:"en",label:"English",nativeName:"English"},{code:"de",label:"German",nativeName:"Deutsch"},{code:"fr",label:"French",nativeName:"Franais"},{code:"es",label:"Spanish",nativeName:"Espaol"},{code:"it",label:"Italian",nativeName:"Italiano"},{code:"ja",label:"Japanese",nativeName:""},{code:"zh",label:"Chinese",nativeName:""},{code:"ar",label:"Arabic",nativeName:""},{code:"pt",label:"Portuguese",nativeName:"Portugus"},{code:"ru",label:"Russian",nativeName:""},{code:"none",label:"Language-neutral",nativeName:void 0}],ub=[{key:"label",description:"Human-readable title for the item (required)",category:"iiif"},{key:"summary",description:"Brief description of the content",category:"iiif"},{key:"rights",description:"License URL (e.g., https://creativecommons.org/licenses/by/4.0/)",category:"iiif"},{key:"navDate",description:"Navigation date in ISO 8601 format (YYYY-MM-DD)",category:"iiif"},{key:"requiredStatement.value",description:"Required attribution text",category:"iiif"},{key:"metadata.title",description:"Title of the resource",category:"dublin-core"},{key:"metadata.creator",description:"Person or organization responsible for creating the content",category:"dublin-core"},{key:"metadata.date",description:"Date associated with the resource (YYYY-MM-DD or YYYY)",category:"dublin-core"},{key:"metadata.description",description:"Detailed description of the content",category:"dublin-core"},{key:"metadata.subject",description:"Topic or keywords (semicolon-separated for multiple)",category:"dublin-core"},{key:"metadata.type",description:"Nature of the resource (e.g., Image, Text, Dataset)",category:"dublin-core"},{key:"metadata.format",description:"File format or medium",category:"dublin-core"},{key:"metadata.identifier",description:"Unique identifier for the resource",category:"dublin-core"},{key:"metadata.source",description:"Related resource from which this was derived",category:"dublin-core"},{key:"metadata.language",description:"Language of the content (ISO 639-1 code)",category:"dublin-core"},{key:"metadata.coverage",description:"Spatial or temporal coverage (location, time period)",category:"dublin-core"},{key:"metadata.rights",description:"Copyright or access rights statement",category:"dublin-core"},{key:"metadata.publisher",description:"Entity responsible for making the resource available",category:"dublin-core"}];function wc(e){return e==="both"?ub:ub.filter(t=>t.category===e)}const ct={BASE_URL:{DEFAULT:"http://localhost/iiif",LEGACY_DOMAINS:["archive.local","example.org"],PATH_SEGMENT:"iiif"},ID_PATTERNS:{MANIFEST:(e,t)=>`${e}/manifest/${t}`,COLLECTION:(e,t)=>`${e}/collection/${t}`,CANVAS:(e,t)=>`${e}/canvas/${t}`,RANGE:(e,t)=>`${e}/range/${t}`,ANNOTATION_PAGE:(e,t)=>`${e}/page/${t}`,ANNOTATION:(e,t)=>`${e}/annotation/${t}`,SEARCH_SERVICE:(e,t)=>`${e}/search/${t}`,IMAGE_SERVICE:(e,t)=>`${e}/image/${t}`},INGEST:{COLLECTION_PREFIX:"_",ROOT_NAME:"root",ROOT_DISPLAY_NAME:"My Archive",LOOSE_FILES_Dir_NAME:"Files",META_FILE:"info.yml"}},kt={PRESENTATION_3:{CONTEXT:"http://iiif.io/api/presentation/3/context.json"},IMAGE_3:{CONTEXT:"http://iiif.io/api/image/3/context.json",PROTOCOL:"http://iiif.io/api/image"},SEARCH_2:{CONTEXT:"http://iiif.io/api/search/2/context.json",PROFILE:"http://iiif.io/api/search/2/search"},AUTH_2:{CONTEXT:"http://iiif.io/api/auth/2/context.json"},DISCOVERY_1:{CONTEXT:"http://iiif.io/api/discovery/1/context.json"}},Ps={RESEARCHER:["Location","Site Phase","Artifact Type","Material","Findings"],ARCHIVIST:["Title","Creator","Date","Format","Rights","Identifier","Language","Source","Description"],DEVELOPER:["Identifier","Technical Note","Linked Data URI","Image Service Profile"]},PC=[{key:"label",label:"Label",description:"Human-readable name",minLevel:"simple",category:"core"},{key:"summary",label:"Summary",description:"Brief description",minLevel:"simple",category:"core"},{key:"thumbnail",label:"Thumbnail",description:"Preview image",minLevel:"simple",category:"core"},{key:"metadata",label:"Metadata",description:"Descriptive key-value pairs",minLevel:"standard",category:"descriptive"},{key:"rights",label:"Rights",description:"License or rights statement URL",minLevel:"standard",category:"descriptive"},{key:"requiredStatement",label:"Attribution",description:"Required attribution text",minLevel:"standard",category:"descriptive"},{key:"navDate",label:"Navigation Date",description:"Date for timeline navigation",minLevel:"standard",category:"descriptive"},{key:"provider",label:"Provider",description:"Institution or person providing resource",minLevel:"standard",category:"descriptive"},{key:"behavior",label:"Behavior",description:"Presentation hints for viewers",minLevel:"advanced",category:"technical"},{key:"viewingDirection",label:"Viewing Direction",description:"Reading order (LTR, RTL, etc.)",minLevel:"advanced",category:"technical"},{key:"services",label:"Services",description:"Linked API services",minLevel:"advanced",category:"technical"},{key:"seeAlso",label:"See Also",description:"Related external resources",minLevel:"advanced",category:"technical"},{key:"rendering",label:"Rendering",description:"Alternate representations (PDF, etc.)",minLevel:"advanced",category:"technical"},{key:"partOf",label:"Part Of",description:"Parent collection reference",minLevel:"advanced",category:"structural"},{key:"start",label:"Start Canvas",description:"Initial canvas to display",minLevel:"advanced",category:"structural"},{key:"structures",label:"Structures",description:"Table of contents (Ranges)",minLevel:"advanced",category:"structural"}];function db(e){const t=["simple","standard","advanced"],n=t.indexOf(e);return PC.filter(i=>t.indexOf(i.minLevel)<=n)}const fb={title:"dc:title",creator:"dc:creator",subject:"dc:subject",description:"dc:description",publisher:"dc:publisher",contributor:"dc:contributor",date:"dc:date",type:"dc:type",format:"dc:format",identifier:"dc:identifier",source:"dc:source",language:"dc:language",relation:"dc:relation",coverage:"dc:coverage",rights:"dc:rights",location:"dc:coverage",gps:"dc:coverage"},$C=[{label:"No Rights Reserved (CC0)",value:"https://creativecommons.org/publicdomain/zero/1.0/"},{label:"Attribution (CC BY 4.0)",value:"https://creativecommons.org/licenses/by/4.0/"},{label:"Attribution-NonCommercial (CC BY-NC 4.0)",value:"https://creativecommons.org/licenses/by-nc/4.0/"},{label:"In Copyright",value:"http://rightsstatements.org/vocab/InC/1.0/"},{label:"Copyright Not Evaluated",value:"http://rightsstatements.org/vocab/CNE/1.0/"},{label:"No Known Copyright",value:"http://rightsstatements.org/vocab/NKC/1.0/"}],zC=["left-to-right","right-to-left","top-to-bottom","bottom-to-top"],Ln={jpg:{type:"Image",format:"image/jpeg",motivation:"painting"},jpeg:{type:"Image",format:"image/jpeg",motivation:"painting"},png:{type:"Image",format:"image/png",motivation:"painting"},webp:{type:"Image",format:"image/webp",motivation:"painting"},gif:{type:"Image",format:"image/gif",motivation:"painting"},mp3:{type:"Sound",format:"audio/mpeg",motivation:"painting"},wav:{type:"Sound",format:"audio/wav",motivation:"painting"},mp4:{type:"Video",format:"video/mp4",motivation:"painting"},txt:{type:"Text",format:"text/plain",motivation:"supplementing"},json:{type:"Dataset",format:"application/json",motivation:"supplementing"},glb:{type:"Model",format:"model/gltf-binary",motivation:"painting"}},Qt={defaultCanvasWidth:2e3,defaultCanvasHeight:2e3,defaultDuration:100,thumbnailWidth:250,thumbnailHeight:250,maxFileSize:100*1024*1024},Wv={jpeg:.85,webp:.85,preview:.8},UC={tileLayer:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"&copy; OpenStreetMap contributors",defaultZoom:2,defaultCenter:[20,0]},BC={min:.1,max:5,step:.1},HC={"wax-compatible":{name:"wax-compatible",label:"WAX Compatible",description:"Matches minicomp/wax defaults for static Jekyll sites",thumbnailWidth:250,sizes:[250,1140],fullWidth:1140,tileSize:256,scaleFactors:[1,2,4,8]},"level0-static":{name:"level0-static",label:"Level 0 Static",description:"Pre-generated sizes for static/serverless hosting (default)",thumbnailWidth:150,sizes:[150,600,1200],fullWidth:1200,tileSize:512,scaleFactors:[1,2,4,8]},"level2-dynamic":{name:"level2-dynamic",label:"Level 2 Dynamic",description:"Minimal derivatives for Level 2 image server deployment",thumbnailWidth:150,sizes:[150],fullWidth:0,tileSize:512,scaleFactors:[1,2,4,8,16]},"mobile-optimized":{name:"mobile-optimized",label:"Mobile Optimized",description:"Smaller derivatives optimized for mobile viewing",thumbnailWidth:100,sizes:[100,400,800],fullWidth:800,tileSize:256,scaleFactors:[1,2,4]},"archive-quality":{name:"archive-quality",label:"Archive Quality",description:"Larger derivatives for archival and print use",thumbnailWidth:250,sizes:[250,800,1600,3200],fullWidth:3200,tileSize:512,scaleFactors:[1,2,4,8,16]}},WC="level0-static";function ba(e){return HC[WC]}const Pl=[150,600,1200],Ht={Collection:{icon:"folder",colorClass:"text-amber-600",bgClass:"bg-amber-100",borderClass:"border-amber-200",label:"Collection",metaphor:"Literary Genres"},Manifest:{icon:"menu_book",colorClass:"text-emerald-600",bgClass:"bg-emerald-100",borderClass:"border-emerald-200",label:"Manifest",metaphor:"Book"},Canvas:{icon:"crop_original",colorClass:"text-blue-500",bgClass:"bg-blue-100",borderClass:"border-blue-200",label:"Canvas",metaphor:"Page"},Range:{icon:"segment",colorClass:"text-indigo-500",bgClass:"bg-indigo-100",borderClass:"border-indigo-200",label:"Range",metaphor:"Table of Contents"},AnnotationPage:{icon:"layers",colorClass:"text-purple-500",bgClass:"bg-purple-100",borderClass:"border-purple-200",label:"Annotation Page",metaphor:"Transparent overlay on page"},Annotation:{icon:"chat_bubble",colorClass:"text-teal-500",bgClass:"bg-teal-100",borderClass:"border-teal-200",label:"Annotation",metaphor:"Note / Mark on the transparent overlay"},Content:{icon:"image",colorClass:"text-slate-500",bgClass:"bg-slate-100",borderClass:"border-slate-200",label:"Content",metaphor:"The actual thing made with ink on the page"},AnnotationCollection:{icon:"collections_bookmark",colorClass:"text-pink-500",bgClass:"bg-pink-100",borderClass:"border-pink-200",label:"Annotation Collection",metaphor:"Collections of one/many persons annotations on a single page, book or genre"}},hb={KEYS:{ESCAPE:"Escape",TAB:"Tab"}},mb={focusableSelector:'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',focusDelay:50},Gv=S.createContext(void 0),ws=()=>{const e=S.useContext(Gv);if(!e)throw new Error("useToast must be used within a ToastProvider");return e},GC=({children:e})=>{const[t,n]=S.useState([]),i=S.useRef(new Set),l=S.useRef(null),o=3;S.useEffect(()=>()=>{i.current.forEach(clearTimeout),i.current.clear()},[]),S.useEffect(()=>{const h=()=>{if(t.length>0){const p=t[0].id;n(g=>g.filter(y=>y.id!==p))}};if(t.length>0)return document.addEventListener("click",h),()=>document.removeEventListener("click",h)},[t]);const u=S.useCallback((h,p="info",g)=>{const y=Math.random().toString(36).substr(2,9);n(v=>[...v.length>=o?v.slice(-o+1):v,{id:y,message:h,type:p,action:g}]);const x=setTimeout(()=>{n(v=>v.filter(N=>N.id!==y)),i.current.delete(x)},em.TOAST_DURATION);i.current.add(x)},[]),d=S.useCallback((h,p,g)=>{const y=Math.random().toString(36).substr(2,9);n(x=>[...x.length>=o?x.slice(-o+1):x,{id:y,message:h,type:p,action:g,persistent:!0}])},[]),m=S.useCallback(h=>{n(p=>p.filter(g=>g.id!==h))},[]);return a.jsxs(Gv.Provider,{value:{showToast:u,showPersistentToast:d},children:[e,a.jsx("div",{ref:l,className:"fixed bottom-4 right-4 z-[100] flex flex-col gap-2 pointer-events-none max-h-[300px] overflow-hidden","aria-live":"polite","aria-atomic":"true",role:"region","aria-label":"Notifications",children:t.map((h,p)=>a.jsxs("div",{role:h.type==="error"?"alert":"status","aria-live":h.type==="error"?"assertive":"polite","aria-atomic":"true",className:`pointer-events-auto min-w-[300px] max-w-[400px] p-4 rounded-lg shadow-xl border flex flex-col gap-2 animate-bounce-in ${h.type==="success"?"bg-white border-green-200 text-green-800":h.type==="error"?"bg-white border-red-200 text-red-800":h.type==="warning"?"bg-white border-amber-200 text-amber-800":"bg-slate-800 border-slate-700 text-white"} ${p===0?"opacity-100":"opacity-90"}`,style:{transform:`scale(${1-p*.05})`,marginBottom:p>0?"-8px":"0"},children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[a.jsx($,{name:h.type==="success"?"check_circle":h.type==="error"?"error":h.type==="warning"?"warning":"info",className:`shrink-0 ${h.type==="success"?"text-green-500":h.type==="error"?"text-red-500":h.type==="warning"?"text-amber-500":"text-blue-400"}`,"aria-hidden":"true"}),a.jsx("span",{className:"text-sm font-medium truncate",children:h.message})]}),a.jsx("button",{onClick:()=>m(h.id),className:"shrink-0 p-1 hover:bg-black/10 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-blue-600","aria-label":"Dismiss notification",type:"button",children:a.jsx($,{name:"close",className:"text-xs opacity-50 hover:opacity-100","aria-hidden":"true"})})]}),h.action&&a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{onClick:()=>{h.action?.onClick(),m(h.id)},className:`text-xs font-medium px-3 py-1.5 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 ${h.action.variant==="primary"?"bg-iiif-blue text-white hover:bg-iiif-blue/90 focus:ring-blue-600":h.type==="success"?"text-green-700 hover:bg-green-50 focus:ring-green-600":h.type==="error"?"text-red-700 hover:bg-red-50 focus:ring-red-600":h.type==="warning"?"text-amber-700 hover:bg-amber-50 focus:ring-amber-600":"text-blue-300 hover:bg-white/10 focus:ring-blue-400"}`,type:"button",children:h.action.label})})]},h.id))})]})};class ma extends S.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null,errorInfo:null},this.handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onRetry&&this.props.onRetry()}}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorInfo:null}}componentDidCatch(t,n){console.error("Uncaught error:",t,n),this.setState({errorInfo:n}),this.props.onError&&this.props.onError(t,n)}render(){return this.state.hasError?this.props.fallback?typeof this.props.fallback=="function"?this.props.fallback(this.state.error,this.handleRetry):this.props.fallback:a.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white max-w-lg w-full rounded-xl shadow-2xl overflow-hidden border border-red-100",children:[a.jsxs("div",{className:"bg-red-50 p-6 flex items-center gap-4 border-b border-red-100",children:[a.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-red-500 shrink-0",children:a.jsx($,{name:"error_outline",className:"text-3xl"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl font-bold text-red-900",children:"Something went wrong"}),a.jsx("p",{className:"text-red-700 text-sm",children:"The application encountered an unexpected error."})]})]}),a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("div",{className:"bg-slate-900 rounded-lg p-4 overflow-auto max-h-64 custom-scrollbar",children:[a.jsx("code",{className:"text-red-300 font-mono text-xs block mb-2",children:this.state.error&&this.state.error.toString()}),a.jsx("code",{className:"text-slate-500 font-mono text-[10px] whitespace-pre-wrap block",children:this.state.errorInfo&&this.state.errorInfo.componentStack})]}),a.jsx("div",{className:"flex gap-3 justify-end",children:a.jsxs("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-slate-800 text-white rounded font-bold text-sm hover:bg-slate-700 flex items-center gap-2",children:[a.jsx($,{name:"refresh"})," Reload Application"]})})]}),a.jsx("div",{className:"bg-slate-50 p-4 text-center text-xs text-slate-400 border-t",children:"If this persists, please export your data and report the issue."})]})}):this.props.children}}const yi=({viewName:e,error:t,onRetry:n,onSwitchView:i})=>a.jsx("div",{className:"flex-1 flex items-center justify-center p-8 bg-slate-50",children:a.jsxs("div",{className:"bg-white max-w-md w-full rounded-xl shadow-lg border border-amber-200 overflow-hidden",children:[a.jsxs("div",{className:"bg-amber-50 p-4 flex items-center gap-3 border-b border-amber-200",children:[a.jsx("div",{className:"w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center text-amber-600 shrink-0",children:a.jsx($,{name:"warning",className:"text-xl"})}),a.jsxs("div",{children:[a.jsxs("h2",{className:"text-base font-bold text-amber-900",children:[e," View Error"]}),a.jsx("p",{className:"text-amber-700 text-xs",children:"This view encountered a problem."})]})]}),a.jsxs("div",{className:"p-4 space-y-3",children:[t&&a.jsx("div",{className:"bg-slate-100 rounded-lg p-3 overflow-auto max-h-32",children:a.jsx("code",{className:"text-red-600 font-mono text-xs",children:t.message})}),a.jsx("p",{className:"text-slate-600 text-sm",children:"Your data is safe. You can try again or switch to a different view."}),a.jsxs("div",{className:"flex gap-2 justify-end pt-2",children:[i&&a.jsxs("button",{onClick:i,className:"px-3 py-1.5 text-slate-600 hover:bg-slate-100 rounded text-sm font-medium flex items-center gap-1",children:[a.jsx($,{name:"swap_horiz",className:"text-sm"})," Switch View"]}),a.jsxs("button",{onClick:n,className:"px-3 py-1.5 bg-amber-500 text-white rounded text-sm font-bold hover:bg-amber-600 flex items-center gap-1",children:[a.jsx($,{name:"refresh",className:"text-sm"})," Try Again"]})]})]})]})});function Le(e,t="en"){if(!e||typeof e!="object")return"";const n=e[t]||e.en||e.none||e["@none"]||Object.values(e)[0];return Array.isArray(n)&&n[0]||""}function Wt(e){return e?.type==="Canvas"}function zt(e){return e?.type==="Manifest"}function Mt(e){return e?.type==="Collection"}class pa{constructor(t){t?typeof t=="string"?this.map={none:[t]}:this.map=Object.fromEntries(Object.entries(t).map(([n,i])=>[n,[...i]])):this.map={}}get(t="none"){const n=[t,"none","@none","en"];for(const i of n){const l=this.map[i];if(l&&l.length>0&&l[0])return l[0]}for(const i of Object.values(this.map))if(i&&i.length>0&&i[0])return i[0];return""}getAll(t){return this.map[t]?[...this.map[t]]:[]}entries(){return Object.entries(this.map).map(([t,n])=>({locale:t,values:[...n]}))}set(t,n){return new pa({...this.map,[t]:[n]})}setAll(t,n){return new pa({...this.map,[t]:[...n]})}append(t,n){return new pa({...this.map,[t]:[...this.map[t]||[],n]})}remove(t){const n={...this.map};return delete n[t],new pa(n)}merge(t){return new pa({...this.map,...t.toJSON()})}isEmpty(){return Object.values(this.map).every(t=>!t||t.length===0||t.every(n=>!n||!n.trim()))}hasLocale(t){const n=this.map[t];return!!(n&&n.length>0&&n.some(i=>i&&i.trim()))}get locales(){return Object.keys(this.map).filter(t=>this.hasLocale(t))}get primaryLocale(){return this.locales[0]||null}toJSON(){return Object.fromEntries(Object.entries(this.map).map(([t,n])=>[t,[...n]]))}static of(t,n="none"){return new pa({[n]:[t]})}static empty(){return new pa}equals(t){const n=Object.keys(this.map).sort(),i=Object.keys(t.map).sort();return n.length!==i.length||n.join(",")!==i.join(",")?!1:n.every(l=>{const o=this.map[l],u=t.map[l];return o.length!==u.length?!1:o.every((d,m)=>d===u[m])})}toString(){return this.get()||"[empty]"}}const YC=[{level:"simple",label:"Simple",shortLabel:"S",icon:"travel_explore",description:"Streamlined interface with user-friendly terms",colorClass:"text-emerald-600 bg-emerald-50 border-emerald-200 hover:bg-emerald-100"},{level:"standard",label:"Standard",shortLabel:"Std",icon:"inventory",description:"Full IIIF terminology and standard features",colorClass:"text-blue-600 bg-blue-50 border-blue-200 hover:bg-blue-100"},{level:"advanced",label:"Advanced",shortLabel:"Adv",icon:"terminal",description:"Technical IDs, raw JSON-LD, and all features",colorClass:"text-purple-600 bg-purple-50 border-purple-200 hover:bg-purple-100"}],qC={simple:"bg-emerald-500 text-white border-emerald-600 shadow-md",standard:"bg-blue-500 text-white border-blue-600 shadow-md",advanced:"bg-purple-500 text-white border-purple-600 shadow-md"},VC={sm:{container:"gap-1",button:"px-2 py-1 text-[10px]",icon:"text-xs"},md:{container:"gap-2",button:"px-3 py-1.5 text-xs",icon:"text-sm"},lg:{container:"gap-2",button:"px-4 py-2 text-sm",icon:"text-base"}},KC=({currentLevel:e,onChange:t,className:n="",showLabels:i=!0,disabled:l=!1,size:o="md"})=>{const u=VC[o];return a.jsx("div",{className:`inline-flex items-center ${u.container} ${n}`,role:"radiogroup","aria-label":"Abstraction level",children:YC.map(d=>{const m=e===d.level;return a.jsxs("button",{type:"button",role:"radio","aria-checked":m,"aria-label":`${d.label} - ${d.description}`,disabled:l,onClick:()=>t(d.level),className:`
              flex items-center gap-1.5 rounded-lg border font-medium
              transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-offset-1
              ${u.button}
              ${m?`${qC[d.level]} focus:ring-${d.level==="simple"?"emerald":d.level==="standard"?"blue":"purple"}-400`:`${d.colorClass} focus:ring-slate-300`}
              ${l?"opacity-50 cursor-not-allowed":"cursor-pointer"}
            `,title:d.description,children:[a.jsx($,{name:d.icon,className:u.icon}),i&&a.jsx("span",{className:"hidden sm:inline",children:d.label}),!i&&a.jsx("span",{children:d.shortLabel})]},d.level)})})},Nu={USE_KEYBOARD_DND:!1,USE_WORKER_URL_CLEANUP:!0,USE_FILE_LIFECYCLE:!0,USE_WORKER_INGEST:!0},XC=Nu.USE_WORKER_INGEST,ZC=({fieldMode:e=!1,onImport:t,onOpenExternalImport:n,onExportTrigger:i,onOpenSettings:l,onToggleFieldMode:o,onToggleQuickHelp:u,abstractionLevel:d="standard",onAbstractionLevelChange:m,className:h=""})=>{const p=m,g="text-[9px] font-black uppercase tracking-widest mb-2 text-slate-500",y="h-px mb-3 bg-slate-800",x=j=>`
    flex items-center justify-center gap-2 px-3 py-2 rounded-lg transition-all border
    ${j?e?"bg-yellow-400/20 text-yellow-400 border-yellow-600 hover:bg-yellow-400/30":"bg-iiif-blue/20 text-iiif-blue border-iiif-blue hover:bg-iiif-blue/30":e?"bg-slate-800 text-slate-300 border-slate-600 hover:bg-slate-700 hover:text-white":"bg-slate-800 text-slate-400 border-slate-700 hover:bg-slate-700 hover:text-white"}
  `,v=`
    flex items-center gap-2 px-3 py-2.5 rounded-lg transition-all border group
    ${e?"bg-slate-800 text-slate-200 border-slate-600 hover:bg-slate-700 hover:border-yellow-400":"bg-slate-800 text-slate-300 border-slate-700 hover:bg-slate-700 hover:text-white hover:border-slate-500"}
  `,N=`
    w-full py-2.5 rounded-lg text-[11px] font-black uppercase tracking-widest 
    flex items-center justify-center gap-2 shadow-lg transition-all active:scale-95
    ${e?"bg-yellow-400 text-black hover:bg-yellow-300":"bg-iiif-blue text-white hover:bg-blue-600"}
  `;return a.jsxs("div",{className:`p-3 ${h}`,children:[p&&a.jsxs("div",{className:"mb-3",children:[a.jsx("div",{className:g,children:"Complexity"}),a.jsx(KC,{currentLevel:d,onChange:m,size:"sm",className:"w-full justify-center"})]}),a.jsxs("div",{className:"mb-3",children:[a.jsx("div",{className:g,children:"Import"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("label",{className:v,title:"Import local folder",children:[a.jsx($,{name:"folder_open",className:"text-lg group-hover:scale-110 transition-transform"}),a.jsx("span",{className:"text-[11px] font-bold",children:"Folder"}),a.jsx("input",{type:"file",multiple:!0,webkitdirectory:"",className:"hidden",onChange:t,"aria-hidden":"true"})]}),a.jsxs("button",{onClick:n,className:v,title:"Import remote manifest or collection",children:[a.jsx($,{name:"cloud_download",className:"text-lg group-hover:scale-110 transition-transform"}),a.jsx("span",{className:"text-[11px] font-bold",children:"Remote"})]})]})]}),a.jsx("div",{className:y}),a.jsxs("div",{className:"mb-3",children:[a.jsx("div",{className:g,children:"Actions"}),a.jsxs("button",{onClick:i,className:N,title:"Export archive to IIIF package",children:[a.jsx($,{name:"publish",className:"text-base"}),"Export Archive"]})]}),a.jsx("div",{className:y}),a.jsxs("div",{children:[a.jsx("div",{className:g,children:"Settings"}),a.jsxs("div",{className:"flex gap-2",children:[u&&a.jsxs("button",{onClick:u,className:x(),title:"Quick Help (?)",children:[a.jsx($,{name:"help_outline",className:"text-base"}),a.jsx("span",{className:"text-[10px] font-bold",children:"Help"})]}),a.jsxs("button",{onClick:l,className:x(),title:"Application settings",children:[a.jsx($,{name:"tune",className:"text-base"}),a.jsx("span",{className:"text-[10px] font-bold",children:"Settings"})]}),a.jsxs("button",{onClick:o,className:x(e),title:e?"Disable Field Mode":"Enable Field Mode",children:[a.jsx($,{name:e?"visibility":"visibility_off",className:"text-base"}),a.jsx("span",{className:"text-[10px] font-bold",children:"Field"})]})]})]})]})};function Ai(e,t){return e?e==="Collection"&&(t==="Manifest"||t==="Collection")?"reference":e==="Manifest"&&t==="Canvas"||e==="Canvas"&&t==="AnnotationPage"||e==="AnnotationPage"&&t==="Annotation"?"ownership":e==="Range"&&(t==="Canvas"||t==="Range")?"reference":"ownership":"none"}function th(e,t){const n=[],i=l=>{l.type===t&&n.push(l),(l.items||[]).forEach(i)};return i(e),n}function JC(e,t){const n=[],i=l=>{Mt(l)&&l.items?.some(d=>d.id===t)&&n.push(l),(l.items||[]).forEach(i)};return i(e),n}function Yv(e,t){if(e.id===t)return e;const n=e.items||e.annotations||[];for(const i of n){const l=Yv(i,t);if(l)return l}return null}function Ja(e,t){return{Collection:["Collection","Manifest"],Manifest:["Canvas"],Canvas:["AnnotationPage"],AnnotationPage:["Annotation"],Range:["Range","Canvas"]}[e]?.includes(t)||!1}function Kc(e){return{Collection:["Collection","Manifest"],Manifest:["Canvas"],Canvas:["AnnotationPage"],AnnotationPage:["Annotation"],Range:["Range"]}[e]||[]}function QC(e){const t=new Map,n=(i,l)=>{if(l&&(Mt(i)||zt(i))){const u=t.get(i.id)||[];u.includes(l)||t.set(i.id,[...u,l])}(i.items||[]).forEach(u=>n(u,Mt(i)?i.id:l))};return n(e),t}function qv(e,t){const n=t||ct.BASE_URL.DEFAULT,i=typeof crypto.randomUUID=="function"?crypto.randomUUID():Math.random().toString(36).substring(2,15);switch(e){case"Manifest":return ct.ID_PATTERNS.MANIFEST(n,i);case"Collection":return ct.ID_PATTERNS.COLLECTION(n,i);case"Range":return ct.ID_PATTERNS.RANGE(n,i)}return`${n}/${e.toLowerCase()}/${i}`}const pb="panel-size-",ej=10,tj=50;function qm(e){const{id:t,defaultSize:n,minSize:i,maxSize:l,direction:o,side:u,collapseThreshold:d=0,persist:m=!0,onCollapse:h,onExpand:p}=e,g=()=>{if(m&&typeof window<"u"){const G=localStorage.getItem(`${pb}${t}`);if(G){const te=parseInt(G,10);if(!isNaN(te)&&te>=i&&te<=l)return te}}return n},[y,x]=S.useState(g),[v,N]=S.useState(!1),[j,C]=S.useState(!1),A=S.useRef(0),_=S.useRef(0);S.useRef(!1),S.useEffect(()=>{m&&!v&&localStorage.setItem(`${pb}${t}`,y.toString())},[t,y,m,v]);const T=S.useCallback(G=>Math.max(i,Math.min(l,G)),[i,l]),L=S.useCallback(G=>{const te=T(G);d>0&&te<d?(N(!0),h?.()):v&&te>=d&&(N(!1),p?.()),x(te)},[T,d,v,h,p]),H=S.useCallback(()=>{L(n),N(!1),p?.()},[n,L,p]),k=S.useCallback(()=>{v?(N(!1),p?.()):(N(!0),h?.())},[v,h,p]),R=S.useCallback(()=>{v&&(N(!1),p?.())},[v,p]),z=S.useCallback(()=>{v||(N(!0),h?.())},[v,h]),P=S.useCallback(G=>"touches"in G?o==="horizontal"?G.touches[0].clientX:G.touches[0].clientY:o==="horizontal"?G.clientX:G.clientY,[o]),K=S.useCallback(G=>{G.preventDefault();const U=P(G)-A.current,V=u==="right"||u==="bottom"?-U:U,O=_.current+V;L(O)},[P,L,u]),I=S.useCallback(()=>{C(!1),document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",I),window.removeEventListener("touchmove",K),window.removeEventListener("touchend",I)},[K]),D=S.useCallback(G=>{if(G.preventDefault(),v){N(!1),p?.();return}C(!0),A.current="touches"in G?o==="horizontal"?G.touches[0].clientX:G.touches[0].clientY:o==="horizontal"?G.clientX:G.clientY,_.current=y,document.body.style.cursor=o==="horizontal"?"col-resize":"row-resize",document.body.style.userSelect="none",window.addEventListener("mousemove",K),window.addEventListener("mouseup",I),window.addEventListener("touchmove",K,{passive:!1}),window.addEventListener("touchend",I)},[v,y,o,K,I,p]),E=S.useCallback(G=>{const te=G.shiftKey?tj:ej;o==="horizontal"?G.key==="ArrowLeft"?(G.preventDefault(),L(y-(u==="right"?-te:te))):G.key==="ArrowRight"&&(G.preventDefault(),L(y+(u==="right"?-te:te))):G.key==="ArrowUp"?(G.preventDefault(),L(y-(u==="bottom"?-te:te))):G.key==="ArrowDown"&&(G.preventDefault(),L(y+(u==="bottom"?-te:te))),G.key==="Home"?(G.preventDefault(),L(i)):G.key==="End"&&(G.preventDefault(),L(l))},[o,u,y,L,i,l]);S.useEffect(()=>()=>{window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",I),window.removeEventListener("touchmove",K),window.removeEventListener("touchend",I)},[K,I]);const q={onMouseDown:D,onTouchStart:D,onDoubleClick:H,onKeyDown:E,tabIndex:0,role:"separator","aria-label":`Resize ${t} panel`,"aria-valuenow":y,"aria-valuemin":i,"aria-valuemax":l,"aria-orientation":o==="horizontal"?"vertical":"horizontal",style:{cursor:o==="horizontal"?"col-resize":"row-resize",touchAction:"none"},className:`resize-handle resize-handle-${o} resize-handle-${u} ${j?"resizing":""}`},W={[o==="horizontal"?"width":"height"]:v?0:y,flexShrink:0,overflow:"hidden",transition:j?"none":"width 200ms ease, height 200ms ease"};return{size:y,isCollapsed:v,isResizing:j,startResize:D,resetSize:H,toggleCollapse:k,setSize:L,expand:R,collapse:z,handleProps:q,panelStyle:W}}const vi=({icon:e,label:t,active:n,onClick:i,fieldMode:l,disabled:o,title:u})=>a.jsxs("button",{onClick:i,disabled:o,title:u,"aria-current":n?"page":void 0,"aria-label":`${t} View`,className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg font-medium snappy-transition group active:scale-95 ${n?l?"bg-yellow-400 text-black font-black border-2 border-black shadow-md":"bg-iiif-blue text-white shadow-md transform scale-[1.02]":l?"text-slate-300 hover:bg-slate-800 hover:text-white":"text-slate-400 hover:bg-slate-800 hover:text-slate-200 hover:translate-x-1"} ${o?"opacity-50 cursor-not-allowed hover:bg-transparent":""}`,children:[a.jsx($,{name:e,className:`transition-transform duration-300 ${n?l?"text-black":"text-white":"text-slate-500 group-hover:scale-110"}`}),a.jsx("span",{className:l?"text-lg":"text-sm",children:t})]}),Vv=({item:e,level:t,selectedId:n,onSelect:i,viewType:l,fieldMode:o,root:u,onStructureUpdate:d,filterText:m,filterType:h})=>{const[p,g]=S.useState(!0),y=e.id===n,x=Ht[e.type]||Ht.Content,v=e.items||e.annotations||[],N=v.length>0,j=Le(e.label)||"Untitled",C=l==="files"?e._filename||e.id.split("/").pop():j,A=R=>{R.key==="Enter"||R.key===" "?(R.preventDefault(),i(e.id)):R.key==="ArrowRight"&&N&&!p?(R.preventDefault(),g(!0)):R.key==="ArrowLeft"&&N&&p&&(R.preventDefault(),g(!1))},_=!m||C.toLowerCase().includes(m.toLowerCase()),T=h==="All"||e.type===h,L=_&&T,H=R=>{R.dataTransfer.setData("application/iiif-item-id",e.id)},k=R=>{R.preventDefault();const z=R.dataTransfer.getData("application/iiif-item-id");if(z===e.id||!d||!u)return;const P=JSON.parse(JSON.stringify(u));let K=null;const I=E=>{const q=E.items||E.annotations||[],W=q.findIndex(G=>G.id===z);if(W>-1)return K=q.splice(W,1)[0],!0;for(const G of q)if(I(G))return!0;return!1},D=E=>{if(E.id===e.id){if(!K)return!1;if(!Ja(E.type,K.type)){const G=Kc(E.type);return console.warn(`Cannot drop ${K.type} into ${E.type}. Valid children: ${G.join(", ")||"none"}`),!1}const W=Ai(E.type,K.type);return console.log(`Creating ${W} relationship: ${E.type}  ${K.type}`),E.items||(E.items=[]),E.items.push(K),!0}const q=E.items||E.annotations||[];for(const W of q)if(D(W))return!0;return!1};I(P),K&&D(P)&&d(P)};return!L&&!N?null:a.jsxs("div",{className:"select-none",role:"none",children:[a.jsxs("div",{draggable:!0,onDragStart:H,onDragOver:R=>R.preventDefault(),onDrop:k,role:"treeitem","aria-selected":y,"aria-expanded":N?p:void 0,tabIndex:0,onKeyDown:A,className:`flex items-center gap-2 cursor-pointer snappy-transition border-l-4 outline-none focus-visible-ring group ${o?"py-3":"py-1.5 border-l-2"} ${y?o?"bg-yellow-400 border-yellow-600 text-black font-bold shadow-md scale-[1.01]":"bg-slate-800 border-iiif-blue text-white shadow-inner":o?"border-transparent text-slate-200 hover:bg-slate-800 hover:border-slate-700":"border-transparent text-slate-400 hover:text-slate-200 hover:bg-slate-800/50 hover:border-slate-700"}`,style:{paddingLeft:t*(o?20:12)+4},onClick:()=>i(e.id),children:[a.jsx("button",{"aria-label":p?`Collapse ${C}`:`Expand ${C}`,"aria-expanded":p,tabIndex:-1,className:`p-1 rounded hover:bg-white/10 transition-transform active:scale-95 ${N?"":"invisible"}`,onClick:R=>{R.stopPropagation(),g(!p)},children:a.jsx($,{name:p?"expand_more":"chevron_right",className:`transition-transform duration-200 ${p?"rotate-0":"-rotate-90"} ${o?"text-xl":"text-[16px]"}`})}),a.jsx($,{name:l==="files"?"folder":x.icon,className:`transition-colors ${o?"text-2xl":"text-[18px]"} ${y?"":x.colorClass} group-hover:brightness-125`}),a.jsx("span",{className:`${o?"text-base font-bold":"text-[11px] font-medium"} truncate transition-colors`,children:C})]}),N&&p&&a.jsx("div",{role:"group",className:"animate-fade-in origin-top",children:v.map(R=>a.jsx(Vv,{item:R,level:t+1,selectedId:n,onSelect:i,viewType:l,fieldMode:o,root:u,onStructureUpdate:d,filterText:m,filterType:h},R.id))})]})},nj=An.memo(function({root:t,selectedId:n,currentMode:i,viewType:l,fieldMode:o,onSelect:u,onModeChange:d,onViewTypeChange:m,onImport:h,onExportTrigger:p,onToggleFieldMode:g,onStructureUpdate:y,visible:x,onOpenExternalImport:v,onOpenSettings:N,onToggleQuickHelp:j,isMobile:C,onClose:A,abstractionLevel:_="standard",onAbstractionLevelChange:T}){const[L,H]=S.useState(""),[k,R]=S.useState("All"),{isResizing:z,handleProps:P,panelStyle:K}=qm({id:"sidebar",defaultSize:256,minSize:200,maxSize:400,direction:"horizontal",side:"right",collapseThreshold:0,persist:!0}),I=C?`fixed inset-y-0 left-0 z-[1000] w-72 shadow-2xl transition-transform duration-300 ${x?"translate-x-0":"-translate-x-full"}`:"flex flex-col h-full border-r shrink-0 relative",D=o?"bg-black border-slate-700":"bg-slate-900 border-slate-800 text-slate-300";return a.jsxs(a.Fragment,{children:[C&&x&&a.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[950]",onClick:A}),a.jsxs("aside",{className:`${I} ${D} flex flex-col overflow-hidden`,style:C?void 0:K,children:[a.jsxs("div",{className:`flex items-center px-4 shrink-0 gap-3 ${o?"h-20 border-b border-slate-700":"h-14 border-b border-slate-800"}`,children:[a.jsx("div",{className:`rounded flex items-center justify-center font-bold text-xs shadow-lg ${o?"w-10 h-10 bg-yellow-400 text-black":"w-8 h-8 bg-iiif-blue text-white"}`,children:"IIIF"}),a.jsxs("div",{className:"flex-1 overflow-hidden",children:[a.jsx("div",{className:`${o?"text-yellow-400 text-lg":"text-white text-sm"} font-black tracking-tight truncate`,children:em.APP_NAME}),a.jsxs("div",{className:`${o?"text-slate-400":"text-slate-500"} text-[10px] uppercase font-black tracking-widest`,children:["v",em.VERSION]})]}),C&&a.jsx("button",{onClick:A,"aria-label":"Close sidebar",className:"p-2 text-slate-500 hover:text-white",children:a.jsx($,{name:"close"})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar flex flex-col min-h-0",children:[a.jsxs("nav",{className:`p-3 space-y-2 border-b shrink-0 ${o?"border-slate-700":"border-slate-800"}`,children:[a.jsx(vi,{icon:"inventory_2",label:"Archive",active:i==="archive",onClick:()=>d("archive"),fieldMode:o}),a.jsx(vi,{icon:"account_tree",label:"Structure",active:i==="collections",onClick:()=>d("collections"),fieldMode:o}),a.jsx(vi,{icon:"table_chart",label:"Catalog",active:i==="metadata",onClick:()=>d("metadata"),fieldMode:o}),a.jsx(vi,{icon:"dashboard",label:"Boards",active:i==="boards",onClick:()=>d("boards"),fieldMode:o}),a.jsx(vi,{icon:"search",label:"Search",active:i==="search",onClick:()=>d("search"),fieldMode:o}),a.jsx(vi,{icon:"delete_outline",label:"Trash",active:i==="trash",onClick:()=>d("trash"),fieldMode:o}),a.jsx(vi,{icon:"visibility",label:"Viewer",active:i==="viewer",onClick:()=>n?d("viewer"):null,fieldMode:o,disabled:!n,title:n?"Open selected item in viewer":"Select an item to view"})]}),a.jsxs("div",{className:"px-4 py-3 flex flex-col gap-2 bg-black/10 shrink-0 sticky top-0 z-10 backdrop-blur-sm",children:[a.jsxs("div",{className:"flex items-center justify-between text-[10px] font-black text-slate-500 uppercase tracking-widest",children:[a.jsx("span",{id:"view-type-label",children:l==="files"?"Physical Disk":"Archival Model"}),a.jsxs("div",{role:"group","aria-labelledby":"view-type-label",className:`flex rounded p-0.5 ${o?"bg-slate-800 border border-slate-600":"bg-slate-800"}`,children:[a.jsx("button",{"aria-pressed":l==="files",className:`px-2 py-0.5 rounded transition-all ${l==="files"?o?"bg-white text-black":"bg-slate-600 text-white":"hover:text-slate-300"}`,onClick:()=>m("files"),children:"Files"}),a.jsx("button",{"aria-pressed":l==="iiif",className:`px-2 py-0.5 rounded transition-all ${l==="iiif"?o?"bg-white text-black":"bg-slate-600 text-white":"hover:text-slate-300"}`,onClick:()=>m("iiif"),children:"IIIF"})]})]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsxs("div",{className:"relative group flex-1",children:[a.jsx("input",{type:"text",value:L,onChange:E=>H(E.target.value),placeholder:"Filter...","aria-label":"Filter archive items",className:`w-full text-xs bg-slate-800 border border-slate-700 rounded-lg px-2 py-2 outline-none focus:border-iiif-blue transition-all ${o?"placeholder:text-slate-600":"placeholder:text-slate-500"}`}),a.jsx($,{name:"filter_list",className:"absolute right-2 top-2 text-[14px] text-slate-500 group-hover:text-slate-300"})]}),a.jsxs("select",{value:k,"aria-label":"Filter by resource type",onChange:E=>R(E.target.value),className:"w-16 text-[10px] bg-slate-800 border border-slate-700 rounded-lg px-1 outline-none text-slate-400 font-bold focus:border-iiif-blue",children:[a.jsx("option",{value:"All",children:"All"}),a.jsx("option",{value:"Collection",children:"Coll."}),a.jsx("option",{value:"Manifest",children:"Manif."}),a.jsx("option",{value:"Canvas",children:"Canvas"})]})]})]}),a.jsx("div",{className:"flex-1 pb-4",role:"tree","aria-label":"Archive Structure",children:t?a.jsx(Vv,{item:t,level:0,selectedId:n,onSelect:u,viewType:l,fieldMode:o,root:t,onStructureUpdate:y,filterText:L,filterType:k}):a.jsx("div",{className:"p-8 text-center text-slate-600 text-sm italic",children:"No field project active."})})]}),a.jsx("div",{className:`border-t shrink-0 ${o?"bg-black border-slate-700":"bg-slate-900 border-slate-800"}`,children:a.jsx(ZC,{fieldMode:o,onImport:h,onOpenExternalImport:v,onExportTrigger:p,onOpenSettings:N,onToggleFieldMode:g,onToggleQuickHelp:j,abstractionLevel:_,onAbstractionLevelChange:T})}),!C&&a.jsx("div",{...P,className:`
              absolute right-0 top-0 bottom-0 w-1 z-30 group
              cursor-col-resize
              transition-colors duration-150
              hover:bg-slate-500/20
              ${z?o?"bg-yellow-400/30":"bg-iiif-blue/30":""}
              ${P.className}
            `,children:a.jsx("div",{className:`
                absolute right-0 top-1/2 -translate-y-1/2
                w-1 h-12 rounded-full
                transition-all duration-150
                opacity-0 group-hover:opacity-100 group-focus:opacity-100
                ${z?o?"bg-yellow-400 opacity-100":"bg-iiif-blue opacity-100":o?"bg-slate-600 group-hover:bg-yellow-400":"bg-slate-500 group-hover:bg-iiif-blue"}
              `})})]})]})},(e,t)=>e.root?.id===t.root?.id&&e.selectedId===t.selectedId&&e.fieldMode===t.fieldMode),sj="modulepreload",aj=function(e){return"/field-studio/"+e},gb={},Xc=function(t,n,i){let l=Promise.resolve();if(n&&n.length>0){let u=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),m=d?.nonce||d?.getAttribute("nonce");l=u(n.map(h=>{if(h=aj(h),h in gb)return;gb[h]=!0;const p=h.endsWith(".css"),g=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${g}`))return;const y=document.createElement("link");if(y.rel=p?"stylesheet":sj,p||(y.as="script"),y.crossOrigin="",y.href=h,m&&y.setAttribute("nonce",m),document.head.appendChild(y),p)return new Promise((x,v)=>{y.addEventListener("load",x),y.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(u){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=u,window.dispatchEvent(d),!d.defaultPrevented)throw u}return l.then(u=>{for(const d of u||[])d.status==="rejected"&&o(d.reason);return t().catch(o)})},Kv=({title:e,subtitle:t,children:n,type:i="field-note"})=>{const l={"field-note":"bg-amber-50 border-amber-200 text-amber-900",exhibit:"bg-blue-50 border-blue-200 text-blue-900",spec:"bg-slate-900 border-slate-700 text-slate-100"};return a.jsxs("div",{className:`p-4 rounded-xl border-l-4 shadow-sm my-4 animate-in fade-in slide-in-from-left-2 ${l[i]}`,children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx($,{name:i==="field-note"?"history_edu":i==="exhibit"?"account_balance":"terminal",className:"text-sm opacity-60"}),a.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest opacity-70",children:e})]}),t&&a.jsx("p",{className:"text-xs font-bold mb-2",children:t}),a.jsx("div",{className:"text-xs leading-relaxed opacity-90 italic",children:n})]})},sn={encode:e=>{const t=JSON.stringify(e),n=new TextEncoder().encode(t);return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},decode:e=>{try{let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4!==0;)t+="=";const n=atob(t),i=Uint8Array.from(n,o=>o.charCodeAt(0)),l=new TextDecoder().decode(i);return JSON.parse(l)}catch(t){return console.error("[ContentState] Decoding failed",t),null}},createContentState:e=>{const t=[];if(e.region){const{x:i,y:l,w:o,h:u}=e.region;t.push({type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:`xywh=${Math.round(i)},${Math.round(l)},${Math.round(o)},${Math.round(u)}`})}if(e.time){let i="t=";e.time.start!==void 0&&e.time.end!==void 0?i+=`${e.time.start},${e.time.end}`:e.time.start!==void 0&&(i+=e.time.start),t.push({type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:i})}e.annotationId&&t.push({type:"AnnotationSelector",value:e.annotationId});const n={type:"SpecificResource",source:{id:e.canvasId,type:"Canvas",partOf:[{id:e.manifestId,type:"Manifest"}]}};return t.length===1?n.selector=t[0]:t.length>1&&(n.selector=t),{"@context":kt.PRESENTATION_3.CONTEXT,type:"Annotation",motivation:"contentState",target:n}},parseContentState:e=>{try{let t=e.target;for(;Array.isArray(t);)t=t[0];if(typeof t=="string")return{manifestId:t,canvasId:t};if(!t||typeof t!="object"||t.type!=="SpecificResource")return null;const n=t,i=n.source,l=typeof i=="string"?i:i.id,u={manifestId:typeof i=="object"&&i.partOf?.[0]?.id?i.partOf[0].id:l,canvasId:l},d=Array.isArray(n.selector)?n.selector:n.selector?[n.selector]:[];for(const m of d)if(m.type==="FragmentSelector"){const h=m.value,p=h.match(/xywh=(\d+),(\d+),(\d+),(\d+)/);p&&(u.region={x:parseInt(p[1]),y:parseInt(p[2]),w:parseInt(p[3]),h:parseInt(p[4])});const g=h.match(/t=([\d.]+)(?:,([\d.]+))?/);g&&(u.time={start:parseFloat(g[1]),end:g[2]?parseFloat(g[2]):void 0})}else if(m.type==="AnnotationSelector")u.annotationId=m.value;else if(m.type==="PointSelector"){const h=m;h.x!==void 0&&h.y!==void 0&&(u.region={x:h.x-50,y:h.y-50,w:100,h:100}),h.t!==void 0&&(u.time={start:h.t})}return u}catch(t){return console.error("[ContentState] Parse failed",t),null}},generateLink:(e,t)=>{try{if(!t.manifestId||!t.canvasId)return console.warn("[ContentState] Invalid viewport state - missing manifestId or canvasId"),window.location.href;let n=e;(!n||n==="/"||n.trim()==="")&&(n=window.location.origin+window.location.pathname),n.startsWith("http")||(n=window.location.origin+(n.startsWith("/")?"":"/")+n),n=n.replace(/\/+$/,""),n===window.location.origin&&(n=window.location.origin+"/field-studio/".replace(/\/$/,""));const l=sn.createContentState(t),o=sn.encode(l),u=new URL(n);return u.searchParams.set("iiif-content",o),u.toString()}catch(n){return console.error("[ContentState] URL generation failed",n),window.location.href}},generateCanvasLink:(e,t,n)=>sn.generateLink(e,{manifestId:t,canvasId:n}),parseFromUrl:(e=window.location.href)=>{try{const n=new URL(e).searchParams.get("iiif-content");if(!n)return null;const i=sn.decode(n);return i?sn.parseContentState(i):null}catch(t){return console.error("[ContentState] URL parse failed",t),null}},updateUrl:e=>{const t=sn.generateLink(window.location.origin+window.location.pathname,e);window.history.replaceState({},"",t)},copyLink:async e=>{try{const t=sn.generateLink(window.location.origin+window.location.pathname,e);return await navigator.clipboard.writeText(t),!0}catch(t){return console.error("[ContentState] Copy failed",t),!1}},generateEmbedCode:(e,t={})=>{const{width:n=800,height:i=600,viewerUrl:l=window.location.origin+"/viewer.html"}=t,o=sn.createContentState(e),u=sn.encode(o),d=new URL(l);return d.searchParams.set("iiif-content",u),`<iframe
  src="${d.toString()}"
  width="${n}"
  height="${i}"
  frameborder="0"
  allowfullscreen
  title="IIIF Viewer"
></iframe>`},handleDrop:e=>{const t=["application/ld+json","application/json","text/plain","text/uri-list"];for(const n of t){const i=e.getData(n);if(i){try{const l=JSON.parse(i);if(l.type==="Annotation"&&l.motivation&&(Array.isArray(l.motivation)?l.motivation:[l.motivation]).includes("contentState"))return sn.parseContentState(l)}catch{}if(i.startsWith("http")){const l=sn.parseFromUrl(i);if(l)return l}}}return null},createDragData:e=>{const t=sn.createContentState(e),n=sn.generateLink(window.location.origin+window.location.pathname,e);return{"application/ld+json":JSON.stringify(t,null,2),"application/json":JSON.stringify(t),"text/plain":n,"text/uri-list":n}},setDragData:(e,t)=>{const n=sn.createDragData(t);for(const[i,l]of Object.entries(n))e.setData(i,l)}},xb={4:"1rem",6:"1.5rem"},bb={minimum:{width:"44px",height:"44px"},field:{width:"56px",height:"56px"}},ij={shareButton:{label:"Share"}},rj=({item:e,manifestId:t,selectedRegion:n,currentTime:i,annotationId:l,fieldMode:o=!1,size:u="md"})=>{const{showToast:d}=ws(),[m,h]=S.useState(!1),[p,g]=S.useState(null),y=S.useRef(null);if(S.useEffect(()=>{const k=R=>{y.current&&!y.current.contains(R.target)&&h(!1)};return document.addEventListener("mousedown",k),()=>document.removeEventListener("mousedown",k)},[]),!e)return null;const x=()=>({manifestId:t||e.id,canvasId:e.id,region:n||void 0,time:i||void 0,annotationId:l||void 0}),v=async()=>{try{const k=x();await sn.copyLink(k)?(g("view"),d("View link copied to clipboard","success"),setTimeout(()=>g(null),2e3)):d("Could not copy link - try again","warning")}catch(k){console.error("[ShareButton] Copy view link failed:",k),d("Failed to copy link","error")}},N=async()=>{try{const k=x();if(!k.canvasId){d("No canvas selected","warning");return}await navigator.clipboard.writeText(k.canvasId),g("canvas"),d("Canvas URI copied to clipboard","success"),setTimeout(()=>g(null),2e3)}catch(k){console.error("[ShareButton] Copy canvas link failed:",k),d("Failed to copy link","error")}},j=async()=>{try{const k=x();if(!k.manifestId||!k.canvasId){d("No content to embed","warning");return}const R=sn.generateEmbedCode(k,{viewerUrl:window.location.origin+window.location.pathname});await navigator.clipboard.writeText(R),g("embed"),d("Embed code copied to clipboard","success"),setTimeout(()=>g(null),2e3)}catch(k){console.error("[ShareButton] Copy embed code failed:",k),d("Failed to copy embed code","error")}},C=async()=>{try{const k=x();if(!k.manifestId||!k.canvasId){d("No content state to copy","warning");return}const R=sn.createContentState(k);await navigator.clipboard.writeText(JSON.stringify(R,null,2)),g("json"),d("Content State JSON copied","success"),setTimeout(()=>g(null),2e3)}catch(k){console.error("[ShareButton] Copy JSON failed:",k),d("Failed to copy JSON","error")}},A=async()=>{try{const k=x(),R=sn.generateLink(window.location.origin+window.location.pathname,k);await navigator.share({title:Le(e.label,"en")||Le(e.label,"none")||"IIIF Resource",text:"View this resource in Field Studio",url:R}),d("Shared successfully","success"),h(!1)}catch(k){k.name!=="AbortError"&&d("Share cancelled","info")}},_=k=>{const R=x();sn.setDragData(k.dataTransfer,R),k.dataTransfer.effectAllowed="copy"},T=async()=>{navigator.share?await A():await v()},L=o?bb.field:bb.minimum,H={sm:"p-1.5 text-sm",md:"p-2",lg:"p-3 text-lg"};return o?a.jsx("button",{onClick:T,draggable:!0,onDragStart:_,className:`
          inline-flex items-center justify-center gap-2
          rounded-lg border transition-all
          bg-black text-yellow-400 border-yellow-400
          hover:bg-yellow-400 hover:text-black
          font-bold focus:outline-none focus:ring-2 focus:ring-yellow-400
          cursor-grab active:cursor-grabbing
        `,style:{height:L.height,minWidth:L.width,padding:`0 ${xb[6]}`,fontSize:"18px"},"aria-label":"Share this view",title:"Share this view",children:a.jsx($,{name:"share",className:"text-2xl"})}):a.jsxs("div",{className:"relative",ref:y,children:[a.jsxs("button",{onClick:()=>h(!m),draggable:!0,onDragStart:_,className:`
          ${H[u]}
          inline-flex items-center justify-center gap-2
          rounded-lg border transition-all
          bg-white text-slate-700 border-slate-300
          hover:bg-slate-50 hover:border-blue-500
          font-medium focus:outline-none focus:ring-2 focus:ring-blue-500
          cursor-grab active:cursor-grabbing
        `,style:{height:L.height,minWidth:L.width,padding:`0 ${xb[4]}`,fontSize:"14px"},"aria-label":"Share this view","aria-expanded":m,"aria-haspopup":"menu",title:"Share (drag to share via drag-and-drop)",children:[a.jsx($,{name:"share",className:"text-base"}),a.jsx("span",{children:ij.shareButton.label}),a.jsx($,{name:"expand_more",className:"text-base opacity-50"})]}),m&&a.jsxs("div",{className:"absolute top-full right-0 mt-2 w-72 bg-white rounded-xl shadow-xl border border-slate-200 z-50 overflow-hidden",style:{animation:"fadeIn 0.2s ease-out"},role:"menu",children:[a.jsxs("div",{className:"p-3 border-b border-slate-100 bg-slate-50",children:[a.jsx("h3",{className:"text-xs font-bold text-slate-700 uppercase tracking-wider",children:"Share This View"}),a.jsxs("p",{className:"text-[10px] text-slate-500 mt-0.5",children:[n?"Includes current zoom region":"Links to this canvas",i?` at ${i.start}s`:""]})]}),a.jsxs("div",{className:"p-2 space-y-1",children:[a.jsxs("button",{onClick:v,className:"w-full flex items-center gap-3 p-2.5 rounded-lg hover:bg-blue-50 text-left transition-colors group",role:"menuitem",children:[a.jsx("div",{className:"w-8 h-8 bg-iiif-blue/10 rounded-lg flex items-center justify-center text-iiif-blue group-hover:bg-iiif-blue group-hover:text-white transition-colors",children:a.jsx($,{name:p==="view"?"check":"content_copy"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-sm font-medium text-slate-800",children:p==="view"?"Copied!":"Copy View Link"}),a.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:n?"Share exact zoom & position":"Share current canvas"})]})]}),n&&a.jsxs("button",{onClick:N,className:"w-full flex items-center gap-3 p-2.5 rounded-lg hover:bg-slate-100 text-left transition-colors group",role:"menuitem",children:[a.jsx("div",{className:"w-8 h-8 bg-slate-100 rounded-lg flex items-center justify-center text-slate-500 group-hover:bg-slate-200 transition-colors",children:a.jsx($,{name:p==="canvas"?"check":"link"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-sm font-medium text-slate-800",children:p==="canvas"?"Copied!":"Copy Canvas Link"}),a.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:"Link to canvas (no zoom)"})]})]}),a.jsxs("button",{onClick:j,className:"w-full flex items-center gap-3 p-2.5 rounded-lg hover:bg-slate-100 text-left transition-colors group",role:"menuitem",children:[a.jsx("div",{className:"w-8 h-8 bg-slate-100 rounded-lg flex items-center justify-center text-slate-500 group-hover:bg-slate-200 transition-colors",children:a.jsx($,{name:p==="embed"?"check":"code"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-sm font-medium text-slate-800",children:p==="embed"?"Copied!":"Copy Embed Code"}),a.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:"HTML iframe for websites"})]})]}),a.jsxs("button",{onClick:C,className:"w-full flex items-center gap-3 p-2.5 rounded-lg hover:bg-slate-100 text-left transition-colors group",role:"menuitem",children:[a.jsx("div",{className:"w-8 h-8 bg-slate-100 rounded-lg flex items-center justify-center text-slate-500 group-hover:bg-slate-200 transition-colors",children:a.jsx($,{name:p==="json"?"check":"data_object"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-sm font-medium text-slate-800",children:p==="json"?"Copied!":"Copy Content State JSON"}),a.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:"IIIF Content State Annotation"})]})]}),typeof navigator<"u"&&navigator.share&&a.jsxs("button",{onClick:A,className:"w-full flex items-center gap-3 p-2.5 rounded-lg hover:bg-slate-100 text-left transition-colors group",role:"menuitem",children:[a.jsx("div",{className:"w-8 h-8 bg-slate-100 rounded-lg flex items-center justify-center text-slate-500 group-hover:bg-slate-200 transition-colors",children:a.jsx($,{name:"ios_share"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-sm font-medium text-slate-800",children:"Share via..."}),a.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:"Open system share dialog"})]})]})]}),a.jsx("div",{className:"p-3 border-t border-slate-100 bg-slate-50",children:a.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-slate-500",children:[a.jsx($,{name:"drag_indicator",className:"text-slate-400"}),a.jsx("span",{children:"Drag this button to share via drag-and-drop"})]})})]}),a.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(-10px); }
          to { opacity: 1; transform: translateY(0); }
        }
      `})]})};class lj{getNavPlace(t){return t.navPlace||null}setNavPlace(t,n){const i={...t};return n?i.navPlace=n:delete i.navPlace,i}createNavPlace(t,n){let i;if(Array.isArray(t))if(Array.isArray(t[0]))i={type:"Polygon",coordinates:t.map(o=>o.map(u=>[u.lng,u.lat]))};else{const l=t;l.length>2?i={type:"LineString",coordinates:l.map(o=>[o.lng,o.lat])}:i={type:"MultiPoint",coordinates:l.map(o=>[o.lng,o.lat])}}else i={type:"Point",coordinates:[t.lng,t.lat]};return{type:"Feature",geometry:i,properties:n||{}}}createFeatureCollection(t){return{type:"FeatureCollection",features:t}}createPointFeature(t,n,i){return{type:"Feature",geometry:{type:"Point",coordinates:[n,t]},properties:i||{}}}createBoundsFeature(t,n){const{north:i,south:l,east:o,west:u}=t;return{type:"Feature",geometry:{type:"Polygon",coordinates:[[[u,l],[o,l],[o,i],[u,i],[u,l]]]},properties:n||{}}}extractCoordinates(t){const n=[],i=l=>{switch(l.type){case"Point":n.push({lat:l.coordinates[1],lng:l.coordinates[0]});break;case"MultiPoint":case"LineString":for(const o of l.coordinates)n.push({lat:o[1],lng:o[0]});break;case"Polygon":case"MultiLineString":for(const o of l.coordinates)for(const u of o)n.push({lat:u[1],lng:u[0]});break;case"MultiPolygon":for(const o of l.coordinates)for(const u of o)for(const d of u)n.push({lat:d[1],lng:d[0]});break;case"GeometryCollection":for(const o of l.geometries)i(o);break}};if(t.type==="Feature"&&t.geometry)i(t.geometry);else if(t.type==="FeatureCollection"&&t.features)for(const l of t.features)i(l.geometry);return n}getCenter(t){const n=this.extractCoordinates(t);if(n.length===0)return null;const i=n.reduce((l,o)=>({lat:l.lat+o.lat,lng:l.lng+o.lng}),{lat:0,lng:0});return{lat:i.lat/n.length,lng:i.lng/n.length}}getBounds(t){const n=this.extractCoordinates(t);if(n.length===0)return null;let i=-90,l=90,o=-180,u=180;for(const d of n)d.lat>i&&(i=d.lat),d.lat<l&&(l=d.lat),d.lng>o&&(o=d.lng),d.lng<u&&(u=d.lng);return{north:i,south:l,east:o,west:u}}collectNavPlaces(t){const n=[],i=l=>{const o=this.getNavPlace(l);if(o&&n.push({item:l,navPlace:o}),l.items)for(const u of l.items)i(u)};return i(t),n}toGeoJSON(t){return t.type==="FeatureCollection"?{type:"FeatureCollection",features:(t.features||[]).map(n=>({type:"Feature",geometry:n.geometry,properties:n.properties||{}}))}:t.type==="Feature"&&t.geometry?{type:"FeatureCollection",features:[{type:"Feature",geometry:t.geometry,properties:t.properties||{}}]}:{type:"FeatureCollection",features:[]}}fromGeoJSON(t){return t.type==="FeatureCollection"?{type:"FeatureCollection",features:t.features.map(n=>({type:"Feature",geometry:n.geometry,properties:n.properties||{}}))}:t.type==="Feature"?{type:"Feature",geometry:t.geometry,properties:t.properties||{}}:{type:"FeatureCollection",features:[]}}async geocode(t){try{const n=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(t)}&format=json&limit=5`,i=await fetch(n,{headers:{"User-Agent":"IIIF-Field-Studio/1.0"}});if(!i.ok)throw new Error(`Geocoding failed: ${i.status}`);return(await i.json()).map(o=>({name:o.display_name,lat:parseFloat(o.lat),lng:parseFloat(o.lon),bounds:o.boundingbox?{south:parseFloat(o.boundingbox[0]),north:parseFloat(o.boundingbox[1]),west:parseFloat(o.boundingbox[2]),east:parseFloat(o.boundingbox[3])}:void 0,type:o.type}))}catch(n){return console.error("[NavPlace] Geocoding failed:",n),[]}}async reverseGeocode(t,n){try{const i=`https://nominatim.openstreetmap.org/reverse?lat=${t}&lon=${n}&format=json`,l=await fetch(i,{headers:{"User-Agent":"IIIF-Field-Studio/1.0"}});if(!l.ok)throw new Error(`Reverse geocoding failed: ${l.status}`);const o=await l.json();return{name:o.display_name,lat:parseFloat(o.lat),lng:parseFloat(o.lon),type:o.type}}catch(i){return console.error("[NavPlace] Reverse geocoding failed:",i),null}}pointInNavPlace(t,n){const i=this.getBounds(n);return i?t.lat>=i.south&&t.lat<=i.north&&t.lng>=i.west&&t.lng<=i.east:!1}calculateDistance(t,n){const l=t.lat*Math.PI/180,o=n.lat*Math.PI/180,u=(n.lat-t.lat)*Math.PI/180,d=(n.lng-t.lng)*Math.PI/180,m=Math.sin(u/2)*Math.sin(u/2)+Math.cos(l)*Math.cos(o)*Math.sin(d/2)*Math.sin(d/2);return 6371e3*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}formatCoordinates(t,n,i="dd"){if(i==="dd")return`${t.toFixed(6)}, ${n.toFixed(6)}`;const l=(o,u)=>{const d=Math.floor(Math.abs(o)),m=Math.floor((Math.abs(o)-d)*60),h=((Math.abs(o)-d)*60-m)*60,p=u?o>=0?"N":"S":o>=0?"E":"W";return`${d}${m}'${h.toFixed(1)}"${p}`};return`${l(t,!0)} ${l(n,!1)}`}}const ca=new lj,oj=({item:e,onChange:t,height:n=400,editable:i=!0})=>{const l=S.useRef(null),o=S.useRef(null),u=S.useRef(null),[d,m]=S.useState(""),[h,p]=S.useState([]),[g,y]=S.useState(!1),[x,v]=S.useState(!1),[N,j]=S.useState(null),[C,A]=S.useState(null),_=ca.getNavPlace(e);S.useEffect(()=>!l.current||o.current||l.current._leaflet_id?void 0:((async()=>{if(!l.current||o.current)return;const I=(await Xc(async()=>{const{default:q}=await import("./leaflet-src-Ce4fyP17.js").then(W=>W.l);return{default:q}},[])).default;if(delete I.Icon.Default.prototype._getIconUrl,I.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"}),l.current._leaflet_id)return;const D=I.map(l.current,{center:[0,0],zoom:2});I.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(D);const E=new I.FeatureGroup;D.addLayer(E),u.current=E,o.current=D,_&&T(_,D,E,I),D.on("click",q=>{if(C==="marker"&&i){const W=ca.createPointFeature(q.latlng.lat,q.latlng.lng);L(W),A(null)}}),D.on("moveend",()=>{const q=D.getCenter();j({lat:q.lat,lng:q.lng})})})(),()=>{o.current&&(o.current.remove(),o.current=null)}),[]),S.useEffect(()=>{if(!o.current||!u.current)return;(async()=>{const I=(await Xc(async()=>{const{default:D}=await import("./leaflet-src-Ce4fyP17.js").then(E=>E.l);return{default:D}},[])).default;u.current.clearLayers(),_&&T(_,o.current,u.current,I)})()},[_]);const T=async(K,I,D,E)=>{const q=ca.toGeoJSON(K);E.geoJSON(q,{pointToLayer:(te,U)=>E.marker(U),onEachFeature:(te,U)=>{const V=te.properties||{};if(V.label){const O=typeof V.label=="string"?V.label:Object.values(V.label)[0]?.[0]||"";O&&U.bindPopup(O)}}}).eachLayer(te=>{D.addLayer(te)});const G=ca.getBounds(K);G&&I.fitBounds([[G.south,G.west],[G.north,G.east]],{padding:[50,50]})},L=S.useCallback(K=>{let I;_?.type==="FeatureCollection"&&_.features?I={..._,features:[..._.features,K]}:_?.type==="Feature"?I={type:"FeatureCollection",features:[{type:"Feature",geometry:_.geometry,properties:_.properties},K]}:I={type:"Feature",geometry:K.geometry,properties:K.properties},t(I)},[_,t]),H=async()=>{if(d.trim()){y(!0);try{const K=await ca.geocode(d);p(K)}catch(K){console.error("Search failed:",K)}finally{y(!1)}}},k=K=>{if(o.current&&(K.bounds?o.current.fitBounds([[K.bounds.south,K.bounds.west],[K.bounds.north,K.bounds.east]]):o.current.setView([K.lat,K.lng],12)),i){const I=ca.createPointFeature(K.lat,K.lng,{label:K.name});L(I)}p([]),m(""),v(!1)},R=()=>{t(null),u.current&&u.current.clearLayers()},z=async()=>{if(!o.current)return;const K=o.current.getBounds(),I=ca.createBoundsFeature({north:K.getNorth(),south:K.getSouth(),east:K.getEast(),west:K.getWest()});L(I)},P=Le(e.label)||"Untitled";return a.jsxs("div",{className:"flex flex-col bg-white rounded-lg border overflow-hidden",children:[a.jsxs("div",{className:"flex items-center gap-2 p-2 border-b bg-slate-50",children:[a.jsxs("span",{className:"text-sm font-medium text-slate-700 mr-2",children:["NavPlace: ",P]}),a.jsx("div",{className:"flex-1"}),i&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"relative",children:[a.jsx("button",{onClick:()=>v(!x),className:`p-2 rounded-lg transition-colors ${x?"bg-iiif-blue text-white":"hover:bg-slate-200"}`,title:"Search location",children:a.jsx($,{name:"search"})}),x&&a.jsxs("div",{className:"absolute top-full right-0 mt-1 w-80 bg-white rounded-lg shadow-xl border z-50",children:[a.jsxs("div",{className:"p-2 flex gap-2",children:[a.jsx("input",{type:"text",value:d,onChange:K=>m(K.target.value),onKeyDown:K=>K.key==="Enter"&&H(),placeholder:"Search for a place...",className:"flex-1 px-3 py-2 border rounded-lg text-sm",autoFocus:!0}),a.jsx("button",{onClick:H,disabled:g,className:"px-3 py-2 bg-iiif-blue text-white rounded-lg text-sm disabled:opacity-50",children:g?"...":"Go"})]}),h.length>0&&a.jsx("div",{className:"max-h-60 overflow-auto border-t",children:h.map((K,I)=>a.jsxs("button",{onClick:()=>k(K),className:"w-full px-3 py-2 text-left hover:bg-slate-50 text-sm border-b last:border-b-0",children:[a.jsx("div",{className:"font-medium text-slate-800 truncate",children:K.name}),a.jsx("div",{className:"text-xs text-slate-500",children:ca.formatCoordinates(K.lat,K.lng)})]},I))})]})]}),a.jsxs("div",{className:"flex items-center border-l pl-2 ml-2",children:[a.jsx("button",{onClick:()=>A(C==="marker"?null:"marker"),className:`p-2 rounded-lg transition-colors ${C==="marker"?"bg-iiif-blue text-white":"hover:bg-slate-200"}`,title:"Add marker (click on map)",children:a.jsx($,{name:"place"})}),a.jsx("button",{onClick:z,className:"p-2 rounded-lg hover:bg-slate-200 transition-colors",title:"Add current view as boundary",children:a.jsx($,{name:"crop_free"})})]}),_&&a.jsx("button",{onClick:R,className:"p-2 rounded-lg hover:bg-red-100 text-red-600 transition-colors",title:"Clear all locations",children:a.jsx($,{name:"delete"})})]})]}),a.jsx("div",{ref:l,style:{height:n},className:"w-full"}),a.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 bg-slate-50 border-t text-xs text-slate-500",children:[a.jsx("div",{children:_?a.jsx(a.Fragment,{children:_.type==="FeatureCollection"?`${_.features?.length||0} features`:"1 feature"}):"No location set"}),N&&a.jsx("div",{children:ca.formatCoordinates(N.lat,N.lng)})]}),C&&a.jsxs("div",{className:"absolute top-16 left-1/2 -translate-x-1/2 bg-iiif-blue text-white px-4 py-2 rounded-full text-sm shadow-lg z-50",children:["Click on map to add ",C,a.jsx("button",{onClick:()=>A(null),className:"ml-2 hover:text-red-200",children:""})]})]})},Xv={simple:{Collection:"Album",Manifest:"Item Group",Canvas:"Page",Annotation:"Note",AnnotationPage:"Note Layer",Range:"Chapter",AnnotationCollection:"Note Collection",Archive:"Library",archive:"library","Archive Explorer":"Library Explorer",Inspector:"Details",Metadata:"Information",Label:"Title",Summary:"Description",Rights:"License",Behavior:"Display Mode",Structures:"Table of Contents",viewingDirection:"Reading Order",navDate:"Date",navPlace:"Location",requiredStatement:"Attribution",provider:"Source",seeAlso:"Related Links",rendering:"Downloads",thumbnail:"Preview",Ingest:"Import",ingest:"import",Export:"Save",export:"save",Synthesize:"Create",synthesize:"create",Batch:"Multiple",batch:"multiple","IIIF Collection":"Album","IIIF Manifest":"Item Group","IIIF Canvas":"Page","W3C Web Annotation":"Note",painting:"content",supplementing:"attachment",commenting:"comment",tagging:"tag",identifying:"identification",describing:"description",workspace:"Browse",detail:"Edit",preview:"View","Source Manifests":"Files","Archive Layout":"Organization","Assign to Collection":"Add to Album","Create Collection":"Create Album",Unassigned:"Not in Album"},standard:{Collection:"Collection",Manifest:"Manifest",Canvas:"Canvas",Annotation:"Annotation",AnnotationPage:"Annotation Page",Range:"Range",AnnotationCollection:"Annotation Collection",Archive:"Archive",archive:"archive","Archive Explorer":"Archive Explorer",Inspector:"Inspector",Metadata:"Metadata",Label:"Label",Summary:"Summary",Rights:"Rights",Behavior:"Behavior",Structures:"Structures",viewingDirection:"Viewing Direction",navDate:"Navigation Date",navPlace:"Navigation Place",requiredStatement:"Required Statement",provider:"Provider",seeAlso:"See Also",rendering:"Rendering",thumbnail:"Thumbnail",Ingest:"Ingest",ingest:"ingest",Export:"Export",export:"export",Synthesize:"Synthesize",synthesize:"synthesize",Batch:"Batch",batch:"batch","IIIF Collection":"IIIF Collection","IIIF Manifest":"IIIF Manifest","IIIF Canvas":"IIIF Canvas","W3C Web Annotation":"W3C Web Annotation",painting:"painting",supplementing:"supplementing",commenting:"commenting",tagging:"tagging",identifying:"identifying",describing:"describing",workspace:"Workspace",detail:"Detail",preview:"Preview","Source Manifests":"Source Manifests","Archive Layout":"Archive Layout","Assign to Collection":"Assign to Collection","Create Collection":"Create Collection",Unassigned:"Unassigned"},advanced:{Collection:"Collection",Manifest:"Manifest",Canvas:"Canvas",Annotation:"Annotation",AnnotationPage:"AnnotationPage",Range:"Range",AnnotationCollection:"AnnotationCollection",Archive:"Archive",archive:"archive","Archive Explorer":"Archive Explorer",Inspector:"Inspector",Metadata:"Metadata",Label:"label (IIIF)",Summary:"summary (IIIF)",Rights:"rights",Behavior:"behavior",Structures:"structures",viewingDirection:"viewingDirection",navDate:"navDate",navPlace:"navPlace",requiredStatement:"requiredStatement",provider:"provider",seeAlso:"seeAlso",rendering:"rendering",thumbnail:"thumbnail",Ingest:"Ingest",ingest:"ingest",Export:"Export",export:"export",Synthesize:"Synthesize",synthesize:"synthesize",Batch:"Batch",batch:"batch","IIIF Collection":"sc:Collection","IIIF Manifest":"sc:Manifest","IIIF Canvas":"sc:Canvas","W3C Web Annotation":"oa:Annotation",painting:"sc:painting",supplementing:"sc:supplementing",commenting:"oa:commenting",tagging:"oa:tagging",identifying:"oa:identifying",describing:"oa:describing",workspace:"workspace",detail:"detail",preview:"preview","Source Manifests":"Source Manifests","Archive Layout":"Archive Layout","Assign to Collection":"Assign to Collection","Create Collection":"Create Collection",Unassigned:"Unassigned"}};function Su(e,t){return Xv[t][e]||e}function cj(e,t){const n={};return e.forEach(i=>{n[i]=Su(i,t)}),n}function uj(e,t,n=!1){const i=Su(e,t);return n?`${/^[aeiou]/i.test(i)?"an":"a"} ${i}`:i}function dj(e){return{Collection:"A curated group of IIIF Manifests (like a folder or album)",Manifest:"A single IIIF resource describing a physical or digital object",Canvas:"A single view or page within a Manifest",Annotation:"A note, tag, or mark associated with a specific region",Range:"A structural division like a chapter or section",Label:"The primary name or title of the resource",Summary:"A brief description of the resource content",Rights:"License or rights statement URL",Behavior:"How the resource should be presented in viewers"}[e]||null}function fj(e,t,n){const i=Su(t,n),l=e===1?i:`${i}s`;return`${e} ${l}`}function Cu(e){const{level:t}=e,n=S.useMemo(()=>Xv[t],[t]),i=S.useCallback(h=>Su(h,t),[t]),l=S.useCallback(h=>cj(h,t),[t]),o=S.useCallback((h,p=!1)=>uj(h,t,p),[t]),u=S.useCallback(h=>dj(h),[]),d=S.useCallback((h,p)=>fj(h,p,t),[t]),m=S.useMemo(()=>({isSimple:t==="simple",isStandard:t==="standard",isAdvanced:t==="advanced"}),[t]);return{level:t,terms:n,t:i,getTerms:l,getResourceTypeLabel:o,getDescription:u,formatCount:d,...m}}const eo={label:{Collection:"REQUIRED",Manifest:"REQUIRED",Canvas:"RECOMMENDED",Range:"RECOMMENDED",AnnotationPage:"OPTIONAL",AnnotationCollection:"RECOMMENDED",Annotation:"OPTIONAL",ContentResource:"OPTIONAL",Agent:"REQUIRED",SpecificResource:"OPTIONAL",Choice:"OPTIONAL",TextualBody:"OPTIONAL"},metadata:{Collection:"RECOMMENDED",Manifest:"RECOMMENDED",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"OPTIONAL",AnnotationCollection:"OPTIONAL",Annotation:"OPTIONAL",ContentResource:"OPTIONAL",Agent:"OPTIONAL",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},summary:{Collection:"RECOMMENDED",Manifest:"RECOMMENDED",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"OPTIONAL",AnnotationCollection:"OPTIONAL",Annotation:"OPTIONAL",ContentResource:"OPTIONAL",Agent:"OPTIONAL",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},requiredStatement:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"OPTIONAL",AnnotationCollection:"OPTIONAL",Annotation:"OPTIONAL",ContentResource:"OPTIONAL",Agent:"OPTIONAL",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},rights:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"OPTIONAL",AnnotationCollection:"OPTIONAL",Annotation:"OPTIONAL",ContentResource:"OPTIONAL",Agent:"OPTIONAL",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},provider:{Collection:"RECOMMENDED",Manifest:"RECOMMENDED",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"OPTIONAL",AnnotationCollection:"OPTIONAL",Annotation:"OPTIONAL",ContentResource:"OPTIONAL",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},thumbnail:{Collection:"RECOMMENDED",Manifest:"RECOMMENDED",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"OPTIONAL",AnnotationCollection:"OPTIONAL",Annotation:"OPTIONAL",ContentResource:"OPTIONAL",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},navDate:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},placeholderCanvas:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},accompanyingCanvas:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},id:{Collection:"REQUIRED",Manifest:"REQUIRED",Canvas:"REQUIRED",Range:"REQUIRED",AnnotationPage:"REQUIRED",AnnotationCollection:"REQUIRED",Annotation:"REQUIRED",ContentResource:"REQUIRED",Agent:"REQUIRED",SpecificResource:"REQUIRED",Choice:"REQUIRED",TextualBody:"OPTIONAL"},type:{Collection:"REQUIRED",Manifest:"REQUIRED",Canvas:"REQUIRED",Range:"REQUIRED",AnnotationPage:"REQUIRED",AnnotationCollection:"REQUIRED",Annotation:"REQUIRED",ContentResource:"REQUIRED",Agent:"REQUIRED",SpecificResource:"REQUIRED",Choice:"REQUIRED",TextualBody:"OPTIONAL"},format:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"RECOMMENDED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"OPTIONAL"},profile:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"OPTIONAL",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},height:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"CONDITIONAL",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"RECOMMENDED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},width:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"CONDITIONAL",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"RECOMMENDED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},duration:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"OPTIONAL",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"RECOMMENDED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},language:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"RECOMMENDED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"OPTIONAL"},viewingDirection:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"NOT_ALLOWED",Range:"OPTIONAL",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},behavior:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"OPTIONAL",AnnotationCollection:"OPTIONAL",Annotation:"OPTIONAL",ContentResource:"OPTIONAL",Agent:"NOT_ALLOWED",SpecificResource:"OPTIONAL",Choice:"OPTIONAL",TextualBody:"NOT_ALLOWED"},timeMode:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"OPTIONAL",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},motivation:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"REQUIRED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},purpose:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"OPTIONAL",Choice:"NOT_ALLOWED",TextualBody:"OPTIONAL"},homepage:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"OPTIONAL",AnnotationCollection:"OPTIONAL",Annotation:"OPTIONAL",ContentResource:"OPTIONAL",Agent:"RECOMMENDED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},rendering:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"OPTIONAL",AnnotationCollection:"OPTIONAL",Annotation:"OPTIONAL",ContentResource:"OPTIONAL",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},service:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"OPTIONAL",AnnotationCollection:"OPTIONAL",Annotation:"OPTIONAL",ContentResource:"OPTIONAL",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},services:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},seeAlso:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"OPTIONAL",AnnotationCollection:"OPTIONAL",Annotation:"OPTIONAL",ContentResource:"OPTIONAL",Agent:"OPTIONAL",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},logo:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"RECOMMENDED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},partOf:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"OPTIONAL",AnnotationCollection:"OPTIONAL",Annotation:"OPTIONAL",ContentResource:"OPTIONAL",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},start:{Collection:"NOT_ALLOWED",Manifest:"OPTIONAL",Canvas:"NOT_ALLOWED",Range:"OPTIONAL",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},supplementary:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"OPTIONAL",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},body:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"REQUIRED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},target:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"REQUIRED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},source:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"REQUIRED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},selector:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"OPTIONAL",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},items:{Collection:"REQUIRED",Manifest:"REQUIRED",Canvas:"RECOMMENDED",Range:"REQUIRED",AnnotationPage:"RECOMMENDED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"OPTIONAL",TextualBody:"NOT_ALLOWED"},structures:{Collection:"NOT_ALLOWED",Manifest:"OPTIONAL",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},annotations:{Collection:"OPTIONAL",Manifest:"OPTIONAL",Canvas:"OPTIONAL",Range:"OPTIONAL",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"OPTIONAL",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},first:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"OPTIONAL",AnnotationCollection:"RECOMMENDED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},last:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"OPTIONAL",AnnotationCollection:"RECOMMENDED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},next:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"OPTIONAL",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},prev:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"OPTIONAL",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},"@context":{Collection:"REQUIRED",Manifest:"REQUIRED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"NOT_ALLOWED"},value:{Collection:"NOT_ALLOWED",Manifest:"NOT_ALLOWED",Canvas:"NOT_ALLOWED",Range:"NOT_ALLOWED",AnnotationPage:"NOT_ALLOWED",AnnotationCollection:"NOT_ALLOWED",Annotation:"NOT_ALLOWED",ContentResource:"NOT_ALLOWED",Agent:"NOT_ALLOWED",SpecificResource:"NOT_ALLOWED",Choice:"NOT_ALLOWED",TextualBody:"REQUIRED"}},Zv={Collection:["Collection","Manifest"],Manifest:["Canvas"],Canvas:["AnnotationPage"],Range:["Range","Canvas","SpecificResource"],AnnotationPage:["Annotation"],Choice:["ContentResource","SpecificResource"]},hj=["left-to-right","right-to-left","top-to-bottom","bottom-to-top"],mj="left-to-right",pj=["trim","scale","loop"],gj=["painting","supplementing"],Jv={Collection:{allowed:["auto-advance","no-auto-advance","repeat","no-repeat","unordered","individuals","continuous","paged","multi-part","together"],notAllowed:["facing-pages","non-paged","no-nav","sequence","thumbnail-nav","hidden"]},Manifest:{allowed:["auto-advance","no-auto-advance","repeat","no-repeat","unordered","individuals","continuous","paged"],notAllowed:["facing-pages","non-paged","multi-part","together","no-nav","sequence","thumbnail-nav","hidden"]},Canvas:{allowed:["auto-advance","no-auto-advance","repeat","no-repeat","facing-pages","non-paged"],notAllowed:["unordered","individuals","continuous","paged","multi-part","together","no-nav","sequence","thumbnail-nav","hidden"]},Range:{allowed:["auto-advance","no-auto-advance","unordered","individuals","continuous","paged","sequence","thumbnail-nav","no-nav"],notAllowed:["facing-pages","non-paged","multi-part","together","repeat","no-repeat","hidden"]},AnnotationPage:{allowed:["hidden"],notAllowed:["auto-advance","no-auto-advance","repeat","no-repeat","unordered","individuals","continuous","paged","facing-pages","non-paged","multi-part","together","no-nav","sequence","thumbnail-nav"]},AnnotationCollection:{allowed:["hidden"],notAllowed:["auto-advance","no-auto-advance","repeat","no-repeat","unordered","individuals","continuous","paged","facing-pages","non-paged","multi-part","together","no-nav","sequence","thumbnail-nav"]},Annotation:{allowed:["hidden"],notAllowed:["auto-advance","no-auto-advance","repeat","no-repeat","unordered","individuals","continuous","paged","facing-pages","non-paged","multi-part","together","no-nav","sequence","thumbnail-nav"]},SpecificResource:{allowed:["hidden"],notAllowed:["auto-advance","no-auto-advance","repeat","no-repeat","unordered","individuals","continuous","paged","facing-pages","non-paged","multi-part","together","no-nav","sequence","thumbnail-nav"]},Choice:{allowed:["hidden"],notAllowed:["auto-advance","no-auto-advance","repeat","no-repeat","unordered","individuals","continuous","paged","facing-pages","non-paged","multi-part","together","no-nav","sequence","thumbnail-nav"]},ContentResource:{allowed:[],notAllowed:["auto-advance","no-auto-advance","repeat","no-repeat","unordered","individuals","continuous","paged","facing-pages","non-paged","multi-part","together","no-nav","sequence","thumbnail-nav","hidden"]},Agent:{allowed:[],notAllowed:["auto-advance","no-auto-advance","repeat","no-repeat","unordered","individuals","continuous","paged","facing-pages","non-paged","multi-part","together","no-nav","sequence","thumbnail-nav","hidden"]},TextualBody:{allowed:[],notAllowed:["auto-advance","no-auto-advance","repeat","no-repeat","unordered","individuals","continuous","paged","facing-pages","non-paged","multi-part","together","no-nav","sequence","thumbnail-nav","hidden"]}},xj=["Dataset","Image","Model","Sound","Text","Video"];function xs(e){const t={required:[],recommended:[],optional:[],notAllowed:[],behaviorAllowed:[],behaviorNotAllowed:[]};for(const[i,l]of Object.entries(eo))switch(l[e]){case"REQUIRED":t.required.push(i);break;case"RECOMMENDED":t.recommended.push(i);break;case"OPTIONAL":case"CONDITIONAL":t.optional.push(i);break;case"NOT_ALLOWED":t.notAllowed.push(i);break}const n=Jv[e];return n&&(t.behaviorAllowed=n.allowed,t.behaviorNotAllowed=n.notAllowed),t}xs("Collection"),xs("Manifest"),xs("Canvas"),xs("Range"),xs("AnnotationPage"),xs("AnnotationCollection"),xs("Annotation"),xs("ContentResource"),xs("Agent"),xs("SpecificResource"),xs("Choice"),xs("TextualBody");function kr(e){return xj.includes(e)?"ContentResource":e}function Vm(e,t){const n=kr(e),i=eo[t];return i&&i[n]||"NOT_ALLOWED"}function bj(e,t){return Vm(e,t)!=="NOT_ALLOWED"}function wi(e){const t=kr(e),n=[];for(const[i,l]of Object.entries(eo))l[t]!=="NOT_ALLOWED"&&n.push(i);return n}function yj(e){const t=kr(e),n=[];for(const[i,l]of Object.entries(eo))l[t]==="REQUIRED"&&n.push(i);return n}function vj(e,t){const n=kr(e),i=Jv[n];return!i||i.notAllowed.includes(t)?!1:i.allowed.includes(t)}function Km(e){return hj.includes(e)}function wj(e){return Vm(e,"viewingDirection")!=="NOT_ALLOWED"}function Nj(e){return pj.includes(e)}function Sj(e){return gj.includes(e)}function Cj(e){return Zv[e]||[]}function jj(e,t){return Zv[e]?.includes(t)||!1}const Ej={Canvas:[{property:"height",condition:e=>"width"in e&&e.width!==void 0&&e.width!==null&&!("height"in e&&e.height!==void 0&&e.height!==null),message:"Canvas must have height if width is present",type:"error"},{property:"width",condition:e=>"height"in e&&e.height!==void 0&&e.height!==null&&!("width"in e&&e.width!==void 0&&e.width!==null),message:"Canvas must have width if height is present",type:"error"}],Agent:[{property:"homepage",condition:e=>e.type==="Agent"&&!("homepage"in e&&e.homepage!==void 0),message:"Agent should have homepage property",type:"warning"},{property:"logo",condition:e=>e.type==="Agent"&&!("logo"in e&&e.logo!==void 0),message:"Agent should have logo property",type:"warning"}],ContentResource:[{property:"format",condition:e=>["Image","Video","Sound","Text","Dataset"].includes(e.type)&&!("format"in e&&e.format!==void 0),message:"Content resource should have format property",type:"warning"}]};function Aj(e){const t=[],n=[],i=kr(e.type),l=Ej[i]||[];for(const o of l)o.condition(e)&&(o.type==="error"?t.push(o.message):n.push(o.message));if(i==="Canvas"){const o=e;o.duration&&(!o.height||!o.width)&&n.push("Canvas with duration should also have height and width for proper rendering")}return{errors:t,warnings:n}}function Qv(e){const t=[],n=kr(e.type),i=yj(n);for(const u of i)(!(u in e)||e[u]===void 0||e[u]===null)&&t.push(`Missing required field: ${u}`);for(const[u,d]of Object.entries(eo))d[n]==="NOT_ALLOWED"&&u in e&&e[u]!==void 0&&t.push(`Field not allowed on ${n}: ${u}`);if(e.behavior){const u=Array.isArray(e.behavior)?e.behavior:[e.behavior];for(const d of u)vj(n,d)||t.push(`Behavior not allowed on ${n}: ${d}`)}e.viewingDirection&&(wj(n)?Km(e.viewingDirection)||t.push(`Invalid viewingDirection: ${e.viewingDirection}`):t.push(`viewingDirection not allowed on ${n}`)),e.timeMode&&(n!=="Annotation"?t.push(`timeMode not allowed on ${n}`):Nj(e.timeMode)||t.push(`Invalid timeMode: ${e.timeMode}`)),e.motivation&&(n!=="Annotation"?t.push(`motivation not allowed on ${n}`):Sj(e.motivation)||t.push(`Invalid motivation: ${e.motivation}. Must be 'painting' or 'supplementing'`));const l=Aj(e);if(t.push(...l.errors),e.id&&!e.id.startsWith("http://")&&!e.id.startsWith("https://")&&["Collection","Manifest","Canvas","Range","AnnotationPage","AnnotationCollection","Annotation"].includes(n)&&t.push("ID must be a valid HTTP(S) URI for IIIF resources"),n==="Canvas"&&e.id?.includes("#")&&t.push("Canvas ID must not contain a fragment identifier"),"items"in e&&e.items!==void 0){const u=e.items;if(!Array.isArray(u))t.push("items must be an array");else if(u.length===0)Vm(n,"items")==="REQUIRED"&&t.push(`${n} must have at least one item in 'items' array`);else for(let d=0;d<u.length;d++){const m=u[d];m&&m.type&&!jj(n,m.type)&&t.push(`Item at index ${d} has invalid type '${m.type}' for parent type '${n}'`)}}if(e.metadata&&Array.isArray(e.metadata)){const u=e.metadata;for(let d=0;d<u.length;d++){const m=u[d];(!m.label||!m.value)&&t.push(`Metadata entry at index ${d} must have both label and value`)}}const o=["label","summary","requiredStatement"];for(const u of o)if(e[u]){const d=e[u];(typeof d!="object"||Array.isArray(d))&&t.push(`${u} must be a language map object`)}return t}const Tj={"CC0 1.0":"http://creativecommons.org/publicdomain/zero/1.0/"},yb={debug:0,info:1,warn:2,error:3,silent:4},_j={minLevel:"warn",enabledGroups:["app","vault","storage","network","ui","worker","general"],enableConsole:!0,enableBuffer:!0,bufferSize:100};class kj{constructor(t={}){this.buffer=[],this.listeners=new Set,this.config={..._j,...t}}configure(t){this.config={...this.config,...t}}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}getRecentLogs(t=50){return this.buffer.slice(-t)}clearBuffer(){this.buffer=[]}shouldLog(t,n){return!(yb[t]<yb[this.config.minLevel]||!this.config.enabledGroups.includes(n))}formatMessage(t,n,i){return`${this.config.prefix?`[${this.config.prefix}] `:""}[${n.toUpperCase()}] ${i}`}log(t){this.config.enableBuffer&&(this.buffer.push(t),this.buffer.length>this.config.bufferSize&&this.buffer.shift());for(const n of this.listeners)try{n(t)}catch{}if(this.config.enableConsole){const n=this.formatMessage(t.level,t.group,t.message);switch(t.level){case"debug":console.debug(n,t.data??"");break;case"info":console.info(n,t.data??"");break;case"warn":console.warn(n,t.data??"");break;case"error":t.error?console.error(n,t.error,t.data??""):console.error(n,t.data??"");break}}}debug(t,n,i){this.shouldLog("debug",t)&&this.log({timestamp:Date.now(),level:"debug",group:t,message:n,data:i})}info(t,n,i){this.shouldLog("info",t)&&this.log({timestamp:Date.now(),level:"info",group:t,message:n,data:i})}warn(t,n,i){this.shouldLog("warn",t)&&this.log({timestamp:Date.now(),level:"warn",group:t,message:n,data:i})}error(t,n,i,l){this.shouldLog("error",t)&&this.log({timestamp:Date.now(),level:"error",group:t,message:n,data:l,error:i})}scoped(t){return new Oj(this,t)}}class Oj{constructor(t,n){this.logger=t,this.group=n}debug(t,n){this.logger.debug(this.group,t,n)}info(t,n){this.logger.info(this.group,t,n)}warn(t,n){this.logger.warn(this.group,t,n)}error(t,n,i){this.logger.error(this.group,t,n,i)}}const Or=new kj;Or.scoped("app");Or.scoped("vault");Or.scoped("storage");Or.scoped("network");Or.scoped("ui");Or.scoped("worker");/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:ew,setPrototypeOf:vb,isFrozen:Ij,getPrototypeOf:Dj,getOwnPropertyDescriptor:Lj}=Object;let{freeze:Mn,seal:ys,create:tm}=Object,{apply:nm,construct:sm}=typeof Reflect<"u"&&Reflect;Mn||(Mn=function(t){return t});ys||(ys=function(t){return t});nm||(nm=function(t,n){for(var i=arguments.length,l=new Array(i>2?i-2:0),o=2;o<i;o++)l[o-2]=arguments[o];return t.apply(n,l)});sm||(sm=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),l=1;l<n;l++)i[l-1]=arguments[l];return new t(...i)});const Nc=Fn(Array.prototype.forEach),Rj=Fn(Array.prototype.lastIndexOf),wb=Fn(Array.prototype.pop),Cl=Fn(Array.prototype.push),Mj=Fn(Array.prototype.splice),Pc=Fn(String.prototype.toLowerCase),nh=Fn(String.prototype.toString),sh=Fn(String.prototype.match),jl=Fn(String.prototype.replace),Fj=Fn(String.prototype.indexOf),Pj=Fn(String.prototype.trim),As=Fn(Object.prototype.hasOwnProperty),Dn=Fn(RegExp.prototype.test),El=$j(TypeError);function Fn(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,i=new Array(n>1?n-1:0),l=1;l<n;l++)i[l-1]=arguments[l];return nm(e,t,i)}}function $j(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return sm(e,n)}}function pt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Pc;vb&&vb(e,null);let i=t.length;for(;i--;){let l=t[i];if(typeof l=="string"){const o=n(l);o!==l&&(Ij(t)||(t[i]=o),l=o)}e[l]=!0}return e}function zj(e){for(let t=0;t<e.length;t++)As(e,t)||(e[t]=null);return e}function Fs(e){const t=tm(null);for(const[n,i]of ew(e))As(e,n)&&(Array.isArray(i)?t[n]=zj(i):i&&typeof i=="object"&&i.constructor===Object?t[n]=Fs(i):t[n]=i);return t}function Al(e,t){for(;e!==null;){const i=Lj(e,t);if(i){if(i.get)return Fn(i.get);if(typeof i.value=="function")return Fn(i.value)}e=Dj(e)}function n(){return null}return n}const Nb=Mn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),ah=Mn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ih=Mn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Uj=Mn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),rh=Mn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Bj=Mn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Sb=Mn(["#text"]),Cb=Mn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),lh=Mn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),jb=Mn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Sc=Mn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Hj=ys(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Wj=ys(/<%[\w\W]*|[\w\W]*%>/gm),Gj=ys(/\$\{[\w\W]*/gm),Yj=ys(/^data-[\-\w.\u00B7-\uFFFF]+$/),qj=ys(/^aria-[\-\w]+$/),tw=ys(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Vj=ys(/^(?:\w+script|data):/i),Kj=ys(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),nw=ys(/^html$/i),Xj=ys(/^[a-z][.\w]*(-[.\w]+)+$/i);var Eb=Object.freeze({__proto__:null,ARIA_ATTR:qj,ATTR_WHITESPACE:Kj,CUSTOM_ELEMENT:Xj,DATA_ATTR:Yj,DOCTYPE_NAME:nw,ERB_EXPR:Wj,IS_ALLOWED_URI:tw,IS_SCRIPT_OR_DATA:Vj,MUSTACHE_EXPR:Hj,TMPLIT_EXPR:Gj});const Tl={element:1,text:3,progressingInstruction:7,comment:8,document:9},Zj=function(){return typeof window>"u"?null:window},Jj=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let i=null;const l="data-tt-policy-suffix";n&&n.hasAttribute(l)&&(i=n.getAttribute(l));const o="dompurify"+(i?"#"+i:"");try{return t.createPolicy(o,{createHTML(u){return u},createScriptURL(u){return u}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Ab=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function sw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Zj();const t=Xe=>sw(Xe);if(t.version="3.3.1",t.removed=[],!e||!e.document||e.document.nodeType!==Tl.document||!e.Element)return t.isSupported=!1,t;let{document:n}=e;const i=n,l=i.currentScript,{DocumentFragment:o,HTMLTemplateElement:u,Node:d,Element:m,NodeFilter:h,NamedNodeMap:p=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:g,DOMParser:y,trustedTypes:x}=e,v=m.prototype,N=Al(v,"cloneNode"),j=Al(v,"remove"),C=Al(v,"nextSibling"),A=Al(v,"childNodes"),_=Al(v,"parentNode");if(typeof u=="function"){const Xe=n.createElement("template");Xe.content&&Xe.content.ownerDocument&&(n=Xe.content.ownerDocument)}let T,L="";const{implementation:H,createNodeIterator:k,createDocumentFragment:R,getElementsByTagName:z}=n,{importNode:P}=i;let K=Ab();t.isSupported=typeof ew=="function"&&typeof _=="function"&&H&&H.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:I,ERB_EXPR:D,TMPLIT_EXPR:E,DATA_ATTR:q,ARIA_ATTR:W,IS_SCRIPT_OR_DATA:G,ATTR_WHITESPACE:te,CUSTOM_ELEMENT:U}=Eb;let{IS_ALLOWED_URI:V}=Eb,O=null;const B=pt({},[...Nb,...ah,...ih,...rh,...Sb]);let Y=null;const X=pt({},[...Cb,...lh,...jb,...Sc]);let Q=Object.seal(tm(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ue=null,be=null;const de=Object.seal(tm(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let ye=!0,le=!0,we=!1,He=!0,Ke=!1,F=!0,me=!1,he=!1,ee=!1,Z=!1,se=!1,Te=!1,_e=!0,ne=!1;const ge="user-content-";let Se=!0,Ce=!1,Me={},Be=null;const We=pt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let qe=null;const Ae=pt({},["audio","video","img","source","image","track"]);let $e=null;const Qe=pt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ge="http://www.w3.org/1998/Math/MathML",ve="http://www.w3.org/2000/svg",je="http://www.w3.org/1999/xhtml";let Ue=je,ft=!1,ie=null;const Oe=pt({},[Ge,ve,je],nh);let ae=pt({},["mi","mo","mn","ms","mtext"]),Fe=pt({},["annotation-xml"]);const Pe=pt({},["title","style","font","a","script"]);let it=null;const rt=["application/xhtml+xml","text/html"],Ot="text/html";let et=null,Et=null;const Vt=n.createElement("form"),pn=function(oe){return oe instanceof RegExp||oe instanceof Function},gn=function(){let oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Et&&Et===oe)){if((!oe||typeof oe!="object")&&(oe={}),oe=Fs(oe),it=rt.indexOf(oe.PARSER_MEDIA_TYPE)===-1?Ot:oe.PARSER_MEDIA_TYPE,et=it==="application/xhtml+xml"?nh:Pc,O=As(oe,"ALLOWED_TAGS")?pt({},oe.ALLOWED_TAGS,et):B,Y=As(oe,"ALLOWED_ATTR")?pt({},oe.ALLOWED_ATTR,et):X,ie=As(oe,"ALLOWED_NAMESPACES")?pt({},oe.ALLOWED_NAMESPACES,nh):Oe,$e=As(oe,"ADD_URI_SAFE_ATTR")?pt(Fs(Qe),oe.ADD_URI_SAFE_ATTR,et):Qe,qe=As(oe,"ADD_DATA_URI_TAGS")?pt(Fs(Ae),oe.ADD_DATA_URI_TAGS,et):Ae,Be=As(oe,"FORBID_CONTENTS")?pt({},oe.FORBID_CONTENTS,et):We,ue=As(oe,"FORBID_TAGS")?pt({},oe.FORBID_TAGS,et):Fs({}),be=As(oe,"FORBID_ATTR")?pt({},oe.FORBID_ATTR,et):Fs({}),Me=As(oe,"USE_PROFILES")?oe.USE_PROFILES:!1,ye=oe.ALLOW_ARIA_ATTR!==!1,le=oe.ALLOW_DATA_ATTR!==!1,we=oe.ALLOW_UNKNOWN_PROTOCOLS||!1,He=oe.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ke=oe.SAFE_FOR_TEMPLATES||!1,F=oe.SAFE_FOR_XML!==!1,me=oe.WHOLE_DOCUMENT||!1,Z=oe.RETURN_DOM||!1,se=oe.RETURN_DOM_FRAGMENT||!1,Te=oe.RETURN_TRUSTED_TYPE||!1,ee=oe.FORCE_BODY||!1,_e=oe.SANITIZE_DOM!==!1,ne=oe.SANITIZE_NAMED_PROPS||!1,Se=oe.KEEP_CONTENT!==!1,Ce=oe.IN_PLACE||!1,V=oe.ALLOWED_URI_REGEXP||tw,Ue=oe.NAMESPACE||je,ae=oe.MATHML_TEXT_INTEGRATION_POINTS||ae,Fe=oe.HTML_INTEGRATION_POINTS||Fe,Q=oe.CUSTOM_ELEMENT_HANDLING||{},oe.CUSTOM_ELEMENT_HANDLING&&pn(oe.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Q.tagNameCheck=oe.CUSTOM_ELEMENT_HANDLING.tagNameCheck),oe.CUSTOM_ELEMENT_HANDLING&&pn(oe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Q.attributeNameCheck=oe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),oe.CUSTOM_ELEMENT_HANDLING&&typeof oe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Q.allowCustomizedBuiltInElements=oe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ke&&(le=!1),se&&(Z=!0),Me&&(O=pt({},Sb),Y=[],Me.html===!0&&(pt(O,Nb),pt(Y,Cb)),Me.svg===!0&&(pt(O,ah),pt(Y,lh),pt(Y,Sc)),Me.svgFilters===!0&&(pt(O,ih),pt(Y,lh),pt(Y,Sc)),Me.mathMl===!0&&(pt(O,rh),pt(Y,jb),pt(Y,Sc))),oe.ADD_TAGS&&(typeof oe.ADD_TAGS=="function"?de.tagCheck=oe.ADD_TAGS:(O===B&&(O=Fs(O)),pt(O,oe.ADD_TAGS,et))),oe.ADD_ATTR&&(typeof oe.ADD_ATTR=="function"?de.attributeCheck=oe.ADD_ATTR:(Y===X&&(Y=Fs(Y)),pt(Y,oe.ADD_ATTR,et))),oe.ADD_URI_SAFE_ATTR&&pt($e,oe.ADD_URI_SAFE_ATTR,et),oe.FORBID_CONTENTS&&(Be===We&&(Be=Fs(Be)),pt(Be,oe.FORBID_CONTENTS,et)),oe.ADD_FORBID_CONTENTS&&(Be===We&&(Be=Fs(Be)),pt(Be,oe.ADD_FORBID_CONTENTS,et)),Se&&(O["#text"]=!0),me&&pt(O,["html","head","body"]),O.table&&(pt(O,["tbody"]),delete ue.tbody),oe.TRUSTED_TYPES_POLICY){if(typeof oe.TRUSTED_TYPES_POLICY.createHTML!="function")throw El('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof oe.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw El('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');T=oe.TRUSTED_TYPES_POLICY,L=T.createHTML("")}else T===void 0&&(T=Jj(x,l)),T!==null&&typeof L=="string"&&(L=T.createHTML(""));Mn&&Mn(oe),Et=oe}},an=pt({},[...ah,...ih,...Uj]),Kt=pt({},[...rh,...Bj]),Je=function(oe){let Re=_(oe);(!Re||!Re.tagName)&&(Re={namespaceURI:Ue,tagName:"template"});const Ye=Pc(oe.tagName),At=Pc(Re.tagName);return ie[oe.namespaceURI]?oe.namespaceURI===ve?Re.namespaceURI===je?Ye==="svg":Re.namespaceURI===Ge?Ye==="svg"&&(At==="annotation-xml"||ae[At]):!!an[Ye]:oe.namespaceURI===Ge?Re.namespaceURI===je?Ye==="math":Re.namespaceURI===ve?Ye==="math"&&Fe[At]:!!Kt[Ye]:oe.namespaceURI===je?Re.namespaceURI===ve&&!Fe[At]||Re.namespaceURI===Ge&&!ae[At]?!1:!Kt[Ye]&&(Pe[Ye]||!an[Ye]):!!(it==="application/xhtml+xml"&&ie[oe.namespaceURI]):!1},Gt=function(oe){Cl(t.removed,{element:oe});try{_(oe).removeChild(oe)}catch{j(oe)}},en=function(oe,Re){try{Cl(t.removed,{attribute:Re.getAttributeNode(oe),from:Re})}catch{Cl(t.removed,{attribute:null,from:Re})}if(Re.removeAttribute(oe),oe==="is")if(Z||se)try{Gt(Re)}catch{}else try{Re.setAttribute(oe,"")}catch{}},Ut=function(oe){let Re=null,Ye=null;if(ee)oe="<remove></remove>"+oe;else{const mt=sh(oe,/^[\r\n\t ]+/);Ye=mt&&mt[0]}it==="application/xhtml+xml"&&Ue===je&&(oe='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+oe+"</body></html>");const At=T?T.createHTML(oe):oe;if(Ue===je)try{Re=new y().parseFromString(At,it)}catch{}if(!Re||!Re.documentElement){Re=H.createDocument(Ue,"template",null);try{Re.documentElement.innerHTML=ft?L:At}catch{}}const Yt=Re.body||Re.documentElement;return oe&&Ye&&Yt.insertBefore(n.createTextNode(Ye),Yt.childNodes[0]||null),Ue===je?z.call(Re,me?"html":"body")[0]:me?Re.documentElement:Yt},Pn=function(oe){return k.call(oe.ownerDocument||oe,oe,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT|h.SHOW_PROCESSING_INSTRUCTION|h.SHOW_CDATA_SECTION,null)},rn=function(oe){return oe instanceof g&&(typeof oe.nodeName!="string"||typeof oe.textContent!="string"||typeof oe.removeChild!="function"||!(oe.attributes instanceof p)||typeof oe.removeAttribute!="function"||typeof oe.setAttribute!="function"||typeof oe.namespaceURI!="string"||typeof oe.insertBefore!="function"||typeof oe.hasChildNodes!="function")},Xt=function(oe){return typeof d=="function"&&oe instanceof d};function It(Xe,oe,Re){Nc(Xe,Ye=>{Ye.call(t,oe,Re,Et)})}const Ws=function(oe){let Re=null;if(It(K.beforeSanitizeElements,oe,null),rn(oe))return Gt(oe),!0;const Ye=et(oe.nodeName);if(It(K.uponSanitizeElement,oe,{tagName:Ye,allowedTags:O}),F&&oe.hasChildNodes()&&!Xt(oe.firstElementChild)&&Dn(/<[/\w!]/g,oe.innerHTML)&&Dn(/<[/\w!]/g,oe.textContent)||oe.nodeType===Tl.progressingInstruction||F&&oe.nodeType===Tl.comment&&Dn(/<[/\w]/g,oe.data))return Gt(oe),!0;if(!(de.tagCheck instanceof Function&&de.tagCheck(Ye))&&(!O[Ye]||ue[Ye])){if(!ue[Ye]&&io(Ye)&&(Q.tagNameCheck instanceof RegExp&&Dn(Q.tagNameCheck,Ye)||Q.tagNameCheck instanceof Function&&Q.tagNameCheck(Ye)))return!1;if(Se&&!Be[Ye]){const At=_(oe)||oe.parentNode,Yt=A(oe)||oe.childNodes;if(Yt&&At){const mt=Yt.length;for(let wn=mt-1;wn>=0;--wn){const rs=N(Yt[wn],!0);rs.__removalCount=(oe.__removalCount||0)+1,At.insertBefore(rs,C(oe))}}}return Gt(oe),!0}return oe instanceof m&&!Je(oe)||(Ye==="noscript"||Ye==="noembed"||Ye==="noframes")&&Dn(/<\/no(script|embed|frames)/i,oe.innerHTML)?(Gt(oe),!0):(Ke&&oe.nodeType===Tl.text&&(Re=oe.textContent,Nc([I,D,E],At=>{Re=jl(Re,At," ")}),oe.textContent!==Re&&(Cl(t.removed,{element:oe.cloneNode()}),oe.textContent=Re)),It(K.afterSanitizeElements,oe,null),!1)},Ii=function(oe,Re,Ye){if(_e&&(Re==="id"||Re==="name")&&(Ye in n||Ye in Vt))return!1;if(!(le&&!be[Re]&&Dn(q,Re))){if(!(ye&&Dn(W,Re))){if(!(de.attributeCheck instanceof Function&&de.attributeCheck(Re,oe))){if(!Y[Re]||be[Re]){if(!(io(oe)&&(Q.tagNameCheck instanceof RegExp&&Dn(Q.tagNameCheck,oe)||Q.tagNameCheck instanceof Function&&Q.tagNameCheck(oe))&&(Q.attributeNameCheck instanceof RegExp&&Dn(Q.attributeNameCheck,Re)||Q.attributeNameCheck instanceof Function&&Q.attributeNameCheck(Re,oe))||Re==="is"&&Q.allowCustomizedBuiltInElements&&(Q.tagNameCheck instanceof RegExp&&Dn(Q.tagNameCheck,Ye)||Q.tagNameCheck instanceof Function&&Q.tagNameCheck(Ye))))return!1}else if(!$e[Re]){if(!Dn(V,jl(Ye,te,""))){if(!((Re==="src"||Re==="xlink:href"||Re==="href")&&oe!=="script"&&Fj(Ye,"data:")===0&&qe[oe])){if(!(we&&!Dn(G,jl(Ye,te,"")))){if(Ye)return!1}}}}}}}return!0},io=function(oe){return oe!=="annotation-xml"&&sh(oe,U)},ro=function(oe){It(K.beforeSanitizeAttributes,oe,null);const{attributes:Re}=oe;if(!Re||rn(oe))return;const Ye={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Y,forceKeepAttr:void 0};let At=Re.length;for(;At--;){const Yt=Re[At],{name:mt,namespaceURI:wn,value:rs}=Yt,$n=et(mt),Is=rs;let xn=mt==="value"?Is:Pj(Is);if(Ye.attrName=$n,Ye.attrValue=xn,Ye.keepAttr=!0,Ye.forceKeepAttr=void 0,It(K.uponSanitizeAttribute,oe,Ye),xn=Ye.attrValue,ne&&($n==="id"||$n==="name")&&(en(mt,oe),xn=ge+xn),F&&Dn(/((--!?|])>)|<\/(style|title|textarea)/i,xn)){en(mt,oe);continue}if($n==="attributename"&&sh(xn,"href")){en(mt,oe);continue}if(Ye.forceKeepAttr)continue;if(!Ye.keepAttr){en(mt,oe);continue}if(!He&&Dn(/\/>/i,xn)){en(mt,oe);continue}Ke&&Nc([I,D,E],Lr=>{xn=jl(xn,Lr," ")});const Dr=et(oe.nodeName);if(!Ii(Dr,$n,xn)){en(mt,oe);continue}if(T&&typeof x=="object"&&typeof x.getAttributeType=="function"&&!wn)switch(x.getAttributeType(Dr,$n)){case"TrustedHTML":{xn=T.createHTML(xn);break}case"TrustedScriptURL":{xn=T.createScriptURL(xn);break}}if(xn!==Is)try{wn?oe.setAttributeNS(wn,mt,xn):oe.setAttribute(mt,xn),rn(oe)?Gt(oe):wb(t.removed)}catch{en(mt,oe)}}It(K.afterSanitizeAttributes,oe,null)},lo=function Xe(oe){let Re=null;const Ye=Pn(oe);for(It(K.beforeSanitizeShadowDOM,oe,null);Re=Ye.nextNode();)It(K.uponSanitizeShadowNode,Re,null),Ws(Re),ro(Re),Re.content instanceof o&&Xe(Re.content);It(K.afterSanitizeShadowDOM,oe,null)};return t.sanitize=function(Xe){let oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Re=null,Ye=null,At=null,Yt=null;if(ft=!Xe,ft&&(Xe="<!-->"),typeof Xe!="string"&&!Xt(Xe))if(typeof Xe.toString=="function"){if(Xe=Xe.toString(),typeof Xe!="string")throw El("dirty is not a string, aborting")}else throw El("toString is not a function");if(!t.isSupported)return Xe;if(he||gn(oe),t.removed=[],typeof Xe=="string"&&(Ce=!1),Ce){if(Xe.nodeName){const rs=et(Xe.nodeName);if(!O[rs]||ue[rs])throw El("root node is forbidden and cannot be sanitized in-place")}}else if(Xe instanceof d)Re=Ut("<!---->"),Ye=Re.ownerDocument.importNode(Xe,!0),Ye.nodeType===Tl.element&&Ye.nodeName==="BODY"||Ye.nodeName==="HTML"?Re=Ye:Re.appendChild(Ye);else{if(!Z&&!Ke&&!me&&Xe.indexOf("<")===-1)return T&&Te?T.createHTML(Xe):Xe;if(Re=Ut(Xe),!Re)return Z?null:Te?L:""}Re&&ee&&Gt(Re.firstChild);const mt=Pn(Ce?Xe:Re);for(;At=mt.nextNode();)Ws(At),ro(At),At.content instanceof o&&lo(At.content);if(Ce)return Xe;if(Z){if(se)for(Yt=R.call(Re.ownerDocument);Re.firstChild;)Yt.appendChild(Re.firstChild);else Yt=Re;return(Y.shadowroot||Y.shadowrootmode)&&(Yt=P.call(i,Yt,!0)),Yt}let wn=me?Re.outerHTML:Re.innerHTML;return me&&O["!doctype"]&&Re.ownerDocument&&Re.ownerDocument.doctype&&Re.ownerDocument.doctype.name&&Dn(nw,Re.ownerDocument.doctype.name)&&(wn="<!DOCTYPE "+Re.ownerDocument.doctype.name+`>
`+wn),Ke&&Nc([I,D,E],rs=>{wn=jl(wn,rs," ")}),T&&Te?T.createHTML(wn):wn},t.setConfig=function(){let Xe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};gn(Xe),he=!0},t.clearConfig=function(){Et=null,he=!1},t.isValidAttribute=function(Xe,oe,Re){Et||gn({});const Ye=et(Xe),At=et(oe);return Ii(Ye,At,Re)},t.addHook=function(Xe,oe){typeof oe=="function"&&Cl(K[Xe],oe)},t.removeHook=function(Xe,oe){if(oe!==void 0){const Re=Rj(K[Xe],oe);return Re===-1?void 0:Mj(K[Xe],Re,1)[0]}return wb(K[Xe])},t.removeHooks=function(Xe){K[Xe]=[]},t.removeAllHooks=function(){K=Ab()},t}var aw=sw();const Qj={ALLOWED_TAGS:["b","i","em","strong","a","p","br","ul","ol","li","span"],ALLOWED_ATTR:["href","target","class","title"],ALLOW_DATA_ATTR:!1,SANITIZE_DOM:!0,KEEP_CONTENT:!0,FORBID_ATTR:["style","onerror","onload","onclick"],RETURN_TRUSTED_TYPE:!1};function oh(e){if(e==null)return"";const t=String(e);return t.trim()?String(aw.sanitize(t,Qj)):""}const eE={ALLOWED_TAGS:["svg","g","path","circle","rect","line","polyline","polygon","ellipse","text","tspan","defs","use","symbol","marker","linearGradient","radialGradient","stop","clipPath","mask","pattern","image","title","desc","metadata"],ALLOWED_ATTR:["viewBox","width","height","x","y","cx","cy","r","rx","ry","d","fill","stroke","stroke-width","stroke-linecap","stroke-linejoin","transform","opacity","class","id","href","xlink:href","points","x1","y1","x2","y2","dx","dy","text-anchor","font-size","font-family","font-weight","style","marker","marker-start","marker-end","marker-mid","clip-path","mask","filter","fill-opacity","stroke-opacity","stroke-dasharray","stroke-dashoffset"],ALLOW_DATA_ATTR:!1,SANITIZE_DOM:!0,KEEP_CONTENT:!0,FORBID_ATTR:["onerror","onload","onclick","onmouseover","onmouseout"],RETURN_TRUSTED_TYPE:!1};function tE(e){if(e==null)return"";const t=String(e);return t.trim()?String(aw.sanitize(t,eE)):""}var iw=Symbol.for("immer-nothing"),Tb=Symbol.for("immer-draftable"),Nt=Symbol.for("immer-state");function bs(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var is=Object,Ar=is.getPrototypeOf,Zc="constructor",ju="prototype",am="configurable",Jc="enumerable",$c="writable",Bl="value",Qa=e=>!!e&&!!e[Nt];function ks(e){return e?rw(e)||Eu(e)||!!e[Tb]||!!e[Zc]?.[Tb]||Au(e)||Tu(e):!1}var nE=is[ju][Zc].toString(),_b=new WeakMap;function rw(e){if(!e||!_u(e))return!1;const t=Ar(e);if(t===null||t===is[ju])return!0;const n=is.hasOwnProperty.call(t,Zc)&&t[Zc];if(n===Object)return!0;if(!vr(n))return!1;let i=_b.get(n);return i===void 0&&(i=Function.toString.call(n),_b.set(n,i)),i===nE}function to(e,t,n=!0){no(e)===0?(n?Reflect.ownKeys(e):is.keys(e)).forEach(l=>{t(l,e[l],e)}):e.forEach((i,l)=>t(l,i,e))}function no(e){const t=e[Nt];return t?t.type_:Eu(e)?1:Au(e)?2:Tu(e)?3:0}var kb=(e,t,n=no(e))=>n===2?e.has(t):is[ju].hasOwnProperty.call(e,t),im=(e,t,n=no(e))=>n===2?e.get(t):e[t],Qc=(e,t,n,i=no(e))=>{i===2?e.set(t,n):i===3?e.add(n):e[t]=n};function sE(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}var Eu=Array.isArray,Au=e=>e instanceof Map,Tu=e=>e instanceof Set,_u=e=>typeof e=="object",vr=e=>typeof e=="function",ch=e=>typeof e=="boolean";function aE(e){const t=+e;return Number.isInteger(t)&&String(t)===e}var iE=e=>_u(e)?e?.[Nt]:null,hn=e=>e.copy_||e.base_,rE=e=>{const t=iE(e);return t?t.copy_??t.base_:e},Xm=e=>e.modified_?e.copy_:e.base_;function rm(e,t){if(Au(e))return new Map(e);if(Tu(e))return new Set(e);if(Eu(e))return Array[ju].slice.call(e);const n=rw(e);if(t===!0||t==="class_only"&&!n){const i=is.getOwnPropertyDescriptors(e);delete i[Nt];let l=Reflect.ownKeys(i);for(let o=0;o<l.length;o++){const u=l[o],d=i[u];d[$c]===!1&&(d[$c]=!0,d[am]=!0),(d.get||d.set)&&(i[u]={[am]:!0,[$c]:!0,[Jc]:d[Jc],[Bl]:e[u]})}return is.create(Ar(e),i)}else{const i=Ar(e);if(i!==null&&n)return{...e};const l=is.create(i);return is.assign(l,e)}}function Zm(e,t=!1){return ku(e)||Qa(e)||!ks(e)||(no(e)>1&&is.defineProperties(e,{set:Cc,add:Cc,clear:Cc,delete:Cc}),is.freeze(e),t&&to(e,(n,i)=>{Zm(i,!0)},!1)),e}function lE(){bs(2)}var Cc={[Bl]:lE};function ku(e){return e===null||!_u(e)?!0:is.isFrozen(e)}var Hl="MapSet",lm="Patches",Ob="ArrayMethods",eu={};function Ti(e){const t=eu[e];return t||bs(0,e),t}var Ib=e=>!!eu[e];function oE(e,t){eu[e]||(eu[e]=t)}var Wl,tu=()=>Wl,cE=(e,t)=>({drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:Ib(Hl)?Ti(Hl):void 0,arrayMethodsPlugin_:Ib(Ob)?Ti(Ob):void 0});function Db(e,t){t&&(e.patchPlugin_=Ti(lm),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function om(e){cm(e),e.drafts_.forEach(uE),e.drafts_=null}function cm(e){e===Wl&&(Wl=e.parent_)}var Lb=e=>Wl=cE(Wl,e);function uE(e){const t=e[Nt];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function Rb(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];if(e!==void 0&&e!==n){n[Nt].modified_&&(om(t),bs(4)),ks(e)&&(e=Mb(t,e));const{patchPlugin_:l}=t;l&&l.generateReplacementPatches_(n[Nt].base_,e,t)}else e=Mb(t,n);return dE(t,e,!0),om(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==iw?e:void 0}function Mb(e,t){if(ku(t))return t;const n=t[Nt];if(!n)return nu(t,e.handledSet_,e);if(!Ou(n,e))return t;if(!n.modified_)return n.base_;if(!n.finalized_){const{callbacks_:i}=n;if(i)for(;i.length>0;)i.pop()(e);cw(n,e)}return n.copy_}function dE(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Zm(t,n)}function lw(e){e.finalized_=!0,e.scope_.unfinalizedDrafts_--}var Ou=(e,t)=>e.scope_===t,fE=[];function ow(e,t,n,i){const l=hn(e),o=e.type_;if(i!==void 0&&im(l,i,o)===t){Qc(l,i,n,o);return}if(!e.draftLocations_){const d=e.draftLocations_=new Map;to(l,(m,h)=>{if(Qa(h)){const p=d.get(h)||[];p.push(m),d.set(h,p)}})}const u=e.draftLocations_.get(t)??fE;for(const d of u)Qc(l,d,n,o)}function hE(e,t,n){e.callbacks_.push(function(l){const o=t;if(!o||!Ou(o,l))return;l.mapSetPlugin_?.fixSetContents(o);const u=Xm(o);ow(e,o.draft_??o,u,n),cw(o,l)})}function cw(e,t){if(e.modified_&&!e.finalized_&&(e.type_===3||e.type_===1&&e.allIndicesReassigned_||(e.assigned_?.size??0)>0)){const{patchPlugin_:i}=t;if(i){const l=i.getPath(e);l&&i.generatePatches_(e,l,t)}lw(e)}}function um(e,t,n){const{scope_:i}=e;if(Qa(n)){const l=n[Nt];Ou(l,i)&&l.callbacks_.push(function(){zc(e);const u=Xm(l);ow(e,n,u,t)})}else ks(n)&&e.callbacks_.push(function(){const o=hn(e);e.type_===3?o.has(n)&&nu(n,i.handledSet_,i):im(o,t,e.type_)===n&&i.drafts_.length>1&&(e.assigned_.get(t)??!1)===!0&&e.copy_&&nu(im(e.copy_,t,e.type_),i.handledSet_,i)})}function nu(e,t,n){return!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1||Qa(e)||t.has(e)||!ks(e)||ku(e)||(t.add(e),to(e,(i,l)=>{if(Qa(l)){const o=l[Nt];if(Ou(o,n)){const u=Xm(o);Qc(e,i,u,e.type_),lw(o)}}else ks(l)&&nu(l,t,n)})),e}function mE(e,t){const n=Eu(e),i={type_:n?1:0,scope_:t?t.scope_:tu(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0};let l=i,o=su;n&&(l=[i],o=Gl);const{revoke:u,proxy:d}=Proxy.revocable(l,o);return i.draft_=d,i.revoke_=u,[d,i]}var su={get(e,t){if(t===Nt)return e;let n=e.scope_.arrayMethodsPlugin_;const i=e.type_===1&&typeof t=="string";if(i&&n?.isArrayOperationMethod(t))return n.createMethodInterceptor(e,t);const l=hn(e);if(!kb(l,t,e.type_))return pE(e,l,t);const o=l[t];if(e.finalized_||!ks(o)||i&&e.operationMethod&&n?.isMutatingArrayMethod(e.operationMethod)&&aE(t))return o;if(o===uh(e.base_,t)){zc(e);const u=e.type_===1?+t:t,d=Yl(e.scope_,o,e,u);return e.copy_[u]=d}return o},has(e,t){return t in hn(e)},ownKeys(e){return Reflect.ownKeys(hn(e))},set(e,t,n){const i=uw(hn(e),t);if(i?.set)return i.set.call(e.draft_,n),!0;if(!e.modified_){const l=uh(hn(e),t),o=l?.[Nt];if(o&&o.base_===n)return e.copy_[t]=n,e.assigned_.set(t,!1),!0;if(sE(n,l)&&(n!==void 0||kb(e.base_,t,e.type_)))return!0;zc(e),ga(e)}return e.copy_[t]===n&&(n!==void 0||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_.set(t,!0),um(e,t,n)),!0},deleteProperty(e,t){return zc(e),uh(e.base_,t)!==void 0||t in e.base_?(e.assigned_.set(t,!1),ga(e)):e.assigned_.delete(t),e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const n=hn(e),i=Reflect.getOwnPropertyDescriptor(n,t);return i&&{[$c]:!0,[am]:e.type_!==1||t!=="length",[Jc]:i[Jc],[Bl]:n[t]}},defineProperty(){bs(11)},getPrototypeOf(e){return Ar(e.base_)},setPrototypeOf(){bs(12)}},Gl={};for(let e in su){let t=su[e];Gl[e]=function(){const n=arguments;return n[0]=n[0][0],t.apply(this,n)}}Gl.deleteProperty=function(e,t){return Gl.set.call(this,e,t,void 0)};Gl.set=function(e,t,n){return su.set.call(this,e[0],t,n,e[0])};function uh(e,t){const n=e[Nt];return(n?hn(n):e)[t]}function pE(e,t,n){const i=uw(t,n);return i?Bl in i?i[Bl]:i.get?.call(e.draft_):void 0}function uw(e,t){if(!(t in e))return;let n=Ar(e);for(;n;){const i=Object.getOwnPropertyDescriptor(n,t);if(i)return i;n=Ar(n)}}function ga(e){e.modified_||(e.modified_=!0,e.parent_&&ga(e.parent_))}function zc(e){e.copy_||(e.assigned_=new Map,e.copy_=rm(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var gE=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(t,n,i)=>{if(vr(t)&&!vr(n)){const o=n;n=t;const u=this;return function(m=o,...h){return u.produce(m,p=>n.call(this,p,...h))}}vr(n)||bs(6),i!==void 0&&!vr(i)&&bs(7);let l;if(ks(t)){const o=Lb(this),u=Yl(o,t,void 0);let d=!0;try{l=n(u),d=!1}finally{d?om(o):cm(o)}return Db(o,i),Rb(l,o)}else if(!t||!_u(t)){if(l=n(t),l===void 0&&(l=t),l===iw&&(l=void 0),this.autoFreeze_&&Zm(l,!0),i){const o=[],u=[];Ti(lm).generateReplacementPatches_(t,l,{patches_:o,inversePatches_:u}),i(o,u)}return l}else bs(1,t)},this.produceWithPatches=(t,n)=>{if(vr(t))return(u,...d)=>this.produceWithPatches(u,m=>t(m,...d));let i,l;return[this.produce(t,n,(u,d)=>{i=u,l=d}),i,l]},ch(e?.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),ch(e?.useStrictShallowCopy)&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),ch(e?.useStrictIteration)&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){ks(e)||bs(8),Qa(e)&&(e=xE(e));const t=Lb(this),n=Yl(t,e,void 0);return n[Nt].isManual_=!0,cm(t),n}finishDraft(e,t){const n=e&&e[Nt];(!n||!n.isManual_)&&bs(9);const{scope_:i}=n;return Db(i,t),Rb(void 0,i)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const l=t[n];if(l.path.length===0&&l.op==="replace"){e=l.value;break}}n>-1&&(t=t.slice(n+1));const i=Ti(lm).applyPatches_;return Qa(e)?i(e,t):this.produce(e,l=>i(l,t))}};function Yl(e,t,n,i){const[l,o]=Au(t)?Ti(Hl).proxyMap_(t,n):Tu(t)?Ti(Hl).proxySet_(t,n):mE(t,n);return(n?.scope_??tu()).drafts_.push(l),o.callbacks_=n?.callbacks_??[],o.key_=i,n&&i!==void 0?hE(n,o,i):o.callbacks_.push(function(m){m.mapSetPlugin_?.fixSetContents(o);const{patchPlugin_:h}=m;o.modified_&&h&&h.generatePatches_(o,[],m)}),l}function xE(e){return Qa(e)||bs(10,e),dw(e)}function dw(e){if(!ks(e)||ku(e))return e;const t=e[Nt];let n,i=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=rm(e,t.scope_.immer_.useStrictShallowCopy_),i=t.scope_.immer_.shouldUseStrictIteration()}else n=rm(e,!0);return to(n,(l,o)=>{Qc(n,l,dw(o))},i),t&&(t.finalized_=!1),n}function bE(){class e extends Map{constructor(h,p){super(),this[Nt]={type_:2,parent_:p,scope_:p?p.scope_:tu(),modified_:!1,finalized_:!1,copy_:void 0,assigned_:void 0,base_:h,draft_:this,isManual_:!1,revoked_:!1,callbacks_:[]}}get size(){return hn(this[Nt]).size}has(h){return hn(this[Nt]).has(h)}set(h,p){const g=this[Nt];return u(g),(!hn(g).has(h)||hn(g).get(h)!==p)&&(n(g),ga(g),g.assigned_.set(h,!0),g.copy_.set(h,p),g.assigned_.set(h,!0),um(g,h,p)),this}delete(h){if(!this.has(h))return!1;const p=this[Nt];return u(p),n(p),ga(p),p.base_.has(h)?p.assigned_.set(h,!1):p.assigned_.delete(h),p.copy_.delete(h),!0}clear(){const h=this[Nt];u(h),hn(h).size&&(n(h),ga(h),h.assigned_=new Map,to(h.base_,p=>{h.assigned_.set(p,!1)}),h.copy_.clear())}forEach(h,p){const g=this[Nt];hn(g).forEach((y,x,v)=>{h.call(p,this.get(x),x,this)})}get(h){const p=this[Nt];u(p);const g=hn(p).get(h);if(p.finalized_||!ks(g)||g!==p.base_.get(h))return g;const y=Yl(p.scope_,g,p,h);return n(p),p.copy_.set(h,y),y}keys(){return hn(this[Nt]).keys()}values(){const h=this.keys();return{[Symbol.iterator]:()=>this.values(),next:()=>{const p=h.next();return p.done?p:{done:!1,value:this.get(p.value)}}}}entries(){const h=this.keys();return{[Symbol.iterator]:()=>this.entries(),next:()=>{const p=h.next();if(p.done)return p;const g=this.get(p.value);return{done:!1,value:[p.value,g]}}}}[Symbol.iterator](){return this.entries()}}function t(m,h){const p=new e(m,h);return[p,p[Nt]]}function n(m){m.copy_||(m.assigned_=new Map,m.copy_=new Map(m.base_))}class i extends Set{constructor(h,p){super(),this[Nt]={type_:3,parent_:p,scope_:p?p.scope_:tu(),modified_:!1,finalized_:!1,copy_:void 0,base_:h,draft_:this,drafts_:new Map,revoked_:!1,isManual_:!1,assigned_:void 0,callbacks_:[]}}get size(){return hn(this[Nt]).size}has(h){const p=this[Nt];return u(p),p.copy_?!!(p.copy_.has(h)||p.drafts_.has(h)&&p.copy_.has(p.drafts_.get(h))):p.base_.has(h)}add(h){const p=this[Nt];return u(p),this.has(h)||(o(p),ga(p),p.copy_.add(h),um(p,h,h)),this}delete(h){if(!this.has(h))return!1;const p=this[Nt];return u(p),o(p),ga(p),p.copy_.delete(h)||(p.drafts_.has(h)?p.copy_.delete(p.drafts_.get(h)):!1)}clear(){const h=this[Nt];u(h),hn(h).size&&(o(h),ga(h),h.copy_.clear())}values(){const h=this[Nt];return u(h),o(h),h.copy_.values()}entries(){const h=this[Nt];return u(h),o(h),h.copy_.entries()}keys(){return this.values()}[Symbol.iterator](){return this.values()}forEach(h,p){const g=this.values();let y=g.next();for(;!y.done;)h.call(p,y.value,y.value,this),y=g.next()}}function l(m,h){const p=new i(m,h);return[p,p[Nt]]}function o(m){m.copy_||(m.copy_=new Set,m.base_.forEach(h=>{if(ks(h)){const p=Yl(m.scope_,h,m,h);m.drafts_.set(h,p),m.copy_.add(p)}else m.copy_.add(h)}))}function u(m){m.revoked_&&bs(3,JSON.stringify(hn(m)))}function d(m){if(m.type_===3&&m.copy_){const h=new Set(m.copy_);m.copy_.clear(),h.forEach(p=>{m.copy_.add(rE(p))})}}oE(Hl,{proxyMap_:t,proxySet_:l,fixSetContents:d})}var dm=new gE;dm.produce;var yE=dm.setAutoFreeze.bind(dm);bE();yE(!1);const Fb={common:new Set(["@context","id","type","_fileRef","_blobUrl","_parentId","_state","_filename"]),Collection:new Set(wi("Collection")),Manifest:new Set(wi("Manifest")),Canvas:new Set(wi("Canvas")),Range:new Set(wi("Range")),AnnotationPage:new Set(wi("AnnotationPage")),Annotation:new Set([...wi("Annotation"),"bodyValue"])};function $s(e){if(typeof structuredClone=="function")try{return structuredClone(e)}catch{}return JSON.parse(JSON.stringify(e))}function vE(e){return typeof e=="object"&&e!==null&&"type"in e}function fm(e,t){const n={},i=Fb.common,l=Fb[t];for(const[o,u]of Object.entries(e))i.has(o)||l.has(o)||u!=null&&(n[o]=u);return n}function Ci(e,t){if(t)for(const[n,i]of Object.entries(t))e[n]=i}function fw(){return{entities:{Collection:{},Manifest:{},Canvas:{},Range:{},AnnotationPage:{},Annotation:{}},references:{},reverseRefs:{},collectionMembers:{},memberOfCollections:{},rootId:null,typeIndex:{},extensions:{},trashedEntities:{}}}function Uc(e){const t=fw();return t.rootId=e.id,Ll(e,t,null),t}function Ll(e,t,n){const i=e.type,l=e.id;t.typeIndex[l]=i,n&&(t.reverseRefs[l]=n,t.references[n]||(t.references[n]=[]),t.references[n].push(l));const o=fm($s(e),i);switch(Object.keys(o).length>0&&(t.extensions[l]=o),i){case"Collection":{const u=e,d=[];if(t.entities.Collection[l]={...u,items:[]},u.items)for(const m of u.items)d.push(m.id),t.memberOfCollections[m.id]||(t.memberOfCollections[m.id]=[]),t.memberOfCollections[m.id].push(l),Ll(m,t,null);t.collectionMembers[l]=d;break}case"Manifest":{const u=e,d=[];if(t.entities.Manifest[l]={...u,items:[],structures:[]},u.items)for(const m of u.items)d.push(m.id),Ll(m,t,l);if(u.structures)for(const m of u.structures)Ll(m,t,l);t.references[l]=d;break}case"Canvas":{const u=e,d=[];if(t.entities.Canvas[l]={...u,items:[],annotations:[]},u.items)for(const m of u.items)d.push(m.id),Pb(m,t,l);if(u.annotations)for(const m of u.annotations)Pb(m,t,l);t.references[l]=d;break}case"Range":{const u=e;if(t.entities.Range[l]={...u},u.items)for(const d of u.items)vE(d)&&d.type==="Range"&&Ll(d,t,l);break}default:console.warn(`Unknown entity type: ${i}`)}}function Pb(e,t,n){const i=e.id;t.typeIndex[i]="AnnotationPage",t.reverseRefs[i]=n,t.references[n]||(t.references[n]=[]),t.references[n].push(i);const l=fm($s(e),"AnnotationPage");Object.keys(l).length>0&&(t.extensions[i]=l),t.entities.AnnotationPage[i]={...e,items:[]};const o=[];if(e.items)for(const u of e.items){o.push(u.id),t.typeIndex[u.id]="Annotation",t.reverseRefs[u.id]=i;const d={...u};if(d.body&&typeof d.body=="object"&&d.body!==null){const h=d.body;"value"in h&&typeof h.value=="string"&&(h.value=oh(h.value)),"format"in h&&h.format==="text/html"&&"value"in h&&(h.value=oh(h.value))}d.bodyValue&&(d.bodyValue=oh(d.bodyValue)),t.entities.Annotation[u.id]=d;const m=fm($s(d),"Annotation");Object.keys(m).length>0&&(t.extensions[u.id]=m)}t.references[i]=o}function wE(e){return e.rootId?hw(e,e.rootId):null}function hw(e,t){const n=e.typeIndex[t];switch(n){case"Collection":{const i=$s(e.entities.Collection[t]),l=e.collectionMembers[t]||[];return i.items=l.map(o=>hw(e,o)).filter(Boolean),Ci(i,e.extensions[t]),i}case"Manifest":{const i=$s(e.entities.Manifest[t]),l=e.references[t]||[];i.items=l.filter(u=>e.typeIndex[u]==="Canvas").map(u=>$b(e,u));const o=Object.keys(e.entities.Range).filter(u=>e.reverseRefs[u]===t);return o.length>0&&(i.structures=o.map(u=>{const d=$s(e.entities.Range[u]);return Ci(d,e.extensions[u]),d})),Ci(i,e.extensions[t]),i}case"Canvas":return $b(e,t);case"Range":{const i=$s(e.entities.Range[t]);return Ci(i,e.extensions[t]),i}default:throw new Error(`Cannot denormalize type: ${n}`)}}function $b(e,t){const n=$s(e.entities.Canvas[t]),i=e.references[t]||[];return n.items=i.filter(l=>e.typeIndex[l]==="AnnotationPage").map(l=>NE(e,l)),Ci(n,e.extensions[t]),n}function NE(e,t){const n=$s(e.entities.AnnotationPage[t]),i=e.references[t]||[];return n.items=i.filter(l=>e.typeIndex[l]==="Annotation").map(l=>{const o=$s(e.entities.Annotation[l]);return Ci(o,e.extensions[l]),o}),Ci(n,e.extensions[t]),n}function Yn(e,t){const n=e.typeIndex[t];return n&&e.entities[n][t]||null}function mw(e,t){const n=[],i=[...e.references[t]||[]];for(;i.length>0;){const l=i.shift();n.push(l),i.push(...e.references[l]||[])}return n}function ua(e,t,n){const i=e.typeIndex[t];if(!i){let m=null;for(const h of Object.keys(e.entities))if(e.entities[h][t]){m=h;break}if(!m)return console.warn(`Entity not found in vault: ${t}. Update aborted.`),e;e.typeIndex[t]=m,console.info(`Fixed stale type index for ${t} (${m})`)}const l=i||e.typeIndex[t],o=e.entities[l],u=o[t];if(!u)return e;n.id&&n.id!==t&&console.warn("Direct ID update through updateEntity is discouraged. Use renameEntity logic.");const d={...u,...n};return{...e,entities:{...e.entities,[l]:{...o,[t]:d}}}}function zb(e,t,n){const i=t.type,l=t.id,o=e.entities[i],u={...e.entities,[i]:{...o,[l]:t}},d={...e.typeIndex,[l]:i},m={...e.references,[n]:[...e.references[n]||[],l]},h={...e.reverseRefs,[l]:n};return{...e,entities:u,typeIndex:d,references:m,reverseRefs:h}}function hm(e,t,n={}){const{permanent:i=!1}=n;if(!e.typeIndex[t])return e;const o=new Set([t,...mw(e,t)]);if(!i)return pw(e,t);const u={Collection:{},Manifest:{},Canvas:{},Range:{},AnnotationPage:{},Annotation:{}};for(const x of Object.keys(e.entities)){const v=e.entities[x];for(const[N,j]of Object.entries(v))o.has(N)||(u[x][N]=j)}const d={};for(const[x,v]of Object.entries(e.typeIndex))o.has(x)||(d[x]=v);const m={};for(const[x,v]of Object.entries(e.references))o.has(x)||(m[x]=v.filter(N=>!o.has(N)));const h={};for(const[x,v]of Object.entries(e.reverseRefs))o.has(x)||(h[x]=v);const p={};for(const[x,v]of Object.entries(e.collectionMembers))o.has(x)||(p[x]=v.filter(N=>!o.has(N)));const g={};for(const[x,v]of Object.entries(e.memberOfCollections))o.has(x)||(g[x]=v.filter(N=>!o.has(N)));const y={...e.trashedEntities};for(const x of o)delete y[x];return{...e,entities:u,typeIndex:d,references:m,reverseRefs:h,collectionMembers:p,memberOfCollections:g,trashedEntities:y,rootId:o.has(e.rootId)?null:e.rootId}}function pw(e,t){if(!e.typeIndex[t])return e;const i=new Set([t,...mw(e,t)]),l=Yn(e,t);if(!l)return e;const o={entity:l,originalParentId:e.reverseRefs[t]||null,trashedAt:Date.now(),memberOfCollections:[...e.memberOfCollections[t]||[]],childIds:[...e.references[t]||[]]},u={...e.trashedEntities,[t]:o},d={Collection:{},Manifest:{},Canvas:{},Range:{},AnnotationPage:{},Annotation:{}};for(const x of Object.keys(e.entities)){const v=e.entities[x];for(const[N,j]of Object.entries(v))i.has(N)||(d[x][N]=j)}const m={};for(const[x,v]of Object.entries(e.typeIndex))i.has(x)||(m[x]=v);const h={};for(const[x,v]of Object.entries(e.references))i.has(x)||(h[x]=v.filter(N=>!i.has(N)));const p={};for(const[x,v]of Object.entries(e.reverseRefs))i.has(x)||(p[x]=v);const g={};for(const[x,v]of Object.entries(e.collectionMembers))i.has(x)||(g[x]=v.filter(N=>!i.has(N)));const y={};for(const[x,v]of Object.entries(e.memberOfCollections))i.has(x)||(y[x]=v.filter(N=>!i.has(N)));return{...e,entities:d,typeIndex:m,references:h,reverseRefs:p,collectionMembers:g,memberOfCollections:y,trashedEntities:u,rootId:i.has(e.rootId)?null:e.rootId}}function Ub(e,t,n){const i=e.trashedEntities[t];if(!i)return console.warn(`Entity ${t} not found in trash`),e;const l=i.entity,o=l.type,u=n?.parentId??i.originalParentId,d={...e.entities,[o]:{...e.entities[o],[t]:{...l,_state:void 0}}},m={...e.typeIndex,[t]:o};let h={...e.references},p={...e.reverseRefs};if(u&&e.typeIndex[u]){const v=e.references[u]||[];if(typeof n?.index=="number"){const N=[...v];N.splice(n.index,0,t),h={...h,[u]:N}}else h={...h,[u]:[...v,t]};p={...p,[t]:u}}let g={...e.collectionMembers},y={...e.memberOfCollections};for(const v of i.memberOfCollections)e.entities.Collection[v]&&(g={...g,[v]:[...g[v]||[],t]},y={...y,[t]:[...y[t]||[],v]});const x={...e.trashedEntities};return delete x[t],{...e,entities:d,typeIndex:m,references:h,reverseRefs:p,collectionMembers:g,memberOfCollections:y,trashedEntities:x}}function SE(e){const t=[];let n=e,i=0;const l=Object.keys(e.trashedEntities);for(const o of l)try{n=hm(n,o,{permanent:!0}),i++}catch(u){t.push(`Failed to delete ${o}: ${u instanceof Error?u.message:"Unknown error"}`)}return{state:n,deletedCount:i,errors:t}}function CE(e,t,n,i){const l=e.reverseRefs[t];if(!l)return e;const u=(e.references[l]||[]).filter(m=>m!==t),d=[...e.references[n]||[]];return typeof i=="number"?d.splice(i,0,t):d.push(t),{...e,references:{...e.references,[l]:u,[n]:d},reverseRefs:{...e.reverseRefs,[t]:n}}}function Bb(e,t,n){return{...e,references:{...e.references,[t]:n}}}async function jE(e){const t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(i=>i.toString(16).padStart(2,"0")).join("")}class EE{constructor(){this.provenanceMap=new Map,this.sessionAgent={type:"Software",name:"IIIF Field Studio",version:"1.0.0"}}setAgent(t){this.sessionAgent=t}generateEntryId(){return`prov-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}recordCreate(t,n,i){const l={id:this.generateEntryId(),timestamp:new Date().toISOString(),action:"create",agent:this.sessionAgent,source:i},o={resourceId:t,resourceType:n,created:l,modified:[],exports:[]};return this.provenanceMap.set(t,o),l}async recordIngest(t,n,i){const l=await i.arrayBuffer(),o=await jE(l),u={filename:i.name,fileSize:i.size,mimeType:i.type,checksum:o,modifiedDate:new Date(i.lastModified).toISOString(),ingestTimestamp:new Date().toISOString()};return this.recordCreate(t,n,u)}recordUpdate(t,n,i){const l=this.provenanceMap.get(t);if(!l)return console.warn(`No provenance record for ${t}`),null;const o={id:this.generateEntryId(),timestamp:new Date().toISOString(),action:"update",agent:this.sessionAgent,changes:n,description:i};return l.modified.push(o),o}recordBatchUpdate(t,n,i){const l=[];for(const o of t){const u=this.recordUpdate(o,n,i);u&&(u.action="batch-update",u.affectedCount=t.length,l.push(u))}return l}recordExport(t,n,i){const l=this.provenanceMap.get(t);if(!l)return null;const o={id:this.generateEntryId(),timestamp:new Date().toISOString(),action:"export",agent:this.sessionAgent,description:`Exported as ${n}${i?` to ${i}`:""}`};return l.exports.push(o),o}recordExternalImport(t,n,i){const l={id:this.generateEntryId(),timestamp:new Date().toISOString(),action:"import-external",agent:this.sessionAgent,description:`Imported from ${i}`},o={resourceId:t,resourceType:n,created:l,modified:[],exports:[]};return this.provenanceMap.set(t,o),l}getProvenance(t){return this.provenanceMap.get(t)||null}getHistory(t){const n=this.provenanceMap.get(t);return n?[n.created,...n.modified,...n.exports].sort((i,l)=>new Date(i.timestamp).getTime()-new Date(l.timestamp).getTime()):[]}exportPREMIS(t){const n=this.provenanceMap.get(t);if(!n)return"";const i=this.getHistory(t),l=`agent:${this.sessionAgent.name.toLowerCase().replace(/\s+/g,"-")}`,o=i.map(v=>{const N={create:"creation",update:"modification",delete:"deletion",merge:"deaccession",export:"dissemination",ingest:"ingestion","batch-update":"modification","import-external":"capture"},j={create:"implementer",update:"editor",delete:"implementer",merge:"implementer",export:"disseminator",ingest:"implementer","batch-update":"editor","import-external":"implementer"},C=v.changes?.map(A=>`
          <premis:eventOutcomeDetailExtension>
            <fieldStudio:propertyChange xmlns:fieldStudio="http://field-studio.io/premis-extension">
              <fieldStudio:property>${this.escapeXml(A.property)}</fieldStudio:property>
              <fieldStudio:oldValue>${this.escapeXml(JSON.stringify(A.oldValue))}</fieldStudio:oldValue>
              <fieldStudio:newValue>${this.escapeXml(JSON.stringify(A.newValue))}</fieldStudio:newValue>
            </fieldStudio:propertyChange>
          </premis:eventOutcomeDetailExtension>`).join("")||"";return`
  <premis:event>
    <premis:eventIdentifier>
      <premis:eventIdentifierType>local</premis:eventIdentifierType>
      <premis:eventIdentifierValue>${v.id}</premis:eventIdentifierValue>
    </premis:eventIdentifier>
    <premis:eventType>${N[v.action]||v.action}</premis:eventType>
    <premis:eventDateTime>${v.timestamp}</premis:eventDateTime>
    <premis:eventDetailInformation>
      <premis:eventDetail>${this.escapeXml(v.description||`${v.action} action performed`)}</premis:eventDetail>
      ${v.affectedCount?`<premis:eventDetailExtension>
        <fieldStudio:batchInfo xmlns:fieldStudio="http://field-studio.io/premis-extension">
          <fieldStudio:affectedCount>${v.affectedCount}</fieldStudio:affectedCount>
        </fieldStudio:batchInfo>
      </premis:eventDetailExtension>`:""}
    </premis:eventDetailInformation>
    <premis:eventOutcomeInformation>
      <premis:eventOutcome>success</premis:eventOutcome>
      ${v.description?`<premis:eventOutcomeDetail>
        <premis:eventOutcomeDetailNote>${this.escapeXml(v.description)}</premis:eventOutcomeDetailNote>${C}
      </premis:eventOutcomeDetail>`:""}
    </premis:eventOutcomeInformation>
    <premis:linkingAgentIdentifier>
      <premis:linkingAgentIdentifierType>local</premis:linkingAgentIdentifierType>
      <premis:linkingAgentIdentifierValue>${l}</premis:linkingAgentIdentifierValue>
      <premis:linkingAgentRole>${j[v.action]||"implementer"}</premis:linkingAgentRole>
    </premis:linkingAgentIdentifier>
    <premis:linkingObjectIdentifier>
      <premis:linkingObjectIdentifierType>URI</premis:linkingObjectIdentifierType>
      <premis:linkingObjectIdentifierValue>${this.escapeXml(t)}</premis:linkingObjectIdentifierValue>
      <premis:linkingObjectRole>outcome</premis:linkingObjectRole>
    </premis:linkingObjectIdentifier>
  </premis:event>`}).join(`
`);let u="";const d=n.created.source;d&&(u=`
    <premis:objectCharacteristics>
      <premis:compositionLevel>0</premis:compositionLevel>
      <premis:fixity>
        <premis:messageDigestAlgorithm>SHA-256</premis:messageDigestAlgorithm>
        <premis:messageDigest>${d.checksum}</premis:messageDigest>
        <premis:messageDigestOriginator>${this.escapeXml(this.sessionAgent.name)}</premis:messageDigestOriginator>
      </premis:fixity>
      <premis:size>${d.fileSize}</premis:size>
      <premis:format>
        <premis:formatDesignation>
          <premis:formatName>${this.escapeXml(d.mimeType)}</premis:formatName>
        </premis:formatDesignation>
        <premis:formatRegistry>
          <premis:formatRegistryName>IANA Media Types</premis:formatRegistryName>
          <premis:formatRegistryKey>${this.escapeXml(d.mimeType)}</premis:formatRegistryKey>
        </premis:formatRegistry>
      </premis:format>
      <premis:creatingApplication>
        <premis:creatingApplicationName>${this.escapeXml(this.sessionAgent.name)}</premis:creatingApplicationName>
        <premis:creatingApplicationVersion>${this.escapeXml(this.sessionAgent.version||"1.0.0")}</premis:creatingApplicationVersion>
        <premis:dateCreatedByApplication>${d.ingestTimestamp}</premis:dateCreatedByApplication>
      </premis:creatingApplication>
    </premis:objectCharacteristics>`);let m=`
    <premis:storage>
      <premis:storageMedium>IndexedDB (Browser Local Storage)</premis:storageMedium>
    </premis:storage>`,h=`
    <premis:significantProperties>
      <premis:significantPropertiesType>IIIF Resource Type</premis:significantPropertiesType>
      <premis:significantPropertiesValue>${n.resourceType}</premis:significantPropertiesValue>
    </premis:significantProperties>`,p=d?.filename?`<premis:originalName>${this.escapeXml(d.filename)}</premis:originalName>`:"";const g=`
    <premis:environment>
      <premis:environmentCharacteristic>recommended</premis:environmentCharacteristic>
      <premis:environmentPurpose>render</premis:environmentPurpose>
      <premis:environmentNote>IIIF-compatible viewer required for optimal presentation</premis:environmentNote>
      <premis:environmentDesignation>
        <premis:environmentName>IIIF Universal Viewer</premis:environmentName>
        <premis:environmentVersion>4.x</premis:environmentVersion>
      </premis:environmentDesignation>
    </premis:environment>`,y=`
  <premis:agent>
    <premis:agentIdentifier>
      <premis:agentIdentifierType>local</premis:agentIdentifierType>
      <premis:agentIdentifierValue>${l}</premis:agentIdentifierValue>
    </premis:agentIdentifier>
    <premis:agentName>${this.escapeXml(this.sessionAgent.name)}</premis:agentName>
    <premis:agentType>${this.sessionAgent.type.toLowerCase()}</premis:agentType>
    <premis:agentVersion>${this.escapeXml(this.sessionAgent.version||"1.0.0")}</premis:agentVersion>
    <premis:agentExtension>
      <fieldStudio:agentDetails xmlns:fieldStudio="http://field-studio.io/premis-extension">
        <fieldStudio:platform>Web Browser (IndexedDB)</fieldStudio:platform>
        <fieldStudio:iiifCompliance>IIIF Presentation API 3.0, IIIF Image API 3.0</fieldStudio:iiifCompliance>
      </fieldStudio:agentDetails>
    </premis:agentExtension>
  </premis:agent>`;return`<?xml version="1.0" encoding="UTF-8"?>
<premis:premis xmlns:premis="http://www.loc.gov/premis/v3"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xmlns:fieldStudio="http://field-studio.io/premis-extension"
               xsi:schemaLocation="http://www.loc.gov/premis/v3 http://www.loc.gov/standards/premis/premis.xsd"
               version="3.0">

  <!-- Intellectual Entity representing the IIIF resource -->
  <premis:object xsi:type="premis:intellectualEntity">
    <premis:objectIdentifier>
      <premis:objectIdentifierType>URI</premis:objectIdentifierType>
      <premis:objectIdentifierValue>${this.escapeXml(t)}</premis:objectIdentifierValue>
    </premis:objectIdentifier>
    <premis:objectCategory>${n.resourceType}</premis:objectCategory>
    ${p}
    <premis:preservationLevel>
      <premis:preservationLevelValue>bit-level</premis:preservationLevelValue>
      <premis:preservationLevelRole>requirement</premis:preservationLevelRole>
      <premis:preservationLevelRationale>Local-first archival with SHA-256 fixity</premis:preservationLevelRationale>
      <premis:preservationLevelDateAssigned>${n.created.timestamp}</premis:preservationLevelDateAssigned>
    </premis:preservationLevel>
    ${h}
    ${u}
    ${m}
    ${g}
  </premis:object>
${o}
${y}

</premis:premis>`}exportMultiplePREMIS(t){const n=[],i=[],l=new Set;for(const u of t){const d=this.provenanceMap.get(u);if(!d)continue;const m=d.created.source;n.push(`
  <premis:object xsi:type="premis:file">
    <premis:objectIdentifier>
      <premis:objectIdentifierType>URI</premis:objectIdentifierType>
      <premis:objectIdentifierValue>${this.escapeXml(u)}</premis:objectIdentifierValue>
    </premis:objectIdentifier>
    <premis:objectCategory>${d.resourceType}</premis:objectCategory>
    ${m?.filename?`<premis:originalName>${this.escapeXml(m.filename)}</premis:originalName>`:""}
    ${m?`<premis:objectCharacteristics>
      <premis:fixity>
        <premis:messageDigestAlgorithm>SHA-256</premis:messageDigestAlgorithm>
        <premis:messageDigest>${m.checksum}</premis:messageDigest>
      </premis:fixity>
      <premis:size>${m.fileSize}</premis:size>
      <premis:format>
        <premis:formatDesignation>
          <premis:formatName>${this.escapeXml(m.mimeType)}</premis:formatName>
        </premis:formatDesignation>
      </premis:format>
    </premis:objectCharacteristics>`:""}
  </premis:object>`);const h=this.getHistory(u);for(const p of h)i.push(`
  <premis:event>
    <premis:eventIdentifier>
      <premis:eventIdentifierType>local</premis:eventIdentifierType>
      <premis:eventIdentifierValue>${p.id}</premis:eventIdentifierValue>
    </premis:eventIdentifier>
    <premis:eventType>${p.action}</premis:eventType>
    <premis:eventDateTime>${p.timestamp}</premis:eventDateTime>
    <premis:eventOutcomeInformation>
      <premis:eventOutcome>success</premis:eventOutcome>
    </premis:eventOutcomeInformation>
    <premis:linkingObjectIdentifier>
      <premis:linkingObjectIdentifierType>URI</premis:linkingObjectIdentifierType>
      <premis:linkingObjectIdentifierValue>${this.escapeXml(u)}</premis:linkingObjectIdentifierValue>
    </premis:linkingObjectIdentifier>
  </premis:event>`),l.add(p.agent.name)}const o=Array.from(l).map(u=>`
  <premis:agent>
    <premis:agentIdentifier>
      <premis:agentIdentifierType>local</premis:agentIdentifierType>
      <premis:agentIdentifierValue>agent:${u.toLowerCase().replace(/\s+/g,"-")}</premis:agentIdentifierValue>
    </premis:agentIdentifier>
    <premis:agentName>${this.escapeXml(u)}</premis:agentName>
    <premis:agentType>software</premis:agentType>
  </premis:agent>`).join(`
`);return`<?xml version="1.0" encoding="UTF-8"?>
<premis:premis xmlns:premis="http://www.loc.gov/premis/v3"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="http://www.loc.gov/premis/v3 http://www.loc.gov/standards/premis/premis.xsd"
               version="3.0">
${n.join(`
`)}
${i.join(`
`)}
${o}
</premis:premis>`}exportAllJSON(){const t={};for(const[n,i]of this.provenanceMap)t[n]=i;return JSON.stringify(t,null,2)}importJSON(t){try{const n=JSON.parse(t);for(const[i,l]of Object.entries(n))this.provenanceMap.set(i,l)}catch(n){console.error("Failed to import provenance:",n)}}getStats(){let t=0,n=0;const i={};for(const l of this.provenanceMap.values())t+=l.modified.length,n+=l.exports.length,i[l.resourceType]=(i[l.resourceType]||0)+1;return{resourceCount:this.provenanceMap.size,totalModifications:t,totalExports:n,resourcesByType:i}}clear(){this.provenanceMap.clear()}escapeXml(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}}const AE=new EE,gw={"auto-advance":["Collection","Manifest","Canvas","Range"],"no-auto-advance":["Collection","Manifest","Canvas","Range"],repeat:["Collection","Manifest"],"no-repeat":["Collection","Manifest"],unordered:["Collection","Manifest","Range"],individuals:["Collection","Manifest","Range"],continuous:["Collection","Manifest","Range"],paged:["Collection","Manifest","Range"],"facing-pages":["Canvas"],"non-paged":["Canvas"],"multi-part":["Collection"],together:["Collection"],sequence:["Range"],"thumbnail-nav":["Range"],"no-nav":["Range"],hidden:["AnnotationCollection","AnnotationPage","Annotation","SpecificResource","Choice"]},xw=[{name:"temporal_advance",values:["auto-advance","no-auto-advance"],default:"no-auto-advance"},{name:"temporal_repeat",values:["repeat","no-repeat"],default:"no-repeat"},{name:"layout",values:["unordered","individuals","continuous","paged"],default:"individuals"},{name:"canvas_paging",values:["facing-pages","non-paged"],notes:"Only meaningful when Manifest has paged behavior"},{name:"collection_presentation",values:["multi-part","together"]},{name:"range_navigation",values:["sequence","thumbnail-nav","no-nav"]}],TE=[{resource:"Collection",inheritsFrom:"Collection",inherits:!0,notes:"Nested Collections inherit from parent Collection"},{resource:"Manifest",inheritsFrom:"Collection",inherits:!1,notes:"Manifests do NOT inherit from referencing Collection"},{resource:"Canvas",inheritsFrom:"Manifest",inherits:!0,notes:"Canvases inherit from their parent Manifest"},{resource:"Canvas",inheritsFrom:"Range",inherits:!1,notes:"Canvases do NOT inherit from referencing Range"},{resource:"Range",inheritsFrom:"Range",inherits:!0,notes:"Nested Ranges inherit from parent Range"},{resource:"Range",inheritsFrom:"Manifest",inherits:!0,notes:"Ranges inherit from their Manifest"}],_E={"auto-advance":{behavior:"auto-advance",category:"temporal_advance",description:"Proceed to next Canvas/segment when current one ends",requires:"duration dimension",validOn:["Collection","Manifest","Canvas","Range"]},"no-auto-advance":{behavior:"no-auto-advance",category:"temporal_advance",description:"Do not proceed automatically when Canvas/segment ends",default:!0,validOn:["Collection","Manifest","Canvas","Range"]},repeat:{behavior:"repeat",category:"temporal_repeat",description:"Loop back to first Canvas when reaching end (if auto-advance active)",requires:"duration dimension",validOn:["Collection","Manifest"]},"no-repeat":{behavior:"no-repeat",category:"temporal_repeat",description:"Do not loop back to beginning",default:!0,validOn:["Collection","Manifest"]},unordered:{behavior:"unordered",category:"layout",description:"Canvases have no inherent order, UI should not imply order",validOn:["Collection","Manifest","Range"]},individuals:{behavior:"individuals",category:"layout",description:"Each Canvas is a distinct view, not for page-turning interface",default:!0,validOn:["Collection","Manifest","Range"]},continuous:{behavior:"continuous",category:"layout",description:"Canvases are partial views, display stitched together (e.g., scroll)",requires:"height and width dimensions",validOn:["Collection","Manifest","Range"]},paged:{behavior:"paged",category:"layout",description:"Display in page-turning interface, first canvas is recto",requires:"height and width dimensions",validOn:["Collection","Manifest","Range"]},"facing-pages":{behavior:"facing-pages",category:"canvas_paging",description:"Canvas depicts both parts of opening, display alone",context:"Only meaningful when Manifest has paged behavior",validOn:["Canvas"]},"non-paged":{behavior:"non-paged",category:"canvas_paging",description:"Skip this Canvas in page-turning interface",context:"Only meaningful when Manifest has paged behavior",validOn:["Canvas"]},"multi-part":{behavior:"multi-part",category:"collection_presentation",description:"Child Manifests/Collections form logical whole (e.g., multi-volume)",validOn:["Collection"]},together:{behavior:"together",category:"collection_presentation",description:"Present all child Manifests simultaneously in separate viewing area",validOn:["Collection"]},sequence:{behavior:"sequence",category:"range_navigation",description:"Range represents alternative ordering of Manifest's Canvases",context:"Must be in Manifest's structures property",validOn:["Range"]},"thumbnail-nav":{behavior:"thumbnail-nav",category:"range_navigation",description:"Use for thumbnail-based navigation (keyframes, scroll sections)",validOn:["Range"]},"no-nav":{behavior:"no-nav",category:"range_navigation",description:"Do not display in navigation hierarchy (blank pages, dead air)",validOn:["Range"]},hidden:{behavior:"hidden",category:"visibility",description:"Do not render by default, allow user to toggle",validOn:["AnnotationCollection","AnnotationPage","Annotation","SpecificResource","Choice"]}};function bw(e,t){return gw[e]?.includes(t)||!1}function yw(e){const t=[];for(const[n,i]of Object.entries(gw))i.includes(e)&&t.push(n);return t}function Jm(e){const t=[];for(const n of xw){const i=e.filter(l=>n.values.includes(l));i.length>1&&t.push(`Conflicting behaviors from ${n.name} set: ${i.join(", ")}`)}return t}function vw(e){for(const t of xw)if(t.values.includes(e))return t;return null}function ww(e,t){return TE.find(i=>i.resource===e&&i.inheritsFrom===t)?.inherits||!1}function Nw(e,t,n,i){const l=[],o=[];for(const d of t)bw(d,e)||l.push(`Behavior "${d}" is not valid for ${e}`);const u=Jm(t);if(l.push(...u),n&&i&&ww(e,n))for(const d of t){const m=vw(d);if(m){const h=i.filter(p=>m.values.includes(p)&&p!==d);h.length>0&&o.push(`Behavior "${d}" conflicts with inherited parent behavior: ${h.join(", ")}. Child overrides parent.`)}}for(const d of t){const m=_E[d];m?.requires&&o.push(`Behavior "${d}" requires ${m.requires}`)}return{valid:l.length===0,errors:l,warnings:o}}function kE(e,t){const n=[],i=yw(e);return t.hasDuration&&i.includes("auto-advance")&&n.push("auto-advance"),t.hasPageSequence&&i.includes("paged")&&n.push("paged"),t.isUnordered&&i.includes("unordered")&&n.push("unordered"),t.isMultiVolume&&i.includes("multi-part")&&n.push("multi-part"),t.hasWidth&&t.hasHeight&&!t.hasPageSequence&&i.includes("continuous")&&n.push("continuous"),n}const OE={".jpg":"image/jpeg",".jpeg":"image/jpeg",".png":"image/png",".gif":"image/gif",".tif":"image/tiff",".tiff":"image/tiff",".webp":"image/webp",".svg":"image/svg+xml",".bmp":"image/bmp",".ico":"image/x-icon",".avif":"image/avif",".heic":"image/heic",".heif":"image/heif",".mp4":"video/mp4",".webm":"video/webm",".ogv":"video/ogg",".mov":"video/quicktime",".avi":"video/x-msvideo",".mkv":"video/x-matroska",".m4v":"video/x-m4v",".mp3":"audio/mpeg",".wav":"audio/wav",".ogg":"audio/ogg",".oga":"audio/ogg",".flac":"audio/flac",".aac":"audio/aac",".m4a":"audio/mp4",".weba":"audio/webm",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".csv":"text/csv",".md":"text/markdown",".vtt":"text/vtt",".srt":"text/srt",".pdf":"application/pdf",".epub":"application/epub+zip",".xml":"application/xml",".json":"application/json",".jsonld":"application/ld+json",".rdf":"application/rdf+xml",".gltf":"model/gltf+json",".glb":"model/gltf-binary",".obj":"model/obj",".stl":"model/stl",".usdz":"model/vnd.usdz+zip"};function IE(e){const t=e.toLowerCase().substring(e.lastIndexOf("."));return OE[t]||null}function vn(e,t="none"){return{[t]:[e]}}function DE(e){if(!e||typeof e!="string"||!/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(Z|[+-]\d{2}:\d{2})$/.test(e))return!1;const n=new Date(e);return!isNaN(n.getTime())}function dn(){return crypto.randomUUID()}const LE=kt.IMAGE_3.CONTEXT,Qm=kt.IMAGE_3.PROTOCOL;function RE(e){switch(e.type){case"full":return"full";case"square":return"square";case"pixels":return`${e.x},${e.y},${e.w},${e.h}`;case"percent":return`pct:${e.x},${e.y},${e.w},${e.h}`;default:return"full"}}function ME(e){const t=e.upscale?"^":"";switch(e.type){case"max":return`${t}max`;case"width":return`${t}${e.width},`;case"height":return`${t},${e.height}`;case"percent":return`${t}pct:${e.percent}`;case"widthHeight":return`${t}${e.width},${e.height}`;case"confined":return`${t}!${e.width},${e.height}`;default:return`${t}max`}}function FE(e){const t=e.mirror?"!":"",n=Number.isInteger(e.degrees)?e.degrees.toString():e.degrees.toFixed(1);return`${t}${n}`}function PE(e,t,n,i="level0",l){const o={"@context":LE,id:e,type:"ImageService3",protocol:Qm,profile:i,width:t,height:n};return l?.sizes&&(o.sizes=l.sizes),l?.tiles&&(o.tiles=l.tiles),l?.maxWidth&&(o.maxWidth=l.maxWidth),l?.maxHeight&&(o.maxHeight=l.maxHeight),l?.extraFeatures&&(o.extraFeatures=l.extraFeatures),l?.extraFormats&&(o.extraFormats=l.extraFormats),l?.extraQualities&&(o.extraQualities=l.extraQualities),l?.rights&&(o.rights=l.rights),o}function $E(e,t,n){const i=n||ba().sizes,l=t/e;return i.filter(o=>o<=e).map(o=>({width:o,height:Math.floor(o*l)}))}function au(e,t="level2",n,i){return{id:e,type:"ImageService3",protocol:Qm,profile:t}}function zE(e){return encodeURIComponent(e)}class UE{constructor(t){this.config={profile:"level0",...t},this.serviceUri=`${this.config.baseUri}/${zE(this.config.identifier)}`}getInfoJson(){return PE(this.serviceUri,this.config.width,this.config.height,this.config.profile,{sizes:this.config.sizes,tiles:this.config.tiles,maxWidth:this.config.maxWidth,maxHeight:this.config.maxHeight,extraFeatures:this.config.extraFeatures,extraFormats:this.config.extraFormats,extraQualities:this.config.extraQualities,rights:this.config.rights})}buildImageUri(t){const n=typeof t.region=="string"?t.region:RE(t.region),i=typeof t.size=="string"?t.size:ME(t.size),l=typeof t.rotation=="string"?t.rotation:FE(t.rotation);return`${this.serviceUri}/${n}/${i}/${l}/${t.quality}.${t.format}`}}function BE(e){if(!e)return!1;const t=e.type||e["@type"];return t==="ImageService3"||t==="ImageService2"||t==="ImageService1"||t==="iiif:ImageService2"||t?.includes("ImageService")}function mm(e){return e?.id||e?.["@id"]}function Hb(e){const t=e?.profile;return Array.isArray(t)?t[0]:t}function pm(e){if(!(!e||!Array.isArray(e)))return e.find(BE)}function gm(e,t={}){const{width:n,height:i,fullSize:l=!1,quality:o="default",format:u="jpg"}=t;let d;l||!n&&!i?d={type:"max"}:n&&i?d={type:"confined",width:n,height:i,confined:!0}:n?d={type:"width",width:n}:i?d={type:"height",height:i}:d={type:"max"};const m=e.split("/"),h=m.pop()||"",p=m.join("/");return new UE({baseUri:p,identifier:h,width:0,height:0}).buildImageUri({region:{type:"full"},size:d,rotation:{degrees:0,mirror:!1},quality:o,format:u})}function HE(e,t={}){const n={url:null,hasService:!1,isBlob:!1};if(!e)return n;const i=e.items?.[0]?.items?.[0]?.body,l=Array.isArray(i)?i[0]:i;if(l?.service){const u=pm(l.service);if(u){const d=mm(u);if(d)return n.hasService=!0,n.serviceId=d,n.serviceProfile=Hb(u),n.url=gm(d,t),n}}const o=e.thumbnail?.[0];if(o?.service){const u=pm(o.service);if(u){const d=mm(u);if(d)return n.hasService=!0,n.serviceId=d,n.serviceProfile=Hb(u),n.url=gm(d,t),n}}return o?.id?(n.url=o.id,n):l?.id?(n.url=l.id,n):e._blobUrl?(n.url=e._blobUrl,n.isBlob=!0,n):(e._fileRef&&(n.fileRef=e._fileRef),n)}function xm(e,t){if(!e)return null;const n=t||ba().thumbnailWidth;if(e._thumbUrl)return e._thumbUrl;const i=e.thumbnail?.[0];if(i){if(i.service){const l=pm(i.service);if(l){const o=mm(l);if(o)return gm(o,{width:n})}}if(i.id)return i.id}return e._blobUrl?e._blobUrl:null}function WE(e,t){if(!e)return null;const n=t;return"items"in e||"_fileRef"in e?HE(e,{width:n}).url:xm(e,n)}function Sw(e,t=4,n=0){if(!e||n>10)return[];if(Wt(e))return[e];const i=[],l=e.items||[];for(const o of l){const u=Sw(o,t-i.length,n+1);if(i.push(...u),i.length>=t)break}return i.slice(0,t)}function Os(e,t){if(!e)return[];const n=t||ba().thumbnailWidth,i=xm(e,n);return i?[i]:Sw(e,4).map(o=>xm(o,n)).filter(o=>o!==null)}function GE(e){if(!e||typeof e!="object")return[];const t=[];return e.items&&Array.isArray(e.items)&&t.push(...e.items),e.annotations&&Array.isArray(e.annotations)&&t.push(...e.annotations),e.structures&&Array.isArray(e.structures)&&t.push(...e.structures),t.filter(n=>n&&typeof n=="object")}function YE(e,t,n={}){const i=[],{maxDepth:l=0,detectCycles:o=!0}=n,u=o?new Set:null;function d(m,h,p,g){if(l>0&&p>l)return;if(u&&m.id){if(u.has(m.id))return;u.add(m.id)}const x=t(m,{depth:p,parent:h,path:g,visited:u||new Set});x!=null&&i.push(x);const v=GE(m);for(const N of v)d(N,m,p+1,[...g,m.id])}return d(e,null,0,[]),i}function Cw(e,t){const n=[];return YE(e,i=>{i.type===t&&n.push(i)}),n}function qE(e){return Cw(e,"Canvas")}function VE(e){return Cw(e,"Manifest")}function Bc(e,t){try{const n=`http://archive.local/iiif/${(e||"Resource").toLowerCase()}`,i=t||crypto.randomUUID();return`${n}/${i}`}catch{return`http://archive.local/iiif/resource/${`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}`}}const so={jpg:{type:"Image",format:"image/jpeg",motivation:"painting"},jpeg:{type:"Image",format:"image/jpeg",motivation:"painting"},png:{type:"Image",format:"image/png",motivation:"painting"},webp:{type:"Image",format:"image/webp",motivation:"painting"},gif:{type:"Image",format:"image/gif",motivation:"painting"},tiff:{type:"Image",format:"image/tiff",motivation:"painting"},tif:{type:"Image",format:"image/tiff",motivation:"painting"},bmp:{type:"Image",format:"image/bmp",motivation:"painting"},svg:{type:"Image",format:"image/svg+xml",motivation:"painting"},avif:{type:"Image",format:"image/avif",motivation:"painting"},heic:{type:"Image",format:"image/heic",motivation:"painting"},heif:{type:"Image",format:"image/heif",motivation:"painting"},mp4:{type:"Video",format:"video/mp4",motivation:"painting"},webm:{type:"Video",format:"video/webm",motivation:"painting"},ogv:{type:"Video",format:"video/ogg",motivation:"painting"},mov:{type:"Video",format:"video/quicktime",motivation:"painting"},avi:{type:"Video",format:"video/x-msvideo",motivation:"painting"},mkv:{type:"Video",format:"video/x-matroska",motivation:"painting"},m4v:{type:"Video",format:"video/x-m4v",motivation:"painting"},mp3:{type:"Sound",format:"audio/mpeg",motivation:"painting"},wav:{type:"Sound",format:"audio/wav",motivation:"painting"},ogg:{type:"Sound",format:"audio/ogg",motivation:"painting"},flac:{type:"Sound",format:"audio/flac",motivation:"painting"},aac:{type:"Sound",format:"audio/aac",motivation:"painting"},m4a:{type:"Sound",format:"audio/mp4",motivation:"painting"},weba:{type:"Sound",format:"audio/webm",motivation:"painting"},txt:{type:"Text",format:"text/plain",motivation:"supplementing"},html:{type:"Text",format:"text/html",motivation:"supplementing"},htm:{type:"Text",format:"text/html",motivation:"supplementing"},md:{type:"Text",format:"text/markdown",motivation:"supplementing"},csv:{type:"Text",format:"text/csv",motivation:"supplementing"},vtt:{type:"Text",format:"text/vtt",motivation:"supplementing"},srt:{type:"Text",format:"text/srt",motivation:"supplementing"},pdf:{type:"Text",format:"application/pdf",motivation:"painting"},json:{type:"Dataset",format:"application/json",motivation:"supplementing"},jsonld:{type:"Dataset",format:"application/ld+json",motivation:"supplementing"},xml:{type:"Dataset",format:"application/xml",motivation:"supplementing"},rdf:{type:"Dataset",format:"application/rdf+xml",motivation:"supplementing"},glb:{type:"Model",format:"model/gltf-binary",motivation:"painting"},gltf:{type:"Model",format:"model/gltf+json",motivation:"painting"},obj:{type:"Model",format:"model/obj",motivation:"painting"},stl:{type:"Model",format:"model/stl",motivation:"painting"}};Object.entries(so).filter(([,e])=>e.type==="Image").map(([e])=>e);Object.entries(so).filter(([,e])=>e.type==="Video").map(([e])=>e);Object.entries(so).filter(([,e])=>e.type==="Sound").map(([e])=>e);Object.entries(so).filter(([,e])=>e.type==="Text").map(([e])=>e);Object.entries(so).filter(([,e])=>e.type==="Model").map(([e])=>e);function KE(e){if(!e)return"";try{const n=new URL(e).pathname,i=n.lastIndexOf(".");return i===-1?"":n.substring(i+1).toLowerCase().split("?")[0]}catch{const t=e.lastIndexOf(".");return t===-1?"":e.substring(t+1).toLowerCase().split("?")[0].split("#")[0]}}function jc(e,t){if(!e)return null;if(typeof e!="object")return`${t} must be an object`;for(const[n,i]of Object.entries(e)){if(!Array.isArray(i))return`${t}["${n}"] must be an array`;for(const l of i)if(typeof l!="string")return`${t}["${n}"] must contain only strings`}return null}function XE(e,t){const n=Nw(t,e);if(n.errors.length>0)return n.errors[0];const i=Jm(e);return i.length>0?i[0]:null}function Wb(e,t){return typeof e!="number"||e<=0?"Canvas width must be a positive number":typeof t!="number"||t<=0?"Canvas height must be a positive number":null}function ZE(e,t){try{switch(t.type){case"UPDATE_LABEL":{const n=jc(t.label,"label");if(n)return{success:!1,state:e,error:n};const l=[{property:"label",oldValue:Yn(e,t.id)?.label,newValue:t.label}];return{success:!0,state:ua(e,t.id,{label:t.label}),changes:l}}case"UPDATE_SUMMARY":{const n=jc(t.summary,"summary");if(n)return{success:!1,state:e,error:n};const l=[{property:"summary",oldValue:Yn(e,t.id)?.summary,newValue:t.summary}];return{success:!0,state:ua(e,t.id,{summary:t.summary}),changes:l}}case"UPDATE_METADATA":{for(let l=0;l<t.metadata.length;l++){const o=t.metadata[l],u=jc(o.label,`metadata[${l}].label`);if(u)return{success:!1,state:e,error:u};const d=jc(o.value,`metadata[${l}].value`);if(d)return{success:!1,state:e,error:d}}const i=[{property:"metadata",oldValue:Yn(e,t.id)?.metadata,newValue:t.metadata}];return{success:!0,state:ua(e,t.id,{metadata:t.metadata}),changes:i}}case"UPDATE_RIGHTS":{if(t.rights&&!t.rights.startsWith("http"))return{success:!1,state:e,error:"Rights must be a valid URL"};const i=[{property:"rights",oldValue:Yn(e,t.id)?.rights,newValue:t.rights}];return{success:!0,state:ua(e,t.id,{rights:t.rights}),changes:i}}case"UPDATE_NAV_DATE":{if(t.navDate&&!DE(t.navDate))return{success:!1,state:e,error:"navDate must be a valid ISO 8601 date-time"};const i=[{property:"navDate",oldValue:Yn(e,t.id)?.navDate,newValue:t.navDate}];return{success:!0,state:ua(e,t.id,{navDate:t.navDate}),changes:i}}case"UPDATE_BEHAVIOR":{const n=Yn(e,t.id);if(!n)return{success:!1,state:e,error:`Entity not found: ${t.id}`};const i=XE(t.behavior,n.type);if(i)return{success:!1,state:e,error:i};const l=[{property:"behavior",oldValue:n.behavior,newValue:t.behavior}];return{success:!0,state:ua(e,t.id,{behavior:t.behavior}),changes:l}}case"UPDATE_VIEWING_DIRECTION":{if(!Km(t.viewingDirection))return{success:!1,state:e,error:`Invalid viewing direction: ${t.viewingDirection}. Must be: left-to-right, right-to-left, top-to-bottom, or bottom-to-top`};const n=Yn(e,t.id),l=[{property:"viewingDirection",oldValue:n&&"viewingDirection"in n?n.viewingDirection:void 0,newValue:t.viewingDirection}];return{success:!0,state:ua(e,t.id,{viewingDirection:t.viewingDirection}),changes:l}}case"UPDATE_CANVAS_DIMENSIONS":{const n=Wb(t.width,t.height);if(n)return{success:!1,state:e,error:n};const i=Yn(e,t.canvasId),l=[{property:"width",oldValue:i?.width,newValue:t.width},{property:"height",oldValue:i?.height,newValue:t.height}];return{success:!0,state:ua(e,t.canvasId,{width:t.width,height:t.height}),changes:l}}case"ADD_CANVAS":{if(!t.canvas.id)return{success:!1,state:e,error:"Canvas must have an id"};const n=Wb(t.canvas.width,t.canvas.height);if(n)return{success:!1,state:e,error:n};let i=zb(e,t.canvas,t.manifestId);if(typeof t.index=="number"){const l=[...e.references[t.manifestId]||[]],o=t.canvas.id,u=l.filter(d=>d!==o);u.splice(t.index,0,o),i=Bb(i,t.manifestId,u)}return{success:!0,state:i,changes:[{property:"items",oldValue:null,newValue:t.canvas.id}]}}case"REMOVE_CANVAS":return{success:!0,state:hm(e,t.canvasId),changes:[{property:"items",oldValue:t.canvasId,newValue:null}]};case"REORDER_CANVASES":{const n=e.references[t.manifestId]||[],i=new Set(n),l=new Set(t.order);if(n.length!==t.order.length)return{success:!1,state:e,error:"Reorder must include all existing canvases"};for(const o of t.order)if(!i.has(o))return{success:!1,state:e,error:`Unknown canvas ID: ${o}`};return{success:!0,state:Bb(e,t.manifestId,t.order),changes:[{property:"items",oldValue:n,newValue:t.order}]}}case"ADD_ANNOTATION":return t.annotation.id?{success:!0,state:zb(e,t.annotation,t.canvasId),changes:[{property:"annotations",oldValue:null,newValue:t.annotation.id}]}:{success:!1,state:e,error:"Annotation must have an id"};case"REMOVE_ANNOTATION":return{success:!0,state:hm(e,t.annotationId),changes:[{property:"annotations",oldValue:t.annotationId,newValue:null}]};case"MOVE_ITEM":{const n=Yn(e,t.itemId),i=Yn(e,t.newParentId);if(!n)return{success:!1,state:e,error:`Item not found: ${t.itemId}`};if(!i)return{success:!1,state:e,error:`Parent not found: ${t.newParentId}`};if(!Ja(i.type,n.type)){const o=Kc(i.type);return{success:!1,state:e,error:`Cannot move ${n.type} into ${i.type}. Valid children: ${o.join(", ")||"none"}`}}const l=Ai(i.type,n.type);return{success:!0,state:CE(e,t.itemId,t.newParentId,t.index),changes:[{property:"_parentId",oldValue:e.reverseRefs[t.itemId],newValue:t.newParentId},{property:"_relationshipType",oldValue:null,newValue:l}]}}case"BATCH_UPDATE":{let n=e;const i=[];for(const l of t.updates){n=ua(n,l.id,l.changes);for(const[o,u]of Object.entries(l.changes)){const d=Yn(e,l.id),m=d?d[o]:void 0;i.push({property:o,oldValue:m,newValue:u})}}return{success:!0,state:n,changes:i}}case"RELOAD_TREE":try{const n=Uc(t.root);return{success:!0,state:n,changes:[{property:"_root",oldValue:e.rootId,newValue:n.rootId}]}}catch(n){return{success:!1,state:e,error:n instanceof Error?n.message:"Failed to reload tree"}}case"MOVE_TO_TRASH":{const n=Yn(e,t.id);if(!n)return{success:!1,state:e,error:`Entity not found: ${t.id}`};const i=[{property:"_state",oldValue:n._state,newValue:"trashed"}];return{success:!0,state:pw(e,t.id),changes:i}}case"RESTORE_FROM_TRASH":{if(!e.trashedEntities?.[t.id])return{success:!1,state:e,error:`Entity ${t.id} not found in trash`};const i=[{property:"_state",oldValue:"trashed",newValue:void 0}];return{success:!0,state:Ub(e,t.id,t.options),changes:i}}case"EMPTY_TRASH":{const n=Object.keys(e.trashedEntities||{}).length;if(n===0)return{success:!0,state:e,changes:[]};const i=SE(e),l=[{property:"_trashedEntities",oldValue:n,newValue:0}];return{success:i.errors.length===0,state:i.state,changes:l,error:i.errors.length>0?i.errors.join("; "):void 0}}case"BATCH_RESTORE":{let n=e;const i=[],l=[];for(const o of t.ids){if(!e.trashedEntities?.[o]){l.push(`Entity ${o} not found in trash`);continue}n=Ub(n,o,t.options),i.push({property:"_state",oldValue:"trashed",newValue:void 0})}return{success:l.length===0,state:n,changes:i,error:l.length>0?l.join("; "):void 0}}default:return{success:!1,state:e,error:"Unknown action type"}}}catch(n){return{success:!1,state:e,error:n instanceof Error?n.message:"Unknown error"}}}class JE{constructor(t=100){this.history=[],this.currentIndex=-1,this.maxSize=t}push(t){this.history=this.history.slice(0,this.currentIndex+1),this.history.push({...t,timestamp:Date.now()}),this.history.length>this.maxSize?this.history.shift():this.currentIndex++}canUndo(){return this.currentIndex>=0}canRedo(){return this.currentIndex<this.history.length-1}undo(){if(!this.canUndo())return null;const t=this.history[this.currentIndex];return this.currentIndex--,t.beforeState}redo(){return this.canRedo()?(this.currentIndex++,this.history[this.currentIndex].afterState):null}getStatus(){return{position:this.currentIndex+1,total:this.history.length,canUndo:this.canUndo(),canRedo:this.canRedo()}}getRecent(t=10){const n=Math.max(0,this.currentIndex-t+1);return this.history.slice(n,this.currentIndex+1)}clear(){this.history=[],this.currentIndex=-1}}class QE{constructor(t,n=100){this.listeners=new Set,this.errorListeners=new Set,this.state=t,this.history=new JE(n)}dispatch(t){const n=this.state,i=ZE(this.state,t);if(!i.success){for(const l of this.errorListeners)l(i.error||"Unknown error",t);return!1}if(this.state=i.state,this.history.push({action:t,beforeState:n,afterState:i.state}),i.changes&&i.changes.length>0){const l="id"in t?t.id:"canvasId"in t?t.canvasId:"manifestId"in t?t.manifestId:null;l&&AE.recordUpdate(l,i.changes,t.type)}for(const l of this.listeners)l(this.state,t);return!0}undo(){const t=this.history.undo();if(!t)return!1;this.state=t;for(const n of this.listeners)n(this.state,{type:"BATCH_UPDATE",updates:[]});return!0}redo(){const t=this.history.redo();if(!t)return!1;this.state=t;for(const n of this.listeners)n(this.state,{type:"BATCH_UPDATE",updates:[]});return!0}getState(){return this.state}getHistoryStatus(){return this.history.getStatus()}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}onError(t){return this.errorListeners.add(t),()=>this.errorListeners.delete(t)}}const iu={updateLabel:(e,t)=>({type:"UPDATE_LABEL",id:e,label:t}),updateSummary:(e,t)=>({type:"UPDATE_SUMMARY",id:e,summary:t}),updateMetadata:(e,t)=>({type:"UPDATE_METADATA",id:e,metadata:t}),updateRights:(e,t)=>({type:"UPDATE_RIGHTS",id:e,rights:t}),updateNavDate:(e,t)=>({type:"UPDATE_NAV_DATE",id:e,navDate:t}),updateBehavior:(e,t)=>({type:"UPDATE_BEHAVIOR",id:e,behavior:t}),updateViewingDirection:(e,t)=>({type:"UPDATE_VIEWING_DIRECTION",id:e,viewingDirection:t}),addCanvas:(e,t,n)=>({type:"ADD_CANVAS",manifestId:e,canvas:t,index:n}),removeCanvas:(e,t)=>({type:"REMOVE_CANVAS",manifestId:e,canvasId:t}),reorderCanvases:(e,t)=>({type:"REORDER_CANVASES",manifestId:e,order:t}),addAnnotation:(e,t)=>({type:"ADD_ANNOTATION",canvasId:e,annotation:t}),removeAnnotation:(e,t)=>({type:"REMOVE_ANNOTATION",canvasId:e,annotationId:t}),updateCanvasDimensions:(e,t,n)=>({type:"UPDATE_CANVAS_DIMENSIONS",canvasId:e,width:t,height:n}),moveItem:(e,t,n)=>({type:"MOVE_ITEM",itemId:e,newParentId:t,index:n}),batchUpdate:e=>({type:"BATCH_UPDATE",updates:e}),reloadTree:e=>({type:"RELOAD_TREE",root:e}),moveToTrash:(e,t)=>({type:"MOVE_TO_TRASH",id:e,options:t}),restoreFromTrash:(e,t)=>({type:"RESTORE_FROM_TRASH",id:e,options:t}),emptyTrash:()=>({type:"EMPTY_TRASH"}),batchRestore:(e,t)=>({type:"BATCH_RESTORE",ids:e,options:t})},eA=(e,t)=>t.some(n=>e instanceof n);let Gb,Yb;function tA(){return Gb||(Gb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function nA(){return Yb||(Yb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const jw=new WeakMap,bm=new WeakMap,Ew=new WeakMap,dh=new WeakMap,ep=new WeakMap;function sA(e){const t=new Promise((n,i)=>{const l=()=>{e.removeEventListener("success",o),e.removeEventListener("error",u)},o=()=>{n(Xa(e.result)),l()},u=()=>{i(e.error),l()};e.addEventListener("success",o),e.addEventListener("error",u)});return t.then(n=>{n instanceof IDBCursor&&jw.set(n,e)}).catch(()=>{}),ep.set(t,e),t}function aA(e){if(bm.has(e))return;const t=new Promise((n,i)=>{const l=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",u),e.removeEventListener("abort",u)},o=()=>{n(),l()},u=()=>{i(e.error||new DOMException("AbortError","AbortError")),l()};e.addEventListener("complete",o),e.addEventListener("error",u),e.addEventListener("abort",u)});bm.set(e,t)}let ym={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return bm.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Ew.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Xa(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function iA(e){ym=e(ym)}function rA(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const i=e.call(fh(this),t,...n);return Ew.set(i,t.sort?t.sort():[t]),Xa(i)}:nA().includes(e)?function(...t){return e.apply(fh(this),t),Xa(jw.get(this))}:function(...t){return Xa(e.apply(fh(this),t))}}function lA(e){return typeof e=="function"?rA(e):(e instanceof IDBTransaction&&aA(e),eA(e,tA())?new Proxy(e,ym):e)}function Xa(e){if(e instanceof IDBRequest)return sA(e);if(dh.has(e))return dh.get(e);const t=lA(e);return t!==e&&(dh.set(e,t),ep.set(t,e)),t}const fh=e=>ep.get(e);function tp(e,t,{blocked:n,upgrade:i,blocking:l,terminated:o}={}){const u=indexedDB.open(e,t),d=Xa(u);return i&&u.addEventListener("upgradeneeded",m=>{i(Xa(u.result),m.oldVersion,m.newVersion,Xa(u.transaction),m)}),n&&u.addEventListener("blocked",m=>n(m.oldVersion,m.newVersion,m)),d.then(m=>{o&&m.addEventListener("close",()=>o()),l&&m.addEventListener("versionchange",h=>l(h.oldVersion,h.newVersion,h))}).catch(()=>{}),d}const oA=["get","getKey","getAll","getAllKeys","count"],cA=["put","add","delete","clear"],hh=new Map;function qb(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(hh.get(t))return hh.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,l=cA.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(l||oA.includes(n)))return;const o=async function(u,...d){const m=this.transaction(u,l?"readwrite":"readonly");let h=m.store;return i&&(h=h.index(d.shift())),(await Promise.all([h[n](...d),l&&m.done]))[0]};return hh.set(t,o),o}iA(e=>({...e,get:(t,n,i)=>qb(t,n)||e.get(t,n,i),has:(t,n)=>!!qb(t,n)||e.has(t,n)}));const uA="biiif-archive-db",fr="files",Ec="project",_l="derivatives",hr="checkpoints",Ha="tiles",mr="tileManifests",dA=.9,Vb=.95;class fA{constructor(){this._dbPromise=null,this._warningCallback=null,this._lastWarningTime=0,this._warningCooldown=6e4,this._initDB()}setWarningCallback(t){this._warningCallback=t}async checkStorageQuota(){const t=await this.getEstimate();if(!t||t.quota===0)return{ok:!0,usagePercent:0};const n=t.usage/t.quota,i=Date.now();return n>=Vb?(i-this._lastWarningTime>this._warningCooldown&&this._warningCallback&&(this._lastWarningTime=i,this._warningCallback({type:"quota_critical",message:`Storage is ${Math.round(n*100)}% full. Export your data immediately to prevent data loss.`,usagePercent:n})),{ok:!1,usagePercent:n}):(n>=dA&&i-this._lastWarningTime>this._warningCooldown&&this._warningCallback&&(this._lastWarningTime=i,this._warningCallback({type:"quota_warning",message:`Storage is ${Math.round(n*100)}% full. Consider exporting your data.`,usagePercent:n})),{ok:!0,usagePercent:n})}_initDB(){this._dbPromise=tp(uA,4,{upgrade(t,n){n<1&&(t.createObjectStore(fr),t.createObjectStore(Ec)),n<2&&t.createObjectStore(_l),n<3&&t.createObjectStore(hr),n<4&&(t.createObjectStore(Ha),t.createObjectStore(mr))},blocked:()=>{console.warn("IDB blocked: Another connection is open with an older version.")},blocking:()=>{console.warn("IDB blocking: A new version is trying to open. Closing this connection."),this._dbPromise=null},terminated:()=>{console.error("IDB terminated: Browser closed the connection."),this._dbPromise=null}})}async getDB(){return this._dbPromise||this._initDB(),this._dbPromise}async saveWithQuotaCheck(t,n){const{ok:i,usagePercent:l}=await this.checkStorageQuota();!i&&l>=Vb&&console.warn(`Storage critically full, attempting ${t} anyway`);try{return await n()}catch(o){throw o instanceof DOMException&&o.name==="QuotaExceededError"&&this._warningCallback?.({type:"save_failed",message:`Failed to ${t}: Storage quota exceeded. Free up space by exporting and clearing data.`,usagePercent:1}),o}}async saveAsset(t,n){return this.saveWithQuotaCheck("save asset",async()=>{await(await this.getDB()).put(fr,t,n)})}async saveDerivative(t,n,i){await(await this.getDB()).put(_l,i,`${t}_${n}`)}async getAsset(t){return await(await this.getDB()).get(fr,t)}async getDerivative(t,n){return await(await this.getDB()).get(_l,`${t}_${n}`)}async saveProject(t){return this.saveWithQuotaCheck("save project",async()=>{await(await this.getDB()).put(Ec,t,"root")})}async loadProject(){const t=await this.getDB();try{return await t.get(Ec,"root")}catch(n){console.error("Failed to load project from IDB",n);return}}async clear(){const t=await this.getDB();await t.clear(fr),await t.clear(_l),await t.clear(Ec)}async getEstimate(){if("storage"in navigator&&"estimate"in navigator.storage)try{const t=await navigator.storage.estimate();return{usage:t.usage||0,quota:t.quota||0}}catch{return null}return null}async loadResource(t){const n=await this.loadProject();if(!n)return null;const i=l=>{if(l.id===t)return l;const o=l.items||l.annotations||[];for(const u of o)if(u&&typeof u=="object"){const d=i(u);if(d)return d}return null};return i(n)}async saveResource(t,n){const i=await this.loadProject();if(!i)return!1;const l=o=>{if(o.id===t)return Object.assign(o,n),!0;const u=o.items||o.annotations||[];for(const d of u)if(d&&typeof d=="object"&&l(d))return!0;return!1};return l(i)?(await this.saveProject(i),!0):!1}async getAllAssetIds(){return await(await this.getDB()).getAllKeys(fr)}async deleteAsset(t){const n=await this.getDB();await n.delete(fr,t);const i=["thumb","small","medium"];for(const l of i)await n.delete(_l,`${t}_${l}`)}async saveCheckpoint(t,n){await(await this.getDB()).put(hr,n,t)}async loadCheckpoint(t){return await(await this.getDB()).get(hr,t)||null}async listCheckpoints(){return await(await this.getDB()).getAll(hr)}async deleteCheckpoint(t){await(await this.getDB()).delete(hr,t)}async clearAllCheckpoints(){await(await this.getDB()).clear(hr)}_getTileKey(t,n,i,l,o="jpg"){return`${t}/${n}/${i}_${l}.${o}`}_getManifestKey(t){return`${t}_manifest`}async saveTile(t,n,i,l,o){return this.saveWithQuotaCheck("save tile",async()=>{const u=await this.getDB(),d=o.type?.includes("png")?"png":"jpg",m=this._getTileKey(t,n,i,l,d);await u.put(Ha,o,m)})}async getTile(t,n,i,l){const o=await this.getDB(),d=(await this.getTileManifest(t))?.format||"jpg",m=this._getTileKey(t,n,i,l,d);return await o.get(Ha,m)||null}async saveTileManifest(t){return this.saveWithQuotaCheck("save tile manifest",async()=>{const n=await this.getDB(),i=this._getManifestKey(t.assetId);await n.put(mr,t,i)})}async getTileManifest(t){const n=await this.getDB(),i=this._getManifestKey(t);return await n.get(mr,i)||null}async hasTile(t,n,i,l){const o=await this.getDB(),d=(await this.getTileManifest(t))?.format||"jpg",m=this._getTileKey(t,n,i,l,d);return await o.get(Ha,m)!==void 0}async hasPyramid(t){return await this.getTileManifest(t)!==null}async deletePyramid(t){const n=await this.getDB(),l=(await n.getAllKeys(Ha)).filter(o=>typeof o=="string"&&o.startsWith(`${t}/`));for(const o of l)await n.delete(Ha,o);await n.delete(mr,this._getManifestKey(t))}async listPyramids(){return await(await this.getDB()).getAll(mr)}async getTileStats(){const t=await this.getDB(),n=await t.getAllKeys(Ha),i=await Promise.all(n.map(u=>t.get(Ha,u)));let l=0;for(const u of i)u&&u.size&&(l+=u.size);const o=await t.getAllKeys(mr);return{totalTiles:i.length,totalSize:l,pyramidCount:o.length}}get tiles(){return{saveTile:this.saveTile.bind(this),getTile:this.getTile.bind(this),saveTileManifest:this.saveTileManifest.bind(this),getTileManifest:this.getTileManifest.bind(this),hasTile:this.hasTile.bind(this),hasPyramid:this.hasPyramid.bind(this),deletePyramid:this.deletePyramid.bind(this),listPyramids:this.listPyramids.bind(this),getTileStats:this.getTileStats.bind(this)}}}const qt=new fA;/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */function Aw(e){return typeof e>"u"||e===null}function hA(e){return typeof e=="object"&&e!==null}function mA(e){return Array.isArray(e)?e:Aw(e)?[]:[e]}function pA(e,t){var n,i,l,o;if(t)for(o=Object.keys(t),n=0,i=o.length;n<i;n+=1)l=o[n],e[l]=t[l];return e}function gA(e,t){var n="",i;for(i=0;i<t;i+=1)n+=e;return n}function xA(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var bA=Aw,yA=hA,vA=mA,wA=gA,NA=xA,SA=pA,Rn={isNothing:bA,isObject:yA,toArray:vA,repeat:wA,isNegativeZero:NA,extend:SA};function Tw(e,t){var n="",i=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(n+=`

`+e.mark.snippet),i+" "+n):i}function ql(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=Tw(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}ql.prototype=Object.create(Error.prototype);ql.prototype.constructor=ql;ql.prototype.toString=function(t){return this.name+": "+Tw(this,t)};var xa=ql;function mh(e,t,n,i,l){var o="",u="",d=Math.floor(l/2)-1;return i-t>d&&(o=" ... ",t=i-d+o.length),n-i>d&&(u=" ...",n=i+d-u.length),{str:o+e.slice(t,n).replace(/\t/g,"")+u,pos:i-t+o.length}}function ph(e,t){return Rn.repeat(" ",t-e.length)+e}function CA(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),typeof t.indent!="number"&&(t.indent=1),typeof t.linesBefore!="number"&&(t.linesBefore=3),typeof t.linesAfter!="number"&&(t.linesAfter=2);for(var n=/\r?\n|\r|\0/g,i=[0],l=[],o,u=-1;o=n.exec(e.buffer);)l.push(o.index),i.push(o.index+o[0].length),e.position<=o.index&&u<0&&(u=i.length-2);u<0&&(u=i.length-1);var d="",m,h,p=Math.min(e.line+t.linesAfter,l.length).toString().length,g=t.maxLength-(t.indent+p+3);for(m=1;m<=t.linesBefore&&!(u-m<0);m++)h=mh(e.buffer,i[u-m],l[u-m],e.position-(i[u]-i[u-m]),g),d=Rn.repeat(" ",t.indent)+ph((e.line-m+1).toString(),p)+" | "+h.str+`
`+d;for(h=mh(e.buffer,i[u],l[u],e.position,g),d+=Rn.repeat(" ",t.indent)+ph((e.line+1).toString(),p)+" | "+h.str+`
`,d+=Rn.repeat("-",t.indent+p+3+h.pos)+`^
`,m=1;m<=t.linesAfter&&!(u+m>=l.length);m++)h=mh(e.buffer,i[u+m],l[u+m],e.position-(i[u]-i[u+m]),g),d+=Rn.repeat(" ",t.indent)+ph((e.line+m+1).toString(),p)+" | "+h.str+`
`;return d.replace(/\n$/,"")}var jA=CA,EA=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],AA=["scalar","sequence","mapping"];function TA(e){var t={};return e!==null&&Object.keys(e).forEach(function(n){e[n].forEach(function(i){t[String(i)]=n})}),t}function _A(e,t){if(t=t||{},Object.keys(t).forEach(function(n){if(EA.indexOf(n)===-1)throw new xa('Unknown option "'+n+'" is met in definition of "'+e+'" YAML type.')}),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(n){return n},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=TA(t.styleAliases||null),AA.indexOf(this.kind)===-1)throw new xa('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var kn=_A;function Kb(e,t){var n=[];return e[t].forEach(function(i){var l=n.length;n.forEach(function(o,u){o.tag===i.tag&&o.kind===i.kind&&o.multi===i.multi&&(l=u)}),n[l]=i}),n}function kA(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},t,n;function i(l){l.multi?(e.multi[l.kind].push(l),e.multi.fallback.push(l)):e[l.kind][l.tag]=e.fallback[l.tag]=l}for(t=0,n=arguments.length;t<n;t+=1)arguments[t].forEach(i);return e}function vm(e){return this.extend(e)}vm.prototype.extend=function(t){var n=[],i=[];if(t instanceof kn)i.push(t);else if(Array.isArray(t))i=i.concat(t);else if(t&&(Array.isArray(t.implicit)||Array.isArray(t.explicit)))t.implicit&&(n=n.concat(t.implicit)),t.explicit&&(i=i.concat(t.explicit));else throw new xa("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");n.forEach(function(o){if(!(o instanceof kn))throw new xa("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(o.loadKind&&o.loadKind!=="scalar")throw new xa("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(o.multi)throw new xa("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),i.forEach(function(o){if(!(o instanceof kn))throw new xa("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var l=Object.create(vm.prototype);return l.implicit=(this.implicit||[]).concat(n),l.explicit=(this.explicit||[]).concat(i),l.compiledImplicit=Kb(l,"implicit"),l.compiledExplicit=Kb(l,"explicit"),l.compiledTypeMap=kA(l.compiledImplicit,l.compiledExplicit),l};var OA=vm,IA=new kn("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),DA=new kn("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),LA=new kn("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),RA=new OA({explicit:[IA,DA,LA]});function MA(e){if(e===null)return!0;var t=e.length;return t===1&&e==="~"||t===4&&(e==="null"||e==="Null"||e==="NULL")}function FA(){return null}function PA(e){return e===null}var $A=new kn("tag:yaml.org,2002:null",{kind:"scalar",resolve:MA,construct:FA,predicate:PA,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function zA(e){if(e===null)return!1;var t=e.length;return t===4&&(e==="true"||e==="True"||e==="TRUE")||t===5&&(e==="false"||e==="False"||e==="FALSE")}function UA(e){return e==="true"||e==="True"||e==="TRUE"}function BA(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var HA=new kn("tag:yaml.org,2002:bool",{kind:"scalar",resolve:zA,construct:UA,predicate:BA,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function WA(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function GA(e){return 48<=e&&e<=55}function YA(e){return 48<=e&&e<=57}function qA(e){if(e===null)return!1;var t=e.length,n=0,i=!1,l;if(!t)return!1;if(l=e[n],(l==="-"||l==="+")&&(l=e[++n]),l==="0"){if(n+1===t)return!0;if(l=e[++n],l==="b"){for(n++;n<t;n++)if(l=e[n],l!=="_"){if(l!=="0"&&l!=="1")return!1;i=!0}return i&&l!=="_"}if(l==="x"){for(n++;n<t;n++)if(l=e[n],l!=="_"){if(!WA(e.charCodeAt(n)))return!1;i=!0}return i&&l!=="_"}if(l==="o"){for(n++;n<t;n++)if(l=e[n],l!=="_"){if(!GA(e.charCodeAt(n)))return!1;i=!0}return i&&l!=="_"}}if(l==="_")return!1;for(;n<t;n++)if(l=e[n],l!=="_"){if(!YA(e.charCodeAt(n)))return!1;i=!0}return!(!i||l==="_")}function VA(e){var t=e,n=1,i;if(t.indexOf("_")!==-1&&(t=t.replace(/_/g,"")),i=t[0],(i==="-"||i==="+")&&(i==="-"&&(n=-1),t=t.slice(1),i=t[0]),t==="0")return 0;if(i==="0"){if(t[1]==="b")return n*parseInt(t.slice(2),2);if(t[1]==="x")return n*parseInt(t.slice(2),16);if(t[1]==="o")return n*parseInt(t.slice(2),8)}return n*parseInt(t,10)}function KA(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!Rn.isNegativeZero(e)}var XA=new kn("tag:yaml.org,2002:int",{kind:"scalar",resolve:qA,construct:VA,predicate:KA,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),ZA=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function JA(e){return!(e===null||!ZA.test(e)||e[e.length-1]==="_")}function QA(e){var t,n;return t=e.replace(/_/g,"").toLowerCase(),n=t[0]==="-"?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),t===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t===".nan"?NaN:n*parseFloat(t,10)}var eT=/^[-+]?[0-9]+e/;function tT(e,t){var n;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Rn.isNegativeZero(e))return"-0.0";return n=e.toString(10),eT.test(n)?n.replace("e",".e"):n}function nT(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||Rn.isNegativeZero(e))}var sT=new kn("tag:yaml.org,2002:float",{kind:"scalar",resolve:JA,construct:QA,predicate:nT,represent:tT,defaultStyle:"lowercase"}),aT=RA.extend({implicit:[$A,HA,XA,sT]}),iT=aT,_w=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),kw=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function rT(e){return e===null?!1:_w.exec(e)!==null||kw.exec(e)!==null}function lT(e){var t,n,i,l,o,u,d,m=0,h=null,p,g,y;if(t=_w.exec(e),t===null&&(t=kw.exec(e)),t===null)throw new Error("Date resolve error");if(n=+t[1],i=+t[2]-1,l=+t[3],!t[4])return new Date(Date.UTC(n,i,l));if(o=+t[4],u=+t[5],d=+t[6],t[7]){for(m=t[7].slice(0,3);m.length<3;)m+="0";m=+m}return t[9]&&(p=+t[10],g=+(t[11]||0),h=(p*60+g)*6e4,t[9]==="-"&&(h=-h)),y=new Date(Date.UTC(n,i,l,o,u,d,m)),h&&y.setTime(y.getTime()-h),y}function oT(e){return e.toISOString()}var cT=new kn("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:rT,construct:lT,instanceOf:Date,represent:oT});function uT(e){return e==="<<"||e===null}var dT=new kn("tag:yaml.org,2002:merge",{kind:"scalar",resolve:uT}),np=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function fT(e){if(e===null)return!1;var t,n,i=0,l=e.length,o=np;for(n=0;n<l;n++)if(t=o.indexOf(e.charAt(n)),!(t>64)){if(t<0)return!1;i+=6}return i%8===0}function hT(e){var t,n,i=e.replace(/[\r\n=]/g,""),l=i.length,o=np,u=0,d=[];for(t=0;t<l;t++)t%4===0&&t&&(d.push(u>>16&255),d.push(u>>8&255),d.push(u&255)),u=u<<6|o.indexOf(i.charAt(t));return n=l%4*6,n===0?(d.push(u>>16&255),d.push(u>>8&255),d.push(u&255)):n===18?(d.push(u>>10&255),d.push(u>>2&255)):n===12&&d.push(u>>4&255),new Uint8Array(d)}function mT(e){var t="",n=0,i,l,o=e.length,u=np;for(i=0;i<o;i++)i%3===0&&i&&(t+=u[n>>18&63],t+=u[n>>12&63],t+=u[n>>6&63],t+=u[n&63]),n=(n<<8)+e[i];return l=o%3,l===0?(t+=u[n>>18&63],t+=u[n>>12&63],t+=u[n>>6&63],t+=u[n&63]):l===2?(t+=u[n>>10&63],t+=u[n>>4&63],t+=u[n<<2&63],t+=u[64]):l===1&&(t+=u[n>>2&63],t+=u[n<<4&63],t+=u[64],t+=u[64]),t}function pT(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var gT=new kn("tag:yaml.org,2002:binary",{kind:"scalar",resolve:fT,construct:hT,predicate:pT,represent:mT}),xT=Object.prototype.hasOwnProperty,bT=Object.prototype.toString;function yT(e){if(e===null)return!0;var t=[],n,i,l,o,u,d=e;for(n=0,i=d.length;n<i;n+=1){if(l=d[n],u=!1,bT.call(l)!=="[object Object]")return!1;for(o in l)if(xT.call(l,o))if(!u)u=!0;else return!1;if(!u)return!1;if(t.indexOf(o)===-1)t.push(o);else return!1}return!0}function vT(e){return e!==null?e:[]}var wT=new kn("tag:yaml.org,2002:omap",{kind:"sequence",resolve:yT,construct:vT}),NT=Object.prototype.toString;function ST(e){if(e===null)return!0;var t,n,i,l,o,u=e;for(o=new Array(u.length),t=0,n=u.length;t<n;t+=1){if(i=u[t],NT.call(i)!=="[object Object]"||(l=Object.keys(i),l.length!==1))return!1;o[t]=[l[0],i[l[0]]]}return!0}function CT(e){if(e===null)return[];var t,n,i,l,o,u=e;for(o=new Array(u.length),t=0,n=u.length;t<n;t+=1)i=u[t],l=Object.keys(i),o[t]=[l[0],i[l[0]]];return o}var jT=new kn("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:ST,construct:CT}),ET=Object.prototype.hasOwnProperty;function AT(e){if(e===null)return!0;var t,n=e;for(t in n)if(ET.call(n,t)&&n[t]!==null)return!1;return!0}function TT(e){return e!==null?e:{}}var _T=new kn("tag:yaml.org,2002:set",{kind:"mapping",resolve:AT,construct:TT}),kT=iT.extend({implicit:[cT,dT],explicit:[gT,wT,jT,_T]}),ei=Object.prototype.hasOwnProperty,ru=1,Ow=2,Iw=3,lu=4,gh=1,OT=2,Xb=3,IT=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,DT=/[\x85\u2028\u2029]/,LT=/[,\[\]\{\}]/,Dw=/^(?:!|!!|![a-z\-]+!)$/i,Lw=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Zb(e){return Object.prototype.toString.call(e)}function Bs(e){return e===10||e===13}function ji(e){return e===9||e===32}function Kn(e){return e===9||e===32||e===10||e===13}function Sr(e){return e===44||e===91||e===93||e===123||e===125}function RT(e){var t;return 48<=e&&e<=57?e-48:(t=e|32,97<=t&&t<=102?t-97+10:-1)}function MT(e){return e===120?2:e===117?4:e===85?8:0}function FT(e){return 48<=e&&e<=57?e-48:-1}function Jb(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"":e===95?"":e===76?"\u2028":e===80?"\u2029":""}function PT(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var Rw=new Array(256),Mw=new Array(256);for(var pr=0;pr<256;pr++)Rw[pr]=Jb(pr)?1:0,Mw[pr]=Jb(pr);function $T(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||kT,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Fw(e,t){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=jA(n),new xa(t,n)}function tt(e,t){throw Fw(e,t)}function ou(e,t){e.onWarning&&e.onWarning.call(null,Fw(e,t))}var Qb={YAML:function(t,n,i){var l,o,u;t.version!==null&&tt(t,"duplication of %YAML directive"),i.length!==1&&tt(t,"YAML directive accepts exactly one argument"),l=/^([0-9]+)\.([0-9]+)$/.exec(i[0]),l===null&&tt(t,"ill-formed argument of the YAML directive"),o=parseInt(l[1],10),u=parseInt(l[2],10),o!==1&&tt(t,"unacceptable YAML version of the document"),t.version=i[0],t.checkLineBreaks=u<2,u!==1&&u!==2&&ou(t,"unsupported YAML version of the document")},TAG:function(t,n,i){var l,o;i.length!==2&&tt(t,"TAG directive accepts exactly two arguments"),l=i[0],o=i[1],Dw.test(l)||tt(t,"ill-formed tag handle (first argument) of the TAG directive"),ei.call(t.tagMap,l)&&tt(t,'there is a previously declared suffix for "'+l+'" tag handle'),Lw.test(o)||tt(t,"ill-formed tag prefix (second argument) of the TAG directive");try{o=decodeURIComponent(o)}catch{tt(t,"tag prefix is malformed: "+o)}t.tagMap[l]=o}};function Za(e,t,n,i){var l,o,u,d;if(t<n){if(d=e.input.slice(t,n),i)for(l=0,o=d.length;l<o;l+=1)u=d.charCodeAt(l),u===9||32<=u&&u<=1114111||tt(e,"expected valid JSON character");else IT.test(d)&&tt(e,"the stream contains non-printable characters");e.result+=d}}function ey(e,t,n,i){var l,o,u,d;for(Rn.isObject(n)||tt(e,"cannot merge mappings; the provided source object is unacceptable"),l=Object.keys(n),u=0,d=l.length;u<d;u+=1)o=l[u],ei.call(t,o)||(t[o]=n[o],i[o]=!0)}function Cr(e,t,n,i,l,o,u,d,m){var h,p;if(Array.isArray(l))for(l=Array.prototype.slice.call(l),h=0,p=l.length;h<p;h+=1)Array.isArray(l[h])&&tt(e,"nested arrays are not supported inside keys"),typeof l=="object"&&Zb(l[h])==="[object Object]"&&(l[h]="[object Object]");if(typeof l=="object"&&Zb(l)==="[object Object]"&&(l="[object Object]"),l=String(l),t===null&&(t={}),i==="tag:yaml.org,2002:merge")if(Array.isArray(o))for(h=0,p=o.length;h<p;h+=1)ey(e,t,o[h],n);else ey(e,t,o,n);else!e.json&&!ei.call(n,l)&&ei.call(t,l)&&(e.line=u||e.line,e.lineStart=d||e.lineStart,e.position=m||e.position,tt(e,"duplicated mapping key")),l==="__proto__"?Object.defineProperty(t,l,{configurable:!0,enumerable:!0,writable:!0,value:o}):t[l]=o,delete n[l];return t}function sp(e){var t;t=e.input.charCodeAt(e.position),t===10?e.position++:t===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):tt(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function mn(e,t,n){for(var i=0,l=e.input.charCodeAt(e.position);l!==0;){for(;ji(l);)l===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),l=e.input.charCodeAt(++e.position);if(t&&l===35)do l=e.input.charCodeAt(++e.position);while(l!==10&&l!==13&&l!==0);if(Bs(l))for(sp(e),l=e.input.charCodeAt(e.position),i++,e.lineIndent=0;l===32;)e.lineIndent++,l=e.input.charCodeAt(++e.position);else break}return n!==-1&&i!==0&&e.lineIndent<n&&ou(e,"deficient indentation"),i}function Iu(e){var t=e.position,n;return n=e.input.charCodeAt(t),!!((n===45||n===46)&&n===e.input.charCodeAt(t+1)&&n===e.input.charCodeAt(t+2)&&(t+=3,n=e.input.charCodeAt(t),n===0||Kn(n)))}function ap(e,t){t===1?e.result+=" ":t>1&&(e.result+=Rn.repeat(`
`,t-1))}function zT(e,t,n){var i,l,o,u,d,m,h,p,g=e.kind,y=e.result,x;if(x=e.input.charCodeAt(e.position),Kn(x)||Sr(x)||x===35||x===38||x===42||x===33||x===124||x===62||x===39||x===34||x===37||x===64||x===96||(x===63||x===45)&&(l=e.input.charCodeAt(e.position+1),Kn(l)||n&&Sr(l)))return!1;for(e.kind="scalar",e.result="",o=u=e.position,d=!1;x!==0;){if(x===58){if(l=e.input.charCodeAt(e.position+1),Kn(l)||n&&Sr(l))break}else if(x===35){if(i=e.input.charCodeAt(e.position-1),Kn(i))break}else{if(e.position===e.lineStart&&Iu(e)||n&&Sr(x))break;if(Bs(x))if(m=e.line,h=e.lineStart,p=e.lineIndent,mn(e,!1,-1),e.lineIndent>=t){d=!0,x=e.input.charCodeAt(e.position);continue}else{e.position=u,e.line=m,e.lineStart=h,e.lineIndent=p;break}}d&&(Za(e,o,u,!1),ap(e,e.line-m),o=u=e.position,d=!1),ji(x)||(u=e.position+1),x=e.input.charCodeAt(++e.position)}return Za(e,o,u,!1),e.result?!0:(e.kind=g,e.result=y,!1)}function UT(e,t){var n,i,l;if(n=e.input.charCodeAt(e.position),n!==39)return!1;for(e.kind="scalar",e.result="",e.position++,i=l=e.position;(n=e.input.charCodeAt(e.position))!==0;)if(n===39)if(Za(e,i,e.position,!0),n=e.input.charCodeAt(++e.position),n===39)i=e.position,e.position++,l=e.position;else return!0;else Bs(n)?(Za(e,i,l,!0),ap(e,mn(e,!1,t)),i=l=e.position):e.position===e.lineStart&&Iu(e)?tt(e,"unexpected end of the document within a single quoted scalar"):(e.position++,l=e.position);tt(e,"unexpected end of the stream within a single quoted scalar")}function BT(e,t){var n,i,l,o,u,d;if(d=e.input.charCodeAt(e.position),d!==34)return!1;for(e.kind="scalar",e.result="",e.position++,n=i=e.position;(d=e.input.charCodeAt(e.position))!==0;){if(d===34)return Za(e,n,e.position,!0),e.position++,!0;if(d===92){if(Za(e,n,e.position,!0),d=e.input.charCodeAt(++e.position),Bs(d))mn(e,!1,t);else if(d<256&&Rw[d])e.result+=Mw[d],e.position++;else if((u=MT(d))>0){for(l=u,o=0;l>0;l--)d=e.input.charCodeAt(++e.position),(u=RT(d))>=0?o=(o<<4)+u:tt(e,"expected hexadecimal character");e.result+=PT(o),e.position++}else tt(e,"unknown escape sequence");n=i=e.position}else Bs(d)?(Za(e,n,i,!0),ap(e,mn(e,!1,t)),n=i=e.position):e.position===e.lineStart&&Iu(e)?tt(e,"unexpected end of the document within a double quoted scalar"):(e.position++,i=e.position)}tt(e,"unexpected end of the stream within a double quoted scalar")}function HT(e,t){var n=!0,i,l,o,u=e.tag,d,m=e.anchor,h,p,g,y,x,v=Object.create(null),N,j,C,A;if(A=e.input.charCodeAt(e.position),A===91)p=93,x=!1,d=[];else if(A===123)p=125,x=!0,d={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=d),A=e.input.charCodeAt(++e.position);A!==0;){if(mn(e,!0,t),A=e.input.charCodeAt(e.position),A===p)return e.position++,e.tag=u,e.anchor=m,e.kind=x?"mapping":"sequence",e.result=d,!0;n?A===44&&tt(e,"expected the node content, but found ','"):tt(e,"missed comma between flow collection entries"),j=N=C=null,g=y=!1,A===63&&(h=e.input.charCodeAt(e.position+1),Kn(h)&&(g=y=!0,e.position++,mn(e,!0,t))),i=e.line,l=e.lineStart,o=e.position,Tr(e,t,ru,!1,!0),j=e.tag,N=e.result,mn(e,!0,t),A=e.input.charCodeAt(e.position),(y||e.line===i)&&A===58&&(g=!0,A=e.input.charCodeAt(++e.position),mn(e,!0,t),Tr(e,t,ru,!1,!0),C=e.result),x?Cr(e,d,v,j,N,C,i,l,o):g?d.push(Cr(e,null,v,j,N,C,i,l,o)):d.push(N),mn(e,!0,t),A=e.input.charCodeAt(e.position),A===44?(n=!0,A=e.input.charCodeAt(++e.position)):n=!1}tt(e,"unexpected end of the stream within a flow collection")}function WT(e,t){var n,i,l=gh,o=!1,u=!1,d=t,m=0,h=!1,p,g;if(g=e.input.charCodeAt(e.position),g===124)i=!1;else if(g===62)i=!0;else return!1;for(e.kind="scalar",e.result="";g!==0;)if(g=e.input.charCodeAt(++e.position),g===43||g===45)gh===l?l=g===43?Xb:OT:tt(e,"repeat of a chomping mode identifier");else if((p=FT(g))>=0)p===0?tt(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):u?tt(e,"repeat of an indentation width identifier"):(d=t+p-1,u=!0);else break;if(ji(g)){do g=e.input.charCodeAt(++e.position);while(ji(g));if(g===35)do g=e.input.charCodeAt(++e.position);while(!Bs(g)&&g!==0)}for(;g!==0;){for(sp(e),e.lineIndent=0,g=e.input.charCodeAt(e.position);(!u||e.lineIndent<d)&&g===32;)e.lineIndent++,g=e.input.charCodeAt(++e.position);if(!u&&e.lineIndent>d&&(d=e.lineIndent),Bs(g)){m++;continue}if(e.lineIndent<d){l===Xb?e.result+=Rn.repeat(`
`,o?1+m:m):l===gh&&o&&(e.result+=`
`);break}for(i?ji(g)?(h=!0,e.result+=Rn.repeat(`
`,o?1+m:m)):h?(h=!1,e.result+=Rn.repeat(`
`,m+1)):m===0?o&&(e.result+=" "):e.result+=Rn.repeat(`
`,m):e.result+=Rn.repeat(`
`,o?1+m:m),o=!0,u=!0,m=0,n=e.position;!Bs(g)&&g!==0;)g=e.input.charCodeAt(++e.position);Za(e,n,e.position,!1)}return!0}function ty(e,t){var n,i=e.tag,l=e.anchor,o=[],u,d=!1,m;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=o),m=e.input.charCodeAt(e.position);m!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,tt(e,"tab characters must not be used in indentation")),!(m!==45||(u=e.input.charCodeAt(e.position+1),!Kn(u))));){if(d=!0,e.position++,mn(e,!0,-1)&&e.lineIndent<=t){o.push(null),m=e.input.charCodeAt(e.position);continue}if(n=e.line,Tr(e,t,Iw,!1,!0),o.push(e.result),mn(e,!0,-1),m=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&m!==0)tt(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break}return d?(e.tag=i,e.anchor=l,e.kind="sequence",e.result=o,!0):!1}function GT(e,t,n){var i,l,o,u,d,m,h=e.tag,p=e.anchor,g={},y=Object.create(null),x=null,v=null,N=null,j=!1,C=!1,A;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=g),A=e.input.charCodeAt(e.position);A!==0;){if(!j&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,tt(e,"tab characters must not be used in indentation")),i=e.input.charCodeAt(e.position+1),o=e.line,(A===63||A===58)&&Kn(i))A===63?(j&&(Cr(e,g,y,x,v,null,u,d,m),x=v=N=null),C=!0,j=!0,l=!0):j?(j=!1,l=!0):tt(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,A=i;else{if(u=e.line,d=e.lineStart,m=e.position,!Tr(e,n,Ow,!1,!0))break;if(e.line===o){for(A=e.input.charCodeAt(e.position);ji(A);)A=e.input.charCodeAt(++e.position);if(A===58)A=e.input.charCodeAt(++e.position),Kn(A)||tt(e,"a whitespace character is expected after the key-value separator within a block mapping"),j&&(Cr(e,g,y,x,v,null,u,d,m),x=v=N=null),C=!0,j=!1,l=!1,x=e.tag,v=e.result;else if(C)tt(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=h,e.anchor=p,!0}else if(C)tt(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=h,e.anchor=p,!0}if((e.line===o||e.lineIndent>t)&&(j&&(u=e.line,d=e.lineStart,m=e.position),Tr(e,t,lu,!0,l)&&(j?v=e.result:N=e.result),j||(Cr(e,g,y,x,v,N,u,d,m),x=v=N=null),mn(e,!0,-1),A=e.input.charCodeAt(e.position)),(e.line===o||e.lineIndent>t)&&A!==0)tt(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return j&&Cr(e,g,y,x,v,null,u,d,m),C&&(e.tag=h,e.anchor=p,e.kind="mapping",e.result=g),C}function YT(e){var t,n=!1,i=!1,l,o,u;if(u=e.input.charCodeAt(e.position),u!==33)return!1;if(e.tag!==null&&tt(e,"duplication of a tag property"),u=e.input.charCodeAt(++e.position),u===60?(n=!0,u=e.input.charCodeAt(++e.position)):u===33?(i=!0,l="!!",u=e.input.charCodeAt(++e.position)):l="!",t=e.position,n){do u=e.input.charCodeAt(++e.position);while(u!==0&&u!==62);e.position<e.length?(o=e.input.slice(t,e.position),u=e.input.charCodeAt(++e.position)):tt(e,"unexpected end of the stream within a verbatim tag")}else{for(;u!==0&&!Kn(u);)u===33&&(i?tt(e,"tag suffix cannot contain exclamation marks"):(l=e.input.slice(t-1,e.position+1),Dw.test(l)||tt(e,"named tag handle cannot contain such characters"),i=!0,t=e.position+1)),u=e.input.charCodeAt(++e.position);o=e.input.slice(t,e.position),LT.test(o)&&tt(e,"tag suffix cannot contain flow indicator characters")}o&&!Lw.test(o)&&tt(e,"tag name cannot contain such characters: "+o);try{o=decodeURIComponent(o)}catch{tt(e,"tag name is malformed: "+o)}return n?e.tag=o:ei.call(e.tagMap,l)?e.tag=e.tagMap[l]+o:l==="!"?e.tag="!"+o:l==="!!"?e.tag="tag:yaml.org,2002:"+o:tt(e,'undeclared tag handle "'+l+'"'),!0}function qT(e){var t,n;if(n=e.input.charCodeAt(e.position),n!==38)return!1;for(e.anchor!==null&&tt(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;n!==0&&!Kn(n)&&!Sr(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&tt(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function VT(e){var t,n,i;if(i=e.input.charCodeAt(e.position),i!==42)return!1;for(i=e.input.charCodeAt(++e.position),t=e.position;i!==0&&!Kn(i)&&!Sr(i);)i=e.input.charCodeAt(++e.position);return e.position===t&&tt(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),ei.call(e.anchorMap,n)||tt(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],mn(e,!0,-1),!0}function Tr(e,t,n,i,l){var o,u,d,m=1,h=!1,p=!1,g,y,x,v,N,j;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,o=u=d=lu===n||Iw===n,i&&mn(e,!0,-1)&&(h=!0,e.lineIndent>t?m=1:e.lineIndent===t?m=0:e.lineIndent<t&&(m=-1)),m===1)for(;YT(e)||qT(e);)mn(e,!0,-1)?(h=!0,d=o,e.lineIndent>t?m=1:e.lineIndent===t?m=0:e.lineIndent<t&&(m=-1)):d=!1;if(d&&(d=h||l),(m===1||lu===n)&&(ru===n||Ow===n?N=t:N=t+1,j=e.position-e.lineStart,m===1?d&&(ty(e,j)||GT(e,j,N))||HT(e,N)?p=!0:(u&&WT(e,N)||UT(e,N)||BT(e,N)?p=!0:VT(e)?(p=!0,(e.tag!==null||e.anchor!==null)&&tt(e,"alias node should not have any properties")):zT(e,N,ru===n)&&(p=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):m===0&&(p=d&&ty(e,j))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&tt(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),g=0,y=e.implicitTypes.length;g<y;g+=1)if(v=e.implicitTypes[g],v.resolve(e.result)){e.result=v.construct(e.result),e.tag=v.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(ei.call(e.typeMap[e.kind||"fallback"],e.tag))v=e.typeMap[e.kind||"fallback"][e.tag];else for(v=null,x=e.typeMap.multi[e.kind||"fallback"],g=0,y=x.length;g<y;g+=1)if(e.tag.slice(0,x[g].tag.length)===x[g].tag){v=x[g];break}v||tt(e,"unknown tag !<"+e.tag+">"),e.result!==null&&v.kind!==e.kind&&tt(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+v.kind+'", not "'+e.kind+'"'),v.resolve(e.result,e.tag)?(e.result=v.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):tt(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||p}function KT(e){var t=e.position,n,i,l,o=!1,u;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(u=e.input.charCodeAt(e.position))!==0&&(mn(e,!0,-1),u=e.input.charCodeAt(e.position),!(e.lineIndent>0||u!==37));){for(o=!0,u=e.input.charCodeAt(++e.position),n=e.position;u!==0&&!Kn(u);)u=e.input.charCodeAt(++e.position);for(i=e.input.slice(n,e.position),l=[],i.length<1&&tt(e,"directive name must not be less than one character in length");u!==0;){for(;ji(u);)u=e.input.charCodeAt(++e.position);if(u===35){do u=e.input.charCodeAt(++e.position);while(u!==0&&!Bs(u));break}if(Bs(u))break;for(n=e.position;u!==0&&!Kn(u);)u=e.input.charCodeAt(++e.position);l.push(e.input.slice(n,e.position))}u!==0&&sp(e),ei.call(Qb,i)?Qb[i](e,i,l):ou(e,'unknown document directive "'+i+'"')}if(mn(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,mn(e,!0,-1)):o&&tt(e,"directives end mark is expected"),Tr(e,e.lineIndent-1,lu,!1,!0),mn(e,!0,-1),e.checkLineBreaks&&DT.test(e.input.slice(t,e.position))&&ou(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&Iu(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,mn(e,!0,-1));return}if(e.position<e.length-1)tt(e,"end of the stream or a document separator is expected");else return}function XT(e,t){e=String(e),t=t||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var n=new $T(e,t),i=e.indexOf("\0");for(i!==-1&&(n.position=i,tt(n,"null byte is not allowed in input")),n.input+="\0";n.input.charCodeAt(n.position)===32;)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)KT(n);return n.documents}function ZT(e,t){var n=XT(e,t);if(n.length!==0){if(n.length===1)return n[0];throw new xa("expected a single document in the stream, but found more")}}var JT=ZT,QT={load:JT},Pw=QT.load;let $w=class{constructor(t){if(e2(t))throw new Error("DataView: Passed buffer type is unsupported.");this.buffer=t,this.byteLength=this.buffer.length}getUint8(t){return this.buffer.readUInt8(t)}getUint16(t,n){return n?this.buffer.readUInt16LE(t):this.buffer.readUInt16BE(t)}getUint32(t,n){return n?this.buffer.readUInt32LE(t):this.buffer.readUInt32BE(t)}getInt32(t,n){return n?this.buffer.readInt32LE(t):this.buffer.readInt32BE(t)}};function e2(e){return typeof e!="object"||e.length===void 0||e.readUInt8===void 0||e.readUInt16LE===void 0||e.readUInt16BE===void 0||e.readUInt32LE===void 0||e.readUInt32BE===void 0||e.readInt32LE===void 0||e.readInt32BE===void 0}function ny(e,t,n){try{return new DataView(e,t,n)}catch{return new $w(e,t,n)}}function lt(e,t,n){const i=[];for(let l=0;l<n&&t+l<e.byteLength;l++)i.push(e.getUint8(t+l));return _r(i)}function t2(e,t){const n=[];let i=0;for(;t+i<e.byteLength;){const l=e.getUint8(t+i);if(l===0)break;n.push(l),i++}return _r(n)}function n2(e,t,n){const i=[];for(let l=0;l<n&&t+l<e.byteLength;l+=2)i.push(e.getUint16(t+l));return i[i.length-1]===0&&i.pop(),_r(i)}function zw(e,t){const n=e.getUint8(t),i=lt(e,t+1,n);return[n,i]}function _r(e){return e.map(t=>String.fromCharCode(t)).join("")}function wt(){for(let e=1;e<arguments.length;e++)for(const t in arguments[e])arguments[0][t]=arguments[e][t];return arguments[0]}function Uw(e,t,n){let i=!1;Object.defineProperty(e,t,{get(){return i||(i=!0,Object.defineProperty(e,t,{configurable:!0,enumerable:!0,value:n.apply(e),writable:!0})),e[t]},configurable:!0,enumerable:!0})}function Bw(e){if(typeof btoa<"u")return btoa(typeof e=="string"?e:Array.prototype.reduce.call(new Uint8Array(e),(t,n)=>t+String.fromCharCode(n),""));if(!(typeof Buffer>"u"))return typeof Buffer.from<"u"?Buffer.from(e).toString("base64"):new Buffer(e).toString("base64")}function s2(e){const t=e.substring(e.indexOf(",")+1);if(e.indexOf(";base64")!==-1)return typeof atob<"u"?Uint8Array.from(atob(t),i=>i.charCodeAt(0)).buffer:typeof Buffer>"u"?void 0:typeof Buffer.from<"u"?Buffer.from(t,"base64"):new Buffer(t,"base64");const n=decodeURIComponent(t);return typeof Buffer<"u"?typeof Buffer.from<"u"?Buffer.from(n):new Buffer(n):Uint8Array.from(n,i=>i.charCodeAt(0)).buffer}function a2(e,t,n){return Hw(n,t-e.length)+e}function i2(e,t){return parseInt(e.replace(".",""),t)/Math.pow(t,(e.split(".")[1]||"").length)}function Hw(e,t){return new Array(t+1).join(e)}const cu=void 0,Ww=0;function Gw(e,t,n="string"){if(t===Ww&&typeof DecompressionStream=="function"){const i=new DecompressionStream("deflate"),l=new Blob([e]).stream().pipeThrough(i);return n==="dataview"?new Response(l).arrayBuffer().then(o=>new DataView(o)):new Response(l).text()}return t!==void 0?Promise.reject(`Unknown compression method ${t}.`):e}const sy={USE_FILE:!0,USE_JFIF:!0,USE_PNG_FILE:!0,USE_EXIF:!0,USE_IPTC:!0,USE_XMP:!0,USE_ICC:!0,USE_MPF:!0,USE_PHOTOSHOP:!0,USE_THUMBNAIL:!0,USE_TIFF:!0,USE_JPEG:!0,USE_PNG:!0,USE_HEIC:!0,USE_WEBP:!0,USE_GIF:!0};function fn(e){return e.map(t=>String.fromCharCode(t)).join("")}function wm(e){if(e.length>=8){const t=fn(e.slice(0,8));if(t==="ASCII\0\0\0")return fn(e.slice(8));if(t==="JIS\0\0\0\0\0")return"[JIS encoded text]";if(t==="UNICODE\0")return"[Unicode encoded text]";if(t==="\0\0\0\0\0\0\0\0")return"[Undefined encoding]"}return"Undefined"}function uu(e){return e[0][0]/e[0][1]+e[1][0]/e[1][1]/60+e[2][0]/e[2][1]/3600}const Nm=18761,Sm=19789,Oi={BIG_ENDIAN:Sm,LITTLE_ENDIAN:Nm,getByteOrder:r2};function r2(e,t){if(e.getUint16(t)===Nm)return Nm;if(e.getUint16(t)===Sm)return Sm;throw new Error("Illegal byte order value. Faulty image.")}const ay={isTiffFile:l2,findTiffOffsets:c2};function l2(e){return!!e&&e.byteLength>=4&&o2(e)}function o2(e){const i=e.getUint16(0)===Oi.LITTLE_ENDIAN;return e.getUint16(2,i)===42}function c2(){return{hasAppMarkers:!0,tiffHeaderOffset:0}}const iy={isJpegFile:j2,findJpegOffsets:E2},u2=2,d2=65496,ry=2,vs=4,qn=2,f2=2,h2=10,m2=18,ly=33,oy=79,cy=18,p2=8,Cm="ICC_PROFILE\0",Yw=vs+Cm.length,g2=Yw+1,uy="MPF\0",qw=65472,Vw=65474,x2=65476,b2=65499,y2=65501,v2=65498,Kw=65504,ip=65505,Xw=65506,w2=65517,N2=65519,S2=65534,C2=65535,dy="JFIF",fy="Exif",hy="http://ns.adobe.com/xap/1.0/\0",my="http://ns.adobe.com/xmp/extension/\0",py="Photoshop 3.0";function j2(e){return!!e&&e.byteLength>=u2&&e.getUint16(0)===d2}function E2(e){let t=ry,n,i,l,o,u,d,m,h,p;for(;t+vs+5<=e.byteLength;){if(A2(e,t))i=t+qn;else if(T2(e,t))l=t+qn;else if(O2(e,t))n=e.getUint16(t+qn),o=t+f2;else if(I2(e,t))n=e.getUint16(t+qn),u=t+h2;else if(D2(e,t))m||(m=[]),n=e.getUint16(t+qn),m.push(F2(t,n));else if(R2(e,t))m||(m=[]),n=e.getUint16(t+qn),m.push(P2(t,n));else if($2(e,t))n=e.getUint16(t+qn),d=t+m2;else if(_2(e,t)){n=e.getUint16(t+qn);const g=t+cy,y=n-(cy-qn),x=e.getUint8(t+Yw),v=e.getUint8(t+g2);h||(h=[]),h.push({offset:g,length:y,chunkNumber:x,chunksTotal:v})}else if(k2(e,t))n=e.getUint16(t+qn),p=t+p2;else if(z2(e,t))n=e.getUint16(t+qn);else if(U2(e,t)){t++;continue}else break;t+=qn+n}return{hasAppMarkers:t>ry,fileDataOffset:i||l,jfifDataOffset:o,tiffHeaderOffset:u,iptcDataOffset:d,xmpChunks:m,iccChunks:h,mpfDataOffset:p}}function A2(e,t){return e.getUint16(t)===qw}function T2(e,t){return e.getUint16(t)===Vw}function _2(e,t){const n=Cm.length;return e.getUint16(t)===Xw&&lt(e,t+vs,n)===Cm}function k2(e,t){const n=uy.length;return e.getUint16(t)===Xw&&lt(e,t+vs,n)===uy}function O2(e,t){const n=dy.length;return e.getUint16(t)===Kw&&lt(e,t+vs,n)===dy&&e.getUint8(t+vs+n)===0}function I2(e,t){const n=fy.length;return e.getUint16(t)===ip&&lt(e,t+vs,n)===fy&&e.getUint8(t+vs+n)===0}function D2(e,t){return e.getUint16(t)===ip&&L2(e,t)}function L2(e,t){const n=hy.length;return lt(e,t+vs,n)===hy}function R2(e,t){return e.getUint16(t)===ip&&M2(e,t)}function M2(e,t){const n=my.length;return lt(e,t+vs,n)===my}function F2(e,t){return{dataOffset:e+ly,length:t-(ly-qn)}}function P2(e,t){return{dataOffset:e+oy,length:t-(oy-qn)}}function $2(e,t){const n=py.length;return e.getUint16(t)===w2&&lt(e,t+vs,n)===py&&e.getUint8(t+vs+n)===0}function z2(e,t){const n=e.getUint16(t);return n>=Kw&&n<=N2||n===S2||n===qw||n===Vw||n===x2||n===b2||n===y2||n===v2}function U2(e,t){return e.getUint16(t)===C2}const gy={isPngFile:W2,findPngOffsets:G2},jm=`PNG\r

`,du=4,_s=4,wr=0,ni=du,En=du+_s,Em="XML:com.adobe.xmp\0",Zw="tEXt",_i="iTXt",rp="zTXt",Jw="pHYs",Qw="tIME",B2="eXIf",H2="iCCP";function W2(e){return!!e&&lt(e,0,jm.length)===jm}function G2(e,t){const i={hasAppMarkers:!1};let l=jm.length;for(;l+du+_s<=e.byteLength;){if(Y2(e,l))i.hasAppMarkers=!0,i.pngHeaderOffset=l+En;else if(q2(e,l)){const o=J2(e,l);o!==void 0&&(i.hasAppMarkers=!0,i.xmpChunks=[{dataOffset:o,length:e.getUint32(l+wr)-(o-(l+En))}])}else if(V2(e,l,t)){i.hasAppMarkers=!0;const o=lt(e,l+ni,_s);i.pngTextChunks||(i.pngTextChunks=[]),i.pngTextChunks.push({length:e.getUint32(l+wr),type:o,offset:l+En})}else if(K2(e,l))i.hasAppMarkers=!0,i.tiffHeaderOffset=l+En;else if(t&&X2(e,l)){i.hasAppMarkers=!0;const o=e.getUint32(l+wr),u=l+En,{profileName:d,compressionMethod:m,compressedProfileOffset:h}=Q2(e,u);i.iccChunks||(i.iccChunks=[]),i.iccChunks.push({offset:h,length:o-(h-u),chunkNumber:1,chunksTotal:1,profileName:d,compressionMethod:m})}else Z2(e,l)&&(i.hasAppMarkers=!0,i.pngChunkOffsets||(i.pngChunkOffsets=[]),i.pngChunkOffsets.push(l+wr));l+=e.getUint32(l+wr)+du+_s+4}return i}function Y2(e,t){return lt(e,t+ni,_s)==="IHDR"}function q2(e,t){return lt(e,t+ni,_s)===_i&&lt(e,t+En,Em.length)===Em}function V2(e,t,n){const i=lt(e,t+ni,_s);return i===Zw||i===_i||i===rp&&n}function K2(e,t){return lt(e,t+ni,_s)===B2}function X2(e,t){return lt(e,t+ni,_s)===H2}function Z2(e,t){const n=[Jw,Qw],i=lt(e,t+ni,_s);return n.includes(i)}function J2(e,t){t+=En+Em.length+1+1;let l=0;for(;l<2&&t<e.byteLength;)e.getUint8(t)===0&&l++,t++;if(!(l<2))return t}function Q2(e,t){const l=t2(e,t);t+=l.length+1;const o=e.getUint8(t);return t+=1,{profileName:l,compressionMethod:o,compressedProfileOffset:t}}const xy={isHeicFile:e_,findHeicOffsets:t_};function e_(e){if(!e)return!1;const t="ftyp",n=4,i=["heic","heix","hevc","hevx","heim","heis","hevm","hevs","mif1"],o=lt(e,n+t.length,4);return lt(e,n,t.length)===t&&i.indexOf(o)!==-1}function t_(e){{const{offset:t,length:n}=n_(e);if(t===void 0)return{hasAppMarkers:!1};const i=Math.min(t+n,e.byteLength),{exifItemOffset:l,ilocOffset:o,colrOffset:u}=r_(e,t,i),d=l_(e,l,o,i),m=o_(e,u,i);return{hasAppMarkers:d!==void 0||m!==void 0,tiffHeaderOffset:d,iccChunks:m}}}function n_(e){let o=0;for(;o+4+4<=e.byteLength;){const u=e1(e,o);if(u>=8&&lt(e,o+4,4)==="meta")return{offset:o,length:u};o+=u}return{offset:void 0,length:0}}function e1(e,t){const i=e.getUint32(t);return s_(i)?e.byteLength-t:a_(i)&&i_(e,t)?e.getUint32(t+12):i}function s_(e){return e===0}function a_(e){return e===1}function i_(e,t){return e.getUint32(t+8)===0}function r_(e,t,n){const o={ilocOffset:void 0,exifItemOffset:void 0,colrOffset:void 0};for(;t+4<=n&&(!o.ilocOffset||!o.exifItemOffset||!o.colrOffset);){const u=lt(e,t,4);u==="iloc"?o.ilocOffset=t:u==="Exif"?o.exifItemOffset=t+-4:u==="colr"&&(o.colrOffset=t+-4),t++}return o}function l_(e,t,n,i){if(!n||!t||t+2>i)return;const p=e.getUint16(t);for(n+=12;n+16<=i;){if(e.getUint16(n)===p){const y=e.getUint32(n+8);if(y+4<=e.byteLength){const v=e.getUint32(y)+4;return y+v}}n+=16}}function o_(e,t,n){if(!t||t+12>n)return;const u=lt(e,t+8,4);if(!(u!=="prof"&&u!=="rICC"))return[{offset:t+12,length:e1(e,t)-12,chunkNumber:1,chunksTotal:1}]}const by={isWebpFile:c_,findOffsets:u_};function c_(e){const n="RIFF",l="WEBP";return!!e&&lt(e,0,n.length)===n&&lt(e,8,l.length)===l}function u_(e){const i="Exif\0\0";let o=12,u=!1,d,m,h,p;for(;o+8<e.byteLength;){const g=lt(e,o,4),y=e.getUint32(o+4,!0);g==="EXIF"?(u=!0,lt(e,o+8,i.length)===i?d=o+8+i.length:d=o+8):g==="XMP "?(u=!0,m=[{dataOffset:o+8,length:y}]):g==="ICCP"?(u=!0,h=[{offset:o+8,length:y,chunkNumber:1,chunksTotal:1}]):g==="VP8X"&&(u=!0,p=o+8),o+=8+(y%2===0?y:y+1)}return{hasAppMarkers:u,tiffHeaderOffset:d,xmpChunks:m,iccChunks:h,vp8xChunkOffset:p}}const yy={isGifFile:h_,findOffsets:m_},d_=6,f_=["GIF87a","GIF89a"];function h_(e){return!!e&&f_.includes(lt(e,0,d_))}function m_(){return{gifHeaderOffset:0}}const p_={parseAppMarkers:g_};function g_(e,t){if(ay.isTiffFile(e))return gr(ay.findTiffOffsets(),"tiff","TIFF");if(iy.isJpegFile(e))return gr(iy.findJpegOffsets(e),"jpeg","JPEG");if(gy.isPngFile(e))return gr(gy.findPngOffsets(e,t),"png","PNG");if(xy.isHeicFile(e))return gr(xy.findHeicOffsets(e),"heic","HEIC");if(by.isWebpFile(e))return gr(by.findOffsets(e),"webp","WebP");if(yy.isGifFile(e))return gr(yy.findOffsets(e),"gif","GIF");throw new Error("Invalid image format")}function gr(e,t,n){return wt({},e,{fileType:{value:t,description:n}})}const ut={ApertureValue:e=>Math.pow(Math.sqrt(2),e[0]/e[1]).toFixed(2),ColorSpace(e){return e===1?"sRGB":e===65535?"Uncalibrated":"Unknown"},ComponentsConfiguration(e){return e.map(t=>{if(t===49)return"Y";if(t===50)return"Cb";if(t===51)return"Cr";if(t===52)return"R";if(t===53)return"G";if(t===54)return"B"}).join("")},Contrast(e){return e===0?"Normal":e===1?"Soft":e===2?"Hard":"Unknown"},CustomRendered(e){return e===0?"Normal process":e===1?"Custom process":"Unknown"},ExposureMode(e){return e===0?"Auto exposure":e===1?"Manual exposure":e===2?"Auto bracket":"Unknown"},ExposureProgram(e){return e===0?"Undefined":e===1?"Manual":e===2?"Normal program":e===3?"Aperture priority":e===4?"Shutter priority":e===5?"Creative program":e===6?"Action program":e===7?"Portrait mode":e===8?"Landscape mode":e===9?"Bulb":"Unknown"},ExposureTime(e){return e[0]>=e[1]?`${Math.round(e[0]/e[1])}`:e[0]!==0?`1/${Math.round(e[1]/e[0])}`:`0/${e[1]}`},FNumber:e=>`f/${e[0]/e[1]}`,FocalLength:e=>e[0]/e[1]+" mm",FocalPlaneResolutionUnit(e){return e===2?"inches":e===3?"centimeters":"Unknown"},LightSource:e=>e===1?"Daylight":e===2?"Fluorescent":e===3?"Tungsten (incandescent light)":e===4?"Flash":e===9?"Fine weather":e===10?"Cloudy weather":e===11?"Shade":e===12?"Daylight fluorescent (D 5700  7100K)":e===13?"Day white fluorescent (N 4600  5400K)":e===14?"Cool white fluorescent (W 3900  4500K)":e===15?"White fluorescent (WW 3200  3700K)":e===17?"Standard light A":e===18?"Standard light B":e===19?"Standard light C":e===20?"D55":e===21?"D65":e===22?"D75":e===23?"D50":e===24?"ISO studio tungsten":e===255?"Other light source":"Unknown",MeteringMode(e){return e===1?"Average":e===2?"CenterWeightedAverage":e===3?"Spot":e===4?"MultiSpot":e===5?"Pattern":e===6?"Partial":e===255?"Other":"Unknown"},ResolutionUnit(e){return e===2?"inches":e===3?"centimeters":"Unknown"},Saturation(e){return e===0?"Normal":e===1?"Low saturation":e===2?"High saturation":"Unknown"},SceneCaptureType(e){return e===0?"Standard":e===1?"Landscape":e===2?"Portrait":e===3?"Night scene":"Unknown"},Sharpness(e){return e===0?"Normal":e===1?"Soft":e===2?"Hard":"Unknown"},ShutterSpeedValue(e){const t=Math.pow(2,e[0]/e[1]);return t<=1?`${Math.round(1/t)}`:`1/${Math.round(t)}`},WhiteBalance(e){return e===0?"Auto white balance":e===1?"Manual white balance":"Unknown"},XResolution:e=>""+Math.round(e[0]/e[1]),YResolution:e=>""+Math.round(e[0]/e[1])},t1={11:"ProcessingSoftware",254:{name:"SubfileType",description:e=>({0:"Full-resolution image",1:"Reduced-resolution image",2:"Single page of multi-page image",3:"Single page of multi-page reduced-resolution image",4:"Transparency mask",5:"Transparency mask of reduced-resolution image",6:"Transparency mask of multi-page image",7:"Transparency mask of reduced-resolution multi-page image",65537:"Alternate reduced-resolution image",4294967295:"Invalid"})[e]||"Unknown"},255:{name:"OldSubfileType",description:e=>({0:"Full-resolution image",1:"Reduced-resolution image",2:"Single page of multi-page image"})[e]||"Unknown"},256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:{name:"Thresholding",description:e=>({1:"No dithering or halftoning",2:"Ordered dither or halfton",3:"Randomized dither"})[e]||"Unknown"},264:"CellWidth",265:"CellLength",266:{name:"FillOrder",description:e=>({1:"Normal",2:"Reversed"})[e]||"Unknown"},269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:{name:"Orientation",description:e=>e===1?"top-left":e===2?"top-right":e===3?"bottom-right":e===4?"bottom-left":e===5?"left-top":e===6?"right-top":e===7?"right-bottom":e===8?"left-bottom":"Undefined"},277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:{name:"XResolution",description:ut.XResolution},283:{name:"YResolution",description:ut.YResolution},284:"PlanarConfiguration",285:"PageName",286:{name:"XPosition",description:e=>""+Math.round(e[0]/e[1])},287:{name:"YPosition",description:e=>""+Math.round(e[0]/e[1])},290:{name:"GrayResponseUnit",description:e=>({1:"0.1",2:"0.001",3:"0.0001",4:"1e-05",5:"1e-06"})[e]||"Unknown"},296:{name:"ResolutionUnit",description:ut.ResolutionUnit},297:"PageNumber",301:"TransferFunction",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",317:"Predictor",318:{name:"WhitePoint",description:e=>e.map(t=>`${t[0]}/${t[1]}`).join(", ")},319:{name:"PrimaryChromaticities",description:e=>e.map(t=>`${t[0]}/${t[1]}`).join(", ")},321:"HalftoneHints",322:"TileWidth",323:"TileLength",330:"A100DataOffset",332:{name:"InkSet",description:e=>({1:"CMYK",2:"Not CMYK"})[e]||"Unknown"},337:"TargetPrinter",338:{name:"ExtraSamples",description:e=>({0:"Unspecified",1:"Associated Alpha",2:"Unassociated Alpha"})[e]||"Unknown"},339:{name:"SampleFormat",description:e=>{const t={1:"Unsigned",2:"Signed",3:"Float",4:"Undefined",5:"Complex int",6:"Complex float"};return Array.isArray(e)?e.map(n=>t[n]||"Unknown").join(", "):"Unknown"}},513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",529:{name:"YCbCrCoefficients",description:e=>e.map(t=>""+t[0]/t[1]).join("/")},530:"YCbCrSubSampling",531:{name:"YCbCrPositioning",description:e=>e===1?"centered":e===2?"co-sited":"undefined "+e},532:{name:"ReferenceBlackWhite",description:e=>e.map(t=>""+t[0]/t[1]).join(", ")},700:"ApplicationNotes",18246:"Rating",18249:"RatingPercent",33432:{name:"Copyright",description:e=>e.join("; ")},33550:"PixelScale",33723:"IPTC-NAA",33920:"IntergraphMatrix",33922:"ModelTiePoint",34118:"SEMInfo",34264:"ModelTransform",34377:"PhotoshopSettings",34665:"Exif IFD Pointer",34675:"ICC_Profile",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34853:"GPS Info IFD Pointer",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",42112:"GDALMetadata",42113:"GDALNoData",50341:"PrintIM",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50739:"ShadowScale",50741:{name:"MakerNoteSafety",description:e=>({0:"Unsafe",1:"Safe"})[e]||"Unknown"},50778:{name:"CalibrationIlluminant1",description:ut.LightSource},50779:{name:"CalibrationIlluminant2",description:ut.LightSource},50781:"RawDataUniqueID",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50885:"SRawType",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:{name:"ProfileEmbedPolicy",description:e=>({0:"Allow Copying",1:"Embed if Used",2:"Never Embed",3:"No Restrictions"})[e]||"Unknown"},50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:{name:"PreviewColorSpace",description:e=>({1:"Gray Gamma 2.2",2:"sRGB",3:"Adobe RGB",4:"ProPhoto RGB"})[e]||"Unknown"},50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:{name:"ProfileHueSatMapEncoding",description:e=>({0:"Linear",1:"sRGB"})[e]||"Unknown"},51108:{name:"ProfileLookTableEncoding",description:e=>({0:"Linear",1:"sRGB"})[e]||"Unknown"},51109:"BaselineExposureOffset",51110:{name:"DefaultBlackRender",description:e=>({0:"Auto",1:"None"})[e]||"Unknown"},51111:"NewRawImageDigest",51112:"RawToPreviewGain"},x_={33434:{name:"ExposureTime",description:ut.ExposureTime},33437:{name:"FNumber",description:ut.FNumber},34850:{name:"ExposureProgram",description:ut.ExposureProgram},34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:{name:"OECF",description:()=>"[Raw OECF table data]"},34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:{name:"SensitivityType",description:e=>({1:"Standard Output Sensitivity",2:"Recommended Exposure Index",3:"ISO Speed",4:"Standard Output Sensitivity and Recommended Exposure Index",5:"Standard Output Sensitivity and ISO Speed",6:"Recommended Exposure Index and ISO Speed",7:"Standard Output Sensitivity, Recommended Exposure Index and ISO Speed"})[e]||"Unknown"},34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:{name:"ExifVersion",description:e=>fn(e)},36867:"DateTimeOriginal",36868:"DateTimeDigitized",36873:"GooglePlusUploadCode",36880:"OffsetTime",36881:"OffsetTimeOriginal",36882:"OffsetTimeDigitized",37121:{name:"ComponentsConfiguration",description:ut.ComponentsConfiguration},37122:"CompressedBitsPerPixel",37377:{name:"ShutterSpeedValue",description:ut.ShutterSpeedValue},37378:{name:"ApertureValue",description:ut.ApertureValue},37379:"BrightnessValue",37380:"ExposureBiasValue",37381:{name:"MaxApertureValue",description:e=>Math.pow(Math.sqrt(2),e[0]/e[1]).toFixed(2)},37382:{name:"SubjectDistance",description:e=>e[0]/e[1]+" m"},37383:{name:"MeteringMode",description:ut.MeteringMode},37384:{name:"LightSource",description:ut.LightSource},37385:{name:"Flash",description:e=>e===0?"Flash did not fire":e===1?"Flash fired":e===5?"Strobe return light not detected":e===7?"Strobe return light detected":e===9?"Flash fired, compulsory flash mode":e===13?"Flash fired, compulsory flash mode, return light not detected":e===15?"Flash fired, compulsory flash mode, return light detected":e===16?"Flash did not fire, compulsory flash mode":e===24?"Flash did not fire, auto mode":e===25?"Flash fired, auto mode":e===29?"Flash fired, auto mode, return light not detected":e===31?"Flash fired, auto mode, return light detected":e===32?"No flash function":e===65?"Flash fired, red-eye reduction mode":e===69?"Flash fired, red-eye reduction mode, return light not detected":e===71?"Flash fired, red-eye reduction mode, return light detected":e===73?"Flash fired, compulsory flash mode, red-eye reduction mode":e===77?"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected":e===79?"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected":e===89?"Flash fired, auto mode, red-eye reduction mode":e===93?"Flash fired, auto mode, return light not detected, red-eye reduction mode":e===95?"Flash fired, auto mode, return light detected, red-eye reduction mode":"Unknown"},37386:{name:"FocalLength",description:ut.FocalLength},37393:"ImageNumber",37394:{name:"SecurityClassification",description:e=>({C:"Confidential",R:"Restricted",S:"Secret",T:"Top Secret",U:"Unclassified"})[e]||"Unknown"},37395:"ImageHistory",37396:{name:"SubjectArea",description:e=>e.length===2?`Location; X: ${e[0]}, Y: ${e[1]}`:e.length===3?`Circle; X: ${e[0]}, Y: ${e[1]}, diameter: ${e[2]}`:e.length===4?`Rectangle; X: ${e[0]}, Y: ${e[1]}, width: ${e[2]}, height: ${e[3]}`:"Unknown"},37500:{name:"MakerNote",description:()=>"[Raw maker note data]"},37510:{name:"UserComment",description:wm},37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37724:"ImageSourceData",37888:{name:"AmbientTemperature",description:e=>e[0]/e[1]+" C"},37889:{name:"Humidity",description:e=>e[0]/e[1]+" %"},37890:{name:"Pressure",description:e=>e[0]/e[1]+" hPa"},37891:{name:"WaterDepth",description:e=>e[0]/e[1]+" m"},37892:{name:"Acceleration",description:e=>e[0]/e[1]+" mGal"},37893:{name:"CameraElevationAngle",description:e=>e[0]/e[1]+" "},40960:{name:"FlashpixVersion",description:e=>e.map(t=>String.fromCharCode(t)).join("")},40961:{name:"ColorSpace",description:ut.ColorSpace},40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",40965:"Interoperability IFD Pointer",41483:"FlashEnergy",41484:{name:"SpatialFrequencyResponse",description:()=>"[Raw SFR table data]"},41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:{name:"FocalPlaneResolutionUnit",description:ut.FocalPlaneResolutionUnit},41492:{name:"SubjectLocation",description:([e,t])=>`X: ${e}, Y: ${t}`},41493:"ExposureIndex",41495:{name:"SensingMethod",description:e=>e===1?"Undefined":e===2?"One-chip color area sensor":e===3?"Two-chip color area sensor":e===4?"Three-chip color area sensor":e===5?"Color sequential area sensor":e===7?"Trilinear sensor":e===8?"Color sequential linear sensor":"Unknown"},41728:{name:"FileSource",description:e=>e===3?"DSC":"Unknown"},41729:{name:"SceneType",description:e=>e===1?"A directly photographed image":"Unknown"},41730:{name:"CFAPattern",description:()=>"[Raw CFA pattern table data]"},41985:{name:"CustomRendered",description:ut.CustomRendered},41986:{name:"ExposureMode",description:ut.ExposureMode},41987:{name:"WhiteBalance",description:ut.WhiteBalance},41988:{name:"DigitalZoomRatio",description:e=>e[0]===0?"Digital zoom was not used":""+e[0]/e[1]},41989:{name:"FocalLengthIn35mmFilm",description:e=>e===0?"Unknown":e},41990:{name:"SceneCaptureType",description:ut.SceneCaptureType},41991:{name:"GainControl",description:e=>e===0?"None":e===1?"Low gain up":e===2?"High gain up":e===3?"Low gain down":e===4?"High gain down":"Unknown"},41992:{name:"Contrast",description:ut.Contrast},41993:{name:"Saturation",description:ut.Saturation},41994:{name:"Sharpness",description:ut.Sharpness},41995:{name:"DeviceSettingDescription",description:()=>"[Raw device settings table data]"},41996:{name:"SubjectDistanceRange",description:e=>e===1?"Macro":e===2?"Close view":e===3?"Distant view":"Unknown"},42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:{name:"LensSpecification",description:e=>{const t=`${e[0][0]/e[0][1]}-${e[1][0]/e[1][1]} mm`;return e[3][1]===0?`${t} f/?`:`${t} f/${1/(e[2][1]/e[2][1]/(e[3][0]/e[3][1]))}`}},42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42080:{name:"CompositeImage",description:e=>({1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"})[e]||"Unknown"},42081:"SourceImageNumberOfCompositeImage",42082:"SourceExposureTimesOfCompositeImage",42240:"Gamma",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},b_={0:{name:"GPSVersionID",description:e=>e[0]===2&&e[1]===2&&e[2]===0&&e[3]===0?"Version 2.2":"Unknown"},1:{name:"GPSLatitudeRef",description:e=>{const t=e.join("");return t==="N"?"North latitude":t==="S"?"South latitude":"Unknown"}},2:{name:"GPSLatitude",description:uu},3:{name:"GPSLongitudeRef",description:e=>{const t=e.join("");return t==="E"?"East longitude":t==="W"?"West longitude":"Unknown"}},4:{name:"GPSLongitude",description:uu},5:{name:"GPSAltitudeRef",description:e=>e===0?"Sea level":e===1?"Sea level reference (negative value)":"Unknown"},6:{name:"GPSAltitude",description:e=>e[0]/e[1]+" m"},7:{name:"GPSTimeStamp",description:e=>e.map(([t,n])=>{const i=t/n;return/^\d(\.|$)/.test(`${i}`)?`0${i}`:i}).join(":")},8:"GPSSatellites",9:{name:"GPSStatus",description:e=>{const t=e.join("");return t==="A"?"Measurement in progress":t==="V"?"Measurement Interoperability":"Unknown"}},10:{name:"GPSMeasureMode",description:e=>{const t=e.join("");return t==="2"?"2-dimensional measurement":t==="3"?"3-dimensional measurement":"Unknown"}},11:"GPSDOP",12:{name:"GPSSpeedRef",description:e=>{const t=e.join("");return t==="K"?"Kilometers per hour":t==="M"?"Miles per hour":t==="N"?"Knots":"Unknown"}},13:"GPSSpeed",14:{name:"GPSTrackRef",description:e=>{const t=e.join("");return t==="T"?"True direction":t==="M"?"Magnetic direction":"Unknown"}},15:"GPSTrack",16:{name:"GPSImgDirectionRef",description:e=>{const t=e.join("");return t==="T"?"True direction":t==="M"?"Magnetic direction":"Unknown"}},17:"GPSImgDirection",18:"GPSMapDatum",19:{name:"GPSDestLatitudeRef",description:e=>{const t=e.join("");return t==="N"?"North latitude":t==="S"?"South latitude":"Unknown"}},20:{name:"GPSDestLatitude",description:e=>e[0][0]/e[0][1]+e[1][0]/e[1][1]/60+e[2][0]/e[2][1]/3600},21:{name:"GPSDestLongitudeRef",description:e=>{const t=e.join("");return t==="E"?"East longitude":t==="W"?"West longitude":"Unknown"}},22:{name:"GPSDestLongitude",description:e=>e[0][0]/e[0][1]+e[1][0]/e[1][1]/60+e[2][0]/e[2][1]/3600},23:{name:"GPSDestBearingRef",description:e=>{const t=e.join("");return t==="T"?"True direction":t==="M"?"Magnetic direction":"Unknown"}},24:"GPSDestBearing",25:{name:"GPSDestDistanceRef",description:e=>{const t=e.join("");return t==="K"?"Kilometers":t==="M"?"Miles":t==="N"?"Knots":"Unknown"}},26:"GPSDestDistance",27:{name:"GPSProcessingMethod",description:wm},28:{name:"GPSAreaInformation",description:wm},29:"GPSDateStamp",30:{name:"GPSDifferential",description:e=>e===0?"Measurement without differential correction":e===1?"Differential correction applied":"Unknown"},31:"GPSHPositioningError"},y_={1:"InteroperabilityIndex",2:{name:"InteroperabilityVersion",description:e=>fn(e)},4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight"},v_={45056:{name:"MPFVersion",description:e=>fn(e)},45057:"NumberOfImages",45058:"MPEntry",45059:"ImageUIDList",45060:"TotalFrames"},vy=wt({},t1,x_),lp="0th",n1="1st",s1="exif",a1="gps",i1="interoperability",r1="mpf",Wa={[lp]:vy,[n1]:t1,[s1]:vy,[a1]:b_,[i1]:y_,[r1]:v_},l1={1:1,2:1,3:2,4:4,5:8,7:1,9:4,10:8,13:4},Am={BYTE:1,ASCII:2,SHORT:3,LONG:4,RATIONAL:5,UNDEFINED:7,SLONG:9,SRATIONAL:10,IFD:13},ze={getAsciiValue:w_,getByteAt:o1,getAsciiAt:N_,getShortAt:S_,getLongAt:fu,getRationalAt:C_,getUndefinedAt:j_,getSlongAt:Tm,getSrationalAt:E_,getIfdPointerAt:A_,typeSizes:l1,tagTypes:Am,getTypeSize:T_};function w_(e){return e.map(t=>String.fromCharCode(t))}function o1(e,t){return e.getUint8(t)}function N_(e,t){return e.getUint8(t)}function S_(e,t,n){return e.getUint16(t,n===Oi.LITTLE_ENDIAN)}function fu(e,t,n){return e.getUint32(t,n===Oi.LITTLE_ENDIAN)}function C_(e,t,n){return[fu(e,t,n),fu(e,t+4,n)]}function j_(e,t){return o1(e,t)}function Tm(e,t,n){return e.getInt32(t,n===Oi.LITTLE_ENDIAN)}function E_(e,t,n){return[Tm(e,t,n),Tm(e,t+4,n)]}function A_(e,t,n){return fu(e,t,n)}function T_(e){if(Am[e]===void 0)throw new Error("No such type found.");return l1[Am[e]]}const __={1:ze.getByteAt,2:ze.getAsciiAt,3:ze.getShortAt,4:ze.getLongAt,5:ze.getRationalAt,7:ze.getUndefinedAt,9:ze.getSlongAt,10:ze.getSrationalAt,13:ze.getIfdPointerAt};function c1(e,t,n){return t+ze.getLongAt(e,t+4,n)}function Ir(e,t,n,i,l,o){const u=ze.getTypeSize("SHORT"),d=12,m={},h=k_(e,i,l);i+=u;for(let p=0;p<h&&!(i+d>e.byteLength);p++){const g=O_(e,t,n,i,l,o);g!==void 0&&(m[g.name]={id:g.id,value:g.value,description:g.description}),i+=d}if(i<e.byteLength-ze.getTypeSize("LONG")){const p=ze.getLongAt(e,i,l);p!==0&&t===lp&&(m.Thumbnail=Ir(e,n1,n,n+p,l,!0))}return m}function k_(e,t,n){return t+ze.getTypeSize("SHORT")<=e.byteLength?ze.getShortAt(e,t,n):0}function O_(e,t,n,i,l,o){const d=ze.getTypeSize("SHORT"),m=d+ze.getTypeSize("SHORT"),h=m+ze.getTypeSize("LONG"),p=ze.getShortAt(e,i,l),g=ze.getShortAt(e,i+d,l),y=ze.getLongAt(e,i+m,l);let x;if(ze.typeSizes[g]===void 0||!o&&Wa[t][p]===void 0)return;if(I_(g,y))x=wy(e,i+h,g,y,l);else{const j=ze.getLongAt(e,i+h,l);if(D_(e,n,j,g,y)){const C=p===33723;x=wy(e,n+j,g,y,l,C)}else x="<faulty value>"}g===ze.tagTypes.ASCII&&(x=L_(x),x=R_(x));let v=`undefined-${p}`,N=x;if(Wa[t][p]!==void 0)if(Wa[t][p].name!==void 0&&Wa[t][p].description!==void 0){v=Wa[t][p].name;try{N=Wa[t][p].description(x)}catch{N=Ny(x)}}else g===ze.tagTypes.RATIONAL||g===ze.tagTypes.SRATIONAL?(v=Wa[t][p],N=""+x[0]/x[1]):(v=Wa[t][p],N=Ny(x));return{id:p,name:v,value:x,description:N}}function I_(e,t){return ze.typeSizes[e]*t<=ze.getTypeSize("LONG")}function wy(e,t,n,i,l,o=!1){let u=[];o&&(i=i*ze.typeSizes[n],n=ze.tagTypes.BYTE);for(let d=0;d<i;d++)u.push(__[n](e,t,l)),t+=ze.typeSizes[n];return n===ze.tagTypes.ASCII?u=ze.getAsciiValue(u):u.length===1&&(u=u[0]),u}function D_(e,t,n,i,l){return t+n+ze.typeSizes[i]*l<=e.byteLength}function L_(e){const t=[];let n=0;for(let i=0;i<e.length;i++){if(e[i]==="\0"){n++;continue}t[n]===void 0&&(t[n]=""),t[n]+=e[i]}return t}function R_(e){try{return e.map(t=>decodeURIComponent(escape(t)))}catch{return e}}function Ny(e){return e instanceof Array?e.join(", "):e}const Sy="Exif IFD Pointer",Cy="GPS Info IFD Pointer",jy="Interoperability IFD Pointer",u1={read:M_};function M_(e,t,n){const i=Oi.getByteOrder(e,t);let l=F_(e,t,i,n);return l=P_(l,e,t,i,n),l=$_(l,e,t,i,n),l=z_(l,e,t,i,n),l}function F_(e,t,n,i){return Ir(e,lp,t,c1(e,t,n),n,i)}function P_(e,t,n,i,l){return e[Sy]!==void 0?wt(e,Ir(t,s1,n,n+e[Sy].value,i,l)):e}function $_(e,t,n,i,l){return e[Cy]!==void 0?wt(e,Ir(t,a1,n,n+e[Cy].value,i,l)):e}function z_(e,t,n,i,l){return e[jy]!==void 0?wt(e,Ir(t,i1,n,n+e[jy].value,i,l)):e}const U_={read:B_},Nr=16;function B_(e,t,n){const i=Oi.getByteOrder(e,t),l=Ir(e,r1,t,c1(e,t,i),i,n);return H_(e,t,l,i)}function H_(e,t,n,i){if(!n.MPEntry)return n;const l=[];for(let o=0;o<Math.ceil(n.MPEntry.value.length/Nr);o++){l[o]={};const u=Rl(n.MPEntry.value,o*Nr,ze.getTypeSize("LONG"),i);l[o].ImageFlags=W_(u),l[o].ImageFormat=G_(u),l[o].ImageType=Y_(u);const d=Rl(n.MPEntry.value,o*Nr+4,ze.getTypeSize("LONG"),i);l[o].ImageSize={value:d,description:""+d};const m=q_(o,n.MPEntry,i,t);l[o].ImageOffset={value:m,description:""+m};const h=Rl(n.MPEntry.value,o*Nr+12,ze.getTypeSize("SHORT"),i);l[o].DependentImage1EntryNumber={value:h,description:""+h};const p=Rl(n.MPEntry.value,o*Nr+14,ze.getTypeSize("SHORT"),i);l[o].DependentImage2EntryNumber={value:p,description:""+p},l[o].image=e.buffer.slice(m,m+d),Uw(l[o],"base64",function(){return Bw(this.image)})}return n.Images=l,n}function Rl(e,t,n,i){if(i===Oi.LITTLE_ENDIAN){let o=0;for(let u=0;u<n;u++)o+=e[t+u]<<8*u;return o}let l=0;for(let o=0;o<n;o++)l+=e[t+o]<<8*(n-1-o);return l}function W_(e){const t=[e>>31&1,e>>30&1,e>>29&1],n=[];return t[0]&&n.push("Dependent Parent Image"),t[1]&&n.push("Dependent Child Image"),t[2]&&n.push("Representative Image"),{value:t,description:n.join(", ")||"None"}}function G_(e){const t=e>>24&7;return{value:t,description:t===0?"JPEG":"Unknown"}}function Y_(e){const t=e&16777215;return{value:t,description:{196608:"Baseline MP Primary Image",65537:"Large Thumbnail (VGA equivalent)",65538:"Large Thumbnail (Full HD equivalent)",131073:"Multi-Frame Image (Panorama)",131074:"Multi-Frame Image (Disparity)",131075:"Multi-Frame Image (Multi-Angle)",0:"Undefined"}[t]||"Unknown"}}function q_(e,t,n,i){return V_(e)?0:Rl(t.value,e*Nr+8,ze.getTypeSize("LONG"),n)+i}function V_(e){return e===0}const K_={read:X_};function X_(e,t){const n=Z_(e,t),i=tk(e,t,n);return{"Bits Per Sample":J_(e,t,n),"Image Height":Q_(e,t,n),"Image Width":ek(e,t,n),"Color Components":i,Subsampling:i&&nk(e,t,i.value,n)}}function Z_(e,t){return ze.getShortAt(e,t)}function J_(e,t,n){if(3>n)return;const o=ze.getByteAt(e,t+2);return{value:o,description:""+o}}function Q_(e,t,n){if(5>n)return;const o=ze.getShortAt(e,t+3);return{value:o,description:`${o}px`}}function ek(e,t,n){if(7>n)return;const o=ze.getShortAt(e,t+5);return{value:o,description:`${o}px`}}function tk(e,t,n){if(8>n)return;const o=ze.getByteAt(e,t+7);return{value:o,description:""+o}}function nk(e,t,n,i){if(8+3*n>i)return;const u=[];for(let d=0;d<n;d++){const m=t+8+d*3;u.push([ze.getByteAt(e,m),ze.getByteAt(e,m+1),ze.getByteAt(e,m+2)])}return{value:u,description:u.length>1?sk(u)+ak(u):""}}function sk(e){const t={1:"Y",2:"Cb",3:"Cr",4:"I",5:"Q"};return e.map(n=>t[n[0]]).join("")}function ak(e){const t={17:"4:4:4 (1 1)",18:"4:4:0 (1 2)",20:"4:4:1 (1 4)",33:"4:2:2 (2 1)",34:"4:2:0 (2 2)",36:"4:2:1 (2 4)",65:"4:1:1 (4 1)",66:"4:1:0 (4 2)"};return e.length===0||e[0][1]===void 0||t[e[0][1]]===void 0?"":t[e[0][1]]}const ik={read:rk};function rk(e,t){const n=lk(e,t),i=hk(e,t,n),l=mk(e,t,n),o={"JFIF Version":ok(e,t,n),"Resolution Unit":ck(e,t,n),XResolution:dk(e,t,n),YResolution:fk(e,t,n),"JFIF Thumbnail Width":i,"JFIF Thumbnail Height":l};if(i!==void 0&&l!==void 0){const u=pk(e,t,3*i.value*l.value,n);u&&(o["JFIF Thumbnail"]=u)}for(const u in o)o[u]===void 0&&delete o[u];return o}function lk(e,t){return ze.getShortAt(e,t)}function ok(e,t,n){if(9>n)return;const o=ze.getByteAt(e,t+7),u=ze.getByteAt(e,t+7+1);return{value:o*256+u,description:o+"."+u}}function ck(e,t,n){if(10>n)return;const o=ze.getByteAt(e,t+9);return{value:o,description:uk(o)}}function uk(e){return e===0?"None":e===1?"inches":e===2?"cm":"Unknown"}function dk(e,t,n){if(12>n)return;const o=ze.getShortAt(e,t+10);return{value:o,description:""+o}}function fk(e,t,n){if(14>n)return;const o=ze.getShortAt(e,t+12);return{value:o,description:""+o}}function hk(e,t,n){if(15>n)return;const o=ze.getByteAt(e,t+14);return{value:o,description:`${o}px`}}function mk(e,t,n){if(16>n)return;const o=ze.getByteAt(e,t+15);return{value:o,description:`${o}px`}}function pk(e,t,n,i){return n===0||16+n>i?void 0:{value:e.buffer.slice(t+16,t+16+n),description:"<24-bit RGB pixel data>"}}const Va={iptc:{256:{name:"Model Version",description:e=>((e[0]<<8)+e[1]).toString()},261:{name:"Destination",repeatable:!0},276:{name:"File Format",description:e=>((e[0]<<8)+e[1]).toString()},278:{name:"File Format Version",description:e=>((e[0]<<8)+e[1]).toString()},286:"Service Identifier",296:"Envelope Number",306:"Product ID",316:"Envelope Priority",326:{name:"Date Sent",description:xh},336:{name:"Time Sent",description:bh},346:{name:"Coded Character Set",description:Ey,encoding_name:Ey},356:"UNO",376:{name:"ARM Identifier",description:e=>((e[0]<<8)+e[1]).toString()},378:{name:"ARM Version",description:e=>((e[0]<<8)+e[1]).toString()},512:{name:"Record Version",description:e=>((e[0]<<8)+e[1]).toString()},515:"Object Type Reference",516:"Object Attribute Reference",517:"Object Name",519:"Edit Status",520:{name:"Editorial Update",description:e=>fn(e)==="01"?"Additional Language":"Unknown"},522:"Urgency",524:{name:"Subject Reference",repeatable:!0,description:e=>{const t=fn(e).split(":");return t[2]+(t[3]?"/"+t[3]:"")+(t[4]?"/"+t[4]:"")}},527:"Category",532:{name:"Supplemental Category",repeatable:!0},534:"Fixture Identifier",537:{name:"Keywords",repeatable:!0},538:{name:"Content Location Code",repeatable:!0},539:{name:"Content Location Name",repeatable:!0},542:"Release Date",547:"Release Time",549:"Expiration Date",550:"Expiration Time",552:"Special Instructions",554:{name:"Action Advised",description:e=>{const t=fn(e);return t==="01"?"Object Kill":t==="02"?"Object Replace":t==="03"?"Object Append":t==="04"?"Object Reference":"Unknown"}},557:{name:"Reference Service",repeatable:!0},559:{name:"Reference Date",repeatable:!0},562:{name:"Reference Number",repeatable:!0},567:{name:"Date Created",description:xh},572:{name:"Time Created",description:bh},574:{name:"Digital Creation Date",description:xh},575:{name:"Digital Creation Time",description:bh},577:"Originating Program",582:"Program Version",587:{name:"Object Cycle",description:e=>{const t=fn(e);return t==="a"?"morning":t==="p"?"evening":t==="b"?"both":"Unknown"}},592:{name:"By-line",repeatable:!0},597:{name:"By-line Title",repeatable:!0},602:"City",604:"Sub-location",607:"Province/State",612:"Country/Primary Location Code",613:"Country/Primary Location Name",615:"Original Transmission Reference",617:"Headline",622:"Credit",627:"Source",628:"Copyright Notice",630:{name:"Contact",repeatable:!0},632:"Caption/Abstract",634:{name:"Writer/Editor",repeatable:!0},637:{name:"Rasterized Caption",description:e=>e},642:"Image Type",643:{name:"Image Orientation",description:e=>{const t=fn(e);return t==="P"?"Portrait":t==="L"?"Landscape":t==="S"?"Square":"Unknown"}},647:"Language Identifier",662:{name:"Audio Type",description:e=>{const t=fn(e),n=t.charAt(0),i=t.charAt(1);let l="";return n==="1"?l+="Mono":n==="2"&&(l+="Stereo"),i==="A"?l+=", actuality":i==="C"?l+=", question and answer session":i==="M"?l+=", music, transmitted by itself":i==="Q"?l+=", response to a question":i==="R"?l+=", raw sound":i==="S"?l+=", scener":i==="V"?l+=", voicer":i==="W"&&(l+=", wrap"),l!==""?l:t}},663:{name:"Audio Sampling Rate",description:e=>parseInt(fn(e),10)+" Hz"},664:{name:"Audio Sampling Resolution",description:e=>{const t=parseInt(fn(e),10);return t+(t===1?" bit":" bits")}},665:{name:"Audio Duration",description:e=>{const t=fn(e);return t.length>=6?t.substr(0,2)+":"+t.substr(2,2)+":"+t.substr(4,2):t}},666:"Audio Outcue",698:"Short Document ID",699:"Unique Document ID",700:"Owner ID",712:{name:e=>e.length===2?"ObjectData Preview File Format":"Record 2 destination",description:e=>{if(e.length===2){const t=(e[0]<<8)+e[1];return t===0?"No ObjectData":t===1?"IPTC-NAA Digital Newsphoto Parameter Record":t===2?"IPTC7901 Recommended Message Format":t===3?"Tagged Image File Format (Adobe/Aldus Image data)":t===4?"Illustrator (Adobe Graphics data)":t===5?"AppleSingle (Apple Computer Inc)":t===6?"NAA 89-3 (ANPA 1312)":t===7?"MacBinary II":t===8?"IPTC Unstructured Character Oriented File Format (UCOFF)":t===9?"United Press International ANPA 1312 variant":t===10?"United Press International Down-Load Message":t===11?"JPEG File Interchange (JFIF)":t===12?"Photo-CD Image-Pac (Eastman Kodak)":t===13?"Microsoft Bit Mapped Graphics File [*.BMP]":t===14?"Digital Audio File [*.WAV] (Microsoft & Creative Labs)":t===15?"Audio plus Moving Video [*.AVI] (Microsoft)":t===16?"PC DOS/Windows Executable Files [*.COM][*.EXE]":t===17?"Compressed Binary File [*.ZIP] (PKWare Inc)":t===18?"Audio Interchange File Format AIFF (Apple Computer Inc)":t===19?"RIFF Wave (Microsoft Corporation)":t===20?"Freehand (Macromedia/Aldus)":t===21?'Hypertext Markup Language "HTML" (The Internet Society)':t===22?"MPEG 2 Audio Layer 2 (Musicom), ISO/IEC":t===23?"MPEG 2 Audio Layer 3, ISO/IEC":t===24?"Portable Document File (*.PDF) Adobe":t===25?"News Industry Text Format (NITF)":t===26?"Tape Archive (*.TAR)":t===27?"Tidningarnas Telegrambyr NITF version (TTNITF DTD)":t===28?"Ritzaus Bureau NITF version (RBNITF DTD)":t===29?"Corel Draw [*.CDR]":`Unknown format ${t}`}return fn(e)}},713:{name:"ObjectData Preview File Format Version",description:(e,t)=>{const n={"00":{"00":"1"},"01":{"01":"1","02":"2","03":"3","04":"4"},"02":{"04":"4"},"03":{"01":"5.0","02":"6.0"},"04":{"01":"1.40"},"05":{"01":"2"},"06":{"01":"1"},11:{"01":"1.02"},20:{"01":"3.1","02":"4.0","03":"5.0","04":"5.5"},21:{"02":"2.0"}},i=fn(e);if(t["ObjectData Preview File Format"]){const l=fn(t["ObjectData Preview File Format"].value);if(n[l]&&n[l][i])return n[l][i]}return i}},714:"ObjectData Preview Data",1802:{name:"Size Mode",description:e=>e[0].toString()},1812:{name:"Max Subfile Size",description:e=>{let t=0;for(let n=0;n<e.length;n++)t=(t<<8)+e[n];return t.toString()}},1882:{name:"ObjectData Size Announced",description:e=>{let t=0;for(let n=0;n<e.length;n++)t=(t<<8)+e[n];return t.toString()}},1887:{name:"Maximum ObjectData Size",description:e=>{let t=0;for(let n=0;n<e.length;n++)t=(t<<8)+e[n];return t.toString()}}}};function xh(e){const t=fn(e);return t.length>=8?t.substr(0,4)+"-"+t.substr(4,2)+"-"+t.substr(6,2):t}function bh(e){const t=fn(e);let n=t;return t.length>=6&&(n=t.substr(0,2)+":"+t.substr(2,2)+":"+t.substr(4,2),t.length===11&&(n+=t.substr(6,1)+t.substr(7,2)+":"+t.substr(9,2))),n}function Ey(e){const t=fn(e);return t==="\x1B%G"?"UTF-8":t==="\x1B%5"?"Windows-1252":t==="\x1B%/G"?"UTF-8 Level 1":t==="\x1B%/H"?"UTF-8 Level 2":t==="\x1B%/I"?"UTF-8 Level 3":t==="\x1B/A"?"ISO-8859-1":t==="\x1B/B"?"ISO-8859-2":t==="\x1B/C"?"ISO-8859-3":t==="\x1B/D"?"ISO-8859-4":t==="\x1B/@"?"ISO-8859-5":t==="\x1B/G"?"ISO-8859-6":t==="\x1B/F"?"ISO-8859-7":t==="\x1B/H"?"ISO-8859-8":"Unknown"}const gk={get:xk};function xk(){if(typeof TextDecoder<"u")return TextDecoder}const bk=5,d1={decode:yk,TAG_HEADER_SIZE:bk};function yk(e,t){const n=gk.get();if(typeof n<"u"&&e!==void 0)try{return new n(e).decode(t instanceof DataView?t.buffer:Uint8Array.from(t))}catch{}const i=t.map(l=>String.fromCharCode(l)).join("");return vk(i)}function vk(e){try{return decodeURIComponent(escape(e))}catch{return e}}const wk=943868237,f1=4,yh=f1+8,Nk=1028,h1=5,_m={read:Sk};function Sk(e,t,n){try{if(Array.isArray(e))return Ay(new DataView(Uint8Array.from(e).buffer),{size:e.length},0,n);const{naaBlock:i,dataOffset:l}=Ck(e,t);return Ay(e,i,l,n)}catch{return{}}}function Ck(e,t){for(;t+yh<=e.byteLength;){const n=jk(e,t);if(Ek(n))return{naaBlock:n,dataOffset:t+yh};t+=yh+n.size+Ak(n)}throw new Error("No IPTC NAA resource block.")}function jk(e,t){if(e.getUint32(t,!1)!==wk)throw new Error("Not an IPTC resource block.");return{type:e.getUint16(t+f1),size:e.getUint16(t+10)}}function Ek(e){return e.type===Nk}function Ak(e){return e.size%2!==0?1:0}function Ay(e,t,n,i){const l={};let o;const u=n+t.size;for(;n<u&&n<e.byteLength;){const{tag:d,tagSize:m}=Tk(e,n,l,o,i);if(d===null)break;d&&("encoding"in d&&(o=d.encoding),l[d.name]===void 0||d.repeatable===void 0?l[d.name]={id:d.id,value:d.value,description:d.description}:(l[d.name]instanceof Array||(l[d.name]=[{id:l[d.name].id,value:l[d.name].value,description:l[d.name].description}]),l[d.name].push({id:d.id,value:d.value,description:d.description}))),n+=h1+m}return l}function Tk(e,t,n,i,l){if(_k(e,t))return{tag:null,tagSize:0};const d=e.getUint16(t+1),m=e.getUint16(t+3);if(!l&&!Va.iptc[d])return{tag:void 0,tagSize:m};const h=kk(e,t+h1,m),p={id:d,name:Ok(Va.iptc[d],d,h),value:h,description:Lk(Va.iptc[d],h,n,i)};return Fk(d)&&(p.repeatable=!0),Pk(d)&&(p.encoding=Va.iptc[d].encoding_name(h)),{tag:p,tagSize:m}}function _k(e,t){return e.getUint8(t)!==28}function kk(e,t,n){const i=[];for(let l=0;l<n;l++)i.push(e.getUint8(t+l));return i}function Ok(e,t,n){return e?Ik(e)?e:Dk(e)?e.name(n):e.name:`undefined-${t}`}function Ik(e){return typeof e=="string"}function Dk(e){return typeof e.name=="function"}function Lk(e,t,n,i){if(Mk(e))try{return e.description(t,n)}catch{}return Rk(e,t)?d1.decode(i,t):t}function Rk(e,t){return e&&t instanceof Array}function Mk(e){return e&&e.description!==void 0}function Fk(e){return Va.iptc[e]&&Va.iptc[e].repeatable}function Pk(e){return Va.iptc[e]&&Va.iptc[e].encoding_name!==void 0}const Ac={"tiff:Orientation"(e){return e==="1"?"Horizontal (normal)":e==="2"?"Mirror horizontal":e==="3"?"Rotate 180":e==="4"?"Mirror vertical":e==="5"?"Mirror horizontal and rotate 270 CW":e==="6"?"Rotate 90 CW":e==="7"?"Mirror horizontal and rotate 90 CW":e==="8"?"Rotate 270 CW":e},"tiff:ResolutionUnit":e=>ut.ResolutionUnit(parseInt(e,10)),"tiff:XResolution":e=>xr(ut.XResolution,e),"tiff:YResolution":e=>xr(ut.YResolution,e),"exif:ApertureValue":e=>xr(ut.ApertureValue,e),"exif:GPSLatitude":Ty,"exif:GPSLongitude":Ty,"exif:FNumber":e=>xr(ut.FNumber,e),"exif:FocalLength":e=>xr(ut.FocalLength,e),"exif:FocalPlaneResolutionUnit":e=>ut.FocalPlaneResolutionUnit(parseInt(e,10)),"exif:ColorSpace":e=>ut.ColorSpace($k(e)),"exif:ComponentsConfiguration"(e,t){if(/^\d, \d, \d, \d$/.test(t)){const n=t.split(", ").map(i=>i.charCodeAt(0));return ut.ComponentsConfiguration(n)}return t},"exif:Contrast":e=>ut.Contrast(parseInt(e,10)),"exif:CustomRendered":e=>ut.CustomRendered(parseInt(e,10)),"exif:ExposureMode":e=>ut.ExposureMode(parseInt(e,10)),"exif:ExposureProgram":e=>ut.ExposureProgram(parseInt(e,10)),"exif:ExposureTime"(e){return m1(e)?ut.ExposureTime(e.split("/").map(t=>parseInt(t,10))):e},"exif:MeteringMode":e=>ut.MeteringMode(parseInt(e,10)),"exif:Saturation":e=>ut.Saturation(parseInt(e,10)),"exif:SceneCaptureType":e=>ut.SceneCaptureType(parseInt(e,10)),"exif:Sharpness":e=>ut.Sharpness(parseInt(e,10)),"exif:ShutterSpeedValue":e=>xr(ut.ShutterSpeedValue,e),"exif:WhiteBalance":e=>ut.WhiteBalance(parseInt(e,10))};function xr(e,t){return m1(t)?e(t.split("/")):t}function $k(e){return e.substring(0,2)==="0x"?parseInt(e.substring(2),16):parseInt(e,10)}function m1(e){return/^-?\d+\/-?\d+$/.test(e)}function Ty(e){const[t,n]=e.split(",");if(t!==void 0&&n!==void 0){const i=parseFloat(t),l=parseFloat(n),o=n.charAt(n.length-1);if(!Number.isNaN(i)&&!Number.isNaN(l))return""+(i+l/60)+o}return e}const zk={get:Uk};function Uk(){if(typeof DOMParser<"u")return new DOMParser;try{return new(__non_webpack_require__("@xmldom/xmldom")).DOMParser({errorHandler:{error:()=>{throw new Error("Faulty XML")}}})}catch{return}}const _y={read:Bk};function Bk(e,t){const n={};if(typeof e=="string")return Tc(n,e),n;const[i,l]=Hk(e,t),o=Tc(n,i);if(l){const u=Tc(n,l);!o&&!u&&(delete n._raw,Tc(n,km(e,t)))}return n}function Hk(e,t){if(t.length===0)return[];const n=[km(e,t.slice(0,1))];return t.length>1&&n.push(km(e,t.slice(1))),n}function km(e,t){const n=t.reduce((o,u)=>o+u.length,0),i=new Uint8Array(n);let l=0;for(let o=0;o<t.length;o++){const u=t[o],d=e.buffer.slice(u.dataOffset,u.dataOffset+u.length);i.set(new Uint8Array(d),l),l+=u.length}return new DataView(i.buffer)}function Tc(e,t){try{const{doc:n,raw:i}=Wk(t);e._raw=(e._raw||"")+i;const l=p1(n);return wt(e,x1(g1(l,!0))),!0}catch{return!1}}function Wk(e){const t=zk.get();if(!t)throw console.warn("Warning: DOMParser is not available. It is needed to be able to parse XMP tags."),new Error;const n=typeof e=="string"?e:lt(e,0,e.byteLength),i=t.parseFromString(Gk(n),"application/xml");if(i.documentElement.nodeName==="parsererror")throw new Error(i.documentElement.textContent);return{doc:i,raw:n}}function Gk(e){return e.replace(/^.+(<\?xpacket begin)/,"$1").replace(/(<\?xpacket end=".*"\?>).+$/,"$1")}function p1(e){for(let t=0;t<e.childNodes.length;t++){if(e.childNodes[t].tagName==="x:xmpmeta")return p1(e.childNodes[t]);if(e.childNodes[t].tagName==="rdf:RDF")return e.childNodes[t]}throw new Error}function g1(e,t=!1){const n=Yk(e);return qk(n)?t?{}:Vk(n[0]):Kk(n)}function Yk(e){const t=[];for(let n=0;n<e.childNodes.length;n++)t.push(e.childNodes[n]);return t}function qk(e){return e.length===1&&e[0].nodeName==="#text"}function Vk(e){return e.nodeValue}function Kk(e){const t={};return e.forEach(n=>{if(Xk(n)){const i=Zk(n);t[n.nodeName]!==void 0?(Array.isArray(t[n.nodeName])||(t[n.nodeName]=[t[n.nodeName]]),t[n.nodeName].push(i)):t[n.nodeName]=i}}),t}function Xk(e){return e.nodeName&&e.nodeName!=="#text"}function Zk(e){return{attributes:Jk(e),value:g1(e)}}function Jk(e){const t={};for(let n=0;n<e.attributes.length;n++)t[e.attributes[n].nodeName]=decodeURIComponent(escape(e.attributes[n].value));return t}function x1(e){const t={};if(typeof e=="string")return e;for(const n in e){let i=e[n];Array.isArray(i)||(i=[i]),i.forEach(l=>{wt(t,op(l.attributes)),typeof l.value=="object"&&wt(t,b1(l.value))})}return t}function op(e){const t={};for(const n in e)try{Qk(n)&&(t[Lu(n)]={value:e[n],attributes:{},description:ya(e[n],n)})}catch{}return t}function Qk(e){return e!=="rdf:parseType"&&!Du(e)}function Du(e){return e.split(":")[0]==="xmlns"}function Lu(e){return/^MicrosoftPhoto(_\d+_)?:Rating$/i.test(e)?"RatingPercent":e.split(":")[1]}function ya(e,t=void 0){if(Array.isArray(e)){const n=eO(e);return t&&typeof Ac[t]=="function"?Ac[t](e,n):n}if(typeof e=="object")return tO(e);try{return t&&typeof Ac[t]=="function"?Ac[t](e):decodeURIComponent(escape(e))}catch{return e}}function eO(e){return e.map(t=>t.value!==void 0?ya(t.value):ya(t)).join(", ")}function tO(e){const t=[];for(const n in e)t.push(`${nO(n)}: ${ya(e[n].value)}`);return t.join("; ")}function nO(e){return e==="CiAdrCity"?"CreatorCity":e==="CiAdrCtry"?"CreatorCountry":e==="CiAdrExtadr"?"CreatorAddress":e==="CiAdrPcode"?"CreatorPostalCode":e==="CiAdrRegion"?"CreatorRegion":e==="CiEmailWork"?"CreatorWorkEmail":e==="CiTelWork"?"CreatorWorkPhone":e==="CiUrlWork"?"CreatorWorkUrl":e}function b1(e){const t={};for(const n in e)try{Du(n)||(t[Lu(n)]=sO(e[n],n))}catch{}return t}function sO(e,t){return iO(e)?rO(e,t):aO(e)?{value:"",attributes:{},description:""}:y1(e)?v1(e,t):w1(e)?N1(e,t):S1(e)?C1(e,t):cO(e)?uO(e,t):cp(e,t)}function aO(e){return e.attributes["rdf:parseType"]==="Resource"&&typeof e.value=="string"&&e.value.trim()===""}function iO(e){return Array.isArray(e)}function rO(e,t){return cp(e[e.length-1],t)}function y1(e){return e.attributes["rdf:parseType"]==="Resource"&&e.value["rdf:value"]!==void 0||e.value["rdf:Description"]!==void 0&&e.value["rdf:Description"].value["rdf:value"]!==void 0}function v1(e,t){const n=Vl(e);e.value["rdf:Description"]!==void 0&&(e=e.value["rdf:Description"]),wt(n,Vl(e),lO(e));const i=oO(e);return{value:i,attributes:n,description:ya(i,t)}}function Vl(e){const t={};for(const n in e.attributes)n!=="rdf:parseType"&&n!=="rdf:resource"&&!Du(n)&&(t[Lu(n)]=e.attributes[n]);return t}function lO(e){const t={};for(const n in e.value)n!=="rdf:value"&&!Du(n)&&(t[Lu(n)]=e.value[n].value);return t}function oO(e){return E1(e.value["rdf:value"])||e.value["rdf:value"].value}function w1(e){return e.attributes["rdf:parseType"]==="Resource"||e.value["rdf:Description"]!==void 0&&e.value["rdf:Description"].value["rdf:value"]===void 0}function N1(e,t){const n={value:{},attributes:{}};return e.value["rdf:Description"]!==void 0&&(wt(n.value,op(e.value["rdf:Description"].attributes)),wt(n.attributes,Vl(e)),e=e.value["rdf:Description"]),wt(n.value,b1(e.value)),n.description=ya(n.value,t),n}function S1(e){return Object.keys(e.value).length===0&&e.attributes["xml:lang"]===void 0&&e.attributes["rdf:resource"]===void 0}function C1(e,t){const n=op(e.attributes);return{value:n,attributes:{},description:ya(n,t)}}function cO(e){return j1(e.value)!==void 0}function j1(e){return e["rdf:Bag"]||e["rdf:Seq"]||e["rdf:Alt"]}function uO(e,t){let n=j1(e.value).value["rdf:li"];const i=Vl(e),l=[];return n===void 0?n=[]:Array.isArray(n)||(n=[n]),n.forEach(o=>{l.push(dO(o))}),{value:l,attributes:i,description:ya(l,t)}}function dO(e){return y1(e)?v1(e):w1(e)?N1(e).value:S1(e)?C1(e).value:cp(e)}function cp(e,t){const n=E1(e)||x1(e.value);return{value:n,attributes:Vl(e),description:ya(n,t)}}function E1(e){return e.attributes&&e.attributes["rdf:resource"]}const da={CLOSED_SUBPATH_LENGTH:0,CLOSED_SUBPATH_BEZIER_LINKED:1,CLOSED_SUBPATH_BEZIER_UNLINKED:2,OPEN_SUBPATH_LENGTH:3,OPEN_SUBPATH_BEZIER_LINKED:4,OPEN_SUBPATH_BEZIER_UNLINKED:5,FILL_RULE:6,CLIPBOARD:7,INITIAL_FILL_RULE:8},A1=24,vh={2e3:{name:"PathInformation",description:fO},2999:{name:"ClippingPathName",description(e){const[,t]=zw(e,0);return t}}};function fO(e){const n={},i=[];for(let l=0;l<e.byteLength;l+=2+A1){const o=ze.getShortAt(e,l);wh[o]&&(n[o]||(n[o]=wh[o].description),i.push({type:o,path:wh[o].path(e,l+2)}))}return JSON.stringify({types:n,paths:i})}const wh={[da.CLOSED_SUBPATH_LENGTH]:{description:"Closed subpath length",path:(e,t)=>[ze.getShortAt(e,t)]},[da.CLOSED_SUBPATH_BEZIER_LINKED]:{description:"Closed subpath Bezier knot, linked",path:_c},[da.CLOSED_SUBPATH_BEZIER_UNLINKED]:{description:"Closed subpath Bezier knot, unlinked",path:_c},[da.OPEN_SUBPATH_LENGTH]:{description:"Open subpath length",path:(e,t)=>[ze.getShortAt(e,t)]},[da.OPEN_SUBPATH_BEZIER_LINKED]:{description:"Open subpath Bezier knot, linked",path:_c},[da.OPEN_SUBPATH_BEZIER_UNLINKED]:{description:"Open subpath Bezier knot, unlinked",path:_c},[da.FILL_RULE]:{description:"Path fill rule",path:()=>[]},[da.INITIAL_FILL_RULE]:{description:"Initial fill rule",path:(e,t)=>[ze.getShortAt(e,t)]},[da.CLIPBOARD]:{description:"Clipboard",path:mO}};function _c(e,t){const i=[];for(let l=0;l<A1;l+=8)i.push(hO(e,t+l));return i}function hO(e,t){const n=Si(e,t,8);return[Si(e,t+4,8),n]}function mO(e,t){return[[Si(e,t,8),Si(e,t+4,8),Si(e,t+8,8),Si(e,t+12,8)],Si(e,t+16,8)]}function Si(e,t,n){const i=ze.getLongAt(e,t),l=i>>>31?-1:1,o=(i&2130706432)>>>32-n,u=i&parseInt(Hw("1",32-n),2);return l*i2(o.toString(2)+"."+a2(u.toString(2),32-n,"0"),2)}const pO={read:bO},T1="8BIM",gO=2,xO=4,ky=T1.length;function bO(e,t){const n=ny(new Uint8Array(e).buffer),i={};let l=0;for(;l<e.length;){const o=lt(n,l,ky);l+=ky;const u=ze.getShortAt(n,l);l+=gO;const{tagName:d,tagNameSize:m}=yO(n,l);l+=m;const h=ze.getLongAt(n,l);if(l+=xO,o===T1){const p=ny(n.buffer,l,h),g={id:u,value:lt(p,0,h)};if(vh[u]){try{g.description=vh[u].description(p)}catch{g.description="<no description formatter>"}i[d||vh[u].name]=g}else t&&(i[`undefined-${u}`]=g)}l+=h+h%2}return i}function yO(e,t){const[n,i]=zw(e,t);return{tagName:i,tagNameSize:1+n+(n%2===0?1:0)}}const Oy={desc:{name:"ICC Description"},cprt:{name:"ICC Copyright"},dmdd:{name:"ICC Device Model Description"},vued:{name:"ICC Viewing Conditions Description"},dmnd:{name:"ICC Device Manufacturer for Display"},tech:{name:"Technology"}},Iy={4:{name:"Preferred CMM type",value:(e,t)=>lt(e,t,4),description:e=>e!==null?Nh(e):""},8:{name:"Profile Version",value:(e,t)=>e.getUint8(t).toString(10)+"."+(e.getUint8(t+1)>>4).toString(10)+"."+(e.getUint8(t+1)%16).toString(10)},12:{name:"Profile/Device class",value:(e,t)=>lt(e,t,4),description:e=>{switch(e.toLowerCase()){case"scnr":return"Input Device profile";case"mntr":return"Display Device profile";case"prtr":return"Output Device profile";case"link":return"DeviceLink profile";case"abst":return"Abstract profile";case"spac":return"ColorSpace profile";case"nmcl":return"NamedColor profile";case"cenc":return"ColorEncodingSpace profile";case"mid ":return"MultiplexIdentification profile";case"mlnk":return"MultiplexLink profile";case"mvis":return"MultiplexVisualization profile";default:return e}}},16:{name:"Color Space",value:(e,t)=>lt(e,t,4)},20:{name:"Connection Space",value:(e,t)=>lt(e,t,4)},24:{name:"ICC Profile Date",value:(e,t)=>vO(e,t).toISOString()},36:{name:"ICC Signature",value:(e,t)=>wO(e.buffer.slice(t,t+4))},40:{name:"Primary Platform",value:(e,t)=>lt(e,t,4),description:e=>Nh(e)},48:{name:"Device Manufacturer",value:(e,t)=>lt(e,t,4),description:e=>Nh(e)},52:{name:"Device Model Number",value:(e,t)=>lt(e,t,4)},64:{name:"Rendering Intent",value:(e,t)=>e.getUint32(t),description:e=>{switch(e){case 0:return"Perceptual";case 1:return"Relative Colorimetric";case 2:return"Saturation";case 3:return"Absolute Colorimetric";default:return e}}},80:{name:"Profile Creator",value:(e,t)=>lt(e,t,4)}};function vO(e,t){const n=e.getUint16(t),i=e.getUint16(t+2)-1,l=e.getUint16(t+4),o=e.getUint16(t+6),u=e.getUint16(t+8),d=e.getUint16(t+10);return new Date(Date.UTC(n,i,l,o,u,d))}function wO(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function Nh(e){switch(e.toLowerCase()){case"appl":return"Apple";case"adbe":return"Adobe";case"msft":return"Microsoft";case"sunw":return"Sun Microsystems";case"sgi":return"Silicon Graphics";case"tgnt":return"Taligent";default:return e}}const Dy={read:kO},NO=84,SO=128,CO="acsp",jO="desc",EO="mluc",AO="text",TO="sig ",_O=12;function kO(e,t,n){return n&&t[0].compressionMethod!==cu?OO(e,t):DO(e,t)}function OO(e,t){if(!IO(t[0].compressionMethod))return{};const n=new DataView(e.buffer.slice(t[0].offset,t[0].offset+t[0].length));return Gw(n,t[0].compressionMethod,"dataview").then(_1).catch(()=>({}))}function IO(e){return e===Ww}function DO(e,t){try{const n=t.reduce((u,d)=>u+d.length,0),i=new Uint8Array(n);let l=0;const o=LO(e);for(let u=1;u<=t.length;u++){const d=t.find(p=>p.chunkNumber===u);if(!d)throw new Error(`ICC chunk ${u} not found`);const m=o.slice(d.offset,d.offset+d.length),h=new Uint8Array(m);i.set(h,l),l+=h.length}return _1(new DataView(i.buffer))}catch{return{}}}function LO(e){return Array.isArray(e)?new DataView(Uint8Array.from(e).buffer).buffer:e.buffer}function RO(e){return e.length<SO+4}function MO(e,t){return e.length<t+_O}function _1(e){const t=e.buffer,n=e.getUint32();if(e.byteLength!==n)throw new Error("ICC profile length not matching");if(e.length<NO)throw new Error("ICC profile too short");const i={},l=Object.keys(Iy);for(let m=0;m<l.length;m++){const h=l[m],p=Iy[h],g=p.value(e,parseInt(h,10));let y=g;p.description&&(y=p.description(g)),i[p.name]={value:g,description:y}}if(kc(t.slice(36,40))!==CO)throw new Error("ICC profile: missing signature");if(RO(t))return i;const u=e.getUint32(128);let d=132;for(let m=0;m<u;m++){if(MO(t,d))return i;const h=lt(e,d,4),p=e.getUint32(d+4),g=e.getUint32(d+8);if(p>t.length)return i;const y=lt(e,p,4);if(y===jO){const x=e.getUint32(p+8);if(x>g)return i;const v=kc(t.slice(p+12,p+x+11));kl(i,h,v)}else if(y===EO){const x=e.getUint32(p+8),v=e.getUint32(p+12);let N=p+16;const j=[];for(let C=0;C<x;C++){const A=lt(e,N+0,2),_=lt(e,N+2,2),T=e.getUint32(N+4),L=e.getUint32(N+8),H=n2(e,p+L,T);j.push({languageCode:A,countryCode:_,text:H}),N+=v}if(x===1)kl(i,h,j[0].text);else{const C={};for(let A=0;A<j.length;A++)C[`${j[A].languageCode}-${j[A].countryCode}`]=j[A].text;kl(i,h,C)}}else if(y===AO){const x=kc(t.slice(p+8,p+g-7));kl(i,h,x)}else if(y===TO){const x=kc(t.slice(p+8,p+12));kl(i,h,x)}d=d+12}return i}function kc(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function kl(e,t,n){Oy[t]?e[Oy[t].name]={value:n,description:n}:e[t]={value:n,description:n}}const FO={read:PO};function PO(e,t){return{"Image Width":$O(e,t),"Image Height":zO(e,t),"Bit Depth":UO(e,t),"Color Type":BO(e,t),Compression:HO(e,t),Filter:WO(e,t),Interlace:GO(e,t)}}function $O(e,t){if(t+0+4>e.byteLength)return;const l=ze.getLongAt(e,t);return{value:l,description:`${l}px`}}function zO(e,t){if(t+4+4>e.byteLength)return;const l=ze.getLongAt(e,t+4);return{value:l,description:`${l}px`}}function UO(e,t){if(t+8+1>e.byteLength)return;const l=ze.getByteAt(e,t+8);return{value:l,description:`${l}`}}function BO(e,t){const l={0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha"};if(t+9+1>e.byteLength)return;const o=ze.getByteAt(e,t+9);return{value:o,description:l[o]||"Unknown"}}function HO(e,t){if(t+10+1>e.byteLength)return;const l=ze.getByteAt(e,t+10);return{value:l,description:l===0?"Deflate/Inflate":"Unknown"}}function WO(e,t){if(t+11+1>e.byteLength)return;const l=ze.getByteAt(e,t+11);return{value:l,description:l===0?"Adaptive":"Unknown"}}function GO(e,t){const l={0:"Noninterlaced",1:"Adam7 Interlace"};if(t+12+1>e.byteLength)return;const o=ze.getByteAt(e,t+12);return{value:o,description:l[o]||"Unknown"}}const YO={read:ZO},Om="STATE_KEYWORD",Im="STATE_COMPRESSION",Dm="STATE_LANG",qO="STATE_TRANSLATED_KEYWORD",Lm="STATE_TEXT",VO=1,KO=1,XO=6;function ZO(e,t,n,i){const l={},o=[];for(let u=0;u<t.length;u++){const{offset:d,length:m,type:h}=t[u],p=JO(e,d,m,h,n);if(p instanceof Promise)o.push(p.then(({name:g,value:y,description:x})=>{try{if(sy.USE_EXIF&&sI(g,y))return{__exif:u1.read(Ry(y),XO,i)};if(sy.USE_IPTC&&aI(g,y))return{__iptc:_m.read(Ry(y),0,i)};if(g)return{[g]:{value:y,description:x}}}catch{}return{}}));else{const{name:g,value:y,description:x}=p;g&&(l[g]={value:y,description:x})}}return{readTags:l,readTagsPromise:o.length>0?Promise.all(o):void 0}}function JO(e,t,n,i,l){const o=[],u=[];let d,m=Om,h=cu;for(let g=0;g<n&&t+g<e.byteLength;g++){if(m===Im){h=QO({type:i,dataView:e,offset:t+g}),i===_i&&(g+=VO),m=Ly(i,m);continue}else if(m===Lm){d=new DataView(e.buffer.slice(t+g,t+n));break}const y=e.getUint8(t+g);y===0?m=Ly(i,m):m===Om?o.push(y):m===Dm&&u.push(y)}if(h!==cu&&!l)return{};const p=Gw(d,h);return p instanceof Promise?p.then(g=>Sh(g,i,u,o)).catch(()=>Sh("<text using unknown compression>".split(""),i,u,o)):Sh(p,i,u,o)}function QO({type:e,dataView:t,offset:n}){if(e===_i){if(t.getUint8(n)===KO)return t.getUint8(n+1)}else if(e===rp)return t.getUint8(n);return cu}function Ly(e,t){return t===Om&&[_i,rp].includes(e)?Im:t===Im?e===_i?Dm:Lm:t===Dm?qO:Lm}function Sh(e,t,n,i){const l=tI(e);return{name:eI(t,n,i),value:l,description:t===_i?nI(e):l}}function eI(e,t,n){const i=_r(n);if(e===Zw||t.length===0)return i;const l=_r(t);return`${i} (${l})`}function tI(e){return e instanceof DataView?lt(e,0,e.byteLength):e}function nI(e){return d1.decode("UTF-8",e)}function sI(e,t){return e.toLowerCase()==="raw profile type exif"&&t.substring(1,5)==="exif"}function aI(e,t){return e.toLowerCase()==="raw profile type iptc"&&t.substring(1,5)==="iptc"}function Ry(e){const t=e.match(/\n(exif|iptc)\n\s*\d+\n([\s\S]*)$/);return iI(t[2].replace(/\n/g,""))}function iI(e){const t=new DataView(new ArrayBuffer(e.length/2));for(let n=0;n<e.length;n+=2)t.setUint8(n/2,parseInt(e.substring(n,n+2),16));return t}const rI={read:lI};function lI(e,t){const n={};for(let i=0;i<t.length;i++){const l=ze.getLongAt(e,t[i]+wr),o=lt(e,t[i]+ni,_s);o===Jw?(n["Pixels Per Unit X"]=oI(e,t[i],l),n["Pixels Per Unit Y"]=cI(e,t[i],l),n["Pixel Units"]=uI(e,t[i],l)):o===Qw&&(n["Modify Date"]=dI(e,t[i],l))}return n}function oI(e,t,n){if(!Ru(e,t,n,0,4))return;const o=ze.getLongAt(e,t+En+0);return{value:o,description:""+o}}function cI(e,t,n){if(!Ru(e,t,n,4,4))return;const o=ze.getLongAt(e,t+En+4);return{value:o,description:""+o}}function uI(e,t,n){if(!Ru(e,t,n,8,1))return;const o=ze.getByteAt(e,t+En+8);return{value:o,description:o===1?"meters":"Unknown"}}function dI(e,t,n){if(!Ru(e,t,n,0,7))return;const l=ze.getShortAt(e,t+En),o=ze.getByteAt(e,t+En+2),u=ze.getByteAt(e,t+En+3),d=ze.getByteAt(e,t+En+4),m=ze.getByteAt(e,t+En+5),h=ze.getByteAt(e,t+En+6);return{value:[l,o,u,d,m,h],description:`${br(l,4)}-${br(o,2)}-${br(u,2)} ${br(d,2)}:${br(m,2)}:${br(h,2)}`}}function Ru(e,t,n,i,l){return i+l<=n&&t+En+i+l<=e.byteLength}function br(e,t){return`${"0".repeat(t-(""+e).length)}${e}`}const fI={read:pI},hI=4,mI=7;function pI(e,t){const n={},i=ze.getByteAt(e,t);return n.Alpha=gI(i),n.Animation=xI(i),n.ImageWidth=My(e,t+hI),n.ImageHeight=My(e,t+mI),n}function gI(e){const t=e&16;return{value:t?1:0,description:t?"Yes":"No"}}function xI(e){const t=e&2;return{value:t?1:0,description:t?"Yes":"No"}}function My(e,t){const n=ze.getByteAt(e,t)+256*ze.getByteAt(e,t+1)+65536*ze.getByteAt(e,t+2)+1;return{value:n,description:n+"px"}}const bI={read:yI};function yI(e){return{"GIF Version":vI(e),"Image Width":wI(e),"Image Height":NI(e),"Global Color Map":SI(e),"Bits Per Pixel":jI(e),"Color Resolution Depth":CI(e)}}function vI(e){if(6>e.byteLength)return;const i=lt(e,3,3);return{value:i,description:i}}function wI(e){if(8>e.byteLength)return;const i=e.getUint16(6,!0);return{value:i,description:`${i}px`}}function NI(e){if(10>e.byteLength)return;const i=e.getUint16(8,!0);return{value:i,description:`${i}px`}}function SI(e){if(11>e.byteLength)return;const l=(e.getUint8(10)&128)>>>7;return{value:l,description:l===1?"Yes":"No"}}function CI(e){if(11>e.byteLength)return;const l=((e.getUint8(10)&112)>>>4)+1;return{value:l,description:`${l} ${l===1?"bit":"bits"}`}}function jI(e){if(11>e.byteLength)return;const l=(e.getUint8(10)&7)+1;return{value:l,description:`${l} ${l===1?"bit":"bits"}`}}const EI=[6,7,99],AI={get:TI};function TI(e,t,n){if(_I(t)){t.type="image/jpeg";const i=n+t.JPEGInterchangeFormat.value;t.image=e.buffer.slice(i,i+t.JPEGInterchangeFormatLength.value),Uw(t,"base64",function(){return Bw(this.image)})}return t}function _I(e){return e&&(e.Compression===void 0||EI.includes(e.Compression.value))&&e.JPEGInterchangeFormat&&e.JPEGInterchangeFormat.value&&e.JPEGInterchangeFormatLength&&e.JPEGInterchangeFormatLength.value}function k1(e){this.name="MetadataMissingError",this.message=e||"No Exif data",this.stack=new Error().stack}k1.prototype=new Error;const O1={MetadataMissingError:k1},kI={load:OI,loadView:I1,errors:O1};function OI(e,t={}){return II(e)?(t.async=!0,DI(e,t).then(n=>Ch(n,t))):zI(e)?(t.async=!0,UI(e).then(n=>Ch(n,t))):Ch(e,t)}function II(e){return typeof e=="string"}function DI(e,t){return/^\w+:\/\//.test(e)?typeof fetch<"u"?LI(e,t):RI(e,t):FI(e)?Promise.resolve(s2(e)):PI(e,t)}function LI(e,{length:t}={}){const n={method:"GET"};return Number.isInteger(t)&&t>=0&&(n.headers={range:`bytes=0-${t-1}`}),fetch(e,n).then(i=>i.arrayBuffer())}function RI(e,{length:t}={}){return new Promise((n,i)=>{const l={};Number.isInteger(t)&&t>=0&&(l.headers={range:`bytes=0-${t-1}`}),MI(e)(e,l,u=>{if(u.statusCode>=200&&u.statusCode<=299){const d=[];u.on("data",m=>d.push(Buffer.from(m))),u.on("error",m=>i(m)),u.on("end",()=>n(Buffer.concat(d)))}else i(`Could not fetch file: ${u.statusCode} ${u.statusMessage}`),u.resume()}).on("error",u=>i(u))})}function MI(e){return/^https:\/\//.test(e)?__non_webpack_require__("https").get:__non_webpack_require__("http").get}function FI(e){return/^data:[^;,]*(;base64)?,/.test(e)}function PI(e,{length:t}={}){return new Promise((n,i)=>{const l=$I();l.open(e,(o,u)=>{o?i(o):l.stat(e,(d,m)=>{if(d)i(d);else{const h=Math.min(m.size,t!==void 0?t:m.size),p=Buffer.alloc(h),g={buffer:p,length:h};l.read(u,g,y=>{y?i(y):l.close(u,x=>{x&&console.warn(`Could not close file ${e}:`,x),n(p)})})}})})})}function $I(){try{return __non_webpack_require__("fs")}catch{return}}function zI(e){return typeof window<"u"&&typeof File<"u"&&e instanceof File}function UI(e){return new Promise((t,n)=>{const i=new FileReader;i.onload=l=>t(l.target.result),i.onerror=()=>n(i.error),i.readAsArrayBuffer(e)})}function Ch(e,t){return BI(e)&&(e=new Uint8Array(e).buffer),I1(HI(e),t)}function BI(e){try{return Buffer.isBuffer(e)}catch{return!1}}function HI(e){try{return new DataView(e)}catch{return new $w(e)}}function I1(e,{expanded:t=!1,async:n=!1,includeUnknown:i=!1}={expanded:!1,async:!1,includeUnknown:!1}){let l=!1,o={};const u=[],{fileType:d,fileDataOffset:m,jfifDataOffset:h,tiffHeaderOffset:p,iptcDataOffset:g,xmpChunks:y,iccChunks:x,mpfDataOffset:v,pngHeaderOffset:N,pngTextChunks:j,pngChunkOffsets:C,vp8xChunkOffset:A,gifHeaderOffset:_}=p_.parseAppMarkers(e,n);if(WI(m)){l=!0;const k=K_.read(e,m);t?o.file=k:o=wt({},o,k)}if(GI(h)){l=!0;const k=ik.read(e,h);t?o.jfif=k:o=wt({},o,k)}if(YI(p)){l=!0;const k=u1.read(e,p,i);if(k.Thumbnail&&(o.Thumbnail=k.Thumbnail,delete k.Thumbnail),t?(o.exif=k,qI(o)):o=wt({},o,k),k["IPTC-NAA"]&&!Fy(g)){const R=_m.read(k["IPTC-NAA"].value,0,i);t?o.iptc=R:o=wt({},o,R)}if(k.ApplicationNotes&&!Py(y)){const R=_y.read(_r(k.ApplicationNotes.value));t?o.xmp=R:(delete R._raw,o=wt({},o,R))}if(k.ImageSourceData){const R=pO.read(k.PhotoshopSettings.value,i);t?o.photoshop=R:o=wt({},o,R)}if(k.ICC_Profile&&!$y(x)){const R=Dy.read(k.ICC_Profile.value,[{offset:0,length:k.ICC_Profile.value.length,chunkNumber:1,chunksTotal:1}]);t?o.icc=R:o=wt({},o,R)}}if(Fy(g)){l=!0;const k=_m.read(e,g,i);t?o.iptc=k:o=wt({},o,k)}if(Py(y)){l=!0;const k=_y.read(e,y);t?o.xmp=k:(delete k._raw,o=wt({},o,k))}if($y(x)){l=!0;const k=Dy.read(e,x,n);k instanceof Promise?u.push(k.then(L)):L(k)}if(VI(v)){l=!0;const k=U_.read(e,v,i);t?o.mpf=k:o=wt({},o,k)}if(KI(N)){l=!0;const k=FO.read(e,N);t?(o.png=o.png?wt({},o.png,k):k,o.pngFile=k):o=wt({},o,k)}if(XI(j)){l=!0;const{readTags:k,readTagsPromise:R}=YO.read(e,j,n,i);H(k),R&&u.push(R.then(z=>z.forEach(H)))}if(ZI(C)){l=!0;const k=rI.read(e,C);t?o.png=o.png?wt({},o.png,k):k:o=wt({},o,k)}if(JI(A)){l=!0;const k=fI.read(e,A);t?o.riff=o.riff?wt({},o.riff,k):k:o=wt({},o,k)}if(QI(_)){l=!0;const k=bI.read(e,_);t?o.gif=o.gif?wt({},o.gif,k):k:o=wt({},o,k)}const T=AI.get(e,o.Thumbnail,p);if(T?(l=!0,o.Thumbnail=T):delete o.Thumbnail,d&&(t?(o.file||(o.file={}),o.file.FileType=d):o.FileType=d),!l)throw new O1.MetadataMissingError;if(n)return Promise.all(u).then(()=>o);return o;function L(k){t?o.icc=k:o=wt({},o,k)}function H(k){if(t){for(const R of["exif","iptc"]){const z=`__${R}`;k[z]&&(o[R]=o[R]?wt({},o.exif,k[z]):k[z],delete k[z])}o.png=o.png?wt({},o.png,k):k,o.pngText=o.pngText?wt({},o.png,k):k}else o=wt({},o,k.__exif?k.__exif:{},k.__iptc?k.__iptc:{},k)}}function WI(e){return e!==void 0}function GI(e){return e!==void 0}function YI(e){return e!==void 0}function qI(e){if(e.exif){if(e.exif.GPSLatitude&&e.exif.GPSLatitudeRef)try{e.gps=e.gps||{},e.gps.Latitude=uu(e.exif.GPSLatitude.value),e.exif.GPSLatitudeRef.value.join("")==="S"&&(e.gps.Latitude=-e.gps.Latitude)}catch{}if(e.exif.GPSLongitude&&e.exif.GPSLongitudeRef)try{e.gps=e.gps||{},e.gps.Longitude=uu(e.exif.GPSLongitude.value),e.exif.GPSLongitudeRef.value.join("")==="W"&&(e.gps.Longitude=-e.gps.Longitude)}catch{}if(e.exif.GPSAltitude&&e.exif.GPSAltitudeRef)try{e.gps=e.gps||{},e.gps.Altitude=e.exif.GPSAltitude.value[0]/e.exif.GPSAltitude.value[1],e.exif.GPSAltitudeRef.value===1&&(e.gps.Altitude=-e.gps.Altitude)}catch{}}}function Fy(e){return e!==void 0}function Py(e){return Array.isArray(e)&&e.length>0}function $y(e){return Array.isArray(e)&&e.length>0}function VI(e){return e!==void 0}function KI(e){return e!==void 0}function XI(e){return e!==void 0}function ZI(e){return e!==void 0}function JI(e){return e!==void 0}function QI(e){return e!==void 0}const D1=async e=>{if(!e.type.startsWith("image/"))return{};try{const t=await kI.load(e),n=[];let i;const l=t.DateTimeOriginal?.description;if(l){const p=l.replace(/^(\d{4}):(\d{2}):(\d{2})/,"$1-$2-$3").replace(" ","T")+"Z";isNaN(Date.parse(p))||(i=p,n.push({label:{en:["Date Created"]},value:{en:[l]}}))}const o=t.Make?.description,u=t.Model?.description;(o||u)&&n.push({label:{en:["Camera"]},value:{en:[[o,u].filter(Boolean).join(" ")]}});const d=t.GPSLatitude?.description,m=t.GPSLongitude?.description;d&&m&&n.push({label:{en:["Location"]},value:{en:[`${d}, ${m}`]}});const h=[];return t.ExposureTime?.description&&h.push(`Exposure: ${t.ExposureTime.description}`),t.FNumber?.description&&h.push(`Aperture: f/${t.FNumber.description}`),t.ISOSpeedRatings?.description&&h.push(`ISO: ${t.ISOSpeedRatings.description}`),h.length>0&&n.push({label:{en:["Technical"]},value:{en:[h.join(", ")]}}),{navDate:i,metadata:n.length>0?n:void 0}}catch(t){return console.warn(`[Metadata] Harvester failed for ${e.name}`,t),{}}},eD=()=>Nu.USE_WORKER_URL_CLEANUP!==!1;let Hc=null;function tD(e){Hc=e}function nD(){Hc&&(Hc(),Hc=null,console.log("[tileWorker] Worker blob URL cleaned up"))}const sD=`
  self.onmessage = async function(e) {
    const { type, assetId, imageData, mimeType, sizes, quality = 0.8 } = e.data;

    if (type !== 'generate' && type !== 'generateBatch') {
      self.postMessage({ type: 'error', assetId, message: 'Unknown message type' });
      return;
    }

    try {
      // Create ImageBitmap from the raw data
      const blob = new Blob([imageData], { type: mimeType });
      const bitmap = await createImageBitmap(blob);
      const { width: originalWidth, height: originalHeight } = bitmap;

      const derivatives = {};
      const totalSizes = sizes.length;

      for (let i = 0; i < sizes.length; i++) {
        const targetWidth = sizes[i];

        // Skip if target is larger than original
        if (targetWidth >= originalWidth) {
          continue;
        }

        // Calculate proportional height
        const ratio = originalHeight / originalWidth;
        const targetHeight = Math.floor(targetWidth * ratio);

        // Create canvas and draw resized image
        const canvas = new OffscreenCanvas(targetWidth, targetHeight);
        const ctx = canvas.getContext('2d');

        if (!ctx) {
          throw new Error('Failed to get canvas context');
        }

        // Use high-quality image smoothing
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';
        ctx.drawImage(bitmap, 0, 0, targetWidth, targetHeight);

        // Convert to JPEG blob
        const derivativeBlob = await canvas.convertToBlob({
          type: 'image/jpeg',
          quality: quality
        });

        // Convert blob to ArrayBuffer for transfer
        const arrayBuffer = await derivativeBlob.arrayBuffer();
        derivatives[targetWidth] = arrayBuffer;

        // Report progress
        self.postMessage({
          type: 'progress',
          assetId,
          currentSize: targetWidth,
          percent: Math.round(((i + 1) / totalSizes) * 100)
        });
      }

      // Clean up
      bitmap.close();

      // Send complete result with transferable ArrayBuffers
      const transferList = Object.values(derivatives);
      self.postMessage({
        type: 'complete',
        assetId,
        derivatives,
        originalWidth,
        originalHeight
      }, transferList);

    } catch (error) {
      self.postMessage({
        type: 'error',
        assetId,
        message: error.message || 'Unknown error during tile generation'
      });
    }
  };
`,aD=new Blob([sD],{type:"application/javascript"}),L1=URL.createObjectURL(aD);tD(()=>{try{URL.revokeObjectURL(L1)}catch(e){console.warn("[tileWorker] Failed to revoke worker blob URL:",e)}});typeof window<"u"&&eD()&&window.addEventListener("beforeunload",nD,{once:!0});class iD{constructor(t=Math.min(navigator.hardwareConcurrency||4,4)){this.workers=[],this.queue=[],this.activeJobs=new Map,this.maxConcurrent=4,this.activeWorkers=0,this.poolSize=Math.min(t,this.maxConcurrent),this.initWorkers()}initWorkers(){for(let t=0;t<this.poolSize;t++){const n=new Worker(L1);n.onmessage=this.handleWorkerMessage.bind(this),n.onerror=this.handleWorkerError.bind(this),this.workers.push(n)}}handleWorkerMessage(t){const{type:n,assetId:i}=t.data;if(n==="progress")return;const l=this.activeJobs.get(i);if(l){if(n==="complete"){const o=t.data,u=new Map;for(const[d,m]of Object.entries(o.derivatives))u.set(parseInt(d),new Blob([m],{type:"image/jpeg"}));l.resolve({derivatives:u,originalWidth:o.originalWidth,originalHeight:o.originalHeight})}else n==="error"&&l.reject(new Error(t.data.message));this.activeJobs.delete(i),this.activeWorkers--,this.processQueue()}}handleWorkerError(t){console.error("Tile worker error:",t)}processQueue(){for(;this.queue.length>0&&this.activeWorkers<this.maxConcurrent;){this.queue.sort((i,l)=>i.priority!==l.priority?l.priority-i.priority:i.timestamp-l.timestamp);const t=this.queue.shift();if(!t)continue;const n=this.workers.find(i=>!Array.from(this.activeJobs.values()).some(l=>!1))||this.workers[this.activeWorkers%this.poolSize];if(n){this.activeWorkers++,this.activeJobs.set(t.request.assetId,{resolve:t.resolve,reject:t.reject});try{n.postMessage(t.request,[t.request.imageData])}catch{n.postMessage(t.request)}}else{this.queue.unshift(t);break}}}getQueueStats(){return{queueLength:this.queue.length,activeWorkers:this.activeWorkers,maxConcurrent:this.maxConcurrent}}async flush(){if(!(this.queue.length===0&&this.activeWorkers===0))return new Promise(t=>{const n=setInterval(()=>{this.queue.length===0&&this.activeWorkers===0&&(clearInterval(n),t())},100)})}async generateDerivatives(t,n,i=Pl,l=1){const o=await n.arrayBuffer();return new Promise((u,d)=>{const m={type:"generate",assetId:t,imageData:o,mimeType:n.type||"image/jpeg",sizes:i,quality:.8},h={request:m,resolve:u,reject:d,priority:l,timestamp:Date.now()};if(this.activeWorkers<this.maxConcurrent){this.activeWorkers++,this.activeJobs.set(t,{resolve:u,reject:d});const p=this.workers[this.activeJobs.size%this.poolSize];try{p.postMessage(m,[o])}catch{p.postMessage(m)}}else this.queue.push(h)})}async generateDerivativesBatch(t,n=Pl,i){const l=new Map,o=t.length;let u=0;const d=this.maxConcurrent*2;for(let m=0;m<t.length;m+=d){const p=t.slice(m,m+d).map(async({assetId:g,file:y,priority:x=1})=>{try{const v=await this.generateDerivatives(g,y,n,x);return l.set(g,v),u++,i?.(u,o),{assetId:g,success:!0}}catch(v){return u++,i?.(u,o),{assetId:g,success:!1,error:v}}});await Promise.all(p)}return l}terminate(){this.workers.forEach(t=>t.terminate()),this.workers=[],this.queue=[],this.activeJobs.clear()}}let jh=null;function rD(){return jh||(jh=new iD),jh}const lD="biiif-integrity-db",oD=1;async function Eh(e){let t;e instanceof Blob?t=await e.arrayBuffer():t=e;const n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("")}class cD{constructor(){this.dbPromise=tp(lD,oD,{upgrade(t){t.objectStoreNames.contains("fingerprints")||t.createObjectStore("fingerprints"),t.objectStoreNames.contains("entityHashes")||t.createObjectStore("entityHashes"),t.objectStoreNames.contains("filenameIndex")||t.createObjectStore("filenameIndex")}})}async registerFile(t,n,i){const l=await Eh(t),o=await this.dbPromise,u=await o.get("fingerprints",l);if(u)return u.entityIds.includes(n)||u.entityIds.push(n),i&&!u.filenames.includes(i)&&u.filenames.push(i),u.lastVerified=Date.now(),await o.put("fingerprints",u,l),await o.put("entityHashes",l,n),{exists:!0,fingerprint:u,isDuplicate:!0,existingEntityId:u.entityIds[0]};const d={hash:l,size:t.size,mimeType:t.type||"application/octet-stream",firstSeen:Date.now(),lastVerified:Date.now(),entityIds:[n],filenames:i?[i]:[]};if(await o.put("fingerprints",d,l),await o.put("entityHashes",l,n),i){const m=await o.get("filenameIndex",i)||[];m.includes(l)||(m.push(l),await o.put("filenameIndex",m,i))}return{exists:!1,fingerprint:d,isDuplicate:!1}}async getFingerprint(t){return(await this.dbPromise).get("fingerprints",t)}async getHashForEntity(t){return(await this.dbPromise).get("entityHashes",t)}async findByFilename(t){const n=await this.dbPromise,i=await n.get("filenameIndex",t)||[],l=[];for(const o of i){const u=await n.get("fingerprints",o);u&&l.push(u)}return l}async verifyFile(t,n){const i=await this.dbPromise,l=await i.get("entityHashes",t);if(!l)return{id:t,status:"missing"};const o=await Eh(n);if(o===l){const d=await i.get("fingerprints",l);return d&&(d.lastVerified=Date.now(),await i.put("fingerprints",d,l)),{id:t,status:"valid",expectedHash:l,actualHash:o}}const u=await i.get("fingerprints",o);return u?{id:t,status:"moved",expectedHash:l,actualHash:o,suggestedPath:u.filenames[0]}:{id:t,status:"corrupted",expectedHash:l,actualHash:o}}async checkDuplicate(t){const n=await Eh(t),l=await(await this.dbPromise).get("fingerprints",n);return l?{exists:!0,fingerprint:l,isDuplicate:!0,existingEntityId:l.entityIds[0]}:{exists:!1,isDuplicate:!1}}async removeEntityAssociation(t){const n=await this.dbPromise,i=await n.get("entityHashes",t);if(i){const l=await n.get("fingerprints",i);l&&(l.entityIds=l.entityIds.filter(o=>o!==t),l.entityIds.length===0?await n.delete("fingerprints",i):await n.put("fingerprints",l,i)),await n.delete("entityHashes",t)}}async getAllFingerprints(){return(await this.dbPromise).getAll("fingerprints")}async getStats(){const t=await this.getAllFingerprints();let n=0,i=0,l=Date.now();for(const o of t)n+=o.size,i+=Math.max(0,o.entityIds.length-1),o.firstSeen<l&&(l=o.firstSeen);return{totalFiles:t.length,totalSize:n,duplicatesAvoided:i,oldestFile:l}}async clear(){const t=await this.dbPromise;await t.clear("fingerprints"),await t.clear("entityHashes"),await t.clear("filenameIndex")}async export(){const t=await this.dbPromise,n={},i={},l=await t.getAll("fingerprints"),o=await t.getAllKeys("fingerprints");for(let m=0;m<o.length;m++)n[o[m]]=l[m];const u=await t.getAll("entityHashes"),d=await t.getAllKeys("entityHashes");for(let m=0;m<d.length;m++)i[d[m]]=u[m];return{fingerprints:n,entityHashes:i}}}const R1=new cD;var uD={};class dD{constructor(t={}){this.fileRefs=new Map,this.cleanedUpCount=0,this.debugMode=t.debug??!1}register(t,n,i){return!t||!n?(this.warn("Cannot register: missing entityId or file"),!1):(this.fileRefs.has(t)&&this.cleanupEntity(t),this.fileRefs.set(t,{entityId:t,file:n,registeredAt:Date.now(),onBeforeCleanup:i}),this.log(`Registered file reference for ${t}`,{size:n.size,name:n.name}),!0)}cleanupEntity(t){const n=this.fileRefs.get(t);if(!n)return!1;if(n.onBeforeCleanup)try{n.onBeforeCleanup()}catch(i){this.warn(`Pre-cleanup callback failed for ${t}:`,i)}return this.fileRefs.delete(t),this.cleanedUpCount++,this.log(`Cleaned up file reference for ${t}`,{heldFor:Date.now()-n.registeredAt,size:n.file.size}),!0}cleanupEntities(t){let n=0;for(const i of t)this.cleanupEntity(i)&&n++;return n>0&&this.log(`Batch cleanup: ${n} references removed`),n}hasReference(t){return this.fileRefs.has(t)}getFile(t){return this.fileRefs.get(t)?.file}getStats(){let t=0;return this.fileRefs.forEach(n=>{t+=n.file.size}),{activeRefs:this.fileRefs.size,totalSize:t,cleanedUpCount:this.cleanedUpCount}}getTrackedEntityIds(){return Array.from(this.fileRefs.keys())}dispose(){const t=this.fileRefs.size;this.fileRefs.forEach((n,i)=>{if(n.onBeforeCleanup)try{n.onBeforeCleanup()}catch{}}),this.fileRefs.clear(),this.cleanedUpCount+=t,this.log(`Disposed: ${t} references cleared`)}log(...t){this.debugMode&&console.log("[FileLifecycleManager]",...t)}warn(...t){console.warn("[FileLifecycleManager]",...t)}}let Ah=null;function M1(){if(!Ah){const e=typeof process<"u"&&uD&&!1;Ah=new dD({debug:e})}return Ah}const zy=4,fD=100,hD=10,mD=100;class pD{constructor(t=Math.min(navigator.hardwareConcurrency||4,zy)){this.workers=[],this.queue=[],this.activeJobs=new Map,this.activeWorkers=0,this.operationStats=new Map,this.pendingWrites=[],this.batchWriteTimer=null,this.completedTasks=0,this.failedTasks=0,this.workerScriptUrl=null,this.poolSize=Math.min(t,zy),this.initWorkers(),this.startBatchWriteLoop()}initWorkers(){const t=this.generateWorkerScript(),n=new Blob([t],{type:"application/javascript"});this.workerScriptUrl=URL.createObjectURL(n);for(let i=0;i<this.poolSize;i++)this.createWorker()}createWorker(){const t=new Worker(this.workerScriptUrl,{type:"module"});return t.onmessage=n=>{this.handleWorkerMessage(n.data)},t.onerror=n=>{console.error("[IngestWorkerPool] Worker error:",n)},this.workers.push(t),t}generateWorkerScript(){return`
      import '${typeof window<"u"?new URL("../workers/ingest.worker.ts",window.location.href).href:""}';
    `}handleWorkerMessage(t){switch(t.type){case"INGEST_PROGRESS":{const{operationId:n,fileId:i,progress:l,stage:o,overallProgress:u}=t.payload,d=this.operationStats.get(n);d&&(d.stage=o);const m=this.findOperation(n);m?.onProgress&&m.onProgress({operationId:n,stage:o,stageProgress:u,filesTotal:d?.totalFiles||0,filesCompleted:d?.completedFiles||0,filesProcessing:0,filesError:d?.failedFiles||0,files:[l],speed:0,etaSeconds:0,startedAt:d?.startTime||Date.now(),updatedAt:Date.now(),isPaused:!1,isCancelled:!1,activityLog:[],overallProgress:u,currentFile:l});break}case"INGEST_FILE_COMPLETE":{const{operationId:n,fileId:i,canvas:l,assetId:o,thumbnailBlob:u}=t.payload;u&&this.queueAssetWrite(l._fileRef,o,u);const d=this.operationStats.get(n);d&&d.completedFiles++,this.completedTasks++,this.activeWorkers--,this.processQueue();break}case"INGEST_NODE_COMPLETE":{const{operationId:n}=t.payload,i=this.activeJobs.get(n);i&&(i.resolve(t.payload),this.activeJobs.delete(n)),this.activeWorkers--,this.processQueue();break}case"INGEST_COMPLETE":{const{operationId:n,root:i,stats:l}=t.payload;this.flushPendingWrites();const o=this.activeJobs.get(n);o&&(o.resolve({root:i,stats:l}),this.activeJobs.delete(n)),this.operationStats.delete(n),this.activeWorkers--,this.processQueue();break}case"INGEST_ERROR":{const{operationId:n,fileId:i,error:l,recoverable:o}=t.payload,u=this.operationStats.get(n);if(u&&u.failedFiles++,this.failedTasks++,!o){const d=this.activeJobs.get(n);d&&(d.reject(new Error(l)),this.activeJobs.delete(n)),this.operationStats.delete(n)}this.activeWorkers--,this.processQueue();break}}}findOperation(t){}startBatchWriteLoop(){this.batchWriteTimer=setInterval(()=>{this.flushPendingWrites()},mD)}queueAssetWrite(t,n,i){this.pendingWrites.push({file:t,assetId:n,thumbnailBlob:i}),this.pendingWrites.length>=hD&&this.flushPendingWrites()}async flushPendingWrites(){if(this.pendingWrites.length===0)return;const t=[...this.pendingWrites];this.pendingWrites=[];const n=3;for(let i=0;i<t.length;i+=n){const l=t.slice(i,i+n);await Promise.all(l.map(async({file:o,assetId:u,thumbnailBlob:d})=>{try{await qt.saveAsset(o,u),d&&await qt.saveDerivative(u,"thumb",d)}catch(m){console.error("[IngestWorkerPool] Failed to save asset:",u,m)}}))}}processQueue(){for(;this.queue.length>0&&this.activeWorkers<this.poolSize;){this.queue.sort((i,l)=>i.priority!==l.priority?l.priority-i.priority:i.timestamp-l.timestamp);const t=this.queue.shift();if(!t)continue;const n=this.workers[this.activeWorkers%this.poolSize];this.activeWorkers++,this.activeJobs.set(t.id,{resolve:t.resolve,reject:t.reject}),n.postMessage({type:t.type==="file"?"PROCESS_FILE":"PROCESS_NODE",payload:t.payload})}}getStats(){return{totalWorkers:this.poolSize,activeWorkers:this.activeWorkers,queueLength:this.queue.length,maxQueueSize:fD,completedTasks:this.completedTasks,failedTasks:this.failedTasks,batchedWrites:this.pendingWrites.length,operations:new Map(this.operationStats)}}async ingestFiles(t,n={}){const i=`ingest-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;this.operationStats.set(i,{operationId:i,startTime:Date.now(),totalFiles:t.length,completedFiles:0,failedFiles:0,stage:"initializing"});const l=this.workers.map(o=>new Promise(u=>{const d=m=>{m.data.type==="INGEST_INITIALIZED"&&(o.removeEventListener("message",d),u())};o.addEventListener("message",d),o.postMessage({type:"INIT_INGEST",payload:{operationId:i,totalFiles:t.length,baseUrl:this.getBaseUrl(),options:{generateThumbnails:n.generateThumbnails!==!1,extractMetadata:n.extractMetadata!==!1,calculateHashes:n.calculateHashes===!0}}})}));return await Promise.all(l),new Promise((o,u)=>{n.signal&&n.signal.addEventListener("abort",()=>{this.cancelOperation(i),u(new Error("Ingest operation cancelled"))}),this.activeJobs.set(i,{resolve:o,reject:u}),setTimeout(()=>{const d=this.operationStats.get(i);o({root:null,report:{manifestsCreated:0,collectionsCreated:0,canvasesCreated:0,filesProcessed:d?.completedFiles||0,warnings:[]}})},100)})}async ingestTree(t,n={}){const i=`ingest-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,l=this.countMediaFiles(t);return this.operationStats.set(i,{operationId:i,startTime:Date.now(),totalFiles:l,completedFiles:0,failedFiles:0,stage:"initializing"}),new Promise((o,u)=>{n.signal&&n.signal.addEventListener("abort",()=>{this.cancelOperation(i),u(new Error("Ingest operation cancelled"))});const d=this.workers[0];this.activeWorkers++,this.activeJobs.set(i,{resolve:m=>{const{root:h,stats:p}=m;o({root:h,report:{manifestsCreated:p.manifestsCreated||0,collectionsCreated:p.collectionsCreated||0,canvasesCreated:p.canvasesCreated||0,filesProcessed:p.filesProcessed||0,warnings:[]}})},reject:u}),d.postMessage({type:"INIT_INGEST",payload:{operationId:i,totalFiles:l,baseUrl:this.getBaseUrl(),options:{generateThumbnails:n.generateThumbnails!==!1,extractMetadata:n.extractMetadata!==!1,calculateHashes:n.calculateHashes===!0}}}),d.postMessage({type:"PROCESS_NODE",payload:{operationId:i,node:t,baseUrl:this.getBaseUrl()}})})}cancelOperation(t){this.operationStats.get(t)&&(this.workers.forEach(l=>{l.postMessage({type:"CANCEL_INGEST",payload:{operationId:t}})}),this.operationStats.delete(t));const i=this.activeJobs.get(t);i&&(i.reject(new Error("Operation cancelled")),this.activeJobs.delete(t))}async flush(){if(await this.flushPendingWrites(),!(this.queue.length===0&&this.activeWorkers===0))return new Promise(t=>{const n=setInterval(()=>{this.queue.length===0&&this.activeWorkers===0&&(clearInterval(n),t())},100)})}terminate(){this.batchWriteTimer&&(clearInterval(this.batchWriteTimer),this.batchWriteTimer=null),this.flushPendingWrites(),this.workers.forEach(t=>t.terminate()),this.workers=[],this.queue=[],this.activeJobs.clear(),this.workerScriptUrl&&(URL.revokeObjectURL(this.workerScriptUrl),this.workerScriptUrl=null)}getBaseUrl(){if(typeof window>"u")return"https://example.com/iiif";const t="/field-studio/".replace(/\/$/,"");return`${window.location.origin}${t}/iiif`}countMediaFiles(t){let n=0;for(const i of t.files.keys()){const l=i.split(".").pop()?.toLowerCase()||"",o=this.getMimeType(l);o&&o.motivation==="painting"&&n++}for(const i of t.directories.values())n+=this.countMediaFiles(i);return n}getMimeType(t){return{jpg:{format:"image/jpeg",type:"Image",motivation:"painting"},jpeg:{format:"image/jpeg",type:"Image",motivation:"painting"},png:{format:"image/png",type:"Image",motivation:"painting"},gif:{format:"image/gif",type:"Image",motivation:"painting"},webp:{format:"image/webp",type:"Image",motivation:"painting"},mp3:{format:"audio/mpeg",type:"Sound",motivation:"painting"},mp4:{format:"video/mp4",type:"Video",motivation:"painting"},webm:{format:"video/webm",type:"Video",motivation:"painting"},pdf:{format:"application/pdf",type:"Text",motivation:"painting"}}[t.toLowerCase()]}}let Th=null;function Rm(){return Th||(Th=new pD),Th}async function gD(e,t={}){return Rm().ingestTree(e,t)}function Mm(e,t){return{operationId:e,stage:"scanning",stageProgress:0,filesTotal:t,filesCompleted:0,filesProcessing:0,filesError:0,files:[],speed:0,etaSeconds:0,startedAt:Date.now(),updatedAt:Date.now(),isPaused:!1,isCancelled:!1,activityLog:[{timestamp:Date.now(),level:"info",message:"Ingest operation started"}],overallProgress:0}}function Ga(e,t,n){const i=e.files.findIndex(v=>v.id===t),l=[...e.files];i>=0&&(l[i]={...l[i],...n});const o=l.filter(v=>v.status==="completed").length,u=l.filter(v=>v.status==="processing").length,d=l.filter(v=>v.status==="error").length,m=(Date.now()-e.startedAt)/1e3,h=m>0?o/m:0,p=e.filesTotal-o,g=h>0?p/h:0,y=l.reduce((v,N)=>v+N.progress,0),x=e.filesTotal>0?Math.round(y/e.filesTotal):0;return{...e,files:l,filesCompleted:o,filesProcessing:u,filesError:d,speed:h,etaSeconds:Math.round(g),overallProgress:x,updatedAt:Date.now()}}function xD(e,t){const n=`file-${e.files.length}-${Date.now()}`,i={...t,id:n,status:"pending",progress:0};return{progress:{...e,files:[...e.files,i],updatedAt:Date.now()},fileId:n}}function Ya(e,t,n="info",i){const l={timestamp:Date.now(),level:n,message:t,fileId:i},o=[...e.activityLog,l].slice(-20);return{...e,activityLog:o,updatedAt:Date.now()}}function Fm(e,t,n=0){return{...e,stage:t,stageProgress:n,updatedAt:Date.now()}}function Uy(e){if(e?.aborted)throw new Error("Ingest operation cancelled")}async function By(e,t=100){for(;e.isPaused&&!e.isCancelled;)await new Promise(n=>setTimeout(n,t))}function _h(e,t){const n=e.currentFile?`${e.stage}: ${e.currentFile.name} (${e.filesCompleted}/${e.filesTotal})`:`${e.stage}: ${e.overallProgress}%`;t(n,e.overallProgress)}function kh(e){const t=(Date.now()-e.startedAt)/1e3;return{filesTotal:e.filesTotal,filesCompleted:e.filesCompleted,filesError:e.filesError,filesSkipped:e.files.filter(n=>n.status==="skipped").length,durationSeconds:Math.round(t*10)/10,averageSpeed:t>0?e.filesCompleted/t:0,wasCancelled:e.isCancelled}}const Hy=()=>Nu.USE_FILE_LIFECYCLE!==!1,bD=()=>typeof Worker<"u"&&typeof OffscreenCanvas<"u",jr=new Map;async function yD(e,t,n,i,l){const o=`ingest-${Date.now()}`,u=hu(e),d=Mm(o,u),m={operationId:o,progress:d,report:{...n},canvases:[],items:[],resolve:()=>{},reject:()=>{},onProgress:l};return jr.set(o,m),new Promise((h,p)=>{m.resolve=h,m.reject=p,i.signal&&i.signal.addEventListener("abort",()=>{Rm().cancelOperation(o),jr.delete(o),p(new Error("Ingest operation cancelled"))}),Rm().ingestTree(e,{generateThumbnails:!0,extractMetadata:!0,calculateHashes:!1,signal:i.signal,onProgress:l}).then(y=>{jr.delete(o),h(y)}).catch(y=>{jr.delete(o),p(y)})})}const zs=[];let Oh=!1;async function Wy(e){if(Oh||zs.length===0)return;Oh=!0;const t=rD(),n=zs.length;let i=0;for(;zs.length>0;){const l=zs.shift();if(l)try{const o=await t.generateDerivatives(l.assetId,l.file,l.sizes),u=ba();for(const[d,m]of o.derivatives){let h="medium";d===u.thumbnailWidth?h="thumb":d<u.fullWidth/2&&(h="small"),await qt.saveDerivative(l.assetId,h,m)}if(i++,e){const d=Math.round(i/n*100);e(`Pre-generating tiles (${i}/${n})...`,d)}}catch(o){console.warn(`Background tile generation failed for ${l.assetId}:`,o)}}Oh=!1}const F1=async(e,t)=>{try{const n=await createImageBitmap(e),i=n.height/n.width,l=Math.floor(t*i),o=new OffscreenCanvas(t,l),u=o.getContext("2d");return u?(u.drawImage(n,0,0,t,l),await o.convertToBlob({type:"image/jpeg",quality:Wv.preview})):null}catch{return null}};function hu(e){let t=0;for(const n of e.files.keys()){const i=n.split(".").pop()?.toLowerCase()||"",l=Ln[i];l&&l.motivation==="painting"&&t++}for(const n of e.directories.values())t+=hu(n);return t}const mu=async(e,t,n,i,l,o)=>{Uy(l.signal),await By(i);let u="Manifest";if(e.iiifIntent&&(e.iiifIntent==="Collection"||e.iiifIntent==="Manifest"))u=e.iiifIntent;else{const y=e.directories.size>0,x=e.name===ct.INGEST.ROOT_NAME||e.name.startsWith(ct.INGEST.COLLECTION_PREFIX),v=Array.from(e.files.keys()).filter(j=>{const C=j.split(".").pop()?.toLowerCase()||"";return!!Ln[C]});!y&&v.length>0?u="Manifest":x||y?u="Collection":v.length>0?u="Manifest":u="Collection"}let d={};if(e.files.has(ct.INGEST.META_FILE))try{const y=await e.files.get(ct.INGEST.META_FILE).text();d=Pw(y)||{}}catch{n.warnings.push(`Invalid ${ct.INGEST.META_FILE} in ${e.path}`),i=Ya(i,`Invalid metadata file in ${e.path}`,"warning")}let m=e.name.startsWith(ct.INGEST.COLLECTION_PREFIX)?e.name.substring(ct.INGEST.COLLECTION_PREFIX.length):e.name;m===ct.INGEST.ROOT_NAME&&(m=ct.INGEST.ROOT_DISPLAY_NAME);const h=qv(u,t),p=d.language||"none",g=d.label?{[p]:[d.label]}:{none:[m]};if(u==="Manifest"){const y=[],x=Array.from(e.files.keys()).sort(),v=new Map,N=[];if(x.forEach(A=>{const _=A.split("."),T=_.pop()?.toLowerCase()||"",L=_.join("."),H=Ln[T];H&&H.motivation==="painting"&&(v.has(L)||v.set(L,{main:e.files.get(A),supplemental:[]}))}),x.forEach(A=>{const _=A.split("."),T=_.pop()?.toLowerCase()||"",L=_.join(".");if(T==="txt"||T==="srt"||T==="vtt"){const H=e.files.get(A);v.has(L)?v.get(L).supplemental.push(H):N.push(H)}}),v.size>0){const A=Array.from(v.values()).filter(_=>_.supplemental.length>0).length;n.warnings.push(`Smart Sidecar: Detected ${A} paired files with transcriptions/captions`),i=Ya(i,`Detected ${A} files with sidecars`,"info")}N.length>0&&(n.warnings.push(`Smart Sidecar: Found ${N.length} orphaned .txt/.srt files`),i=Ya(i,`Found ${N.length} orphaned supplemental files`,"warning")),i=Fm(i,"processing"),o(i);const j=Array.from(v.keys()).sort();for(let A=0;A<j.length;A++){Uy(l.signal),await By(i);const _=j[A],{main:T,supplemental:L}=v.get(_),H=T.name.split(".").pop()?.toLowerCase()||"",{progress:k,fileId:R}=xD(i,{name:T.name,path:e.path?`${e.path}/${T.name}`:T.name,size:T.size,mimeType:T.type||Ln[H]?.format||"application/octet-stream"});i=k,i=Ga(i,R,{status:"processing",startedAt:Date.now(),progress:10}),i={...i,currentFile:i.files.find(K=>K.id===R)},o(i);const z=ct.ID_PATTERNS.CANVAS(h,y.length+1),P=`${h.split("/").pop()}-${T.name.replace(/[^a-zA-Z0-9-_]/g,"")}`;try{i=Ga(i,R,{progress:30}),o(i);const K=await R1.registerFile(T,z,T.name);if(K.isDuplicate&&K.existingEntityId){n.warnings.push(`Duplicate detected: "${T.name}" matches existing file (hash: ${K.fingerprint?.hash.substring(0,8)}...). Original entity: ${K.existingEntityId}.`),n.duplicatesSkipped=(n.duplicatesSkipped||0)+1,i=Ya(i,`Duplicate skipped: ${T.name}`,"warning",R),i=Ga(i,R,{status:"skipped",progress:100,completedAt:Date.now()}),o(i);continue}i=Ga(i,R,{progress:50}),o(i),await qt.saveAsset(T,P);let I=Qt.defaultCanvasWidth,D=Qt.defaultCanvasHeight;if(T.type.startsWith("image/")){try{const Q=await createImageBitmap(T);I=Q.width,D=Q.height,Q.close()}catch{console.warn(`Could not read image dimensions for ${T.name}, using defaults`)}const Y=ba();i=Ga(i,R,{progress:70}),o(i);const X=await F1(T,Y.thumbnailWidth);X&&await qt.saveDerivative(P,"thumb",X),zs.push({assetId:P,file:T,sizes:Y.sizes.filter(Q=>Q>Y.thumbnailWidth)})}i=Ga(i,R,{progress:80}),o(i);const E=await D1(T),q=Ln[H]?.type||"Image",W=q==="Image",G=ba(),te=W?[{id:`${ct.ID_PATTERNS.IMAGE_SERVICE(t,P)}/full/${G.thumbnailWidth},/0/default.jpg`,type:"Image",format:"image/jpeg",width:G.thumbnailWidth}]:void 0,U={id:`${z}/annotation/painting`,type:"Annotation",label:{none:["Content Resource"]},motivation:"painting",target:z,body:{id:`${ct.ID_PATTERNS.IMAGE_SERVICE(t,P)}/full/max/0/default.jpg`,type:q,format:Ln[H]?.format||"image/jpeg",service:W?[au(ct.ID_PATTERNS.IMAGE_SERVICE(t,P),"level2")]:void 0}},V=[{id:`${z}/page/painting`,type:"AnnotationPage",label:{none:["Painting Page"]},items:[U]}],O=[];if(L.length>0){const Y={id:`${z}/page/supplementing`,type:"AnnotationPage",label:{none:["Supplements"]},items:await Promise.all(L.map(async(X,Q)=>{const ue=`${P}-supp-${Q}`,be=await X.text(),de=new Blob([be],{type:"text/plain"});return await qt.saveAsset(de,ue),{id:`${z}/annotation/supp-${Q}`,type:"Annotation",motivation:"supplementing",label:{none:[X.name]},body:{type:"TextualBody",value:be,format:X.name.endsWith(".srt")?"text/vtt":"text/plain",language:X.name.endsWith(".srt")?void 0:"en"},target:z}}))};O.push(Y)}const B={id:z,type:"Canvas",label:{none:[T.name]},width:I,height:D,items:V,annotations:O,thumbnail:te,navDate:E.navDate,metadata:E.metadata,_fileRef:T};Hy()&&M1().register(z,T,()=>{Hy()&&console.log(`[iiifBuilder] Cleaning up file reference for canvas ${z}`)}),y.push(B),n.canvasesCreated++,n.filesProcessed++,i=Ga(i,R,{status:"completed",progress:100,completedAt:Date.now()}),i=Ya(i,`Processed: ${T.name}`,"success",R),o(i)}catch(K){const I=K instanceof Error?K.message:String(K);if(i=Ga(i,R,{status:"error",error:I,completedAt:Date.now()}),i=Ya(i,`Error processing ${T.name}: ${I}`,"error",R),o(i),I.includes("cancelled"))throw K}}return n.manifestsCreated++,{"@context":kt.PRESENTATION_3.CONTEXT,id:h,type:"Manifest",label:g,items:y,behavior:e.iiifBehavior||["individuals"],viewingDirection:e.viewingDirection||"left-to-right",service:[{id:ct.ID_PATTERNS.SEARCH_SERVICE(t,h.split("/").pop()||""),type:"SearchService2",profile:kt.SEARCH_2.PROFILE,label:{en:["Content Search"]}}]}}else{const y=[];if(Array.from(e.files.keys()).filter(N=>{const j=N.split(".").pop()?.toLowerCase()||"",C=Ln[j];return C&&C.motivation==="painting"}).length>0){const N={name:`${m} - ${ct.INGEST.LOOSE_FILES_Dir_NAME}`,path:e.path,files:new Map(Array.from(e.files.entries()).filter(([j])=>{const C=j.split(".").pop()?.toLowerCase()||"",A=Ln[C];return A&&A.motivation==="painting"})),directories:new Map,iiifIntent:"Manifest"};y.push(await mu(N,t,n,i,l,o))}for(const[N,j]of e.directories.entries())N.startsWith("+")||N.startsWith("!")||y.push(await mu(j,t,n,i,l,o));return n.collectionsCreated++,{"@context":kt.PRESENTATION_3.CONTEXT,id:h,type:"Collection",label:g,items:y}}},Pm=async(e,t,n,i)=>{let l="Manifest";if(e.iiifIntent&&(e.iiifIntent==="Collection"||e.iiifIntent==="Manifest"))l=e.iiifIntent;else{const p=e.directories.size>0,g=e.name===ct.INGEST.ROOT_NAME||e.name.startsWith(ct.INGEST.COLLECTION_PREFIX),y=Array.from(e.files.keys()).filter(v=>{const N=v.split(".").pop()?.toLowerCase()||"";return!!Ln[N]});!p&&y.length>0?l="Manifest":g||p?l="Collection":y.length>0?l="Manifest":l="Collection"}let o={};if(e.files.has(ct.INGEST.META_FILE))try{const p=await e.files.get(ct.INGEST.META_FILE).text();o=Pw(p)||{}}catch{n.warnings.push(`Invalid ${ct.INGEST.META_FILE} in ${e.path}`)}let u=e.name.startsWith(ct.INGEST.COLLECTION_PREFIX)?e.name.substring(ct.INGEST.COLLECTION_PREFIX.length):e.name;u===ct.INGEST.ROOT_NAME&&(u=ct.INGEST.ROOT_DISPLAY_NAME);const d=qv(l,t),m=o.language||"none",h=o.label?{[m]:[o.label]}:{none:[u]};if(l==="Manifest"){const p=[],g=Array.from(e.files.keys()).sort(),y=new Map,x=[];if(g.forEach(j=>{const C=j.split("."),A=C.pop()?.toLowerCase()||"",_=C.join("."),T=Ln[A];T&&T.motivation==="painting"&&(y.has(_)||y.set(_,{main:e.files.get(j),supplemental:[]}))}),g.forEach(j=>{const C=j.split("."),A=C.pop()?.toLowerCase()||"",_=C.join(".");if(A==="txt"||A==="srt"||A==="vtt"){const T=e.files.get(j);y.has(_)?y.get(_).supplemental.push(T):x.push(T)}}),y.size>0){const j=Array.from(y.values()).filter(C=>C.supplemental.length>0).length;n.warnings.push(`Smart Sidecar: Detected ${j} paired files with transcriptions/captions`)}x.length>0&&n.warnings.push(`Smart Sidecar: Found ${x.length} orphaned .txt/.srt files (no matching media)`);const v=Array.from(y.keys()).sort();for(let j=0;j<v.length;j++){const C=v[j],{main:A,supplemental:_}=y.get(C),T=A.name.split(".").pop()?.toLowerCase()||"";if(i){const U=Math.round(j/v.length*100);i(`Ingesting ${A.name}...`,U)}const L=ct.ID_PATTERNS.CANVAS(d,p.length+1),H=`${d.split("/").pop()}-${A.name.replace(/[^a-zA-Z0-9-_]/g,"")}`,k=await R1.registerFile(A,L,A.name);k.isDuplicate&&k.existingEntityId&&(n.warnings.push(`Duplicate detected: "${A.name}" matches existing file (hash: ${k.fingerprint?.hash.substring(0,8)}...). Original entity: ${k.existingEntityId}. File will still be imported with shared reference.`),n.duplicatesSkipped=(n.duplicatesSkipped||0)+1),await qt.saveAsset(A,H);let R=Qt.defaultCanvasWidth,z=Qt.defaultCanvasHeight;if(A.type.startsWith("image/")){try{const O=await createImageBitmap(A);R=O.width,z=O.height,O.close()}catch{console.warn(`Could not read image dimensions for ${A.name}, using defaults`)}const U=ba(),V=await F1(A,U.thumbnailWidth);V&&await qt.saveDerivative(H,"thumb",V),zs.push({assetId:H,file:A,sizes:U.sizes.filter(O=>O>U.thumbnailWidth)})}const P=await D1(A),K=Ln[T]?.type||"Image",I=K==="Image",D=ba(),E=I?[{id:`${ct.ID_PATTERNS.IMAGE_SERVICE(t,H)}/full/${D.thumbnailWidth},/0/default.jpg`,type:"Image",format:"image/jpeg",width:D.thumbnailWidth}]:void 0,q={id:`${L}/annotation/painting`,type:"Annotation",label:{none:["Content Resource"]},motivation:"painting",target:L,body:{id:`${ct.ID_PATTERNS.IMAGE_SERVICE(t,H)}/full/max/0/default.jpg`,type:K,format:Ln[T]?.format||"image/jpeg",service:I?[au(ct.ID_PATTERNS.IMAGE_SERVICE(t,H),"level2")]:void 0}},W=[{id:`${L}/page/painting`,type:"AnnotationPage",label:{none:["Painting Page"]},items:[q]}],G=[];if(_.length>0){const U={id:`${L}/page/supplementing`,type:"AnnotationPage",label:{none:["Supplements"]},items:await Promise.all(_.map(async(V,O)=>{const B=`${H}-supp-${O}`,Y=await V.text(),X=new Blob([Y],{type:"text/plain"});return await qt.saveAsset(X,B),{id:`${L}/annotation/supp-${O}`,type:"Annotation",motivation:"supplementing",label:{none:[V.name]},body:{type:"TextualBody",value:Y,format:V.name.endsWith(".srt")?"text/vtt":"text/plain",language:V.name.endsWith(".srt")?void 0:"en"},target:L}}))};G.push(U)}const te={id:L,type:"Canvas",label:{none:[A.name]},width:R,height:z,items:W,annotations:G,thumbnail:E,navDate:P.navDate,metadata:P.metadata,_fileRef:A};M1().register(L,A,()=>{console.log(`[iiifBuilder] Cleaning up file reference for canvas ${L}`)}),p.push(te),n.canvasesCreated++,n.filesProcessed++}return n.manifestsCreated++,{"@context":kt.PRESENTATION_3.CONTEXT,id:d,type:"Manifest",label:h,items:p,behavior:e.iiifBehavior||["individuals"],viewingDirection:e.viewingDirection||"left-to-right",service:[{id:ct.ID_PATTERNS.SEARCH_SERVICE(t,d.split("/").pop()||""),type:"SearchService2",profile:kt.SEARCH_2.PROFILE,label:{en:["Content Search"]}}]}}else{const p=[];if(Array.from(e.files.keys()).filter(x=>{const v=x.split(".").pop()?.toLowerCase()||"",N=Ln[v];return N&&N.motivation==="painting"}).length>0){const x={name:`${u} - ${ct.INGEST.LOOSE_FILES_Dir_NAME}`,path:e.path,files:new Map(Array.from(e.files.entries()).filter(([v])=>{const N=v.split(".").pop()?.toLowerCase()||"",j=Ln[N];return j&&j.motivation==="painting"})),directories:new Map,iiifIntent:"Manifest"};p.push(await Pm(x,t,n,i))}for(const[x,v]of e.directories.entries())x.startsWith("+")||x.startsWith("!")||p.push(await Pm(v,t,n,i));return n.collectionsCreated++,{"@context":kt.PRESENTATION_3.CONTEXT,id:d,type:"Collection",label:h,items:p}}},vD=async(e,t=null,n)=>{const i={manifestsCreated:0,collectionsCreated:0,canvasesCreated:0,filesProcessed:0,warnings:[]},l=typeof n=="function",o=l?{}:n||{},u=l?n:void 0,d=!l;let m=e.iiifBaseUrl;if(m)m=m.replace(/\/$/,"");else{const y="/field-studio/".replace(/\/$/,"");m=`${window.location.origin}${y}/${ct.BASE_URL.PATH_SEGMENT}`}let h,p;if(bD()&&!l)try{const x=await yD(e,m,i,o,v=>{o.onProgress?.(v),u&&_h(v,u)});if(p=x.root,i.manifestsCreated=x.report.manifestsCreated,i.collectionsCreated=x.report.collectionsCreated,i.canvasesCreated=x.report.canvasesCreated,i.filesProcessed=x.report.filesProcessed,jr.size===0){const v=Array.from(jr.values()).pop()?.progress;v&&(i.progressSummary=kh(v))}}catch(y){console.warn("[ingestTree] Worker ingest failed, falling back to main thread:",y),p=await mu(e,m,i,Mm(`fallback-${Date.now()}`,hu(e)),o,x=>{o.onProgress?.(x),u&&_h(x,u)})}else if(d){const y=`ingest-${Date.now()}`,x=hu(e);h=Mm(y,x);const v=N=>{o.onProgress?.(N),u&&_h(N,u)};try{p=await mu(e,m,i,h,o,v),h=Fm(h,"complete",100),h=Ya(h,`Ingest complete: ${i.filesProcessed} files processed`,"success"),v(h),i.progressSummary=kh(h)}catch(N){throw h&&(h={...h,isCancelled:N instanceof Error&&N.message.includes("cancelled")},h=Fm(h,"error"),h=Ya(h,N instanceof Error?N.message:"Unknown error during ingest","error"),v(h),i.progressSummary=kh(h)),N}}else p=await Pm(e,m,i,u);if(t&&Mt(t)){const y=JSON.parse(JSON.stringify(t));if(y.items||(y.items=[]),Mt(p)&&e.name==="root"){const x=p.items||[];for(const v of x)if(Ja("Collection",v.type)){const N=Ai("Collection",v.type);console.log(`Adding ${v.type} to Collection with ${N} relationship`),y.items.push(v)}else i.warnings.push(`Skipped ${v.type} - not valid child of Collection`)}else if(Ja("Collection",p.type)){const x=Ai("Collection",p.type);console.log(`Adding ${p.type} to existing Collection with ${x} relationship`),y.items.push(p)}else i.warnings.push(`Cannot add ${p.type} to existing Collection - invalid child type`);return await qt.saveProject(y),zs.length>0&&(i.warnings.push(`Background tile generation queued for ${zs.length} images`),Wy(u).catch(x=>console.warn("Background tile generation error:",x))),{root:y,report:i}}else return await qt.saveProject(p),zs.length>0&&(i.warnings.push(`Background tile generation queued for ${zs.length} images`),Wy(u).catch(y=>console.warn("Background tile generation error:",y))),{root:p,report:i}},P1=e=>{const t={name:"root",path:"",files:new Map,directories:new Map};for(const n of e){if(n.name.startsWith("."))continue;const l=(n.webkitRelativePath||n.name).split("/");let o=t;for(let u=0;u<l.length-1;u++){const d=l[u];o.directories.has(d)||o.directories.set(d,{name:d,path:o.path?`${o.path}/${d}`:d,files:new Map,directories:new Map}),o=o.directories.get(d)}o.files.set(l[l.length-1],n)}return t};function Mu(e){const t=e["@context"];if(!t)return"unknown";const n=Array.isArray(t)?t.join(" "):String(t);return n.includes("presentation/3")?"3.0":n.includes("presentation/2")?n.includes("2.1")||e.sequences?.[0]?.canvases?"2.1":"2.0":e.sequences?"2.1":e.items?.some(i=>Wt(i))?"3.0":"unknown"}function $1(e){const t=Mu(e);return t==="2.0"||t==="2.1"}function $l(e){const t=Mu(e);if(t==="3.0")return ED(e);t==="unknown"&&console.warn("Unknown IIIF version, attempting upgrade anyway");const n=ao(e["@type"]||e.type);switch(n){case"Collection":return wD(e);case"Manifest":return ND(e);default:return console.warn(`Unknown resource type: ${n}, returning as-is`),e}}function wD(e){const n=Pu(e,["@context","@id","@type","id","type","label","description","summary","metadata","thumbnail","attribution","requiredStatement","license","rights","logo","provider","navDate","viewingHint","behavior","manifests","collections","members","items"]),i={"@context":kt.PRESENTATION_3.CONTEXT,id:e["@id"]||e.id,type:"Collection",label:On(e.label),items:[],...n};e.description&&(i.summary=On(e.description)),e.metadata&&(i.metadata=Fu(e.metadata)),e.thumbnail&&(i.thumbnail=up(e.thumbnail)),e.attribution&&(i.requiredStatement=z1(e.attribution)),e.license&&(i.rights=e.license),e.logo&&(i.provider=[{id:"",type:"Agent",label:{none:["Provider"]},logo:U1(e.logo)}]),e.navDate&&(i.navDate=e.navDate),e.viewingHint&&(i.behavior=Kl(e.viewingHint,"Collection"));const l=[];if(e.manifests)for(const o of e.manifests)l.push($l(o));if(e.collections)for(const o of e.collections)l.push($l(o));if(e.members)for(const o of e.members)l.push($l(o));return i.items=l,i}function ND(e){const n=Pu(e,["@context","@id","@type","id","type","label","description","summary","metadata","thumbnail","attribution","requiredStatement","license","rights","logo","provider","navDate","viewingHint","behavior","viewingDirection","sequences","items","structures","related","homepage","seeAlso","rendering","within","partOf","service","services"]),i={"@context":kt.PRESENTATION_3.CONTEXT,id:e["@id"]||e.id,type:"Manifest",label:On(e.label),items:[],...n};if(e.description&&(i.summary=On(e.description)),e.metadata&&(i.metadata=Fu(e.metadata)),e.thumbnail&&(i.thumbnail=up(e.thumbnail)),e.attribution&&(i.requiredStatement=z1(e.attribution)),e.license&&(i.rights=e.license),e.logo&&(i.provider=[{id:"",type:"Agent",label:{none:["Provider"]},logo:U1(e.logo)}]),e.navDate&&(i.navDate=e.navDate),e.viewingHint&&(i.behavior=Kl(e.viewingHint,"Manifest")),e.viewingDirection&&(i.viewingDirection=Km(e.viewingDirection)?e.viewingDirection:mj),e.sequences&&e.sequences.length>0){const l=e.sequences[0];l.canvases&&(i.items=l.canvases.map(o=>SD(o))),!i.behavior&&l.viewingHint&&(i.behavior=Kl(l.viewingHint,"Manifest")),!i.viewingDirection&&l.viewingDirection&&(i.viewingDirection=l.viewingDirection)}return e.structures&&(i.structures=e.structures.map(l=>$m(l))),e.related&&(i.homepage=Array.isArray(e.related)?e.related.map(Gy):[Gy(e.related)]),e.seeAlso&&(i.seeAlso=Array.isArray(e.seeAlso)?e.seeAlso.map(Yy):[Yy(e.seeAlso)]),e.rendering&&(i.rendering=Array.isArray(e.rendering)?e.rendering.map(qy):[qy(e.rendering)]),e.within&&(i.partOf=Array.isArray(e.within)?e.within.map(Vy):[Vy(e.within)]),e.service&&(i.service=Array.isArray(e.service)?e.service.map(Xl):[Xl(e.service)]),i}function SD(e){const n=Pu(e,["@id","@type","id","type","label","description","summary","metadata","thumbnail","navDate","width","height","duration","viewingHint","behavior","images","items","otherContent","annotations"]),i={id:e["@id"]||e.id,type:"Canvas",label:On(e.label),width:e.width,height:e.height,items:[],...n};if(e.description&&(i.summary=On(e.description)),e.metadata&&(i.metadata=Fu(e.metadata)),e.thumbnail&&(i.thumbnail=up(e.thumbnail)),e.navDate&&(i.navDate=e.navDate),e.duration&&(i.duration=e.duration),e.viewingHint&&(i.behavior=Kl(e.viewingHint,"Canvas")),e.images&&e.images.length>0){const l={id:`${i.id}/page/1`,type:"AnnotationPage",items:e.images.map((o,u)=>CD(o,i.id,u))};i.items=[l]}return e.otherContent&&e.otherContent.length>0&&(i.annotations=e.otherContent.map(l=>({id:l["@id"]||l.id,type:"AnnotationPage",label:l.label?On(l.label):void 0,items:[]}))),i}function CD(e,t,n){const i=e.resource||{};return{id:e["@id"]||`${t}/annotation/${n}`,type:"Annotation",motivation:"painting",target:e.on||t,body:{id:i["@id"]||i.id,type:jD(i["@type"]||i.type),format:i.format,width:i.width,height:i.height,service:i.service?[Xl(i.service)]:void 0}}}function $m(e){const n=Pu(e,["@id","@type","id","type","label","description","summary","metadata","viewingHint","behavior","canvases","ranges","members","items"]),i={id:e["@id"]||e.id,type:"Range",label:On(e.label),items:[],...n};return e.description&&(i.summary=On(e.description)),e.metadata&&(i.metadata=Fu(e.metadata)),e.viewingHint&&(i.behavior=Kl(e.viewingHint,"Range")),e.canvases&&i.items.push(...e.canvases.map(l=>({id:l,type:"Canvas"}))),e.ranges&&i.items.push(...e.ranges.map(l=>typeof l=="string"?{id:l,type:"Range"}:$m(l))),e.members&&i.items.push(...e.members.map(l=>ao(l["@type"]||l.type)==="Range"?typeof l=="string"?{id:l,type:"Range"}:$m(l):{id:l["@id"]||l.id||l,type:"Canvas"})),i}function On(e){if(!e)return{none:[""]};if(typeof e=="object"&&!Array.isArray(e)&&!e["@value"])return e;if(typeof e=="string")return{none:[e]};if(Array.isArray(e)){const t={};for(const n of e)if(typeof n=="string")t.none||(t.none=[]),t.none.push(n);else if(n["@value"]){const i=n["@language"]||"none";t[i]||(t[i]=[]),t[i].push(n["@value"])}return Object.keys(t).length>0?t:{none:[""]}}return e["@value"]?{[e["@language"]||"none"]:[e["@value"]]}:{none:[String(e)]}}function Fu(e){return Array.isArray(e)?e.map(t=>({label:On(t.label),value:On(t.value)})):[]}function up(e){return e?(Array.isArray(e)?e:[e]).map(n=>({id:n["@id"]||n.id,type:"Image",format:n.format||"image/jpeg",width:n.width,height:n.height,service:n.service?[Xl(n.service)]:void 0})):[]}function z1(e){return{label:{en:["Attribution"]},value:On(e)}}function U1(e){return e?(Array.isArray(e)?e:[e]).map(n=>({id:typeof n=="string"?n:n["@id"]||n.id,type:"Image",format:typeof n=="object"?n.format:"image/png"})):[]}function Kl(e,t="Manifest"){if(!e)return[];const n=Array.isArray(e)?e:[e],i={individuals:"individuals",paged:"paged",continuous:"continuous","multi-part":"multi-part","non-paged":"non-paged","facing-pages":"facing-pages",top:"sequence"};return n.map(l=>i[l]||l).filter(l=>l&&bw(l,t))}function Xl(e){if(!e)return null;if(Array.isArray(e))return e.map(u=>Xl(u)).filter(Boolean);const t=e.profile||e["@profile"],n=e["@context"];let i="Service";n?.includes("image")||t?.includes("image")||n?.includes(Qm)||t?.includes("level")?n?.includes("/3")||t?.includes("level0")||t?.includes("level1")||t?.includes("level2")?i="ImageService3":i="ImageService2":n?.includes("search")||t?.includes("search")?i="SearchService2":(n?.includes("auth")||t?.includes("auth"))&&(i="AuthCookieService1");let o=typeof t=="string"?t:t?.[0];return i==="ImageService3"&&o&&(o.includes("level0")||o.includes("level1.json")?o="level0":o.includes("level1")&&!o.includes("level1.json")?o="level1":o.includes("level2")&&(o="level2")),{id:e["@id"]||e.id,type:i,profile:o,...e.width&&{width:e.width},...e.height&&{height:e.height},...e.tiles&&{tiles:e.tiles},...e.sizes&&{sizes:e.sizes}}}function Gy(e){return typeof e=="string"?{id:e,type:"Text",label:{none:["Related"]}}:{id:e["@id"]||e.id,type:"Text",label:e.label?On(e.label):{none:["Related"]},format:e.format}}function Yy(e){return typeof e=="string"?{id:e,type:"Dataset"}:{id:e["@id"]||e.id,type:"Dataset",format:e.format,profile:e.profile,label:e.label?On(e.label):void 0}}function qy(e){return typeof e=="string"?{id:e,type:"Text"}:{id:e["@id"]||e.id,type:"Text",label:e.label?On(e.label):void 0,format:e.format}}function Vy(e){return typeof e=="string"?{id:e,type:"Collection"}:{id:e["@id"]||e.id,type:ao(e["@type"]||e.type)||"Collection",label:e.label?On(e.label):void 0}}function ao(e){if(!e)return"";Array.isArray(e)&&(e=e[0]);const t=String(e);return t.includes(":")?t.split(":").pop()||t:{"sc:Collection":"Collection","sc:Manifest":"Manifest","sc:Sequence":"Sequence","sc:Canvas":"Canvas","sc:Range":"Range","sc:AnnotationList":"AnnotationPage","oa:Annotation":"Annotation","dctypes:Image":"Image","dctypes:Sound":"Sound","dctypes:Video":"Video","dctypes:Text":"Text"}[t]||t}function jD(e){const t=ao(e);return{Image:"Image","dctypes:Image":"Image",Sound:"Sound","dctypes:Sound":"Sound",Video:"Video","dctypes:Video":"Video",Text:"Text","dctypes:Text":"Text"}[t]||t||"Image"}function ED(e){const t={...e},n=["@id","@type","sequences","otherContent","images","within","attribution","license","logo","related","description"];for(const i of n)delete t[i];return!t.id&&e["@id"]&&(t.id=e["@id"]),!t.type&&e["@type"]&&(t.type=ao(e["@type"])),t}function Pu(e,t){const n={};for(const i of Object.keys(e))t.includes(i)||i.startsWith("@")||(n[i]=e[i]);return n}function AD(e){return $l(e)}function TD(e){const t=Mu(e);return{detected:t,needsUpgrade:$1(e),label:t==="unknown"?"Unknown Version":`IIIF Presentation ${t}`}}const _D={importManifest:AD,getVersionInfo:TD,detectVersion:Mu,needsUpgrade:$1,upgradeToV3:$l},kD={generateRangesFromPatterns:e=>{if(!e.items||e.items.length<2)return e;const t=e.items,n=[];let i=null,l=null;return t.forEach((o,u)=>{const d=Le(o.label),m=d.match(/(\d+)/),h=m?parseInt(m[1],10):null;(i===null||h===null||l===null||Math.abs(h-l)>1)&&(i={id:`${e.id}/range/auto-${crypto.randomUUID().slice(0,8)}`,type:"Range",label:{none:[`Section starting at ${d}`]},items:[]},n.push(i)),i.items.push({id:o.id,type:"Canvas"}),l=h}),{...e,structures:n}}};function Oc(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ih={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Ky;function OD(){return Ky||(Ky=1,(function(e,t){(function(n){e.exports=n()})(function(){return(function n(i,l,o){function u(h,p){if(!l[h]){if(!i[h]){var g=typeof Oc=="function"&&Oc;if(!p&&g)return g(h,!0);if(d)return d(h,!0);var y=new Error("Cannot find module '"+h+"'");throw y.code="MODULE_NOT_FOUND",y}var x=l[h]={exports:{}};i[h][0].call(x.exports,function(v){var N=i[h][1][v];return u(N||v)},x,x.exports,n,i,l,o)}return l[h].exports}for(var d=typeof Oc=="function"&&Oc,m=0;m<o.length;m++)u(o[m]);return u})({1:[function(n,i,l){var o=n("./utils"),u=n("./support"),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";l.encode=function(m){for(var h,p,g,y,x,v,N,j=[],C=0,A=m.length,_=A,T=o.getTypeOf(m)!=="string";C<m.length;)_=A-C,g=T?(h=m[C++],p=C<A?m[C++]:0,C<A?m[C++]:0):(h=m.charCodeAt(C++),p=C<A?m.charCodeAt(C++):0,C<A?m.charCodeAt(C++):0),y=h>>2,x=(3&h)<<4|p>>4,v=1<_?(15&p)<<2|g>>6:64,N=2<_?63&g:64,j.push(d.charAt(y)+d.charAt(x)+d.charAt(v)+d.charAt(N));return j.join("")},l.decode=function(m){var h,p,g,y,x,v,N=0,j=0,C="data:";if(m.substr(0,C.length)===C)throw new Error("Invalid base64 input, it looks like a data url.");var A,_=3*(m=m.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(m.charAt(m.length-1)===d.charAt(64)&&_--,m.charAt(m.length-2)===d.charAt(64)&&_--,_%1!=0)throw new Error("Invalid base64 input, bad content length.");for(A=u.uint8array?new Uint8Array(0|_):new Array(0|_);N<m.length;)h=d.indexOf(m.charAt(N++))<<2|(y=d.indexOf(m.charAt(N++)))>>4,p=(15&y)<<4|(x=d.indexOf(m.charAt(N++)))>>2,g=(3&x)<<6|(v=d.indexOf(m.charAt(N++))),A[j++]=h,x!==64&&(A[j++]=p),v!==64&&(A[j++]=g);return A}},{"./support":30,"./utils":32}],2:[function(n,i,l){var o=n("./external"),u=n("./stream/DataWorker"),d=n("./stream/Crc32Probe"),m=n("./stream/DataLengthProbe");function h(p,g,y,x,v){this.compressedSize=p,this.uncompressedSize=g,this.crc32=y,this.compression=x,this.compressedContent=v}h.prototype={getContentWorker:function(){var p=new u(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new m("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new u(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(p,g,y){return p.pipe(new d).pipe(new m("uncompressedSize")).pipe(g.compressWorker(y)).pipe(new m("compressedSize")).withStreamInfo("compression",g)},i.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,i,l){var o=n("./stream/GenericWorker");l.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},l.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,i,l){var o=n("./utils"),u=(function(){for(var d,m=[],h=0;h<256;h++){d=h;for(var p=0;p<8;p++)d=1&d?3988292384^d>>>1:d>>>1;m[h]=d}return m})();i.exports=function(d,m){return d!==void 0&&d.length?o.getTypeOf(d)!=="string"?(function(h,p,g,y){var x=u,v=y+g;h^=-1;for(var N=y;N<v;N++)h=h>>>8^x[255&(h^p[N])];return-1^h})(0|m,d,d.length,0):(function(h,p,g,y){var x=u,v=y+g;h^=-1;for(var N=y;N<v;N++)h=h>>>8^x[255&(h^p.charCodeAt(N))];return-1^h})(0|m,d,d.length,0):0}},{"./utils":32}],5:[function(n,i,l){l.base64=!1,l.binary=!1,l.dir=!1,l.createFolders=!0,l.date=null,l.compression=null,l.compressionOptions=null,l.comment=null,l.unixPermissions=null,l.dosPermissions=null},{}],6:[function(n,i,l){var o=null;o=typeof Promise<"u"?Promise:n("lie"),i.exports={Promise:o}},{lie:37}],7:[function(n,i,l){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",u=n("pako"),d=n("./utils"),m=n("./stream/GenericWorker"),h=o?"uint8array":"array";function p(g,y){m.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=y,this.meta={}}l.magic="\b\0",d.inherits(p,m),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(d.transformTo(h,g.data),!1)},p.prototype.flush=function(){m.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){m.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new u[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(y){g.push({data:y,meta:g.meta})}},l.compressWorker=function(g){return new p("Deflate",g)},l.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,i,l){function o(x,v){var N,j="";for(N=0;N<v;N++)j+=String.fromCharCode(255&x),x>>>=8;return j}function u(x,v,N,j,C,A){var _,T,L=x.file,H=x.compression,k=A!==h.utf8encode,R=d.transformTo("string",A(L.name)),z=d.transformTo("string",h.utf8encode(L.name)),P=L.comment,K=d.transformTo("string",A(P)),I=d.transformTo("string",h.utf8encode(P)),D=z.length!==L.name.length,E=I.length!==P.length,q="",W="",G="",te=L.dir,U=L.date,V={crc32:0,compressedSize:0,uncompressedSize:0};v&&!N||(V.crc32=x.crc32,V.compressedSize=x.compressedSize,V.uncompressedSize=x.uncompressedSize);var O=0;v&&(O|=8),k||!D&&!E||(O|=2048);var B=0,Y=0;te&&(B|=16),C==="UNIX"?(Y=798,B|=(function(Q,ue){var be=Q;return Q||(be=ue?16893:33204),(65535&be)<<16})(L.unixPermissions,te)):(Y=20,B|=(function(Q){return 63&(Q||0)})(L.dosPermissions)),_=U.getUTCHours(),_<<=6,_|=U.getUTCMinutes(),_<<=5,_|=U.getUTCSeconds()/2,T=U.getUTCFullYear()-1980,T<<=4,T|=U.getUTCMonth()+1,T<<=5,T|=U.getUTCDate(),D&&(W=o(1,1)+o(p(R),4)+z,q+="up"+o(W.length,2)+W),E&&(G=o(1,1)+o(p(K),4)+I,q+="uc"+o(G.length,2)+G);var X="";return X+=`
\0`,X+=o(O,2),X+=H.magic,X+=o(_,2),X+=o(T,2),X+=o(V.crc32,4),X+=o(V.compressedSize,4),X+=o(V.uncompressedSize,4),X+=o(R.length,2),X+=o(q.length,2),{fileRecord:g.LOCAL_FILE_HEADER+X+R+q,dirRecord:g.CENTRAL_FILE_HEADER+o(Y,2)+X+o(K.length,2)+"\0\0\0\0"+o(B,4)+o(j,4)+R+q+K}}var d=n("../utils"),m=n("../stream/GenericWorker"),h=n("../utf8"),p=n("../crc32"),g=n("../signature");function y(x,v,N,j){m.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=v,this.zipPlatform=N,this.encodeFileName=j,this.streamFiles=x,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}d.inherits(y,m),y.prototype.push=function(x){var v=x.meta.percent||0,N=this.entriesCount,j=this._sources.length;this.accumulate?this.contentBuffer.push(x):(this.bytesWritten+=x.data.length,m.prototype.push.call(this,{data:x.data,meta:{currentFile:this.currentFile,percent:N?(v+100*(N-j-1))/N:100}}))},y.prototype.openedSource=function(x){this.currentSourceOffset=this.bytesWritten,this.currentFile=x.file.name;var v=this.streamFiles&&!x.file.dir;if(v){var N=u(x,v,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:N.fileRecord,meta:{percent:0}})}else this.accumulate=!0},y.prototype.closedSource=function(x){this.accumulate=!1;var v=this.streamFiles&&!x.file.dir,N=u(x,v,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(N.dirRecord),v)this.push({data:(function(j){return g.DATA_DESCRIPTOR+o(j.crc32,4)+o(j.compressedSize,4)+o(j.uncompressedSize,4)})(x),meta:{percent:100}});else for(this.push({data:N.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},y.prototype.flush=function(){for(var x=this.bytesWritten,v=0;v<this.dirRecords.length;v++)this.push({data:this.dirRecords[v],meta:{percent:100}});var N=this.bytesWritten-x,j=(function(C,A,_,T,L){var H=d.transformTo("string",L(T));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(C,2)+o(C,2)+o(A,4)+o(_,4)+o(H.length,2)+H})(this.dirRecords.length,N,x,this.zipComment,this.encodeFileName);this.push({data:j,meta:{percent:100}})},y.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},y.prototype.registerPrevious=function(x){this._sources.push(x);var v=this;return x.on("data",function(N){v.processChunk(N)}),x.on("end",function(){v.closedSource(v.previous.streamInfo),v._sources.length?v.prepareNextSource():v.end()}),x.on("error",function(N){v.error(N)}),this},y.prototype.resume=function(){return!!m.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},y.prototype.error=function(x){var v=this._sources;if(!m.prototype.error.call(this,x))return!1;for(var N=0;N<v.length;N++)try{v[N].error(x)}catch{}return!0},y.prototype.lock=function(){m.prototype.lock.call(this);for(var x=this._sources,v=0;v<x.length;v++)x[v].lock()},i.exports=y},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,i,l){var o=n("../compressions"),u=n("./ZipFileWorker");l.generateWorker=function(d,m,h){var p=new u(m.streamFiles,h,m.platform,m.encodeFileName),g=0;try{d.forEach(function(y,x){g++;var v=(function(A,_){var T=A||_,L=o[T];if(!L)throw new Error(T+" is not a valid compression method !");return L})(x.options.compression,m.compression),N=x.options.compressionOptions||m.compressionOptions||{},j=x.dir,C=x.date;x._compressWorker(v,N).withStreamInfo("file",{name:y,dir:j,date:C,comment:x.comment||"",unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(y){p.error(y)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,i,l){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var u=new o;for(var d in this)typeof this[d]!="function"&&(u[d]=this[d]);return u}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(u,d){return new o().loadAsync(u,d)},o.external=n("./external"),i.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,i,l){var o=n("./utils"),u=n("./external"),d=n("./utf8"),m=n("./zipEntries"),h=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(y){return new u.Promise(function(x,v){var N=y.decompressed.getContentWorker().pipe(new h);N.on("error",function(j){v(j)}).on("end",function(){N.streamInfo.crc32!==y.decompressed.crc32?v(new Error("Corrupted zip : CRC32 mismatch")):x()}).resume()})}i.exports=function(y,x){var v=this;return x=o.extend(x||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:d.utf8decode}),p.isNode&&p.isStream(y)?u.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",y,!0,x.optimizedBinaryString,x.base64).then(function(N){var j=new m(x);return j.load(N),j}).then(function(N){var j=[u.Promise.resolve(N)],C=N.files;if(x.checkCRC32)for(var A=0;A<C.length;A++)j.push(g(C[A]));return u.Promise.all(j)}).then(function(N){for(var j=N.shift(),C=j.files,A=0;A<C.length;A++){var _=C[A],T=_.fileNameStr,L=o.resolve(_.fileNameStr);v.file(L,_.decompressed,{binary:!0,optimizedBinaryString:!0,date:_.date,dir:_.dir,comment:_.fileCommentStr.length?_.fileCommentStr:null,unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions,createFolders:x.createFolders}),_.dir||(v.file(L).unsafeOriginalName=T)}return j.zipComment.length&&(v.comment=j.zipComment),v})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,i,l){var o=n("../utils"),u=n("../stream/GenericWorker");function d(m,h){u.call(this,"Nodejs stream input adapter for "+m),this._upstreamEnded=!1,this._bindStream(h)}o.inherits(d,u),d.prototype._bindStream=function(m){var h=this;(this._stream=m).pause(),m.on("data",function(p){h.push({data:p,meta:{percent:0}})}).on("error",function(p){h.isPaused?this.generatedError=p:h.error(p)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},d.prototype.pause=function(){return!!u.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,i,l){var o=n("readable-stream").Readable;function u(d,m,h){o.call(this,m),this._helper=d;var p=this;d.on("data",function(g,y){p.push(g)||p._helper.pause(),h&&h(y)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(u,o),u.prototype._read=function(){this._helper.resume()},i.exports=u},{"../utils":32,"readable-stream":16}],14:[function(n,i,l){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,u){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,u);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,u)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var u=new Buffer(o);return u.fill(0),u},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,i,l){function o(L,H,k){var R,z=d.getTypeOf(H),P=d.extend(k||{},p);P.date=P.date||new Date,P.compression!==null&&(P.compression=P.compression.toUpperCase()),typeof P.unixPermissions=="string"&&(P.unixPermissions=parseInt(P.unixPermissions,8)),P.unixPermissions&&16384&P.unixPermissions&&(P.dir=!0),P.dosPermissions&&16&P.dosPermissions&&(P.dir=!0),P.dir&&(L=C(L)),P.createFolders&&(R=j(L))&&A.call(this,R,!0);var K=z==="string"&&P.binary===!1&&P.base64===!1;k&&k.binary!==void 0||(P.binary=!K),(H instanceof g&&H.uncompressedSize===0||P.dir||!H||H.length===0)&&(P.base64=!1,P.binary=!0,H="",P.compression="STORE",z="string");var I=null;I=H instanceof g||H instanceof m?H:v.isNode&&v.isStream(H)?new N(L,H):d.prepareContent(L,H,P.binary,P.optimizedBinaryString,P.base64);var D=new y(L,I,P);this.files[L]=D}var u=n("./utf8"),d=n("./utils"),m=n("./stream/GenericWorker"),h=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),y=n("./zipObject"),x=n("./generate"),v=n("./nodejsUtils"),N=n("./nodejs/NodejsStreamInputAdapter"),j=function(L){L.slice(-1)==="/"&&(L=L.substring(0,L.length-1));var H=L.lastIndexOf("/");return 0<H?L.substring(0,H):""},C=function(L){return L.slice(-1)!=="/"&&(L+="/"),L},A=function(L,H){return H=H!==void 0?H:p.createFolders,L=C(L),this.files[L]||o.call(this,L,null,{dir:!0,createFolders:H}),this.files[L]};function _(L){return Object.prototype.toString.call(L)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(L){var H,k,R;for(H in this.files)R=this.files[H],(k=H.slice(this.root.length,H.length))&&H.slice(0,this.root.length)===this.root&&L(k,R)},filter:function(L){var H=[];return this.forEach(function(k,R){L(k,R)&&H.push(R)}),H},file:function(L,H,k){if(arguments.length!==1)return L=this.root+L,o.call(this,L,H,k),this;if(_(L)){var R=L;return this.filter(function(P,K){return!K.dir&&R.test(P)})}var z=this.files[this.root+L];return z&&!z.dir?z:null},folder:function(L){if(!L)return this;if(_(L))return this.filter(function(z,P){return P.dir&&L.test(z)});var H=this.root+L,k=A.call(this,H),R=this.clone();return R.root=k.name,R},remove:function(L){L=this.root+L;var H=this.files[L];if(H||(L.slice(-1)!=="/"&&(L+="/"),H=this.files[L]),H&&!H.dir)delete this.files[L];else for(var k=this.filter(function(z,P){return P.name.slice(0,L.length)===L}),R=0;R<k.length;R++)delete this.files[k[R].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(L){var H,k={};try{if((k=d.extend(L||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:u.utf8encode})).type=k.type.toLowerCase(),k.compression=k.compression.toUpperCase(),k.type==="binarystring"&&(k.type="string"),!k.type)throw new Error("No output type specified.");d.checkSupport(k.type),k.platform!=="darwin"&&k.platform!=="freebsd"&&k.platform!=="linux"&&k.platform!=="sunos"||(k.platform="UNIX"),k.platform==="win32"&&(k.platform="DOS");var R=k.comment||this.comment||"";H=x.generateWorker(this,k,R)}catch(z){(H=new m("error")).error(z)}return new h(H,k.type||"string",k.mimeType)},generateAsync:function(L,H){return this.generateInternalStream(L).accumulate(H)},generateNodeStream:function(L,H){return(L=L||{}).type||(L.type="nodebuffer"),this.generateInternalStream(L).toNodejsStream(H)}};i.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,i,l){i.exports=n("stream")},{stream:void 0}],17:[function(n,i,l){var o=n("./DataReader");function u(d){o.call(this,d);for(var m=0;m<this.data.length;m++)d[m]=255&d[m]}n("../utils").inherits(u,o),u.prototype.byteAt=function(d){return this.data[this.zero+d]},u.prototype.lastIndexOfSignature=function(d){for(var m=d.charCodeAt(0),h=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),y=this.length-4;0<=y;--y)if(this.data[y]===m&&this.data[y+1]===h&&this.data[y+2]===p&&this.data[y+3]===g)return y-this.zero;return-1},u.prototype.readAndCheckSignature=function(d){var m=d.charCodeAt(0),h=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),y=this.readData(4);return m===y[0]&&h===y[1]&&p===y[2]&&g===y[3]},u.prototype.readData=function(d){if(this.checkOffset(d),d===0)return[];var m=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,m},i.exports=u},{"../utils":32,"./DataReader":18}],18:[function(n,i,l){var o=n("../utils");function u(d){this.data=d,this.length=d.length,this.index=0,this.zero=0}u.prototype={checkOffset:function(d){this.checkIndex(this.index+d)},checkIndex:function(d){if(this.length<this.zero+d||d<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+d+"). Corrupted zip ?")},setIndex:function(d){this.checkIndex(d),this.index=d},skip:function(d){this.setIndex(this.index+d)},byteAt:function(){},readInt:function(d){var m,h=0;for(this.checkOffset(d),m=this.index+d-1;m>=this.index;m--)h=(h<<8)+this.byteAt(m);return this.index+=d,h},readString:function(d){return o.transformTo("string",this.readData(d))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var d=this.readInt(4);return new Date(Date.UTC(1980+(d>>25&127),(d>>21&15)-1,d>>16&31,d>>11&31,d>>5&63,(31&d)<<1))}},i.exports=u},{"../utils":32}],19:[function(n,i,l){var o=n("./Uint8ArrayReader");function u(d){o.call(this,d)}n("../utils").inherits(u,o),u.prototype.readData=function(d){this.checkOffset(d);var m=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,m},i.exports=u},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,i,l){var o=n("./DataReader");function u(d){o.call(this,d)}n("../utils").inherits(u,o),u.prototype.byteAt=function(d){return this.data.charCodeAt(this.zero+d)},u.prototype.lastIndexOfSignature=function(d){return this.data.lastIndexOf(d)-this.zero},u.prototype.readAndCheckSignature=function(d){return d===this.readData(4)},u.prototype.readData=function(d){this.checkOffset(d);var m=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,m},i.exports=u},{"../utils":32,"./DataReader":18}],21:[function(n,i,l){var o=n("./ArrayReader");function u(d){o.call(this,d)}n("../utils").inherits(u,o),u.prototype.readData=function(d){if(this.checkOffset(d),d===0)return new Uint8Array(0);var m=this.data.subarray(this.zero+this.index,this.zero+this.index+d);return this.index+=d,m},i.exports=u},{"../utils":32,"./ArrayReader":17}],22:[function(n,i,l){var o=n("../utils"),u=n("../support"),d=n("./ArrayReader"),m=n("./StringReader"),h=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");i.exports=function(g){var y=o.getTypeOf(g);return o.checkSupport(y),y!=="string"||u.uint8array?y==="nodebuffer"?new h(g):u.uint8array?new p(o.transformTo("uint8array",g)):new d(o.transformTo("array",g)):new m(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,i,l){l.LOCAL_FILE_HEADER="PK",l.CENTRAL_FILE_HEADER="PK",l.CENTRAL_DIRECTORY_END="PK",l.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",l.ZIP64_CENTRAL_DIRECTORY_END="PK",l.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,i,l){var o=n("./GenericWorker"),u=n("../utils");function d(m){o.call(this,"ConvertWorker to "+m),this.destType=m}u.inherits(d,o),d.prototype.processChunk=function(m){this.push({data:u.transformTo(this.destType,m.data),meta:m.meta})},i.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(n,i,l){var o=n("./GenericWorker"),u=n("../crc32");function d(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(d,o),d.prototype.processChunk=function(m){this.streamInfo.crc32=u(m.data,this.streamInfo.crc32||0),this.push(m)},i.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,i,l){var o=n("../utils"),u=n("./GenericWorker");function d(m){u.call(this,"DataLengthProbe for "+m),this.propName=m,this.withStreamInfo(m,0)}o.inherits(d,u),d.prototype.processChunk=function(m){if(m){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+m.data.length}u.prototype.processChunk.call(this,m)},i.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(n,i,l){var o=n("../utils"),u=n("./GenericWorker");function d(m){u.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,m.then(function(p){h.dataIsReady=!0,h.data=p,h.max=p&&p.length||0,h.type=o.getTypeOf(p),h.isPaused||h._tickAndRepeat()},function(p){h.error(p)})}o.inherits(d,u),d.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var m=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":m=this.data.substring(this.index,h);break;case"uint8array":m=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":m=this.data.slice(this.index,h)}return this.index=h,this.push({data:m,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(n,i,l){function o(u){this.name=u||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(u){this.emit("data",u)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(u){this.emit("error",u)}return!0},error:function(u){return!this.isFinished&&(this.isPaused?this.generatedError=u:(this.isFinished=!0,this.emit("error",u),this.previous&&this.previous.error(u),this.cleanUp()),!0)},on:function(u,d){return this._listeners[u].push(d),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(u,d){if(this._listeners[u])for(var m=0;m<this._listeners[u].length;m++)this._listeners[u][m].call(this,d)},pipe:function(u){return u.registerPrevious(this)},registerPrevious:function(u){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=u.streamInfo,this.mergeStreamInfo(),this.previous=u;var d=this;return u.on("data",function(m){d.processChunk(m)}),u.on("end",function(){d.end()}),u.on("error",function(m){d.error(m)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var u=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),u=!0),this.previous&&this.previous.resume(),!u},flush:function(){},processChunk:function(u){this.push(u)},withStreamInfo:function(u,d){return this.extraStreamInfo[u]=d,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var u in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,u)&&(this.streamInfo[u]=this.extraStreamInfo[u])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var u="Worker "+this.name;return this.previous?this.previous+" -> "+u:u}},i.exports=o},{}],29:[function(n,i,l){var o=n("../utils"),u=n("./ConvertWorker"),d=n("./GenericWorker"),m=n("../base64"),h=n("../support"),p=n("../external"),g=null;if(h.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function y(v,N){return new p.Promise(function(j,C){var A=[],_=v._internalType,T=v._outputType,L=v._mimeType;v.on("data",function(H,k){A.push(H),N&&N(k)}).on("error",function(H){A=[],C(H)}).on("end",function(){try{var H=(function(k,R,z){switch(k){case"blob":return o.newBlob(o.transformTo("arraybuffer",R),z);case"base64":return m.encode(R);default:return o.transformTo(k,R)}})(T,(function(k,R){var z,P=0,K=null,I=0;for(z=0;z<R.length;z++)I+=R[z].length;switch(k){case"string":return R.join("");case"array":return Array.prototype.concat.apply([],R);case"uint8array":for(K=new Uint8Array(I),z=0;z<R.length;z++)K.set(R[z],P),P+=R[z].length;return K;case"nodebuffer":return Buffer.concat(R);default:throw new Error("concat : unsupported type '"+k+"'")}})(_,A),L);j(H)}catch(k){C(k)}A=[]}).resume()})}function x(v,N,j){var C=N;switch(N){case"blob":case"arraybuffer":C="uint8array";break;case"base64":C="string"}try{this._internalType=C,this._outputType=N,this._mimeType=j,o.checkSupport(C),this._worker=v.pipe(new u(C)),v.lock()}catch(A){this._worker=new d("error"),this._worker.error(A)}}x.prototype={accumulate:function(v){return y(this,v)},on:function(v,N){var j=this;return v==="data"?this._worker.on(v,function(C){N.call(j,C.data,C.meta)}):this._worker.on(v,function(){o.delay(N,arguments,j)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(v){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},v)}},i.exports=x},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,i,l){if(l.base64=!0,l.array=!0,l.string=!0,l.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",l.nodebuffer=typeof Buffer<"u",l.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")l.blob=!1;else{var o=new ArrayBuffer(0);try{l.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var u=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);u.append(o),l.blob=u.getBlob("application/zip").size===0}catch{l.blob=!1}}}try{l.nodestream=!!n("readable-stream").Readable}catch{l.nodestream=!1}},{"readable-stream":16}],31:[function(n,i,l){for(var o=n("./utils"),u=n("./support"),d=n("./nodejsUtils"),m=n("./stream/GenericWorker"),h=new Array(256),p=0;p<256;p++)h[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;h[254]=h[254]=1;function g(){m.call(this,"utf-8 decode"),this.leftOver=null}function y(){m.call(this,"utf-8 encode")}l.utf8encode=function(x){return u.nodebuffer?d.newBufferFrom(x,"utf-8"):(function(v){var N,j,C,A,_,T=v.length,L=0;for(A=0;A<T;A++)(64512&(j=v.charCodeAt(A)))==55296&&A+1<T&&(64512&(C=v.charCodeAt(A+1)))==56320&&(j=65536+(j-55296<<10)+(C-56320),A++),L+=j<128?1:j<2048?2:j<65536?3:4;for(N=u.uint8array?new Uint8Array(L):new Array(L),A=_=0;_<L;A++)(64512&(j=v.charCodeAt(A)))==55296&&A+1<T&&(64512&(C=v.charCodeAt(A+1)))==56320&&(j=65536+(j-55296<<10)+(C-56320),A++),j<128?N[_++]=j:(j<2048?N[_++]=192|j>>>6:(j<65536?N[_++]=224|j>>>12:(N[_++]=240|j>>>18,N[_++]=128|j>>>12&63),N[_++]=128|j>>>6&63),N[_++]=128|63&j);return N})(x)},l.utf8decode=function(x){return u.nodebuffer?o.transformTo("nodebuffer",x).toString("utf-8"):(function(v){var N,j,C,A,_=v.length,T=new Array(2*_);for(N=j=0;N<_;)if((C=v[N++])<128)T[j++]=C;else if(4<(A=h[C]))T[j++]=65533,N+=A-1;else{for(C&=A===2?31:A===3?15:7;1<A&&N<_;)C=C<<6|63&v[N++],A--;1<A?T[j++]=65533:C<65536?T[j++]=C:(C-=65536,T[j++]=55296|C>>10&1023,T[j++]=56320|1023&C)}return T.length!==j&&(T.subarray?T=T.subarray(0,j):T.length=j),o.applyFromCharCode(T)})(x=o.transformTo(u.uint8array?"uint8array":"array",x))},o.inherits(g,m),g.prototype.processChunk=function(x){var v=o.transformTo(u.uint8array?"uint8array":"array",x.data);if(this.leftOver&&this.leftOver.length){if(u.uint8array){var N=v;(v=new Uint8Array(N.length+this.leftOver.length)).set(this.leftOver,0),v.set(N,this.leftOver.length)}else v=this.leftOver.concat(v);this.leftOver=null}var j=(function(A,_){var T;for((_=_||A.length)>A.length&&(_=A.length),T=_-1;0<=T&&(192&A[T])==128;)T--;return T<0||T===0?_:T+h[A[T]]>_?T:_})(v),C=v;j!==v.length&&(u.uint8array?(C=v.subarray(0,j),this.leftOver=v.subarray(j,v.length)):(C=v.slice(0,j),this.leftOver=v.slice(j,v.length))),this.push({data:l.utf8decode(C),meta:x.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:l.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},l.Utf8DecodeWorker=g,o.inherits(y,m),y.prototype.processChunk=function(x){this.push({data:l.utf8encode(x.data),meta:x.meta})},l.Utf8EncodeWorker=y},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,i,l){var o=n("./support"),u=n("./base64"),d=n("./nodejsUtils"),m=n("./external");function h(N){return N}function p(N,j){for(var C=0;C<N.length;++C)j[C]=255&N.charCodeAt(C);return j}n("setimmediate"),l.newBlob=function(N,j){l.checkSupport("blob");try{return new Blob([N],{type:j})}catch{try{var C=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return C.append(N),C.getBlob(j)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(N,j,C){var A=[],_=0,T=N.length;if(T<=C)return String.fromCharCode.apply(null,N);for(;_<T;)j==="array"||j==="nodebuffer"?A.push(String.fromCharCode.apply(null,N.slice(_,Math.min(_+C,T)))):A.push(String.fromCharCode.apply(null,N.subarray(_,Math.min(_+C,T)))),_+=C;return A.join("")},stringifyByChar:function(N){for(var j="",C=0;C<N.length;C++)j+=String.fromCharCode(N[C]);return j},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,d.allocBuffer(1)).length===1}catch{return!1}})()}};function y(N){var j=65536,C=l.getTypeOf(N),A=!0;if(C==="uint8array"?A=g.applyCanBeUsed.uint8array:C==="nodebuffer"&&(A=g.applyCanBeUsed.nodebuffer),A)for(;1<j;)try{return g.stringifyByChunk(N,C,j)}catch{j=Math.floor(j/2)}return g.stringifyByChar(N)}function x(N,j){for(var C=0;C<N.length;C++)j[C]=N[C];return j}l.applyFromCharCode=y;var v={};v.string={string:h,array:function(N){return p(N,new Array(N.length))},arraybuffer:function(N){return v.string.uint8array(N).buffer},uint8array:function(N){return p(N,new Uint8Array(N.length))},nodebuffer:function(N){return p(N,d.allocBuffer(N.length))}},v.array={string:y,array:h,arraybuffer:function(N){return new Uint8Array(N).buffer},uint8array:function(N){return new Uint8Array(N)},nodebuffer:function(N){return d.newBufferFrom(N)}},v.arraybuffer={string:function(N){return y(new Uint8Array(N))},array:function(N){return x(new Uint8Array(N),new Array(N.byteLength))},arraybuffer:h,uint8array:function(N){return new Uint8Array(N)},nodebuffer:function(N){return d.newBufferFrom(new Uint8Array(N))}},v.uint8array={string:y,array:function(N){return x(N,new Array(N.length))},arraybuffer:function(N){return N.buffer},uint8array:h,nodebuffer:function(N){return d.newBufferFrom(N)}},v.nodebuffer={string:y,array:function(N){return x(N,new Array(N.length))},arraybuffer:function(N){return v.nodebuffer.uint8array(N).buffer},uint8array:function(N){return x(N,new Uint8Array(N.length))},nodebuffer:h},l.transformTo=function(N,j){if(j=j||"",!N)return j;l.checkSupport(N);var C=l.getTypeOf(j);return v[C][N](j)},l.resolve=function(N){for(var j=N.split("/"),C=[],A=0;A<j.length;A++){var _=j[A];_==="."||_===""&&A!==0&&A!==j.length-1||(_===".."?C.pop():C.push(_))}return C.join("/")},l.getTypeOf=function(N){return typeof N=="string"?"string":Object.prototype.toString.call(N)==="[object Array]"?"array":o.nodebuffer&&d.isBuffer(N)?"nodebuffer":o.uint8array&&N instanceof Uint8Array?"uint8array":o.arraybuffer&&N instanceof ArrayBuffer?"arraybuffer":void 0},l.checkSupport=function(N){if(!o[N.toLowerCase()])throw new Error(N+" is not supported by this platform")},l.MAX_VALUE_16BITS=65535,l.MAX_VALUE_32BITS=-1,l.pretty=function(N){var j,C,A="";for(C=0;C<(N||"").length;C++)A+="\\x"+((j=N.charCodeAt(C))<16?"0":"")+j.toString(16).toUpperCase();return A},l.delay=function(N,j,C){setImmediate(function(){N.apply(C||null,j||[])})},l.inherits=function(N,j){function C(){}C.prototype=j.prototype,N.prototype=new C},l.extend=function(){var N,j,C={};for(N=0;N<arguments.length;N++)for(j in arguments[N])Object.prototype.hasOwnProperty.call(arguments[N],j)&&C[j]===void 0&&(C[j]=arguments[N][j]);return C},l.prepareContent=function(N,j,C,A,_){return m.Promise.resolve(j).then(function(T){return o.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1)&&typeof FileReader<"u"?new m.Promise(function(L,H){var k=new FileReader;k.onload=function(R){L(R.target.result)},k.onerror=function(R){H(R.target.error)},k.readAsArrayBuffer(T)}):T}).then(function(T){var L=l.getTypeOf(T);return L?(L==="arraybuffer"?T=l.transformTo("uint8array",T):L==="string"&&(_?T=u.decode(T):C&&A!==!0&&(T=(function(H){return p(H,o.uint8array?new Uint8Array(H.length):new Array(H.length))})(T))),T):m.Promise.reject(new Error("Can't read the data of '"+N+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,i,l){var o=n("./reader/readerFor"),u=n("./utils"),d=n("./signature"),m=n("./zipEntry"),h=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var y=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+u.pretty(y)+", expected "+u.pretty(g)+")")}},isSignature:function(g,y){var x=this.reader.index;this.reader.setIndex(g);var v=this.reader.readString(4)===y;return this.reader.setIndex(x),v},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),y=h.uint8array?"uint8array":"array",x=u.transformTo(y,g);this.zipComment=this.loadOptions.decodeFileName(x)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,y,x,v=this.zip64EndOfCentralSize-44;0<v;)g=this.reader.readInt(2),y=this.reader.readInt(4),x=this.reader.readData(y),this.zip64ExtensibleData[g]={id:g,length:y,value:x}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,y;for(g=0;g<this.files.length;g++)y=this.files[g],this.reader.setIndex(y.localHeaderOffset),this.checkSignature(d.LOCAL_FILE_HEADER),y.readLocalPart(this.reader),y.handleUTF8(),y.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(d.CENTRAL_FILE_HEADER);)(g=new m({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(d.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,d.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var y=g;if(this.checkSignature(d.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===u.MAX_VALUE_16BITS||this.diskWithCentralDirStart===u.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===u.MAX_VALUE_16BITS||this.centralDirRecords===u.MAX_VALUE_16BITS||this.centralDirSize===u.MAX_VALUE_32BITS||this.centralDirOffset===u.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,d.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var x=this.centralDirOffset+this.centralDirSize;this.zip64&&(x+=20,x+=12+this.zip64EndOfCentralSize);var v=y-x;if(0<v)this.isSignature(y,d.CENTRAL_FILE_HEADER)||(this.reader.zero=v);else if(v<0)throw new Error("Corrupted zip: missing "+Math.abs(v)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,i,l){var o=n("./reader/readerFor"),u=n("./utils"),d=n("./compressedObject"),m=n("./crc32"),h=n("./utf8"),p=n("./compressions"),g=n("./support");function y(x,v){this.options=x,this.loadOptions=v}y.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(x){var v,N;if(x.skip(22),this.fileNameLength=x.readInt(2),N=x.readInt(2),this.fileName=x.readData(this.fileNameLength),x.skip(N),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((v=(function(j){for(var C in p)if(Object.prototype.hasOwnProperty.call(p,C)&&p[C].magic===j)return p[C];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+u.pretty(this.compressionMethod)+" unknown (inner file : "+u.transformTo("string",this.fileName)+")");this.decompressed=new d(this.compressedSize,this.uncompressedSize,this.crc32,v,x.readData(this.compressedSize))},readCentralPart:function(x){this.versionMadeBy=x.readInt(2),x.skip(2),this.bitFlag=x.readInt(2),this.compressionMethod=x.readString(2),this.date=x.readDate(),this.crc32=x.readInt(4),this.compressedSize=x.readInt(4),this.uncompressedSize=x.readInt(4);var v=x.readInt(2);if(this.extraFieldsLength=x.readInt(2),this.fileCommentLength=x.readInt(2),this.diskNumberStart=x.readInt(2),this.internalFileAttributes=x.readInt(2),this.externalFileAttributes=x.readInt(4),this.localHeaderOffset=x.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");x.skip(v),this.readExtraFields(x),this.parseZIP64ExtraField(x),this.fileComment=x.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var x=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),x==0&&(this.dosPermissions=63&this.externalFileAttributes),x==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var x=o(this.extraFields[1].value);this.uncompressedSize===u.MAX_VALUE_32BITS&&(this.uncompressedSize=x.readInt(8)),this.compressedSize===u.MAX_VALUE_32BITS&&(this.compressedSize=x.readInt(8)),this.localHeaderOffset===u.MAX_VALUE_32BITS&&(this.localHeaderOffset=x.readInt(8)),this.diskNumberStart===u.MAX_VALUE_32BITS&&(this.diskNumberStart=x.readInt(4))}},readExtraFields:function(x){var v,N,j,C=x.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});x.index+4<C;)v=x.readInt(2),N=x.readInt(2),j=x.readData(N),this.extraFields[v]={id:v,length:N,value:j};x.setIndex(C)},handleUTF8:function(){var x=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var v=this.findExtraFieldUnicodePath();if(v!==null)this.fileNameStr=v;else{var N=u.transformTo(x,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(N)}var j=this.findExtraFieldUnicodeComment();if(j!==null)this.fileCommentStr=j;else{var C=u.transformTo(x,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(C)}}},findExtraFieldUnicodePath:function(){var x=this.extraFields[28789];if(x){var v=o(x.value);return v.readInt(1)!==1||m(this.fileName)!==v.readInt(4)?null:h.utf8decode(v.readData(x.length-5))}return null},findExtraFieldUnicodeComment:function(){var x=this.extraFields[25461];if(x){var v=o(x.value);return v.readInt(1)!==1||m(this.fileComment)!==v.readInt(4)?null:h.utf8decode(v.readData(x.length-5))}return null}},i.exports=y},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,i,l){function o(v,N,j){this.name=v,this.dir=j.dir,this.date=j.date,this.comment=j.comment,this.unixPermissions=j.unixPermissions,this.dosPermissions=j.dosPermissions,this._data=N,this._dataBinary=j.binary,this.options={compression:j.compression,compressionOptions:j.compressionOptions}}var u=n("./stream/StreamHelper"),d=n("./stream/DataWorker"),m=n("./utf8"),h=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(v){var N=null,j="string";try{if(!v)throw new Error("No output type specified.");var C=(j=v.toLowerCase())==="string"||j==="text";j!=="binarystring"&&j!=="text"||(j="string"),N=this._decompressWorker();var A=!this._dataBinary;A&&!C&&(N=N.pipe(new m.Utf8EncodeWorker)),!A&&C&&(N=N.pipe(new m.Utf8DecodeWorker))}catch(_){(N=new p("error")).error(_)}return new u(N,j,"")},async:function(v,N){return this.internalStream(v).accumulate(N)},nodeStream:function(v,N){return this.internalStream(v||"nodebuffer").toNodejsStream(N)},_compressWorker:function(v,N){if(this._data instanceof h&&this._data.compression.magic===v.magic)return this._data.getCompressedWorker();var j=this._decompressWorker();return this._dataBinary||(j=j.pipe(new m.Utf8EncodeWorker)),h.createWorkerFrom(j,v,N)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof p?this._data:new d(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],y=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},x=0;x<g.length;x++)o.prototype[g[x]]=y;i.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,i,l){(function(o){var u,d,m=o.MutationObserver||o.WebKitMutationObserver;if(m){var h=0,p=new m(v),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),u=function(){g.data=h=++h%2}}else if(o.setImmediate||o.MessageChannel===void 0)u="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var N=o.document.createElement("script");N.onreadystatechange=function(){v(),N.onreadystatechange=null,N.parentNode.removeChild(N),N=null},o.document.documentElement.appendChild(N)}:function(){setTimeout(v,0)};else{var y=new o.MessageChannel;y.port1.onmessage=v,u=function(){y.port2.postMessage(0)}}var x=[];function v(){var N,j;d=!0;for(var C=x.length;C;){for(j=x,x=[],N=-1;++N<C;)j[N]();C=x.length}d=!1}i.exports=function(N){x.push(N)!==1||d||u()}}).call(this,typeof qa<"u"?qa:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,i,l){var o=n("immediate");function u(){}var d={},m=["REJECTED"],h=["FULFILLED"],p=["PENDING"];function g(C){if(typeof C!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,C!==u&&N(this,C)}function y(C,A,_){this.promise=C,typeof A=="function"&&(this.onFulfilled=A,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}function x(C,A,_){o(function(){var T;try{T=A(_)}catch(L){return d.reject(C,L)}T===C?d.reject(C,new TypeError("Cannot resolve promise with itself")):d.resolve(C,T)})}function v(C){var A=C&&C.then;if(C&&(typeof C=="object"||typeof C=="function")&&typeof A=="function")return function(){A.apply(C,arguments)}}function N(C,A){var _=!1;function T(k){_||(_=!0,d.reject(C,k))}function L(k){_||(_=!0,d.resolve(C,k))}var H=j(function(){A(L,T)});H.status==="error"&&T(H.value)}function j(C,A){var _={};try{_.value=C(A),_.status="success"}catch(T){_.status="error",_.value=T}return _}(i.exports=g).prototype.finally=function(C){if(typeof C!="function")return this;var A=this.constructor;return this.then(function(_){return A.resolve(C()).then(function(){return _})},function(_){return A.resolve(C()).then(function(){throw _})})},g.prototype.catch=function(C){return this.then(null,C)},g.prototype.then=function(C,A){if(typeof C!="function"&&this.state===h||typeof A!="function"&&this.state===m)return this;var _=new this.constructor(u);return this.state!==p?x(_,this.state===h?C:A,this.outcome):this.queue.push(new y(_,C,A)),_},y.prototype.callFulfilled=function(C){d.resolve(this.promise,C)},y.prototype.otherCallFulfilled=function(C){x(this.promise,this.onFulfilled,C)},y.prototype.callRejected=function(C){d.reject(this.promise,C)},y.prototype.otherCallRejected=function(C){x(this.promise,this.onRejected,C)},d.resolve=function(C,A){var _=j(v,A);if(_.status==="error")return d.reject(C,_.value);var T=_.value;if(T)N(C,T);else{C.state=h,C.outcome=A;for(var L=-1,H=C.queue.length;++L<H;)C.queue[L].callFulfilled(A)}return C},d.reject=function(C,A){C.state=m,C.outcome=A;for(var _=-1,T=C.queue.length;++_<T;)C.queue[_].callRejected(A);return C},g.resolve=function(C){return C instanceof this?C:d.resolve(new this(u),C)},g.reject=function(C){var A=new this(u);return d.reject(A,C)},g.all=function(C){var A=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=C.length,T=!1;if(!_)return this.resolve([]);for(var L=new Array(_),H=0,k=-1,R=new this(u);++k<_;)z(C[k],k);return R;function z(P,K){A.resolve(P).then(function(I){L[K]=I,++H!==_||T||(T=!0,d.resolve(R,L))},function(I){T||(T=!0,d.reject(R,I))})}},g.race=function(C){var A=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=C.length,T=!1;if(!_)return this.resolve([]);for(var L=-1,H=new this(u);++L<_;)k=C[L],A.resolve(k).then(function(R){T||(T=!0,d.resolve(H,R))},function(R){T||(T=!0,d.reject(H,R))});var k;return H}},{immediate:36}],38:[function(n,i,l){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),i.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,i,l){var o=n("./zlib/deflate"),u=n("./utils/common"),d=n("./utils/strings"),m=n("./zlib/messages"),h=n("./zlib/zstream"),p=Object.prototype.toString,g=0,y=-1,x=0,v=8;function N(C){if(!(this instanceof N))return new N(C);this.options=u.assign({level:y,method:v,chunkSize:16384,windowBits:15,memLevel:8,strategy:x,to:""},C||{});var A=this.options;A.raw&&0<A.windowBits?A.windowBits=-A.windowBits:A.gzip&&0<A.windowBits&&A.windowBits<16&&(A.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var _=o.deflateInit2(this.strm,A.level,A.method,A.windowBits,A.memLevel,A.strategy);if(_!==g)throw new Error(m[_]);if(A.header&&o.deflateSetHeader(this.strm,A.header),A.dictionary){var T;if(T=typeof A.dictionary=="string"?d.string2buf(A.dictionary):p.call(A.dictionary)==="[object ArrayBuffer]"?new Uint8Array(A.dictionary):A.dictionary,(_=o.deflateSetDictionary(this.strm,T))!==g)throw new Error(m[_]);this._dict_set=!0}}function j(C,A){var _=new N(A);if(_.push(C,!0),_.err)throw _.msg||m[_.err];return _.result}N.prototype.push=function(C,A){var _,T,L=this.strm,H=this.options.chunkSize;if(this.ended)return!1;T=A===~~A?A:A===!0?4:0,typeof C=="string"?L.input=d.string2buf(C):p.call(C)==="[object ArrayBuffer]"?L.input=new Uint8Array(C):L.input=C,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new u.Buf8(H),L.next_out=0,L.avail_out=H),(_=o.deflate(L,T))!==1&&_!==g)return this.onEnd(_),!(this.ended=!0);L.avail_out!==0&&(L.avail_in!==0||T!==4&&T!==2)||(this.options.to==="string"?this.onData(d.buf2binstring(u.shrinkBuf(L.output,L.next_out))):this.onData(u.shrinkBuf(L.output,L.next_out)))}while((0<L.avail_in||L.avail_out===0)&&_!==1);return T===4?(_=o.deflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===g):T!==2||(this.onEnd(g),!(L.avail_out=0))},N.prototype.onData=function(C){this.chunks.push(C)},N.prototype.onEnd=function(C){C===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},l.Deflate=N,l.deflate=j,l.deflateRaw=function(C,A){return(A=A||{}).raw=!0,j(C,A)},l.gzip=function(C,A){return(A=A||{}).gzip=!0,j(C,A)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,i,l){var o=n("./zlib/inflate"),u=n("./utils/common"),d=n("./utils/strings"),m=n("./zlib/constants"),h=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),y=Object.prototype.toString;function x(N){if(!(this instanceof x))return new x(N);this.options=u.assign({chunkSize:16384,windowBits:0,to:""},N||{});var j=this.options;j.raw&&0<=j.windowBits&&j.windowBits<16&&(j.windowBits=-j.windowBits,j.windowBits===0&&(j.windowBits=-15)),!(0<=j.windowBits&&j.windowBits<16)||N&&N.windowBits||(j.windowBits+=32),15<j.windowBits&&j.windowBits<48&&(15&j.windowBits)==0&&(j.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var C=o.inflateInit2(this.strm,j.windowBits);if(C!==m.Z_OK)throw new Error(h[C]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function v(N,j){var C=new x(j);if(C.push(N,!0),C.err)throw C.msg||h[C.err];return C.result}x.prototype.push=function(N,j){var C,A,_,T,L,H,k=this.strm,R=this.options.chunkSize,z=this.options.dictionary,P=!1;if(this.ended)return!1;A=j===~~j?j:j===!0?m.Z_FINISH:m.Z_NO_FLUSH,typeof N=="string"?k.input=d.binstring2buf(N):y.call(N)==="[object ArrayBuffer]"?k.input=new Uint8Array(N):k.input=N,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new u.Buf8(R),k.next_out=0,k.avail_out=R),(C=o.inflate(k,m.Z_NO_FLUSH))===m.Z_NEED_DICT&&z&&(H=typeof z=="string"?d.string2buf(z):y.call(z)==="[object ArrayBuffer]"?new Uint8Array(z):z,C=o.inflateSetDictionary(this.strm,H)),C===m.Z_BUF_ERROR&&P===!0&&(C=m.Z_OK,P=!1),C!==m.Z_STREAM_END&&C!==m.Z_OK)return this.onEnd(C),!(this.ended=!0);k.next_out&&(k.avail_out!==0&&C!==m.Z_STREAM_END&&(k.avail_in!==0||A!==m.Z_FINISH&&A!==m.Z_SYNC_FLUSH)||(this.options.to==="string"?(_=d.utf8border(k.output,k.next_out),T=k.next_out-_,L=d.buf2string(k.output,_),k.next_out=T,k.avail_out=R-T,T&&u.arraySet(k.output,k.output,_,T,0),this.onData(L)):this.onData(u.shrinkBuf(k.output,k.next_out)))),k.avail_in===0&&k.avail_out===0&&(P=!0)}while((0<k.avail_in||k.avail_out===0)&&C!==m.Z_STREAM_END);return C===m.Z_STREAM_END&&(A=m.Z_FINISH),A===m.Z_FINISH?(C=o.inflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===m.Z_OK):A!==m.Z_SYNC_FLUSH||(this.onEnd(m.Z_OK),!(k.avail_out=0))},x.prototype.onData=function(N){this.chunks.push(N)},x.prototype.onEnd=function(N){N===m.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=N,this.msg=this.strm.msg},l.Inflate=x,l.inflate=v,l.inflateRaw=function(N,j){return(j=j||{}).raw=!0,v(N,j)},l.ungzip=v},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,i,l){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";l.assign=function(m){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var p=h.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(m[g]=p[g])}}return m},l.shrinkBuf=function(m,h){return m.length===h?m:m.subarray?m.subarray(0,h):(m.length=h,m)};var u={arraySet:function(m,h,p,g,y){if(h.subarray&&m.subarray)m.set(h.subarray(p,p+g),y);else for(var x=0;x<g;x++)m[y+x]=h[p+x]},flattenChunks:function(m){var h,p,g,y,x,v;for(h=g=0,p=m.length;h<p;h++)g+=m[h].length;for(v=new Uint8Array(g),h=y=0,p=m.length;h<p;h++)x=m[h],v.set(x,y),y+=x.length;return v}},d={arraySet:function(m,h,p,g,y){for(var x=0;x<g;x++)m[y+x]=h[p+x]},flattenChunks:function(m){return[].concat.apply([],m)}};l.setTyped=function(m){m?(l.Buf8=Uint8Array,l.Buf16=Uint16Array,l.Buf32=Int32Array,l.assign(l,u)):(l.Buf8=Array,l.Buf16=Array,l.Buf32=Array,l.assign(l,d))},l.setTyped(o)},{}],42:[function(n,i,l){var o=n("./common"),u=!0,d=!0;try{String.fromCharCode.apply(null,[0])}catch{u=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d=!1}for(var m=new o.Buf8(256),h=0;h<256;h++)m[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function p(g,y){if(y<65537&&(g.subarray&&d||!g.subarray&&u))return String.fromCharCode.apply(null,o.shrinkBuf(g,y));for(var x="",v=0;v<y;v++)x+=String.fromCharCode(g[v]);return x}m[254]=m[254]=1,l.string2buf=function(g){var y,x,v,N,j,C=g.length,A=0;for(N=0;N<C;N++)(64512&(x=g.charCodeAt(N)))==55296&&N+1<C&&(64512&(v=g.charCodeAt(N+1)))==56320&&(x=65536+(x-55296<<10)+(v-56320),N++),A+=x<128?1:x<2048?2:x<65536?3:4;for(y=new o.Buf8(A),N=j=0;j<A;N++)(64512&(x=g.charCodeAt(N)))==55296&&N+1<C&&(64512&(v=g.charCodeAt(N+1)))==56320&&(x=65536+(x-55296<<10)+(v-56320),N++),x<128?y[j++]=x:(x<2048?y[j++]=192|x>>>6:(x<65536?y[j++]=224|x>>>12:(y[j++]=240|x>>>18,y[j++]=128|x>>>12&63),y[j++]=128|x>>>6&63),y[j++]=128|63&x);return y},l.buf2binstring=function(g){return p(g,g.length)},l.binstring2buf=function(g){for(var y=new o.Buf8(g.length),x=0,v=y.length;x<v;x++)y[x]=g.charCodeAt(x);return y},l.buf2string=function(g,y){var x,v,N,j,C=y||g.length,A=new Array(2*C);for(x=v=0;x<C;)if((N=g[x++])<128)A[v++]=N;else if(4<(j=m[N]))A[v++]=65533,x+=j-1;else{for(N&=j===2?31:j===3?15:7;1<j&&x<C;)N=N<<6|63&g[x++],j--;1<j?A[v++]=65533:N<65536?A[v++]=N:(N-=65536,A[v++]=55296|N>>10&1023,A[v++]=56320|1023&N)}return p(A,v)},l.utf8border=function(g,y){var x;for((y=y||g.length)>g.length&&(y=g.length),x=y-1;0<=x&&(192&g[x])==128;)x--;return x<0||x===0?y:x+m[g[x]]>y?x:y}},{"./common":41}],43:[function(n,i,l){i.exports=function(o,u,d,m){for(var h=65535&o|0,p=o>>>16&65535|0,g=0;d!==0;){for(d-=g=2e3<d?2e3:d;p=p+(h=h+u[m++]|0)|0,--g;);h%=65521,p%=65521}return h|p<<16|0}},{}],44:[function(n,i,l){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,i,l){var o=(function(){for(var u,d=[],m=0;m<256;m++){u=m;for(var h=0;h<8;h++)u=1&u?3988292384^u>>>1:u>>>1;d[m]=u}return d})();i.exports=function(u,d,m,h){var p=o,g=h+m;u^=-1;for(var y=h;y<g;y++)u=u>>>8^p[255&(u^d[y])];return-1^u}},{}],46:[function(n,i,l){var o,u=n("../utils/common"),d=n("./trees"),m=n("./adler32"),h=n("./crc32"),p=n("./messages"),g=0,y=4,x=0,v=-2,N=-1,j=4,C=2,A=8,_=9,T=286,L=30,H=19,k=2*T+1,R=15,z=3,P=258,K=P+z+1,I=42,D=113,E=1,q=2,W=3,G=4;function te(F,me){return F.msg=p[me],me}function U(F){return(F<<1)-(4<F?9:0)}function V(F){for(var me=F.length;0<=--me;)F[me]=0}function O(F){var me=F.state,he=me.pending;he>F.avail_out&&(he=F.avail_out),he!==0&&(u.arraySet(F.output,me.pending_buf,me.pending_out,he,F.next_out),F.next_out+=he,me.pending_out+=he,F.total_out+=he,F.avail_out-=he,me.pending-=he,me.pending===0&&(me.pending_out=0))}function B(F,me){d._tr_flush_block(F,0<=F.block_start?F.block_start:-1,F.strstart-F.block_start,me),F.block_start=F.strstart,O(F.strm)}function Y(F,me){F.pending_buf[F.pending++]=me}function X(F,me){F.pending_buf[F.pending++]=me>>>8&255,F.pending_buf[F.pending++]=255&me}function Q(F,me){var he,ee,Z=F.max_chain_length,se=F.strstart,Te=F.prev_length,_e=F.nice_match,ne=F.strstart>F.w_size-K?F.strstart-(F.w_size-K):0,ge=F.window,Se=F.w_mask,Ce=F.prev,Me=F.strstart+P,Be=ge[se+Te-1],We=ge[se+Te];F.prev_length>=F.good_match&&(Z>>=2),_e>F.lookahead&&(_e=F.lookahead);do if(ge[(he=me)+Te]===We&&ge[he+Te-1]===Be&&ge[he]===ge[se]&&ge[++he]===ge[se+1]){se+=2,he++;do;while(ge[++se]===ge[++he]&&ge[++se]===ge[++he]&&ge[++se]===ge[++he]&&ge[++se]===ge[++he]&&ge[++se]===ge[++he]&&ge[++se]===ge[++he]&&ge[++se]===ge[++he]&&ge[++se]===ge[++he]&&se<Me);if(ee=P-(Me-se),se=Me-P,Te<ee){if(F.match_start=me,_e<=(Te=ee))break;Be=ge[se+Te-1],We=ge[se+Te]}}while((me=Ce[me&Se])>ne&&--Z!=0);return Te<=F.lookahead?Te:F.lookahead}function ue(F){var me,he,ee,Z,se,Te,_e,ne,ge,Se,Ce=F.w_size;do{if(Z=F.window_size-F.lookahead-F.strstart,F.strstart>=Ce+(Ce-K)){for(u.arraySet(F.window,F.window,Ce,Ce,0),F.match_start-=Ce,F.strstart-=Ce,F.block_start-=Ce,me=he=F.hash_size;ee=F.head[--me],F.head[me]=Ce<=ee?ee-Ce:0,--he;);for(me=he=Ce;ee=F.prev[--me],F.prev[me]=Ce<=ee?ee-Ce:0,--he;);Z+=Ce}if(F.strm.avail_in===0)break;if(Te=F.strm,_e=F.window,ne=F.strstart+F.lookahead,ge=Z,Se=void 0,Se=Te.avail_in,ge<Se&&(Se=ge),he=Se===0?0:(Te.avail_in-=Se,u.arraySet(_e,Te.input,Te.next_in,Se,ne),Te.state.wrap===1?Te.adler=m(Te.adler,_e,Se,ne):Te.state.wrap===2&&(Te.adler=h(Te.adler,_e,Se,ne)),Te.next_in+=Se,Te.total_in+=Se,Se),F.lookahead+=he,F.lookahead+F.insert>=z)for(se=F.strstart-F.insert,F.ins_h=F.window[se],F.ins_h=(F.ins_h<<F.hash_shift^F.window[se+1])&F.hash_mask;F.insert&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[se+z-1])&F.hash_mask,F.prev[se&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=se,se++,F.insert--,!(F.lookahead+F.insert<z)););}while(F.lookahead<K&&F.strm.avail_in!==0)}function be(F,me){for(var he,ee;;){if(F.lookahead<K){if(ue(F),F.lookahead<K&&me===g)return E;if(F.lookahead===0)break}if(he=0,F.lookahead>=z&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+z-1])&F.hash_mask,he=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),he!==0&&F.strstart-he<=F.w_size-K&&(F.match_length=Q(F,he)),F.match_length>=z)if(ee=d._tr_tally(F,F.strstart-F.match_start,F.match_length-z),F.lookahead-=F.match_length,F.match_length<=F.max_lazy_match&&F.lookahead>=z){for(F.match_length--;F.strstart++,F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+z-1])&F.hash_mask,he=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart,--F.match_length!=0;);F.strstart++}else F.strstart+=F.match_length,F.match_length=0,F.ins_h=F.window[F.strstart],F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+1])&F.hash_mask;else ee=d._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++;if(ee&&(B(F,!1),F.strm.avail_out===0))return E}return F.insert=F.strstart<z-1?F.strstart:z-1,me===y?(B(F,!0),F.strm.avail_out===0?W:G):F.last_lit&&(B(F,!1),F.strm.avail_out===0)?E:q}function de(F,me){for(var he,ee,Z;;){if(F.lookahead<K){if(ue(F),F.lookahead<K&&me===g)return E;if(F.lookahead===0)break}if(he=0,F.lookahead>=z&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+z-1])&F.hash_mask,he=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),F.prev_length=F.match_length,F.prev_match=F.match_start,F.match_length=z-1,he!==0&&F.prev_length<F.max_lazy_match&&F.strstart-he<=F.w_size-K&&(F.match_length=Q(F,he),F.match_length<=5&&(F.strategy===1||F.match_length===z&&4096<F.strstart-F.match_start)&&(F.match_length=z-1)),F.prev_length>=z&&F.match_length<=F.prev_length){for(Z=F.strstart+F.lookahead-z,ee=d._tr_tally(F,F.strstart-1-F.prev_match,F.prev_length-z),F.lookahead-=F.prev_length-1,F.prev_length-=2;++F.strstart<=Z&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+z-1])&F.hash_mask,he=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),--F.prev_length!=0;);if(F.match_available=0,F.match_length=z-1,F.strstart++,ee&&(B(F,!1),F.strm.avail_out===0))return E}else if(F.match_available){if((ee=d._tr_tally(F,0,F.window[F.strstart-1]))&&B(F,!1),F.strstart++,F.lookahead--,F.strm.avail_out===0)return E}else F.match_available=1,F.strstart++,F.lookahead--}return F.match_available&&(ee=d._tr_tally(F,0,F.window[F.strstart-1]),F.match_available=0),F.insert=F.strstart<z-1?F.strstart:z-1,me===y?(B(F,!0),F.strm.avail_out===0?W:G):F.last_lit&&(B(F,!1),F.strm.avail_out===0)?E:q}function ye(F,me,he,ee,Z){this.good_length=F,this.max_lazy=me,this.nice_length=he,this.max_chain=ee,this.func=Z}function le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=A,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new u.Buf16(2*k),this.dyn_dtree=new u.Buf16(2*(2*L+1)),this.bl_tree=new u.Buf16(2*(2*H+1)),V(this.dyn_ltree),V(this.dyn_dtree),V(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new u.Buf16(R+1),this.heap=new u.Buf16(2*T+1),V(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new u.Buf16(2*T+1),V(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function we(F){var me;return F&&F.state?(F.total_in=F.total_out=0,F.data_type=C,(me=F.state).pending=0,me.pending_out=0,me.wrap<0&&(me.wrap=-me.wrap),me.status=me.wrap?I:D,F.adler=me.wrap===2?0:1,me.last_flush=g,d._tr_init(me),x):te(F,v)}function He(F){var me=we(F);return me===x&&(function(he){he.window_size=2*he.w_size,V(he.head),he.max_lazy_match=o[he.level].max_lazy,he.good_match=o[he.level].good_length,he.nice_match=o[he.level].nice_length,he.max_chain_length=o[he.level].max_chain,he.strstart=0,he.block_start=0,he.lookahead=0,he.insert=0,he.match_length=he.prev_length=z-1,he.match_available=0,he.ins_h=0})(F.state),me}function Ke(F,me,he,ee,Z,se){if(!F)return v;var Te=1;if(me===N&&(me=6),ee<0?(Te=0,ee=-ee):15<ee&&(Te=2,ee-=16),Z<1||_<Z||he!==A||ee<8||15<ee||me<0||9<me||se<0||j<se)return te(F,v);ee===8&&(ee=9);var _e=new le;return(F.state=_e).strm=F,_e.wrap=Te,_e.gzhead=null,_e.w_bits=ee,_e.w_size=1<<_e.w_bits,_e.w_mask=_e.w_size-1,_e.hash_bits=Z+7,_e.hash_size=1<<_e.hash_bits,_e.hash_mask=_e.hash_size-1,_e.hash_shift=~~((_e.hash_bits+z-1)/z),_e.window=new u.Buf8(2*_e.w_size),_e.head=new u.Buf16(_e.hash_size),_e.prev=new u.Buf16(_e.w_size),_e.lit_bufsize=1<<Z+6,_e.pending_buf_size=4*_e.lit_bufsize,_e.pending_buf=new u.Buf8(_e.pending_buf_size),_e.d_buf=1*_e.lit_bufsize,_e.l_buf=3*_e.lit_bufsize,_e.level=me,_e.strategy=se,_e.method=he,He(F)}o=[new ye(0,0,0,0,function(F,me){var he=65535;for(he>F.pending_buf_size-5&&(he=F.pending_buf_size-5);;){if(F.lookahead<=1){if(ue(F),F.lookahead===0&&me===g)return E;if(F.lookahead===0)break}F.strstart+=F.lookahead,F.lookahead=0;var ee=F.block_start+he;if((F.strstart===0||F.strstart>=ee)&&(F.lookahead=F.strstart-ee,F.strstart=ee,B(F,!1),F.strm.avail_out===0)||F.strstart-F.block_start>=F.w_size-K&&(B(F,!1),F.strm.avail_out===0))return E}return F.insert=0,me===y?(B(F,!0),F.strm.avail_out===0?W:G):(F.strstart>F.block_start&&(B(F,!1),F.strm.avail_out),E)}),new ye(4,4,8,4,be),new ye(4,5,16,8,be),new ye(4,6,32,32,be),new ye(4,4,16,16,de),new ye(8,16,32,32,de),new ye(8,16,128,128,de),new ye(8,32,128,256,de),new ye(32,128,258,1024,de),new ye(32,258,258,4096,de)],l.deflateInit=function(F,me){return Ke(F,me,A,15,8,0)},l.deflateInit2=Ke,l.deflateReset=He,l.deflateResetKeep=we,l.deflateSetHeader=function(F,me){return F&&F.state?F.state.wrap!==2?v:(F.state.gzhead=me,x):v},l.deflate=function(F,me){var he,ee,Z,se;if(!F||!F.state||5<me||me<0)return F?te(F,v):v;if(ee=F.state,!F.output||!F.input&&F.avail_in!==0||ee.status===666&&me!==y)return te(F,F.avail_out===0?-5:v);if(ee.strm=F,he=ee.last_flush,ee.last_flush=me,ee.status===I)if(ee.wrap===2)F.adler=0,Y(ee,31),Y(ee,139),Y(ee,8),ee.gzhead?(Y(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0)),Y(ee,255&ee.gzhead.time),Y(ee,ee.gzhead.time>>8&255),Y(ee,ee.gzhead.time>>16&255),Y(ee,ee.gzhead.time>>24&255),Y(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),Y(ee,255&ee.gzhead.os),ee.gzhead.extra&&ee.gzhead.extra.length&&(Y(ee,255&ee.gzhead.extra.length),Y(ee,ee.gzhead.extra.length>>8&255)),ee.gzhead.hcrc&&(F.adler=h(F.adler,ee.pending_buf,ee.pending,0)),ee.gzindex=0,ee.status=69):(Y(ee,0),Y(ee,0),Y(ee,0),Y(ee,0),Y(ee,0),Y(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),Y(ee,3),ee.status=D);else{var Te=A+(ee.w_bits-8<<4)<<8;Te|=(2<=ee.strategy||ee.level<2?0:ee.level<6?1:ee.level===6?2:3)<<6,ee.strstart!==0&&(Te|=32),Te+=31-Te%31,ee.status=D,X(ee,Te),ee.strstart!==0&&(X(ee,F.adler>>>16),X(ee,65535&F.adler)),F.adler=1}if(ee.status===69)if(ee.gzhead.extra){for(Z=ee.pending;ee.gzindex<(65535&ee.gzhead.extra.length)&&(ee.pending!==ee.pending_buf_size||(ee.gzhead.hcrc&&ee.pending>Z&&(F.adler=h(F.adler,ee.pending_buf,ee.pending-Z,Z)),O(F),Z=ee.pending,ee.pending!==ee.pending_buf_size));)Y(ee,255&ee.gzhead.extra[ee.gzindex]),ee.gzindex++;ee.gzhead.hcrc&&ee.pending>Z&&(F.adler=h(F.adler,ee.pending_buf,ee.pending-Z,Z)),ee.gzindex===ee.gzhead.extra.length&&(ee.gzindex=0,ee.status=73)}else ee.status=73;if(ee.status===73)if(ee.gzhead.name){Z=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>Z&&(F.adler=h(F.adler,ee.pending_buf,ee.pending-Z,Z)),O(F),Z=ee.pending,ee.pending===ee.pending_buf_size)){se=1;break}se=ee.gzindex<ee.gzhead.name.length?255&ee.gzhead.name.charCodeAt(ee.gzindex++):0,Y(ee,se)}while(se!==0);ee.gzhead.hcrc&&ee.pending>Z&&(F.adler=h(F.adler,ee.pending_buf,ee.pending-Z,Z)),se===0&&(ee.gzindex=0,ee.status=91)}else ee.status=91;if(ee.status===91)if(ee.gzhead.comment){Z=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>Z&&(F.adler=h(F.adler,ee.pending_buf,ee.pending-Z,Z)),O(F),Z=ee.pending,ee.pending===ee.pending_buf_size)){se=1;break}se=ee.gzindex<ee.gzhead.comment.length?255&ee.gzhead.comment.charCodeAt(ee.gzindex++):0,Y(ee,se)}while(se!==0);ee.gzhead.hcrc&&ee.pending>Z&&(F.adler=h(F.adler,ee.pending_buf,ee.pending-Z,Z)),se===0&&(ee.status=103)}else ee.status=103;if(ee.status===103&&(ee.gzhead.hcrc?(ee.pending+2>ee.pending_buf_size&&O(F),ee.pending+2<=ee.pending_buf_size&&(Y(ee,255&F.adler),Y(ee,F.adler>>8&255),F.adler=0,ee.status=D)):ee.status=D),ee.pending!==0){if(O(F),F.avail_out===0)return ee.last_flush=-1,x}else if(F.avail_in===0&&U(me)<=U(he)&&me!==y)return te(F,-5);if(ee.status===666&&F.avail_in!==0)return te(F,-5);if(F.avail_in!==0||ee.lookahead!==0||me!==g&&ee.status!==666){var _e=ee.strategy===2?(function(ne,ge){for(var Se;;){if(ne.lookahead===0&&(ue(ne),ne.lookahead===0)){if(ge===g)return E;break}if(ne.match_length=0,Se=d._tr_tally(ne,0,ne.window[ne.strstart]),ne.lookahead--,ne.strstart++,Se&&(B(ne,!1),ne.strm.avail_out===0))return E}return ne.insert=0,ge===y?(B(ne,!0),ne.strm.avail_out===0?W:G):ne.last_lit&&(B(ne,!1),ne.strm.avail_out===0)?E:q})(ee,me):ee.strategy===3?(function(ne,ge){for(var Se,Ce,Me,Be,We=ne.window;;){if(ne.lookahead<=P){if(ue(ne),ne.lookahead<=P&&ge===g)return E;if(ne.lookahead===0)break}if(ne.match_length=0,ne.lookahead>=z&&0<ne.strstart&&(Ce=We[Me=ne.strstart-1])===We[++Me]&&Ce===We[++Me]&&Ce===We[++Me]){Be=ne.strstart+P;do;while(Ce===We[++Me]&&Ce===We[++Me]&&Ce===We[++Me]&&Ce===We[++Me]&&Ce===We[++Me]&&Ce===We[++Me]&&Ce===We[++Me]&&Ce===We[++Me]&&Me<Be);ne.match_length=P-(Be-Me),ne.match_length>ne.lookahead&&(ne.match_length=ne.lookahead)}if(ne.match_length>=z?(Se=d._tr_tally(ne,1,ne.match_length-z),ne.lookahead-=ne.match_length,ne.strstart+=ne.match_length,ne.match_length=0):(Se=d._tr_tally(ne,0,ne.window[ne.strstart]),ne.lookahead--,ne.strstart++),Se&&(B(ne,!1),ne.strm.avail_out===0))return E}return ne.insert=0,ge===y?(B(ne,!0),ne.strm.avail_out===0?W:G):ne.last_lit&&(B(ne,!1),ne.strm.avail_out===0)?E:q})(ee,me):o[ee.level].func(ee,me);if(_e!==W&&_e!==G||(ee.status=666),_e===E||_e===W)return F.avail_out===0&&(ee.last_flush=-1),x;if(_e===q&&(me===1?d._tr_align(ee):me!==5&&(d._tr_stored_block(ee,0,0,!1),me===3&&(V(ee.head),ee.lookahead===0&&(ee.strstart=0,ee.block_start=0,ee.insert=0))),O(F),F.avail_out===0))return ee.last_flush=-1,x}return me!==y?x:ee.wrap<=0?1:(ee.wrap===2?(Y(ee,255&F.adler),Y(ee,F.adler>>8&255),Y(ee,F.adler>>16&255),Y(ee,F.adler>>24&255),Y(ee,255&F.total_in),Y(ee,F.total_in>>8&255),Y(ee,F.total_in>>16&255),Y(ee,F.total_in>>24&255)):(X(ee,F.adler>>>16),X(ee,65535&F.adler)),O(F),0<ee.wrap&&(ee.wrap=-ee.wrap),ee.pending!==0?x:1)},l.deflateEnd=function(F){var me;return F&&F.state?(me=F.state.status)!==I&&me!==69&&me!==73&&me!==91&&me!==103&&me!==D&&me!==666?te(F,v):(F.state=null,me===D?te(F,-3):x):v},l.deflateSetDictionary=function(F,me){var he,ee,Z,se,Te,_e,ne,ge,Se=me.length;if(!F||!F.state||(se=(he=F.state).wrap)===2||se===1&&he.status!==I||he.lookahead)return v;for(se===1&&(F.adler=m(F.adler,me,Se,0)),he.wrap=0,Se>=he.w_size&&(se===0&&(V(he.head),he.strstart=0,he.block_start=0,he.insert=0),ge=new u.Buf8(he.w_size),u.arraySet(ge,me,Se-he.w_size,he.w_size,0),me=ge,Se=he.w_size),Te=F.avail_in,_e=F.next_in,ne=F.input,F.avail_in=Se,F.next_in=0,F.input=me,ue(he);he.lookahead>=z;){for(ee=he.strstart,Z=he.lookahead-(z-1);he.ins_h=(he.ins_h<<he.hash_shift^he.window[ee+z-1])&he.hash_mask,he.prev[ee&he.w_mask]=he.head[he.ins_h],he.head[he.ins_h]=ee,ee++,--Z;);he.strstart=ee,he.lookahead=z-1,ue(he)}return he.strstart+=he.lookahead,he.block_start=he.strstart,he.insert=he.lookahead,he.lookahead=0,he.match_length=he.prev_length=z-1,he.match_available=0,F.next_in=_e,F.input=ne,F.avail_in=Te,he.wrap=se,x},l.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,i,l){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,i,l){i.exports=function(o,u){var d,m,h,p,g,y,x,v,N,j,C,A,_,T,L,H,k,R,z,P,K,I,D,E,q;d=o.state,m=o.next_in,E=o.input,h=m+(o.avail_in-5),p=o.next_out,q=o.output,g=p-(u-o.avail_out),y=p+(o.avail_out-257),x=d.dmax,v=d.wsize,N=d.whave,j=d.wnext,C=d.window,A=d.hold,_=d.bits,T=d.lencode,L=d.distcode,H=(1<<d.lenbits)-1,k=(1<<d.distbits)-1;e:do{_<15&&(A+=E[m++]<<_,_+=8,A+=E[m++]<<_,_+=8),R=T[A&H];t:for(;;){if(A>>>=z=R>>>24,_-=z,(z=R>>>16&255)===0)q[p++]=65535&R;else{if(!(16&z)){if((64&z)==0){R=T[(65535&R)+(A&(1<<z)-1)];continue t}if(32&z){d.mode=12;break e}o.msg="invalid literal/length code",d.mode=30;break e}P=65535&R,(z&=15)&&(_<z&&(A+=E[m++]<<_,_+=8),P+=A&(1<<z)-1,A>>>=z,_-=z),_<15&&(A+=E[m++]<<_,_+=8,A+=E[m++]<<_,_+=8),R=L[A&k];n:for(;;){if(A>>>=z=R>>>24,_-=z,!(16&(z=R>>>16&255))){if((64&z)==0){R=L[(65535&R)+(A&(1<<z)-1)];continue n}o.msg="invalid distance code",d.mode=30;break e}if(K=65535&R,_<(z&=15)&&(A+=E[m++]<<_,(_+=8)<z&&(A+=E[m++]<<_,_+=8)),x<(K+=A&(1<<z)-1)){o.msg="invalid distance too far back",d.mode=30;break e}if(A>>>=z,_-=z,(z=p-g)<K){if(N<(z=K-z)&&d.sane){o.msg="invalid distance too far back",d.mode=30;break e}if(D=C,(I=0)===j){if(I+=v-z,z<P){for(P-=z;q[p++]=C[I++],--z;);I=p-K,D=q}}else if(j<z){if(I+=v+j-z,(z-=j)<P){for(P-=z;q[p++]=C[I++],--z;);if(I=0,j<P){for(P-=z=j;q[p++]=C[I++],--z;);I=p-K,D=q}}}else if(I+=j-z,z<P){for(P-=z;q[p++]=C[I++],--z;);I=p-K,D=q}for(;2<P;)q[p++]=D[I++],q[p++]=D[I++],q[p++]=D[I++],P-=3;P&&(q[p++]=D[I++],1<P&&(q[p++]=D[I++]))}else{for(I=p-K;q[p++]=q[I++],q[p++]=q[I++],q[p++]=q[I++],2<(P-=3););P&&(q[p++]=q[I++],1<P&&(q[p++]=q[I++]))}break}}break}}while(m<h&&p<y);m-=P=_>>3,A&=(1<<(_-=P<<3))-1,o.next_in=m,o.next_out=p,o.avail_in=m<h?h-m+5:5-(m-h),o.avail_out=p<y?y-p+257:257-(p-y),d.hold=A,d.bits=_}},{}],49:[function(n,i,l){var o=n("../utils/common"),u=n("./adler32"),d=n("./crc32"),m=n("./inffast"),h=n("./inftrees"),p=1,g=2,y=0,x=-2,v=1,N=852,j=592;function C(I){return(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24)}function A(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function _(I){var D;return I&&I.state?(D=I.state,I.total_in=I.total_out=D.total=0,I.msg="",D.wrap&&(I.adler=1&D.wrap),D.mode=v,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new o.Buf32(N),D.distcode=D.distdyn=new o.Buf32(j),D.sane=1,D.back=-1,y):x}function T(I){var D;return I&&I.state?((D=I.state).wsize=0,D.whave=0,D.wnext=0,_(I)):x}function L(I,D){var E,q;return I&&I.state?(q=I.state,D<0?(E=0,D=-D):(E=1+(D>>4),D<48&&(D&=15)),D&&(D<8||15<D)?x:(q.window!==null&&q.wbits!==D&&(q.window=null),q.wrap=E,q.wbits=D,T(I))):x}function H(I,D){var E,q;return I?(q=new A,(I.state=q).window=null,(E=L(I,D))!==y&&(I.state=null),E):x}var k,R,z=!0;function P(I){if(z){var D;for(k=new o.Buf32(512),R=new o.Buf32(32),D=0;D<144;)I.lens[D++]=8;for(;D<256;)I.lens[D++]=9;for(;D<280;)I.lens[D++]=7;for(;D<288;)I.lens[D++]=8;for(h(p,I.lens,0,288,k,0,I.work,{bits:9}),D=0;D<32;)I.lens[D++]=5;h(g,I.lens,0,32,R,0,I.work,{bits:5}),z=!1}I.lencode=k,I.lenbits=9,I.distcode=R,I.distbits=5}function K(I,D,E,q){var W,G=I.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new o.Buf8(G.wsize)),q>=G.wsize?(o.arraySet(G.window,D,E-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(q<(W=G.wsize-G.wnext)&&(W=q),o.arraySet(G.window,D,E-q,W,G.wnext),(q-=W)?(o.arraySet(G.window,D,E-q,q,0),G.wnext=q,G.whave=G.wsize):(G.wnext+=W,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=W))),0}l.inflateReset=T,l.inflateReset2=L,l.inflateResetKeep=_,l.inflateInit=function(I){return H(I,15)},l.inflateInit2=H,l.inflate=function(I,D){var E,q,W,G,te,U,V,O,B,Y,X,Q,ue,be,de,ye,le,we,He,Ke,F,me,he,ee,Z=0,se=new o.Buf8(4),Te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!I||!I.state||!I.output||!I.input&&I.avail_in!==0)return x;(E=I.state).mode===12&&(E.mode=13),te=I.next_out,W=I.output,V=I.avail_out,G=I.next_in,q=I.input,U=I.avail_in,O=E.hold,B=E.bits,Y=U,X=V,me=y;e:for(;;)switch(E.mode){case v:if(E.wrap===0){E.mode=13;break}for(;B<16;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}if(2&E.wrap&&O===35615){se[E.check=0]=255&O,se[1]=O>>>8&255,E.check=d(E.check,se,2,0),B=O=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&O)<<8)+(O>>8))%31){I.msg="incorrect header check",E.mode=30;break}if((15&O)!=8){I.msg="unknown compression method",E.mode=30;break}if(B-=4,F=8+(15&(O>>>=4)),E.wbits===0)E.wbits=F;else if(F>E.wbits){I.msg="invalid window size",E.mode=30;break}E.dmax=1<<F,I.adler=E.check=1,E.mode=512&O?10:12,B=O=0;break;case 2:for(;B<16;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}if(E.flags=O,(255&E.flags)!=8){I.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){I.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=O>>8&1),512&E.flags&&(se[0]=255&O,se[1]=O>>>8&255,E.check=d(E.check,se,2,0)),B=O=0,E.mode=3;case 3:for(;B<32;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}E.head&&(E.head.time=O),512&E.flags&&(se[0]=255&O,se[1]=O>>>8&255,se[2]=O>>>16&255,se[3]=O>>>24&255,E.check=d(E.check,se,4,0)),B=O=0,E.mode=4;case 4:for(;B<16;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}E.head&&(E.head.xflags=255&O,E.head.os=O>>8),512&E.flags&&(se[0]=255&O,se[1]=O>>>8&255,E.check=d(E.check,se,2,0)),B=O=0,E.mode=5;case 5:if(1024&E.flags){for(;B<16;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}E.length=O,E.head&&(E.head.extra_len=O),512&E.flags&&(se[0]=255&O,se[1]=O>>>8&255,E.check=d(E.check,se,2,0)),B=O=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(U<(Q=E.length)&&(Q=U),Q&&(E.head&&(F=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),o.arraySet(E.head.extra,q,G,Q,F)),512&E.flags&&(E.check=d(E.check,q,Q,G)),U-=Q,G+=Q,E.length-=Q),E.length))break e;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(U===0)break e;for(Q=0;F=q[G+Q++],E.head&&F&&E.length<65536&&(E.head.name+=String.fromCharCode(F)),F&&Q<U;);if(512&E.flags&&(E.check=d(E.check,q,Q,G)),U-=Q,G+=Q,F)break e}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(U===0)break e;for(Q=0;F=q[G+Q++],E.head&&F&&E.length<65536&&(E.head.comment+=String.fromCharCode(F)),F&&Q<U;);if(512&E.flags&&(E.check=d(E.check,q,Q,G)),U-=Q,G+=Q,F)break e}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;B<16;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}if(O!==(65535&E.check)){I.msg="header crc mismatch",E.mode=30;break}B=O=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),I.adler=E.check=0,E.mode=12;break;case 10:for(;B<32;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}I.adler=E.check=C(O),B=O=0,E.mode=11;case 11:if(E.havedict===0)return I.next_out=te,I.avail_out=V,I.next_in=G,I.avail_in=U,E.hold=O,E.bits=B,2;I.adler=E.check=1,E.mode=12;case 12:if(D===5||D===6)break e;case 13:if(E.last){O>>>=7&B,B-=7&B,E.mode=27;break}for(;B<3;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}switch(E.last=1&O,B-=1,3&(O>>>=1)){case 0:E.mode=14;break;case 1:if(P(E),E.mode=20,D!==6)break;O>>>=2,B-=2;break e;case 2:E.mode=17;break;case 3:I.msg="invalid block type",E.mode=30}O>>>=2,B-=2;break;case 14:for(O>>>=7&B,B-=7&B;B<32;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}if((65535&O)!=(O>>>16^65535)){I.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&O,B=O=0,E.mode=15,D===6)break e;case 15:E.mode=16;case 16:if(Q=E.length){if(U<Q&&(Q=U),V<Q&&(Q=V),Q===0)break e;o.arraySet(W,q,G,Q,te),U-=Q,G+=Q,V-=Q,te+=Q,E.length-=Q;break}E.mode=12;break;case 17:for(;B<14;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}if(E.nlen=257+(31&O),O>>>=5,B-=5,E.ndist=1+(31&O),O>>>=5,B-=5,E.ncode=4+(15&O),O>>>=4,B-=4,286<E.nlen||30<E.ndist){I.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;B<3;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}E.lens[Te[E.have++]]=7&O,O>>>=3,B-=3}for(;E.have<19;)E.lens[Te[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,he={bits:E.lenbits},me=h(0,E.lens,0,19,E.lencode,0,E.work,he),E.lenbits=he.bits,me){I.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;ye=(Z=E.lencode[O&(1<<E.lenbits)-1])>>>16&255,le=65535&Z,!((de=Z>>>24)<=B);){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}if(le<16)O>>>=de,B-=de,E.lens[E.have++]=le;else{if(le===16){for(ee=de+2;B<ee;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}if(O>>>=de,B-=de,E.have===0){I.msg="invalid bit length repeat",E.mode=30;break}F=E.lens[E.have-1],Q=3+(3&O),O>>>=2,B-=2}else if(le===17){for(ee=de+3;B<ee;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}B-=de,F=0,Q=3+(7&(O>>>=de)),O>>>=3,B-=3}else{for(ee=de+7;B<ee;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}B-=de,F=0,Q=11+(127&(O>>>=de)),O>>>=7,B-=7}if(E.have+Q>E.nlen+E.ndist){I.msg="invalid bit length repeat",E.mode=30;break}for(;Q--;)E.lens[E.have++]=F}}if(E.mode===30)break;if(E.lens[256]===0){I.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,he={bits:E.lenbits},me=h(p,E.lens,0,E.nlen,E.lencode,0,E.work,he),E.lenbits=he.bits,me){I.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,he={bits:E.distbits},me=h(g,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,he),E.distbits=he.bits,me){I.msg="invalid distances set",E.mode=30;break}if(E.mode=20,D===6)break e;case 20:E.mode=21;case 21:if(6<=U&&258<=V){I.next_out=te,I.avail_out=V,I.next_in=G,I.avail_in=U,E.hold=O,E.bits=B,m(I,X),te=I.next_out,W=I.output,V=I.avail_out,G=I.next_in,q=I.input,U=I.avail_in,O=E.hold,B=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;ye=(Z=E.lencode[O&(1<<E.lenbits)-1])>>>16&255,le=65535&Z,!((de=Z>>>24)<=B);){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}if(ye&&(240&ye)==0){for(we=de,He=ye,Ke=le;ye=(Z=E.lencode[Ke+((O&(1<<we+He)-1)>>we)])>>>16&255,le=65535&Z,!(we+(de=Z>>>24)<=B);){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}O>>>=we,B-=we,E.back+=we}if(O>>>=de,B-=de,E.back+=de,E.length=le,ye===0){E.mode=26;break}if(32&ye){E.back=-1,E.mode=12;break}if(64&ye){I.msg="invalid literal/length code",E.mode=30;break}E.extra=15&ye,E.mode=22;case 22:if(E.extra){for(ee=E.extra;B<ee;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}E.length+=O&(1<<E.extra)-1,O>>>=E.extra,B-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;ye=(Z=E.distcode[O&(1<<E.distbits)-1])>>>16&255,le=65535&Z,!((de=Z>>>24)<=B);){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}if((240&ye)==0){for(we=de,He=ye,Ke=le;ye=(Z=E.distcode[Ke+((O&(1<<we+He)-1)>>we)])>>>16&255,le=65535&Z,!(we+(de=Z>>>24)<=B);){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}O>>>=we,B-=we,E.back+=we}if(O>>>=de,B-=de,E.back+=de,64&ye){I.msg="invalid distance code",E.mode=30;break}E.offset=le,E.extra=15&ye,E.mode=24;case 24:if(E.extra){for(ee=E.extra;B<ee;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}E.offset+=O&(1<<E.extra)-1,O>>>=E.extra,B-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){I.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(V===0)break e;if(Q=X-V,E.offset>Q){if((Q=E.offset-Q)>E.whave&&E.sane){I.msg="invalid distance too far back",E.mode=30;break}ue=Q>E.wnext?(Q-=E.wnext,E.wsize-Q):E.wnext-Q,Q>E.length&&(Q=E.length),be=E.window}else be=W,ue=te-E.offset,Q=E.length;for(V<Q&&(Q=V),V-=Q,E.length-=Q;W[te++]=be[ue++],--Q;);E.length===0&&(E.mode=21);break;case 26:if(V===0)break e;W[te++]=E.length,V--,E.mode=21;break;case 27:if(E.wrap){for(;B<32;){if(U===0)break e;U--,O|=q[G++]<<B,B+=8}if(X-=V,I.total_out+=X,E.total+=X,X&&(I.adler=E.check=E.flags?d(E.check,W,X,te-X):u(E.check,W,X,te-X)),X=V,(E.flags?O:C(O))!==E.check){I.msg="incorrect data check",E.mode=30;break}B=O=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;B<32;){if(U===0)break e;U--,O+=q[G++]<<B,B+=8}if(O!==(4294967295&E.total)){I.msg="incorrect length check",E.mode=30;break}B=O=0}E.mode=29;case 29:me=1;break e;case 30:me=-3;break e;case 31:return-4;case 32:default:return x}return I.next_out=te,I.avail_out=V,I.next_in=G,I.avail_in=U,E.hold=O,E.bits=B,(E.wsize||X!==I.avail_out&&E.mode<30&&(E.mode<27||D!==4))&&K(I,I.output,I.next_out,X-I.avail_out)?(E.mode=31,-4):(Y-=I.avail_in,X-=I.avail_out,I.total_in+=Y,I.total_out+=X,E.total+=X,E.wrap&&X&&(I.adler=E.check=E.flags?d(E.check,W,X,I.next_out-X):u(E.check,W,X,I.next_out-X)),I.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(Y==0&&X===0||D===4)&&me===y&&(me=-5),me)},l.inflateEnd=function(I){if(!I||!I.state)return x;var D=I.state;return D.window&&(D.window=null),I.state=null,y},l.inflateGetHeader=function(I,D){var E;return I&&I.state?(2&(E=I.state).wrap)==0?x:((E.head=D).done=!1,y):x},l.inflateSetDictionary=function(I,D){var E,q=D.length;return I&&I.state?(E=I.state).wrap!==0&&E.mode!==11?x:E.mode===11&&u(1,D,q,0)!==E.check?-3:K(I,D,q,q)?(E.mode=31,-4):(E.havedict=1,y):x},l.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,i,l){var o=n("../utils/common"),u=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(p,g,y,x,v,N,j,C){var A,_,T,L,H,k,R,z,P,K=C.bits,I=0,D=0,E=0,q=0,W=0,G=0,te=0,U=0,V=0,O=0,B=null,Y=0,X=new o.Buf16(16),Q=new o.Buf16(16),ue=null,be=0;for(I=0;I<=15;I++)X[I]=0;for(D=0;D<x;D++)X[g[y+D]]++;for(W=K,q=15;1<=q&&X[q]===0;q--);if(q<W&&(W=q),q===0)return v[N++]=20971520,v[N++]=20971520,C.bits=1,0;for(E=1;E<q&&X[E]===0;E++);for(W<E&&(W=E),I=U=1;I<=15;I++)if(U<<=1,(U-=X[I])<0)return-1;if(0<U&&(p===0||q!==1))return-1;for(Q[1]=0,I=1;I<15;I++)Q[I+1]=Q[I]+X[I];for(D=0;D<x;D++)g[y+D]!==0&&(j[Q[g[y+D]]++]=D);if(k=p===0?(B=ue=j,19):p===1?(B=u,Y-=257,ue=d,be-=257,256):(B=m,ue=h,-1),I=E,H=N,te=D=O=0,T=-1,L=(V=1<<(G=W))-1,p===1&&852<V||p===2&&592<V)return 1;for(;;){for(R=I-te,P=j[D]<k?(z=0,j[D]):j[D]>k?(z=ue[be+j[D]],B[Y+j[D]]):(z=96,0),A=1<<I-te,E=_=1<<G;v[H+(O>>te)+(_-=A)]=R<<24|z<<16|P|0,_!==0;);for(A=1<<I-1;O&A;)A>>=1;if(A!==0?(O&=A-1,O+=A):O=0,D++,--X[I]==0){if(I===q)break;I=g[y+j[D]]}if(W<I&&(O&L)!==T){for(te===0&&(te=W),H+=E,U=1<<(G=I-te);G+te<q&&!((U-=X[G+te])<=0);)G++,U<<=1;if(V+=1<<G,p===1&&852<V||p===2&&592<V)return 1;v[T=O&L]=W<<24|G<<16|H-N|0}}return O!==0&&(v[H+O]=I-te<<24|64<<16|0),C.bits=W,0}},{"../utils/common":41}],51:[function(n,i,l){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,i,l){var o=n("../utils/common"),u=0,d=1;function m(Z){for(var se=Z.length;0<=--se;)Z[se]=0}var h=0,p=29,g=256,y=g+1+p,x=30,v=19,N=2*y+1,j=15,C=16,A=7,_=256,T=16,L=17,H=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=new Array(2*(y+2));m(K);var I=new Array(2*x);m(I);var D=new Array(512);m(D);var E=new Array(256);m(E);var q=new Array(p);m(q);var W,G,te,U=new Array(x);function V(Z,se,Te,_e,ne){this.static_tree=Z,this.extra_bits=se,this.extra_base=Te,this.elems=_e,this.max_length=ne,this.has_stree=Z&&Z.length}function O(Z,se){this.dyn_tree=Z,this.max_code=0,this.stat_desc=se}function B(Z){return Z<256?D[Z]:D[256+(Z>>>7)]}function Y(Z,se){Z.pending_buf[Z.pending++]=255&se,Z.pending_buf[Z.pending++]=se>>>8&255}function X(Z,se,Te){Z.bi_valid>C-Te?(Z.bi_buf|=se<<Z.bi_valid&65535,Y(Z,Z.bi_buf),Z.bi_buf=se>>C-Z.bi_valid,Z.bi_valid+=Te-C):(Z.bi_buf|=se<<Z.bi_valid&65535,Z.bi_valid+=Te)}function Q(Z,se,Te){X(Z,Te[2*se],Te[2*se+1])}function ue(Z,se){for(var Te=0;Te|=1&Z,Z>>>=1,Te<<=1,0<--se;);return Te>>>1}function be(Z,se,Te){var _e,ne,ge=new Array(j+1),Se=0;for(_e=1;_e<=j;_e++)ge[_e]=Se=Se+Te[_e-1]<<1;for(ne=0;ne<=se;ne++){var Ce=Z[2*ne+1];Ce!==0&&(Z[2*ne]=ue(ge[Ce]++,Ce))}}function de(Z){var se;for(se=0;se<y;se++)Z.dyn_ltree[2*se]=0;for(se=0;se<x;se++)Z.dyn_dtree[2*se]=0;for(se=0;se<v;se++)Z.bl_tree[2*se]=0;Z.dyn_ltree[2*_]=1,Z.opt_len=Z.static_len=0,Z.last_lit=Z.matches=0}function ye(Z){8<Z.bi_valid?Y(Z,Z.bi_buf):0<Z.bi_valid&&(Z.pending_buf[Z.pending++]=Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0}function le(Z,se,Te,_e){var ne=2*se,ge=2*Te;return Z[ne]<Z[ge]||Z[ne]===Z[ge]&&_e[se]<=_e[Te]}function we(Z,se,Te){for(var _e=Z.heap[Te],ne=Te<<1;ne<=Z.heap_len&&(ne<Z.heap_len&&le(se,Z.heap[ne+1],Z.heap[ne],Z.depth)&&ne++,!le(se,_e,Z.heap[ne],Z.depth));)Z.heap[Te]=Z.heap[ne],Te=ne,ne<<=1;Z.heap[Te]=_e}function He(Z,se,Te){var _e,ne,ge,Se,Ce=0;if(Z.last_lit!==0)for(;_e=Z.pending_buf[Z.d_buf+2*Ce]<<8|Z.pending_buf[Z.d_buf+2*Ce+1],ne=Z.pending_buf[Z.l_buf+Ce],Ce++,_e===0?Q(Z,ne,se):(Q(Z,(ge=E[ne])+g+1,se),(Se=k[ge])!==0&&X(Z,ne-=q[ge],Se),Q(Z,ge=B(--_e),Te),(Se=R[ge])!==0&&X(Z,_e-=U[ge],Se)),Ce<Z.last_lit;);Q(Z,_,se)}function Ke(Z,se){var Te,_e,ne,ge=se.dyn_tree,Se=se.stat_desc.static_tree,Ce=se.stat_desc.has_stree,Me=se.stat_desc.elems,Be=-1;for(Z.heap_len=0,Z.heap_max=N,Te=0;Te<Me;Te++)ge[2*Te]!==0?(Z.heap[++Z.heap_len]=Be=Te,Z.depth[Te]=0):ge[2*Te+1]=0;for(;Z.heap_len<2;)ge[2*(ne=Z.heap[++Z.heap_len]=Be<2?++Be:0)]=1,Z.depth[ne]=0,Z.opt_len--,Ce&&(Z.static_len-=Se[2*ne+1]);for(se.max_code=Be,Te=Z.heap_len>>1;1<=Te;Te--)we(Z,ge,Te);for(ne=Me;Te=Z.heap[1],Z.heap[1]=Z.heap[Z.heap_len--],we(Z,ge,1),_e=Z.heap[1],Z.heap[--Z.heap_max]=Te,Z.heap[--Z.heap_max]=_e,ge[2*ne]=ge[2*Te]+ge[2*_e],Z.depth[ne]=(Z.depth[Te]>=Z.depth[_e]?Z.depth[Te]:Z.depth[_e])+1,ge[2*Te+1]=ge[2*_e+1]=ne,Z.heap[1]=ne++,we(Z,ge,1),2<=Z.heap_len;);Z.heap[--Z.heap_max]=Z.heap[1],(function(We,qe){var Ae,$e,Qe,Ge,ve,je,Ue=qe.dyn_tree,ft=qe.max_code,ie=qe.stat_desc.static_tree,Oe=qe.stat_desc.has_stree,ae=qe.stat_desc.extra_bits,Fe=qe.stat_desc.extra_base,Pe=qe.stat_desc.max_length,it=0;for(Ge=0;Ge<=j;Ge++)We.bl_count[Ge]=0;for(Ue[2*We.heap[We.heap_max]+1]=0,Ae=We.heap_max+1;Ae<N;Ae++)Pe<(Ge=Ue[2*Ue[2*($e=We.heap[Ae])+1]+1]+1)&&(Ge=Pe,it++),Ue[2*$e+1]=Ge,ft<$e||(We.bl_count[Ge]++,ve=0,Fe<=$e&&(ve=ae[$e-Fe]),je=Ue[2*$e],We.opt_len+=je*(Ge+ve),Oe&&(We.static_len+=je*(ie[2*$e+1]+ve)));if(it!==0){do{for(Ge=Pe-1;We.bl_count[Ge]===0;)Ge--;We.bl_count[Ge]--,We.bl_count[Ge+1]+=2,We.bl_count[Pe]--,it-=2}while(0<it);for(Ge=Pe;Ge!==0;Ge--)for($e=We.bl_count[Ge];$e!==0;)ft<(Qe=We.heap[--Ae])||(Ue[2*Qe+1]!==Ge&&(We.opt_len+=(Ge-Ue[2*Qe+1])*Ue[2*Qe],Ue[2*Qe+1]=Ge),$e--)}})(Z,se),be(ge,Be,Z.bl_count)}function F(Z,se,Te){var _e,ne,ge=-1,Se=se[1],Ce=0,Me=7,Be=4;for(Se===0&&(Me=138,Be=3),se[2*(Te+1)+1]=65535,_e=0;_e<=Te;_e++)ne=Se,Se=se[2*(_e+1)+1],++Ce<Me&&ne===Se||(Ce<Be?Z.bl_tree[2*ne]+=Ce:ne!==0?(ne!==ge&&Z.bl_tree[2*ne]++,Z.bl_tree[2*T]++):Ce<=10?Z.bl_tree[2*L]++:Z.bl_tree[2*H]++,ge=ne,Be=(Ce=0)===Se?(Me=138,3):ne===Se?(Me=6,3):(Me=7,4))}function me(Z,se,Te){var _e,ne,ge=-1,Se=se[1],Ce=0,Me=7,Be=4;for(Se===0&&(Me=138,Be=3),_e=0;_e<=Te;_e++)if(ne=Se,Se=se[2*(_e+1)+1],!(++Ce<Me&&ne===Se)){if(Ce<Be)for(;Q(Z,ne,Z.bl_tree),--Ce!=0;);else ne!==0?(ne!==ge&&(Q(Z,ne,Z.bl_tree),Ce--),Q(Z,T,Z.bl_tree),X(Z,Ce-3,2)):Ce<=10?(Q(Z,L,Z.bl_tree),X(Z,Ce-3,3)):(Q(Z,H,Z.bl_tree),X(Z,Ce-11,7));ge=ne,Be=(Ce=0)===Se?(Me=138,3):ne===Se?(Me=6,3):(Me=7,4)}}m(U);var he=!1;function ee(Z,se,Te,_e){X(Z,(h<<1)+(_e?1:0),3),(function(ne,ge,Se,Ce){ye(ne),Y(ne,Se),Y(ne,~Se),o.arraySet(ne.pending_buf,ne.window,ge,Se,ne.pending),ne.pending+=Se})(Z,se,Te)}l._tr_init=function(Z){he||((function(){var se,Te,_e,ne,ge,Se=new Array(j+1);for(ne=_e=0;ne<p-1;ne++)for(q[ne]=_e,se=0;se<1<<k[ne];se++)E[_e++]=ne;for(E[_e-1]=ne,ne=ge=0;ne<16;ne++)for(U[ne]=ge,se=0;se<1<<R[ne];se++)D[ge++]=ne;for(ge>>=7;ne<x;ne++)for(U[ne]=ge<<7,se=0;se<1<<R[ne]-7;se++)D[256+ge++]=ne;for(Te=0;Te<=j;Te++)Se[Te]=0;for(se=0;se<=143;)K[2*se+1]=8,se++,Se[8]++;for(;se<=255;)K[2*se+1]=9,se++,Se[9]++;for(;se<=279;)K[2*se+1]=7,se++,Se[7]++;for(;se<=287;)K[2*se+1]=8,se++,Se[8]++;for(be(K,y+1,Se),se=0;se<x;se++)I[2*se+1]=5,I[2*se]=ue(se,5);W=new V(K,k,g+1,y,j),G=new V(I,R,0,x,j),te=new V(new Array(0),z,0,v,A)})(),he=!0),Z.l_desc=new O(Z.dyn_ltree,W),Z.d_desc=new O(Z.dyn_dtree,G),Z.bl_desc=new O(Z.bl_tree,te),Z.bi_buf=0,Z.bi_valid=0,de(Z)},l._tr_stored_block=ee,l._tr_flush_block=function(Z,se,Te,_e){var ne,ge,Se=0;0<Z.level?(Z.strm.data_type===2&&(Z.strm.data_type=(function(Ce){var Me,Be=4093624447;for(Me=0;Me<=31;Me++,Be>>>=1)if(1&Be&&Ce.dyn_ltree[2*Me]!==0)return u;if(Ce.dyn_ltree[18]!==0||Ce.dyn_ltree[20]!==0||Ce.dyn_ltree[26]!==0)return d;for(Me=32;Me<g;Me++)if(Ce.dyn_ltree[2*Me]!==0)return d;return u})(Z)),Ke(Z,Z.l_desc),Ke(Z,Z.d_desc),Se=(function(Ce){var Me;for(F(Ce,Ce.dyn_ltree,Ce.l_desc.max_code),F(Ce,Ce.dyn_dtree,Ce.d_desc.max_code),Ke(Ce,Ce.bl_desc),Me=v-1;3<=Me&&Ce.bl_tree[2*P[Me]+1]===0;Me--);return Ce.opt_len+=3*(Me+1)+5+5+4,Me})(Z),ne=Z.opt_len+3+7>>>3,(ge=Z.static_len+3+7>>>3)<=ne&&(ne=ge)):ne=ge=Te+5,Te+4<=ne&&se!==-1?ee(Z,se,Te,_e):Z.strategy===4||ge===ne?(X(Z,2+(_e?1:0),3),He(Z,K,I)):(X(Z,4+(_e?1:0),3),(function(Ce,Me,Be,We){var qe;for(X(Ce,Me-257,5),X(Ce,Be-1,5),X(Ce,We-4,4),qe=0;qe<We;qe++)X(Ce,Ce.bl_tree[2*P[qe]+1],3);me(Ce,Ce.dyn_ltree,Me-1),me(Ce,Ce.dyn_dtree,Be-1)})(Z,Z.l_desc.max_code+1,Z.d_desc.max_code+1,Se+1),He(Z,Z.dyn_ltree,Z.dyn_dtree)),de(Z),_e&&ye(Z)},l._tr_tally=function(Z,se,Te){return Z.pending_buf[Z.d_buf+2*Z.last_lit]=se>>>8&255,Z.pending_buf[Z.d_buf+2*Z.last_lit+1]=255&se,Z.pending_buf[Z.l_buf+Z.last_lit]=255&Te,Z.last_lit++,se===0?Z.dyn_ltree[2*Te]++:(Z.matches++,se--,Z.dyn_ltree[2*(E[Te]+g+1)]++,Z.dyn_dtree[2*B(se)]++),Z.last_lit===Z.lit_bufsize-1},l._tr_align=function(Z){X(Z,2,3),Q(Z,_,K),(function(se){se.bi_valid===16?(Y(se,se.bi_buf),se.bi_buf=0,se.bi_valid=0):8<=se.bi_valid&&(se.pending_buf[se.pending++]=255&se.bi_buf,se.bi_buf>>=8,se.bi_valid-=8)})(Z)}},{"../utils/common":41}],53:[function(n,i,l){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,i,l){(function(o){(function(u,d){if(!u.setImmediate){var m,h,p,g,y=1,x={},v=!1,N=u.document,j=Object.getPrototypeOf&&Object.getPrototypeOf(u);j=j&&j.setTimeout?j:u,m={}.toString.call(u.process)==="[object process]"?function(T){process.nextTick(function(){A(T)})}:(function(){if(u.postMessage&&!u.importScripts){var T=!0,L=u.onmessage;return u.onmessage=function(){T=!1},u.postMessage("","*"),u.onmessage=L,T}})()?(g="setImmediate$"+Math.random()+"$",u.addEventListener?u.addEventListener("message",_,!1):u.attachEvent("onmessage",_),function(T){u.postMessage(g+T,"*")}):u.MessageChannel?((p=new MessageChannel).port1.onmessage=function(T){A(T.data)},function(T){p.port2.postMessage(T)}):N&&"onreadystatechange"in N.createElement("script")?(h=N.documentElement,function(T){var L=N.createElement("script");L.onreadystatechange=function(){A(T),L.onreadystatechange=null,h.removeChild(L),L=null},h.appendChild(L)}):function(T){setTimeout(A,0,T)},j.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var L=new Array(arguments.length-1),H=0;H<L.length;H++)L[H]=arguments[H+1];var k={callback:T,args:L};return x[y]=k,m(y),y++},j.clearImmediate=C}function C(T){delete x[T]}function A(T){if(v)setTimeout(A,0,T);else{var L=x[T];if(L){v=!0;try{(function(H){var k=H.callback,R=H.args;switch(R.length){case 0:k();break;case 1:k(R[0]);break;case 2:k(R[0],R[1]);break;case 3:k(R[0],R[1],R[2]);break;default:k.apply(d,R)}})(L)}finally{C(T),v=!1}}}}function _(T){T.source===u&&typeof T.data=="string"&&T.data.indexOf(g)===0&&A(+T.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof qa<"u"?qa:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ih)),Ih.exports}var B1=OD();const Zl=wu(B1),ID=jC({__proto__:null,default:Zl},[B1]);class DD{validateTree(t){const n={};if(!t)return n;const i=new Set,l=(o,u,d)=>{const m=this.validateItem(o,u,d);i.has(o.id)&&m.push({id:Math.random().toString(36).substr(2,9),itemId:o.id,itemLabel:Le(o.label)||"Unknown",level:"error",category:"Identity",message:"CRITICAL: Duplicate ID detected. This will break most IIIF viewers.",fixable:!0}),i.add(o.id),m.length>0&&(n[o.id]=(n[o.id]||[]).concat(m)),(o.items||o.annotations||o.structures||[]).forEach(p=>{p&&typeof p=="object"&&l(p,o,o.type)})};return l(t),n}hasContent(t){return t?Object.values(t).some(n=>n.some(i=>i&&i.trim().length>0)):!1}mapSchemaErrors(t,n){return n.map(i=>{let l="Structure",o=!1;return i.includes("id")||i.includes("type")?(l="Identity",o=!0):i.includes("width")||i.includes("height")||i.includes("duration")?(l="Content",o=!0):(i.includes("behavior")||i.includes("Behavior"))&&(l="Structure",o=!0),{id:Math.random().toString(36).substr(2,9),itemId:t.id,itemLabel:Le(t.label)||"Untitled",level:"error",category:l,message:i,fixable:o}})}validateItem(t,n,i){const l=[],o=(m,h,p,g=!1)=>{l.push({id:Math.random().toString(36).substr(2,9),itemId:t.id,itemLabel:Le(t.label)||"Untitled",level:m,category:h,message:p,fixable:g})},u=Qv(t);if(l.push(...this.mapSchemaErrors(t,u)),t.behavior){const m=Nw(t.type,t.behavior,i,n?.behavior);for(const p of m.errors)o("error","Structure",p,!0);for(const p of m.warnings)o("warning","Structure",p,!1);const h=Jm(t.behavior);for(const p of h)o("error","Structure",p,!0)}i&&(Wt(t)&&i==="Range"&&o("warning","Structure","Canvas behavior should inherit from Manifest, not Range. Check behavior consistency.",!1),t.behavior&&n?.behavior&&ww(t.type,i)),t.id&&!t.id.startsWith("http")&&o("error","Identity","ID must be a valid HTTP(S) URI.",!0);const d=["Collection","Manifest","Range"].includes(t.type);if(this.hasContent(t.label)||d||Wt(t)&&o("warning","Metadata","A Canvas should have a label for navigation.",!0),Wt(t)&&(t.items?.some(p=>p.items?.some(g=>g.motivation==="painting"))||o("warning","Content",'Canvas has no "painting" content. It will appear blank.')),zt(t)){const m=t;(!m.items||m.items.length===0)&&o("error","Structure",'Manifest MUST have at least one Canvas in "items".',!0)}return Mt(t)&&(t.items||o("error","Structure",'Collection must have an "items" array.',!0)),d&&!this.hasContent(t.summary)&&o("warning","Metadata",'Adding a "summary" improves search.',!0),d&&!t.thumbnail&&o("warning","Metadata",'Adding a "thumbnail" is recommended.',!1),l}}function Xy(e,t,n){if(!e||e.length===0)return{status:"pristine"};const l={label:["label","missing required","must have"],summary:["summary"],metadata:["metadata"],id:["id","duplicate id","http","uri"],type:["type","missing required field: type"],items:["items","must have at least one"],rights:["rights"],behavior:["behavior"],thumbnail:["thumbnail"],width:["width","dimensions"],height:["height","dimensions"],duration:["duration"],viewingDirection:["viewingdirection","viewing direction"],navDate:["navdate","nav date"],navPlace:["navplace","nav place"],provider:["provider"],requiredStatement:["requiredstatement","required statement"],"@context":["@context","context"],structures:["structures"],annotations:["annotations"]}[t.toLowerCase()];if(!l)return{status:"pristine"};const o=e.filter(p=>{const g=(p.message||"").toLowerCase();return l.some(y=>g.includes(y.toLowerCase()))});if(o.length===0)return{status:"pristine"};const u=o.find(p=>p.level==="error"),d=o.find(p=>p.level==="warning"),m=u||d;if(!m)return{status:"pristine"};const h={status:m.level==="error"?"invalid":"valid",message:m.message};return m.fixable&&n&&(h.fix=()=>n(m),h.fixDescription=LD(m)),h}function LD(e){const t=(e.message||"").toLowerCase();return t.includes("missing required field: type")?"Add default resource type":t.includes("missing required field: id")?"Generate valid HTTP URI ID":t.includes("id must be a valid http")?"Convert ID to HTTP(S) URI":t.includes("duplicate id")?"Append unique suffix to ID":t.includes("canvas id must not contain a fragment")?"Remove fragment identifier from Canvas ID":t.includes("label")&&t.includes("required")?"Add label derived from ID":t.includes("label")&&t.includes("language map")?"Convert label to language map format":t.includes("summary")?"Add placeholder summary":t.includes("metadata")&&t.includes("label and value")?"Fix metadata entry structure":t.includes("metadata")?"Initialize metadata array":t.includes("dimensions")||t.includes("width")||t.includes("height")?e.itemLabel?.toLowerCase().includes("canvas")?"Set default canvas dimensions":e.itemLabel?.toLowerCase().includes("image")?"Set default image dimensions":"Set default dimensions":t.includes("duration")?"Add duration field (update value manually)":t.includes("items")&&t.includes("must have at least one")?"Add placeholder item":t.includes("items")&&t.includes("invalid type")?"Remove items with invalid types":t.includes("items")?"Initialize items array":t.includes("structures")&&e.itemLabel?.toLowerCase().includes("collection")?"Remove invalid structures property":t.includes("structures")?"Remove structures from invalid resource type":t.includes("rights")?"Add CC0 rights statement":t.includes("requiredstatement")||t.includes("required statement")?"Add default attribution statement":t.includes("provider")?"Add default provider/institution":t.includes("behavior")&&t.includes("not allowed")?"Remove invalid behaviors for resource type":t.includes("behavior")&&t.includes("conflict")?"Resolve conflicting behaviors (keep first from each group)":t.includes("behavior")?"Clear or fix behaviors":t.includes("viewingdirection")&&t.includes("not allowed")?"Remove viewingDirection from this resource type":t.includes("viewingdirection")?"Set default viewingDirection to left-to-right":t.includes("navdate")&&t.includes("not allowed")?"Remove navDate from this resource type":t.includes("navdate")?"Set navDate to current date":t.includes("thumbnail")?"Add placeholder thumbnail reference":t.includes("format")&&t.includes("not allowed")?"Remove format from invalid resource type":t.includes("format")?"Add default format based on content type":t.includes("@context")&&t.includes("must have")?"Add IIIF Presentation API 3.0 context":t.includes("@context")?"Remove @context from embedded resource":t.includes("motivation")&&t.includes("not allowed")?"Remove motivation from invalid resource type":t.includes("motivation")?"Set default motivation to painting":t.includes("annotations")&&t.includes("not allowed")?"Remove annotations from invalid resource type":t.includes("service")&&t.includes("not allowed")?"Remove service from invalid resource type":t.includes("must be a language map")?"Convert to valid language map format":t.includes("http")&&t.includes("uri")?"Generate valid HTTP URI":"Auto-fix available"}const Jl=new DD,RD=8765;function MD(e=RD){return`{
  "name": "@canopy-iiif/app-root",
  "version": "1.6.0",
  "description": "An open-source static site generator designed for fast creation, contextualization, and customization of a discovery-focused digital scholarship and collections website using IIIF APIs.",
  "private": true,
  "main": "app/scripts/canopy-build.mjs",
  "scripts": {
    "build": "tsx app/scripts/canopy-build.mts",
    "dev": "tsx app/scripts/canopy-build.mts",
    "serve:iiif": "npx serve assets -l ${e} --cors",
    "start": "concurrently \\"npm run serve:iiif\\" \\"sleep 2 && npm run dev\\""
  },
  "dependencies": {
    "@canopy-iiif/app": "^1.6.0",
    "@samvera/clover-iiif": "^3.3.2",
    "swiper": "^11.2.10",
    "esbuild": "^0.21.4",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "concurrently": "^9.0.0",
    "serve": "^14.0.0"
  },
  "devDependencies": {
    "@tailwindcss/cli": "^4.1.13",
    "tailwindcss": "^4.1.13",
    "tsx": "^4.19.1"
  },
  "author": "Mat Jordan <mat@northwestern.edu>",
  "homepage": "https://canopy-iiif.github.io/app/",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/canopy-iiif/app.git",
    "directory": "packages/app"
  },
  "license": "MIT"
}
`}const FD=`node_modules/
.tool-versions

# canopy specific
site/
.template-build/

# remove this if you would like to commit the cache
.cache

# ignore pnpm local store (we standardize on npm)
.pnpm-store/

# Do not commit compiled UI stylesheet; built in dev/publish
packages/app/ui/styles/index.css

# Ignore built UI bundle; built on demand and at publish
packages/app/ui/dist/

# Test outputs
tests/coverage/
playwright-report/
test-results/
`,PD=`MIT License

Copyright (c) 2025 Mat Jordan

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
`,$D=`/**
 * Canopy build and development orchestration entry point
 *
 * This wrapper delegates to @canopy-iiif/app's orchestrator so the published
 * package manages core logic. Keeping the entry small ensures the generated
 * template which consumes the published package can stay up to date.
 *
 * See https://github.com/canopy-iiif/app for more information.
 *
 * @license MIT
 * Copyright (c) 2025 Mat Jordan
 */

import {orchestrate} from "@canopy-iiif/app/orchestrator";

const err = (msg: string): void => {
  console.error(\`[canopy][error] \${msg}\`);
};

orchestrate().catch((error: unknown) => {
  const message =
    error &&
    typeof error === "object" &&
    "stack" in error &&
    typeof error.stack === "string"
      ? error.stack
      : error &&
          typeof error === "object" &&
          "message" in error &&
          typeof error.message === "string"
        ? error.message
        : String(error);
  err(message);
  process.exit(1);
});
`,zD=`@import "tailwindcss";
@import "@canopy-iiif/app/ui/styles/index.css";
@import "./custom.css";

@layer properties {
  :root,
  :host {
    --font-sans: system-ui, "Segoe UI", Helvetica, Arial, sans-serif;
    --font-serif: "Fraunces", Georgia, "Times New Roman", serif;
    --font-mono: "IBM Plex Mono", "ui-monospace", Menlo, Consolas, monospace;
    --default-font-family: var(--font-serif);
  }
}

@utility max-w-content {
  max-width: 1080px;
}

@utility max-w-wide {
  max-width: 1300px;
}

@layer base {
  html {
    font-size: 110%;
    font-weight: 300;
  }

  body {
    background: var(--color-gray-50);
    color: var(--color-gray-900);
  }

  h1,
  h2,
  h3,
  h4,
  .canopy-logo {
    font-family: var(--font-serif);
    font-weight: 600;
    letter-spacing: -0.025em;
  }
}
`,UD=`/**
 * Example custom color variables
 * @see https://canopy-iiif.github.io/app/docs/theming/tailwind#custom
 */

/* @layer properties {
  :root,
  :host {
    --color-northwestern-purple: #4e2a84;
    --color-accent-700: var(--color-northwestern-purple);
    --color-accent-default: var(--color-northwestern-purple);
  }
} */
`,BD=`/**
 * Replace the examples with your own components or add new ones. You
 * may also import components from dependencies and re-export them here.
 */

// Map SSR-safe components to be rendered at build time and used in MDX files
export const components = {
  Example: './Example.tsx',
};

// Map browser-only components to their source files; the builder bundles
// them separately and hydrates placeholders at runtime.
export const clientComponents = {
  ExampleClient: './Example.client.tsx',
};
`,HD=`import React from "react";

export default function Example({
  title,
  children,
}: {
  title: string;
  children?: React.ReactNode;
}) {
  return (
    <article>
      <strong>{title}</strong>
      <p>{children}</p>
    </article>
  );
}
`,WD=`import React, {useEffect, useState} from "react";

export default function ExampleClient({text}: {text?: string}) {
  const [viewportWidth, setViewportWidth] = useState<number | null>(null);

  useEffect(() => {
    const handle = () => setViewportWidth(window.innerWidth || null);
    handle();
    window.addEventListener("resize", handle);
    return () => window.removeEventListener("resize", handle);
  }, []);

  return (
    <div>
      <p>
        This component is running in browser only as it requires access to the
        browser window and cannot safely be rendered at build time.
      </p>
      {text && <p>{text}</p>}
      <em>Viewport width: {viewportWidth ? \`\${viewportWidth}px\` : "..."}</em>
    </div>
  );
}
`,GD=`<div>{props.children}</div>
`,YD=`<Layout navigation={true} fluid={true}>
  {props.children}
</Layout>
`,qD=`---
type: work
---

import {
  Label,
  Summary,
  Metadata,
  RequiredStatement,
  References,
} from "@canopy-iiif/app/ui/server";

<Container variant="wide" className="canopy-work--layout">
  <div className="canopy-work--primary">
    <Viewer iiifContent={props.manifest.id} />
  </div>
  <div className="canopy-work--secondary">
    <header>
      <Label manifest={props.manifest} as="h1" />
      <Summary manifest={props.manifest} as="p" className="canopy-lead" />
    </header>
    <div>
      <References />
      <Metadata manifest={props.manifest} />
      <RequiredStatement manifest={props.manifest} />
      <Id id={props.manifest.id} />
    </div>
  </div>
</Container>
<Container>
  <h2>Related Items</h2>
  <RelatedItems iiifContent={props.manifest.id} top={3} />
</Container>
`,VD=`<div className="canopy-search-results">
  <SearchTabs />
  <SearchSummary />
  <SearchResults />
</div>
`,KD=`import {ArticleCard} from "@canopy-iiif/app/ui";

<ArticleCard
  href={props.record?.href}
  title={props.record?.title || props.record?.href || "Untitled"}
  annotation={props.record?.annotation}
  summary={props.record?.summary || props.record?.summaryValue || ""}
  summaryMarkdown={
    props.record?.summaryMarkdown ||
    props.record?.summary ||
    props.record?.summaryValue ||
    ""
  }
  metadata={Array.isArray(props.record?.metadata) ? props.record.metadata : []}
  query={props.query}
  recordType={props.record?.type}
/>
`,XD=`import {Card} from "@canopy-iiif/app/ui";

<Card
  href={props.record?.href}
  title={props.record?.title || props.record?.href || "Untitled"}
  src={props.record?.type === "work" ? props.record?.thumbnail : undefined}
  imgWidth={props.record?.thumbnailWidth}
  imgHeight={props.record?.thumbnailHeight}
  aspectRatio={props.thumbnailAspectRatio}
/>
`,ZD=`User-agent: *
Disallow: /
`,JD=`name: Deploy to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: pages
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      - name: Install dependencies
        run: |
          npm config set fund false
          npm config set audit false
          npm ci --no-audit --no-fund || npm install --no-audit --no-fund

      - name: Configure Pages
        uses: actions/configure-pages@v5
        with:
          enablement: true
          token: \${{ secrets.GITHUB_TOKEN }}

      - name: Determine base path for Pages
        run: |
          REPO_NAME="\${GITHUB_REPOSITORY#*/}"
          if [[ "$REPO_NAME" == *.github.io ]]; then
            echo "CANOPY_BASE_PATH=" >> $GITHUB_ENV
          else
            echo "CANOPY_BASE_PATH=/$REPO_NAME" >> $GITHUB_ENV
          fi
      - name: Determine absolute base URL for Pages
        run: |
          OWNER="\${GITHUB_REPOSITORY%/*}"
          REPO="\${GITHUB_REPOSITORY#*/}"
          if [[ "$REPO" == "$OWNER.github.io" ]]; then
            BASE_URL="https://\${OWNER}.github.io"
          else
            BASE_URL="https://\${OWNER}.github.io/\${REPO}"
          fi
          echo "CANOPY_BASE_URL=\${BASE_URL}" >> $GITHUB_ENV

      - name: Build site
        env:
          CANOPY_CHUNK_SIZE: "10"
          CANOPY_FETCH_CONCURRENCY: "1"
        run: npm run build

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: site

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: \${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
`,QD=`name: Update Canopy App

on:
  workflow_dispatch:
    inputs:
      npm_version:
        description: "Optional @canopy-iiif/app version (default latest)"
        required: false
        type: string
      clover_version:
        description: "Optional @samvera/clover-iiif version (default latest)"
        required: false
        type: string

permissions:
  contents: write
  pull-requests: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      - name: Install updated packages
        env:
          APP_VERSION: \${{ github.event.inputs.npm_version }}
          CLOVER_VERSION: \${{ github.event.inputs.clover_version }}
        run: |
          npm config set fund false
          npm config set audit false
          APP_TARGET=\${APP_VERSION:-latest}
          CLOVER_TARGET=\${CLOVER_VERSION:-latest}
          npm install --no-audit --no-fund \\
            @canopy-iiif/app@"\${APP_TARGET}" \\
            @samvera/clover-iiif@"\${CLOVER_TARGET}"

      - name: Record changes
        id: git-status
        run: |
          if git diff --quiet HEAD -- package.json package-lock.json; then
            echo "changed=false" >> "$GITHUB_OUTPUT"
          else
            echo "changed=true" >> "$GITHUB_OUTPUT"
          fi

      - name: Create pull request
        if: steps.git-status.outputs.changed == 'true'
        uses: peter-evans/create-pull-request@v7
        with:
          branch: chore/update-canopy-app
          commit-message: "chore: update @canopy-iiif/app and @samvera/clover-iiif"
          title: "chore: update @canopy-iiif/app and @samvera/clover-iiif"
          body: |
            Automated update of \`@canopy-iiif/app\` and \`@samvera/clover-iiif\` triggered from the Actions tab.

            Review the diff, run \`npm install\`, and rerun your usual checks before merging.
          delete-branch: true

      - name: No update needed
        if: steps.git-status.outputs.changed != 'true'
        run: echo "@canopy-iiif/app and @samvera/clover-iiif are already up to date."
`,eL=e=>`import {Meta, Stylesheet} from "@canopy-iiif/app/head";
import {CanopyHeader, CanopyFooter} from "@canopy-iiif/app/ui";

export function Head() {
  return (
    <>
      <Meta />
      <Stylesheet />
      <link rel="preconnect" href="https://fonts.googleapis.com" />
      <link
        rel="preconnect"
        href="https://fonts.gstatic.com"
        crossOrigin="true"
      />
      <link
        href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght,SOFT,WONK@0,9..144,300..600,50,0..1;1,9..144,300..600,50,0..1&display=swap"
        rel="stylesheet"
      />
    </>
  );
}

export function App({children}) {
  return (
    <>
      <CanopyHeader
        navigation={[
          {href: "/search", label: "Works"},
          {href: "/about", label: "About"},
        ]}
        logo={Logo}
      />
      <main>{children}</main>
      <CanopyFooter>
        <p>Copyright ${new Date().getFullYear()} ${e}, MIT License. A Canopy IIIF Project.</p>
      </CanopyFooter>
    </>
  );
}

export const Logo = () => (
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500">
    <circle className="canopy-logo-backlight" cx="250" cy="250" r="250" />
    <path
      className="canopy-logo-overlay"
      d="M125,33.45C50.28,76.68,0,157.47,0,250s50.28,173.32,125,216.55c74.72-43.23,125-124.01,125-216.55S199.72,76.68,125,33.45Z"
    />
  </svg>
);
`,tL=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500">
  <circle fill="#4f46e5" cx="250" cy="250" r="250"/>
  <path fill="#fff" opacity="0.3" d="M125,33.45C50.28,76.68,0,157.47,0,250s50.28,173.32,125,216.55c74.72-43.23,125-124.01,125-216.55S199.72,76.68,125,33.45Z"/>
</svg>`,Ol=8765;class nL{async resizeImage(t,n,i,l="image/jpeg",o=.85){const u=await createImageBitmap(t),d=new OffscreenCanvas(n,i),m=d.getContext("2d");if(!m)throw new Error("Could not get canvas context");return m.drawImage(u,0,0,n,i),u.close(),await d.convertToBlob({type:l,quality:o})}async convertToGrayscale(t,n,i){const l=await createImageBitmap(t),o=new OffscreenCanvas(n,i),u=o.getContext("2d");if(!u)throw new Error("Could not get canvas context");u.drawImage(l,0,0,n,i),l.close();const d=u.getImageData(0,0,n,i),m=d.data;for(let h=0;h<m.length;h+=4){const p=.299*m[h]+.587*m[h+1]+.114*m[h+2];m[h]=p,m[h+1]=p,m[h+2]=p}return u.putImageData(d,0,0),await o.convertToBlob({type:"image/jpeg",quality:.85})}async extractSquareRegion(t,n,i){const l=await createImageBitmap(t),o=Math.min(n,i),u=Math.floor((n-o)/2),d=Math.floor((i-o)/2),m=new OffscreenCanvas(o,o),h=m.getContext("2d");if(!h)throw new Error("Could not get canvas context");return h.drawImage(l,u,d,o,o,0,0,o,o),l.close(),await m.convertToBlob({type:"image/jpeg",quality:.85})}async generateTile(t,n,i){const l=await createImageBitmap(t,n.x,n.y,n.w,n.h),o=new OffscreenCanvas(i.w,i.h),u=o.getContext("2d");if(!u)throw new Error("Could not get canvas context");return u.drawImage(l,0,0,i.w,i.h),l.close(),await o.convertToBlob({type:"image/jpeg",quality:.85})}async generateTilePyramid(t,n,i,l,o,u=512){const d=[],m=[];let h=Math.max(n,i),p=1;for(;h/p>u;)m.push(p),p*=2;m.push(p);for(const g of m){const y=Math.ceil(n/g),x=Math.ceil(i/g),v=Math.ceil(y/u),N=Math.ceil(x/u);for(let j=0;j<N;j++)for(let C=0;C<v;C++){const A=C*u*g,_=j*u*g,T=Math.min(u*g,n-A),L=Math.min(u*g,i-_),H=Math.ceil(T/g),k=Math.ceil(L/g),R=await this.generateTile(t,{x:A,y:_,w:T,h:L},{w:H,h:k}),z=`${A},${_},${T},${L}`,P=`${H},${k}`,K=`${o}/${l}/${z}/${P}/0/default.jpg`;d.push({path:K,blob:R})}}return d}async prepareExport(t,n){const i=[],l=v=>n.format==="canopy"?v.toLowerCase()+"s":v.toLowerCase(),o=n.format==="canopy"?"assets/iiif":"iiif",u=n.canopyConfig?.port||Ol,d=n.format==="canopy"?n.canopyConfig?.baseUrl||`http://localhost:${u}`:"",m=new Map;if(n.format==="canopy"){const v=N=>{const j=N.id.split("/").pop()||"unknown",C=l(N.type),A=`${d}/iiif/${C}/${j}.json`;m.set(N.id,A),N.items&&N.items.forEach(_=>{(Mt(_)||zt(_))&&v(_)})};v(t)}const h=(v,N)=>{if(v==null||typeof v!="object")return v;if(Array.isArray(v))return v.map(C=>h(C,N));const j={};for(const[C,A]of Object.entries(v))if(C==="id"&&typeof A=="string")if(m.has(A))j[C]=m.get(A);else if(A.includes("/canvas/")||A.includes("/annotation")||A.includes("/page/")){const _=A.split("/").slice(-3).join("/");j[C]=`${d}/iiif/manifests/${N}.json/${_}`}else j[C]=A;else if(C==="target"&&typeof A=="string")if(A.includes("/canvas/")){const _=A.split("/").slice(-2).join("/");j[C]=`${d}/iiif/manifests/${N}.json/${_}`}else j[C]=A;else j[C]=h(A,N);return j},p=[],g=(v,N)=>{const j=v.id;let C=j.split("/").pop()||"unknown",A=l(v.type),_=JSON.parse(JSON.stringify(v));n.format==="canopy"&&(_.id=m.get(j)||`${d}/iiif/${A}/${C}.json`),_.items&&(_.items=_.items.map((T,L)=>{if(Mt(T)||zt(T)){if(n.format==="canopy")return{id:m.get(T.id)||T.id,type:T.type,label:T.label};{const H=T.id.split("/").pop();return{id:`../${l(T.type)}/${H}.json`,type:T.type,label:T.label}}}else if(T.type==="Canvas"){const H=N.items?.[L];let k=n.format==="canopy"?h(T,C):JSON.parse(JSON.stringify(T));if(H&&H._fileRef&&H._fileRef.name&&n.includeAssets){const R=H._fileRef.name,z=R.replace(/\.[^/.]+$/,"").replace(/[^a-zA-Z0-9-_]/g,"_"),P=`${C}-${z}`,K=`assets/${R}`;if(i.push({path:K,content:H._fileRef,type:"asset"}),H._fileRef.type.startsWith("image/")){const D=n.format==="canopy"?"assets/iiif/images":"images",E=H.width||2e3,q=H.height||2e3;p.push({file:H._fileRef,assetId:P,imagesBasePath:D,imgWidth:E,imgHeight:q}),i.push({path:`${D}/${P}/info.json`,content:this.generateImageInfoJsonForExport(P,E,q,n.format==="canopy",!0,n.imageApiOptions,void 0,u),type:"info"})}const I=k.items?.[0]?.items?.[0];if(I&&I.body&&!Array.isArray(I.body)){n.format;const D=H.width||2e3,E=H.height||2e3;n.format==="canopy"?(I.body.id=`${d}/iiif/images/${P}/full/max/0/default.jpg`,I.body.width=D,I.body.height=E,I.body.service=[au(`${d}/iiif/images/${P}`,"level0")]):(I.body.id=`../../images/${P}/full/max/0/default.jpg`,I.body.width=D,I.body.height=E,I.body.service=[au(`../../images/${P}`,"level0")])}if((!k.width||k.width===Qt.defaultCanvasWidth)&&(k.width=H.width||Qt.defaultCanvasWidth,k.height=H.height||Qt.defaultCanvasHeight),k.thumbnail&&Array.isArray(k.thumbnail)){const E=(H?.height||2e3)/(H?.width||2e3),q=Math.floor(150*E);k.thumbnail=k.thumbnail.map(W=>({...W,id:n.format==="canopy"?`${d}/iiif/images/${P}/full/150,${q}/0/default.jpg`:`../../images/${P}/full/150,${q}/0/default.jpg`,width:150,height:q}))}}return delete k._fileRef,k}return T})),delete _._fileRef,i.push({path:`${o}/${A}/${C}.json`,content:JSON.stringify(_,null,2),type:"json"}),N.items&&N.items.forEach(T=>{(Mt(T)||zt(T))&&g(T,T)})};g(t,t);const y=n.imageApiOptions||{},x=y.tileSize||512;for(const v of p){const{file:N,assetId:j,imagesBasePath:C,imgWidth:A,imgHeight:_}=v,T=_/A;i.push({path:`${C}/${j}/full/max/0/default.jpg`,content:N,type:"asset"});for(const L of Pl)if(L<A){const H=Math.floor(L*T);try{const k=await this.resizeImage(N,L,H);if(i.push({path:`${C}/${j}/full/${L},${H}/0/default.jpg`,content:k,type:"asset"}),y.includeWebP){const R=await this.resizeImage(N,L,H,"image/webp",.85);i.push({path:`${C}/${j}/full/${L},${H}/0/default.webp`,content:R,type:"asset"})}}catch(k){console.warn(`Failed to resize ${j} to ${L}x${H}`,k),i.push({path:`${C}/${j}/full/${L},${H}/0/default.jpg`,content:N,type:"asset"})}}if(y.includeGrayscale)try{const L=await this.convertToGrayscale(N,A,_);i.push({path:`${C}/${j}/full/max/0/gray.jpg`,content:L,type:"asset"});for(const H of Pl)if(H<A){const k=Math.floor(H*T),R=await this.convertToGrayscale(N,H,k);i.push({path:`${C}/${j}/full/${H},${k}/0/gray.jpg`,content:R,type:"asset"})}}catch(L){console.warn(`Failed to generate grayscale for ${j}`,L)}if(y.includeSquare)try{const L=Math.min(A,_),H=await this.extractSquareRegion(N,A,_);i.push({path:`${C}/${j}/square/max/0/default.jpg`,content:H,type:"asset"});const k=ba().sizes.filter(R=>R<=600);for(const R of k)if(R<L){const z=await this.resizeImage(H,R,R);i.push({path:`${C}/${j}/square/${R},${R}/0/default.jpg`,content:z,type:"asset"})}}catch(L){console.warn(`Failed to generate square region for ${j}`,L)}try{const L=await this.generateTilePyramid(N,A,_,j,C,x);for(const H of L)i.push({path:H.path,content:H.blob,type:"asset"})}catch(L){console.warn(`Failed to generate tiles for ${j}`,L)}}if(n.format==="static-site"){try{const v=await this.fetchViewerAssets();i.push(...v)}catch(v){console.error("Failed to bundle viewer assets, falling back to CDN",v)}i.push({path:"index.html",content:this.generateIndexHtml(t,n),type:"html"})}else if(n.format==="canopy"&&n.canopyConfig){i.push({path:"canopy.yml",content:this.generateCanopyConfig(t,n.canopyConfig),type:"info"}),i.push({path:"README.md",content:this.generateCanopyReadme(n.canopyConfig),type:"info"});const v=this.generateCanopyTemplateFiles(n.canopyConfig);i.push(...v);const N=this.generateContentFiles(t,n.canopyConfig);if(i.push(...N),n.canopyConfig.metadata.length>0){const j=this.generateFacetCollections(t,n.canopyConfig);i.push(...j)}}return i}generateCanopyTemplateFiles(t){const n=[],i=t.port||Ol;return n.push({path:"package.json",content:MD(i),type:"info"}),n.push({path:".gitignore",content:FD,type:"info"}),n.push({path:"LICENSE",content:PD,type:"info"}),n.push({path:"app/scripts/canopy-build.mts",content:$D,type:"info"}),n.push({path:"app/styles/index.css",content:zD,type:"info"}),n.push({path:"app/styles/custom.css",content:UD,type:"info"}),n.push({path:"app/components/mdx.tsx",content:BD,type:"info"}),n.push({path:"app/components/Example.tsx",content:HD,type:"info"}),n.push({path:"app/components/Example.client.tsx",content:WD,type:"info"}),n.push({path:"content/_app.mdx",content:eL(t.title),type:"info"}),n.push({path:"content/_layout.mdx",content:GD,type:"info"}),n.push({path:"content/about/_layout.mdx",content:YD,type:"info"}),n.push({path:"content/works/_layout.mdx",content:qD,type:"info"}),n.push({path:"content/search/_layout.mdx",content:VD,type:"info"}),n.push({path:"content/search/_result-article.mdx",content:KD,type:"info"}),n.push({path:"content/search/_result-figure.mdx",content:XD,type:"info"}),n.push({path:"assets/robots.txt",content:ZD,type:"info"}),n.push({path:"assets/canopy.svg",content:tL,type:"info"}),n.push({path:".github/workflows/deploy-pages.yml",content:JD,type:"info"}),n.push({path:".github/workflows/update-canopy-app.yml",content:QD,type:"info"}),n}generateFacetCollections(t,n){const i=[],l=n.baseUrl||"",o={},u=d=>{if(zt(d)){const m=d.id;d.metadata?.forEach(h=>{const p=this.extractIIIFValue(h.label),g=this.extractIIIFValue(h.value);p&&g&&n.metadata.includes(p)&&(o[p]||(o[p]={}),o[p][g]||(o[p][g]=[]),o[p][g].includes(m)||o[p][g].push(m))})}d.items?.forEach(m=>{(Mt(m)||zt(m))&&u(m)})};u(t);for(const[d,m]of Object.entries(o)){const h=this.sanitizePathSegment(d);for(const[p,g]of Object.entries(m)){const y=this.sanitizePathSegment(p),x=`${l}/iiif/api/facet/${h}/${y}.json`,v={"@context":kt.PRESENTATION_3.CONTEXT,id:x,type:"Collection",label:{none:[`${d}: ${p}`]},summary:{none:[`${g.length} items with ${d} "${p}"`]},items:g.map(N=>{const j=N.split("/").pop();return{id:`${l}/iiif/manifests/${j}.json`,type:"Manifest"}})};i.push({path:`assets/iiif/api/facet/${h}/${y}.json`,content:JSON.stringify(v,null,2),type:"json"})}}return i}generateContentFiles(t,n){const i=[],l=n.title,o=this.extractIIIFValue(t.summary)||`A IIIF collection featuring ${this.countManifests(t)} items.`,d=n.featured&&n.featured.length>0?`
<Container>

## Featured Items

<Featured />

</Container>
`:"",m=`---
title: ${l}
description: ${o}
---

<Interstitials.Hero
  headline="${l}"
  description="${o.replace(/"/g,'\\"')}"
  background="theme"
  random={true}
  links={[
    {
      href: "/search",
      title: "Browse Collection",
      type: "primary",
    },
    {
      href: "/about",
      title: "About",
      type: "secondary",
    },
  ]}
/>${d}

<Container>

## Explore the Collection

Browse and discover items from this collection using the search and metadata facets.

<RelatedItems top={6} />

</Container>
`;i.push({path:"content/index.mdx",content:m,type:"info"});const h=this.countManifests(t),p=n.metadata.length>0?n.metadata.join(", "):"various categories",g=`---
title: About
description: About ${l}
---

# About ${l}

${o}

## Collection Overview

This collection contains **${h} items** organized by metadata including ${p}.

<ButtonWrapper variant="interstitial" text="Ready to explore?">
  <Button href="/search" label="Browse Collection" />
</ButtonWrapper>

## Using This Site

- **Search**: Use the search page to find items by keyword or browse by metadata facets
- **Works**: Each item has its own page with a viewer, metadata, and related items
- **Metadata**: Filter items by ${p}

---

*This site was generated with [IIIF Field Studio](https://github.com/micahchoo/field-studio) and [Canopy IIIF](https://canopy-iiif.github.io/app/).*
`;return i.push({path:"content/about/index.mdx",content:g,type:"info"}),i}countManifests(t){return VE(t).length}sanitizePathSegment(t){return t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").substring(0,100)}extractIIIFValue(t){return Le(t,"none")||Le(t,"en")||""}generateCanopyReadme(t){const n=t.featured.length>0?`*   **Featured Items**: ${t.featured.length} items selected for homepage`:"",i=t.port||Ol;return`# ${t.title} - Canopy IIIF Site

This is a complete, ready-to-run Canopy IIIF site exported from IIIF Field Studio.

##  Quick Start

This export includes everything you need - no need to clone the template separately!

1.  **Extract** this archive to a folder

2.  **Install dependencies**
    \`\`\`bash
    npm install
    \`\`\`

3.  **Start the development environment**

    You need to run TWO commands in separate terminals:

    **Terminal 1 - Start the IIIF file server:**
    \`\`\`bash
    npm run serve:iiif
    \`\`\`
    This serves your IIIF files at http://localhost:${i}

    **Terminal 2 - Start the Canopy build:**
    \`\`\`bash
    npm run dev
    \`\`\`

    Or use the combined command (requires both terminals):
    \`\`\`bash
    npm start
    \`\`\`

4.  **Open** http://localhost:5001 in your browser

##  Deploy to GitHub Pages

Before deploying, update the URLs in \`canopy.yml\`:

1.  Change the collection URL from \`http://localhost:${i}/iiif/...\` to your GitHub Pages URL
    (e.g., \`https://username.github.io/repo-name/iiif/...\`)

2.  Create a new GitHub repository and push this folder

3.  GitHub Actions will automatically build and deploy your site

##  Configuration

Your site settings are in \`canopy.yml\`:

*   **Title**: ${t.title}
*   **Theme**: ${t.theme.accentColor} / ${t.theme.grayColor} (${t.theme.appearance})
*   **Search**: ${t.search.enabled?"Enabled":"Disabled"}
*   **Metadata Facets**: ${t.metadata.length>0?t.metadata.join(", "):"None configured"}
${n}

##  Contents

\`\`\`
 canopy.yml              # Site configuration
 package.json            # Dependencies
 content/
    index.mdx           # Homepage
    about/index.mdx     # About page
    _app.mdx            # Site header/footer
    works/_layout.mdx   # Manifest page layout
    search/_layout.mdx  # Search results layout
 assets/
    iiif/
        collections/    # IIIF Collection JSON
        manifests/      # IIIF Manifest JSON
        images/         # Image derivatives
        api/facet/      # Metadata facet collections
 app/
    scripts/            # Build scripts
    styles/             # Custom CSS
    components/         # Custom components
 .github/workflows/      # Auto-deploy workflows
\`\`\`

##  Documentation

*   [Canopy IIIF Docs](https://canopy-iiif.github.io/app/docs/)
*   [IIIF Field Studio](https://github.com/micahchoo/field-studio)

---
*Generated with IIIF Field Studio*
`}generateCanopyConfig(t,n){const i=t.id.split("/").pop(),l=t.type.toLowerCase()+"s",o=n.port||Ol,u=n.baseUrl||`http://localhost:${o}`,d=`${u}/iiif/${l}/${i}.json`,m=zt(t)?"manifest:":"collection:",h=n.featured.map(g=>{const y=g.split("/").pop();return`${u}/iiif/manifests/${y}.json`});return[`title: "${n.title.replace(/"/g,'\\"')}"`,...n.baseUrl?[`baseUrl: "${n.baseUrl}"`]:[],"","# IIIF Collection source (uses local server during development)","# Update to your deployed URL for production",m,`  - ${d}`,"","metadata:",...n.metadata.map(g=>`  - ${g}`),"",...h.length>0?["featured:",...h.map(g=>`  - ${g}`),""]:[],"theme:",`  accentColor: ${n.theme.accentColor}`,`  grayColor: ${n.theme.grayColor}`,`  appearance: ${n.theme.appearance}`,"","search:","  index:","    metadata:",`      enabled: ${n.search.enabled}`,"    summary:",`      enabled: ${n.search.indexSummary}`].join(`
`)}async fetchViewerAssets(){const t=[{path:"viewer/uv.css",url:"https://cdn.jsdelivr.net/npm/universalviewer@4/dist/uv.css"},{path:"viewer/uv.js",url:"https://cdn.jsdelivr.net/npm/universalviewer@4/dist/uv.js"}];return Promise.all(t.map(async n=>{const i=await fetch(n.url);if(!i.ok)throw new Error(`Failed to fetch ${n.url}`);const l=await i.blob();return{path:n.path,content:l,type:"asset"}}))}async exportArchive(t,n,i){if(!n.ignoreErrors){i({status:"Airtight Validation...",percent:5});const d=Jl.validateTree(t);if(Object.values(d).some(h=>h.some(p=>p.level==="error")))throw new Error("Archive Integrity Failed. Resolve critical errors in Dry Run or use 'Ignore Errors' mode.")}i({status:"Synthesizing structure...",percent:20});const l=await this.prepareExport(t,n),o=new Zl;l.forEach(d=>o.file(d.path,d.content));const u=await o.generateAsync({type:"blob"},d=>{i({status:"Compressing archive...",percent:30+d.percent*.7})});return i({status:"Export Complete",percent:100}),u}generateImageInfoJsonForExport(t,n,i,l=!1,o=!1,u,d,m=Ol){const h=l?`http://localhost:${m}/iiif/images/${t}`:`images/${t}`,p=u?.tileSize||512,g=[];if(o){let j=Math.max(n,i),C=1;for(;j/C>p;)g.push(C),C*=2;g.push(C)}const y=[];u?.includeWebP&&y.push("webp");const x=[];u?.includeGrayscale&&(x.push("gray"),x.push("color"));const v=[];u?.includeSquare&&v.push("regionSquare"),v.push("sizeByWh");const N={"@context":kt.IMAGE_3.CONTEXT,id:h,type:"ImageService3",protocol:kt.IMAGE_3.PROTOCOL,profile:"level0",width:n,height:i,sizes:$E(n,i,Pl)};return o&&g.length>0&&(N.tiles=[{width:p,height:p,scaleFactors:g}]),y.length>0&&(N.preferredFormats=["webp","jpg"],N.extraFormats=y),x.length>0&&(N.extraQualities=x),v.length>0&&(N.extraFeatures=v),d&&(N.rights=d),JSON.stringify(N,null,2)}generateIndexHtml(t,n){const i=t.id.split("/").pop(),o=`iiif/${t.type.toLowerCase()}/${i}.json`,u=t.label?.none?.[0]||t.label?.en?.[0]||"IIIF Export",d=y=>y.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"').replace(/'/g,"&#x27;"),m=d(u),h=d(o),p=n.format==="static-site"?"viewer/uv.css":"https://cdn.jsdelivr.net/npm/universalviewer@4/dist/uv.css",g=n.format==="static-site"?"viewer/uv.js":"https://cdn.jsdelivr.net/npm/universalviewer@4/dist/uv.js";return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${u} - IIIF Archive</title>

    <!-- Universal Viewer -->
    <link rel="stylesheet" type="text/css" href="${p}">
    <script src="${g}"><\/script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        header {
            background: #1e293b;
            border-bottom: 1px solid #334155;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }
        .header-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .badge {
            background: #3b82f6;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        h1 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #f1f5f9;
        }
        .info-btn {
            background: transparent;
            border: 1px solid #475569;
            color: #cbd5e1;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .info-btn:hover {
            background: #334155;
            border-color: #64748b;
        }
        #viewer-container {
            flex: 1;
            min-height: 0;
            position: relative;
            background: #000;
        }
        #uv {
            width: 100%;
            height: 100%;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: #1e293b;
            border-radius: 0.75rem;
            max-width: 600px;
            width: 90%;
            padding: 2rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
        }
        .modal h2 {
            color: #3b82f6;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        .modal p {
            color: #cbd5e1;
            line-height: 1.75;
            margin-bottom: 1rem;
        }
        .modal code {
            background: #0f172a;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-family: monospace;
            color: #60a5fa;
        }
        .modal-footer {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #334155;
        }
        .btn-primary {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.625rem 1.25rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        .btn-primary:hover {
            background: #2563eb;
        }
        .feature-list {
            list-style: none;
            margin: 1rem 0;
        }
        .feature-list li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }
        .feature-list li:before {
            content: "";
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
        }
        footer {
            background: #1e293b;
            border-top: 1px solid #334155;
            padding: 1rem 2rem;
            text-align: center;
            font-size: 0.875rem;
            color: #64748b;
            flex-shrink: 0;
        }
        footer a {
            color: #3b82f6;
            text-decoration: none;
        }
        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <span class="badge">IIIF 3.0</span>
            <h1>${m}</h1>
        </div>
        <button class="info-btn" onclick="toggleModal()">
            About This Archive
        </button>
    </header>

    <div id="viewer-container">
        <div id="uv" class="uv"></div>
    </div>

    <footer>
        Generated by <a href="https://github.com/micahchoo/field-studio" target="_blank">IIIF Field Studio</a>
        &middot; Standards-compliant IIIF Presentation API 3.0 archive
    </footer>

    <div id="info-modal" class="modal">
        <div class="modal-content">
            <h2> About This IIIF Archive</h2>
            <p>
                This is a self-contained, standards-compliant IIIF archive.
                It can be opened in any IIIF-compatible viewer or served from any web host.
            </p>
            <ul class="feature-list">
                <li>IIIF Presentation API 3.0 compliant</li>
                <li>IIIF Image API Level 0 (pre-generated sizes)</li>
                <li>W3C Web Annotation Data Model</li>
                <li>No server or database required</li>
            </ul>
            <p>
                <strong>Entry Point:</strong> <code>${h}</code>
            </p>
            <p>
                To use with external viewers, point them to the manifest URL above.
                The archive includes all necessary images and metadata.
            </p>
            <div class="modal-footer">
                <button class="btn-primary" onclick="toggleModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Universal Viewer
        const manifestUri = '${h}';

        function createUV() {
            const urlDataProvider = new UV.URLDataProvider();

            const config = {
                modules: {
                    resourceLeftPanel: {
                        options: {
                            panelOpen: true
                        }
                    }
                }
            };

            const uv = createUV('#uv', {
                manifestUri: manifestUri,
                configUri: '',
                root: '/',
                embedded: true
            }, new urlDataProvider(true));
        }

        // Modal control
        function toggleModal() {
            document.getElementById('info-modal').classList.toggle('active');
        }

        // Initialize on load
        window.addEventListener('load', () => {
            try {
                createUV();
            } catch (error) {
                console.error('Failed to initialize Universal Viewer:', error);
                document.getElementById('viewer-container').innerHTML =
                    '<div style="color: #ef4444; padding: 2rem; text-align: center;">' +
                    '<p style="margin-bottom: 1rem;"> Failed to load viewer</p>' +
                    '<p><a href="' + manifestUri + '" style="color: #3b82f6;">View manifest JSON</a></p>' +
                    '</div>';
            }
        });
    <\/script>
</body>
</html>`}}const Zy=new nL;class sL{async exportOCFL(t,n){const i=[],l=[];let o=0,u=0,d=0;try{const m=this.sanitizeId(t.id),h="v1",p=new Date().toISOString(),g=[],y=JSON.stringify(t,null,2),x=await this.computeDigest(y,n.digestAlgorithm);if(g.push({logicalPath:"manifest.json",content:y,digest:x,size:new Blob([y]).size}),d++,n.includeMedia){const _=this.collectCanvases(t);for(const T of _)try{const L=await this.extractCanvasMedia(T,n.digestAlgorithm);L&&(g.push(L),u++)}catch(L){l.push(`Failed to extract media from canvas ${T.id}: ${L}`)}}i.push({path:`${m}/0=ocfl_object_1.1`,content:`ocfl_object_1.1
`});const v={},N={};for(const _ of g){const T=`${h}/content/${_.logicalPath}`;v[_.digest]||(v[_.digest]=[]),v[_.digest].push(T),N[_.digest]||(N[_.digest]=[]),N[_.digest].push(_.logicalPath),i.push({path:`${m}/${T}`,content:_.content}),o+=_.size}const j={id:t.id,type:"https://ocfl.io/1.1/spec/#inventory",digestAlgorithm:n.digestAlgorithm,head:h,contentDirectory:"content",manifest:v,versions:{[h]:{created:p,message:n.versionMessage||"Initial version",user:n.user?{name:n.user.name,address:n.user.email?`mailto:${n.user.email}`:void 0}:void 0,state:N}}},C=JSON.stringify(j,null,2),A=await this.computeDigest(C,n.digestAlgorithm);return i.push({path:`${m}/inventory.json`,content:C}),i.push({path:`${m}/inventory.json.${n.digestAlgorithm}`,content:`${A} inventory.json
`}),d+=2,i.push({path:`${m}/${h}/inventory.json`,content:C}),i.push({path:`${m}/${h}/inventory.json.${n.digestAlgorithm}`,content:`${A} inventory.json
`}),d+=2,{success:l.length===0,files:i,errors:l,stats:{totalFiles:i.length,totalSize:o,mediaFiles:u,metadataFiles:d}}}catch(m){return{success:!1,files:[],errors:[`OCFL export failed: ${m}`],stats:{totalFiles:0,totalSize:0,mediaFiles:0,metadataFiles:0}}}}async exportBagIt(t,n){const i=[],l=[],o=[];let u=0,d=0,m=0;try{const h=this.sanitizeId(Le(t.label)||t.id),p=new Date().toISOString().split("T")[0],g=JSON.stringify(t,null,2),y=new Blob([g]).size,x=await this.computeDigest(g,n.digestAlgorithm);if(o.push({path:"data/manifest.json",content:g,size:y,digest:x}),u+=y,m++,n.includeMedia){const k=this.collectCanvases(t);for(const R of k)try{const z=await this.extractCanvasMedia(R,n.digestAlgorithm);z&&(o.push({path:`data/media/${z.logicalPath}`,content:z.content,size:z.size,digest:z.digest}),u+=z.size,d++)}catch(z){l.push(`Failed to extract media from canvas ${R.id}: ${z}`)}}const v=`BagIt-Version: 1.0
Tag-File-Character-Encoding: UTF-8
`;i.push({path:`${h}/bagit.txt`,content:v});const N=[`Bagging-Date: ${p}`,`Payload-Oxum: ${u}.${o.length}`];n.organization&&N.push(`Source-Organization: ${n.organization}`),n.description&&N.push(`External-Description: ${n.description}`),n.externalId&&N.push(`External-Identifier: ${n.externalId}`),n.user&&(N.push(`Contact-Name: ${n.user.name}`),n.user.email&&N.push(`Contact-Email: ${n.user.email}`));const j=this.formatSize(u);N.push(`Bag-Size: ${j}`);const C=N.join(`
`)+`
`;i.push({path:`${h}/bag-info.txt`,content:C});const A=[];for(const k of o)A.push(`${k.digest}  ${k.path}`);const _=A.join(`
`)+`
`;i.push({path:`${h}/manifest-${n.digestAlgorithm}.txt`,content:_});const T=[{path:"bagit.txt",content:v},{path:"bag-info.txt",content:C},{path:`manifest-${n.digestAlgorithm}.txt`,content:_}],L=[];for(const k of T){const R=await this.computeDigest(k.content,n.digestAlgorithm);L.push(`${R}  ${k.path}`)}const H=L.join(`
`)+`
`;i.push({path:`${h}/tagmanifest-${n.digestAlgorithm}.txt`,content:H}),m+=4;for(const k of o)i.push({path:`${h}/${k.path}`,content:k.content});return{success:l.length===0,files:i,errors:l,stats:{totalFiles:i.length,totalSize:u,mediaFiles:d,metadataFiles:m}}}catch(h){return{success:!1,files:[],errors:[`BagIt export failed: ${h}`],stats:{totalFiles:0,totalSize:0,mediaFiles:0,metadataFiles:0}}}}async validateBagIt(t,n="sha256"){const i=[];if(!Array.from(t.keys()).find(m=>m.endsWith("/bagit.txt")))return i.push("Missing bagit.txt"),{valid:!1,errors:i};const o=Array.from(t.keys()).find(m=>m.match(/manifest-(sha256|sha512|md5)\.txt$/));if(!o)return i.push("Missing manifest file"),{valid:!1,errors:i};const u=t.get(o);if(!u||typeof u!="string")return i.push("Cannot read manifest file"),{valid:!1,errors:i};const d=u.trim().split(`
`);for(const m of d){const h=m.match(/^([a-f0-9]+)\s+(.+)$/);if(!h)continue;const[,p,g]=h,y=Array.from(t.keys()).find(N=>N.endsWith(g));if(!y){i.push(`Missing file: ${g}`);continue}const x=t.get(y);if(!x){i.push(`Cannot read file: ${g}`);continue}const v=await this.computeDigest(x,n);v!==p&&i.push(`Checksum mismatch for ${g}: expected ${p}, got ${v}`)}return{valid:i.length===0,errors:i}}collectCanvases(t){const n=[],i=l=>{if(Wt(l)&&n.push(l),l.items)for(const o of l.items)i(o)};return i(t),n}async extractCanvasMedia(t,n){if(t._fileRef){const d=t._fileRef,m=d,h=await this.computeDigest(m,n);return{logicalPath:d.name,content:m,digest:h,size:d.size}}const i=t.items?.[0]?.items?.[0];if(!i?.body)return null;const l=Array.isArray(i.body)?i.body[0]:i.body,o=typeof l=="string"?l:l?.id;if(!o)return null;const u=await qt.getAsset(o);if(u){const d=await this.computeDigest(u,n);return{logicalPath:o.split("/").pop()||"media",content:u,digest:d,size:u.size}}return null}async computeDigest(t,n){const i=typeof t=="string"?new TextEncoder().encode(t):new Uint8Array(await t.arrayBuffer()),l=await crypto.subtle.digest(n==="sha256"?"SHA-256":"SHA-512",i);return Array.from(new Uint8Array(l)).map(u=>u.toString(16).padStart(2,"0")).join("")}sanitizeId(t){return t.replace(/^https?:\/\//,"").replace(/[^a-zA-Z0-9_-]/g,"_").slice(0,100)}formatSize(t){return t<1024?`${t} bytes`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:t<1024*1024*1024?`${(t/(1024*1024)).toFixed(1)} MB`:`${(t/(1024*1024*1024)).toFixed(2)} GB`}async downloadAsZip(t,n="archival-package.zip"){const i=(await Xc(async()=>{const{default:m}=await Promise.resolve().then(()=>ID);return{default:m}},void 0)).default,l=new i;for(const m of t.files)m.content instanceof Blob,l.file(m.path,m.content);const o=await l.generateAsync({type:"blob"}),u=URL.createObjectURL(o),d=document.createElement("a");d.href=u,d.download=n,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(u)}}const Jy=new sL;function Dh(e,t){return typeof e>"u"?t:e}function Qy(e){const t=Array(e);for(let n=0;n<e;n++)t[n]=Xn();return t}function aL(e){return Object.keys(e)}function Xn(){return Object.create(null)}function iL(e){return[].concat.apply([],e)}function rL(e,t){return t.length-e.length}function lL(e){return e.constructor===Array}function pu(e){return typeof e=="string"}function zm(e){return typeof e=="object"}function oL(e){return typeof e=="function"}function cL(e,t,n,i){if(e&&(t&&(e=Lh(e,t)),this.matcher&&(e=Lh(e,this.matcher)),this.stemmer&&1<e.length&&(e=Lh(e,this.stemmer)),i&&1<e.length&&(e=fL(e)),n||n==="")){const l=e.split(n);return this.filter?hL(l,this.filter):l}return e}const uL=/[\p{Z}\p{S}\p{P}\p{C}]+/u;function dL(e){const t=Xn();for(let n=0,i=e.length;n<i;n++)t[e[n]]=1;return t}function ev(e,t){const n=aL(e),i=n.length,l=[];let o="",u=0;for(let d,m,h=0;h<i;h++)d=n[h],m=e[d],m?(l[u++]=tv(t?"(?!\\b)"+d+"(\\b|_)":d),l[u++]=m):o+=(o?"|":"")+d;return o&&(l[u++]=tv(t?"(?!\\b)("+o+")(\\b|_)":"("+o+")"),l[u]=""),l}function Lh(e,t){for(let n=0,i=t.length;n<i&&(e=e.replace(t[n],t[n+1]),!!e);n+=2);return e}function tv(e){return new RegExp(e,"g")}function fL(e){let t="",n="";for(let i,l=0,o=e.length;l<o;l++)(i=e[l])!==n&&(t+=n=i);return t}function hL(e,t){const n=e.length,i=[];for(let l=0,o=0;l<n;l++){const u=e[l];u&&!t[u]&&(i[o++]=u)}return i}function mL(e){return cL.call(this,(""+e).toLowerCase(),!1,uL,!1)}const pL={},gL={};function xL(e){Il(e,"add"),Il(e,"append"),Il(e,"search"),Il(e,"update"),Il(e,"remove")}function Il(e,t){e[t+"Async"]=function(){const n=this,i=arguments,l=i[i.length-1];let o;oL(l)&&(o=l,delete i[i.length-1]);const u=new Promise(function(d){setTimeout(function(){n.async=!0;const m=n[t].apply(n,i);n.async=!1,d(m)})});return o?(u.then(o),this):u}}function bL(e,t,n,i){const l=e.length;let o,u,d=[],m=0;i&&(i=[]);for(let h=l-1;0<=h;h--){const p=e[h],g=p.length,y=Xn();let x=!o;for(let v=0;v<g;v++){const N=p[v],j=N.length;if(j)for(let C,A,_=0;_<j;_++)if(A=N[_],o){if(o[A]){if(!h){if(n)n--;else if(d[m++]=A,m===t)return d}(h||i)&&(y[A]=1),x=!0}if(i&&(C=(u[A]||0)+1,u[A]=C,C<l)){const T=i[C-2]||(i[C-2]=[]);T[T.length]=A}}else y[A]=1}if(i)o||(u=y);else if(!x)return[];o=y}if(i)for(let h,p,g=i.length-1;0<=g;g--){h=i[g],p=h.length;for(let y,x=0;x<p;x++)if(y=h[x],!o[y]){if(n)n--;else if(d[m++]=y,m===t)return d;o[y]=1}}return d}function Wc(e){this.limit=e!==!0&&e,this.cache=Xn(),this.queue=[]}function yL(e,t,n){zm(e)&&(e=e.query);let i=this.cache.get(e);return i||(i=this.search(e,t,n),this.cache.set(e,i)),i}Wc.prototype.set=function(e,t){if(!this.cache[e]){let n=this.queue.length;n===this.limit?delete this.cache[this.queue[n-1]]:n++;for(let i=n-1;0<i;i--)this.queue[i]=this.queue[i-1];this.queue[0]=e}this.cache[e]=t},Wc.prototype.get=function(e){const t=this.cache[e];if(this.limit&&t){const n=this.queue.indexOf(e);if(n){const i=this.queue[n-1];this.queue[n-1]=this.queue[n],this.queue[n]=i}}return t},Wc.prototype.del=function(e){for(let t,n,i=0;i<this.queue.length;i++)n=this.queue[i],t=this.cache[n],t.includes(e)&&(this.queue.splice(i--,1),delete this.cache[n])};const vL={memory:{charset:"latin:extra",resolution:3,minlength:4,fastupdate:!1},performance:{resolution:3,minlength:3,optimize:!1,context:{depth:2,resolution:1}},match:{charset:"latin:extra",tokenize:"reverse"},score:{charset:"latin:advanced",resolution:20,minlength:3,context:{depth:3,resolution:9}},default:{}};function wL(e){if(pu(e))e=vL[e];else{const t=e.preset;t&&(e=Object.assign({},t[t],e))}return e}function NL(e,t,n,i,l,o,u){setTimeout(function(){const d=e(n?n+"."+i:i,JSON.stringify(u));d&&d.then?d.then(function(){t.export(e,t,n,l,o+1)}):t.export(e,t,n,l,o+1)})}function SL(e,t,n,i,l){let o,u;switch(l||(l=0)){case 0:if(o="reg",this.fastupdate)for(let d in u=Xn(),this.register)u[d]=1;else u=this.register;break;case 1:o="cfg",u={doc:0,opt:this.optimize?1:0};break;case 2:o="map",u=this.map;break;case 3:o="ctx",u=this.ctx;break;default:return}return NL(e,t||this,n,o,i,l,u),!0}function CL(e,t){t&&(pu(t)&&(t=JSON.parse(t)),e==="cfg"?this.optimize=!!t.opt:e==="reg"?(this.fastupdate=!1,this.register=t):e==="map"?this.map=t:e==="ctx"&&(this.ctx=t))}function _n(e,t){if(!(this instanceof _n))return new _n(e);let n,i,l;e?(e=wL(e),n=e.charset,i=e.lang,pu(n)&&(n.indexOf(":")===-1&&(n+=":default"),n=gL[n]),pu(i)&&(i=pL[i])):e={};let o,u,d=e.context||{};this.encode=e.encode||n&&n.encode||mL,this.register=t||Xn(),this.resolution=o=e.resolution||9,this.tokenize=l=n&&n.tokenize||e.tokenize||"strict",this.depth=l==="strict"&&d.depth,this.bidirectional=Dh(d.bidirectional,!0),this.optimize=u=Dh(e.optimize,!0),this.fastupdate=Dh(e.fastupdate,!0),this.minlength=e.minlength||1,this.boost=e.boost,this.map=u?Qy(o):Xn(),this.resolution_ctx=o=d.resolution||1,this.ctx=u?Qy(o):Xn(),this.rtl=n&&n.rtl||e.rtl,this.matcher=(l=e.matcher||i&&i.matcher)&&ev(l,!1),this.stemmer=(l=e.stemmer||i&&i.stemmer)&&ev(l,!0),this.filter=(l=e.filter||i&&i.filter)&&dL(l),this.cache=(l=e.cache)&&new Wc(l)}_n.prototype.append=function(e,t){return this.add(e,t,!0)},_n.prototype.add=function(e,t,n,i){if(t&&(e||e===0)){if(!i&&!n&&this.register[e])return this.update(e,t);t=this.encode(""+t);const l=t.length;if(l){const o=Xn(),u=Xn(),d=this.depth,m=this.resolution;for(let h=0;h<l;h++){let p=t[this.rtl?l-1-h:h],g=p.length;if(p&&g>=this.minlength&&(d||!u[p])){let y=Ic(m,l,h),x="";switch(this.tokenize){case"full":if(2<g){for(let v=0;v<g;v++)for(let N=g;N>v;N--)if(N-v>=this.minlength){const j=Ic(m,l,h,g,v);x=p.substring(v,N),this.push_index(u,x,j,e,n)}break}case"reverse":if(1<g){for(let v=g-1;0<v;v--)if(x=p[v]+x,x.length>=this.minlength){const N=Ic(m,l,h,g,v);this.push_index(u,x,N,e,n)}x=""}case"forward":if(1<g){for(let v=0;v<g;v++)x+=p[v],x.length>=this.minlength&&this.push_index(u,x,y,e,n);break}default:if(this.boost&&(y=Math.min(0|y/this.boost(t,p,h),m-1)),this.push_index(u,p,y,e,n),d&&1<l&&h<l-1){const v=Xn(),N=this.resolution_ctx,j=p,C=Math.min(d+1,l-h);v[j]=1;for(let A=1;A<C;A++)if(p=t[this.rtl?l-1-h-A:h+A],p&&p.length>=this.minlength&&!v[p]){v[p]=1;const _=Ic(N+(l/2>N?0:1),l,h,C-1,A-1),T=this.bidirectional&&p>j;this.push_index(o,T?j:p,_,e,n,T?p:j)}}}}}this.fastupdate||(this.register[e]=1)}}return this};function Ic(e,t,n,i,l){return n&&1<e?t+(i||0)<=e?n+(l||0):0|(e-1)/(t+(i||0))*(n+(l||0))+1:0}_n.prototype.push_index=function(e,t,n,i,l,o){let u=o?this.ctx:this.map;if((!e[t]||o&&!e[t][o])&&(this.optimize&&(u=u[n]),o?(e=e[t]||(e[t]=Xn()),e[o]=1,u=u[o]||(u[o]=Xn())):e[t]=1,u=u[t]||(u[t]=[]),this.optimize||(u=u[n]||(u[n]=[])),(!l||!u.includes(i))&&(u[u.length]=i,this.fastupdate))){const d=this.register[i]||(this.register[i]=[]);d[d.length]=u}},_n.prototype.search=function(e,t,n){n||(!t&&zm(e)?(n=e,e=n.query):zm(t)&&(n=t));let i,l,o,u=[],d=0;if(n&&(e=n.query||e,t=n.limit,d=n.offset||0,l=n.context,o=n.suggest),e&&(e=this.encode(""+e),i=e.length,1<i)){const g=Xn(),y=[];for(let x,v=0,N=0;v<i;v++)if(x=e[v],x&&x.length>=this.minlength&&!g[x]){if(!this.optimize&&!o&&!this.map[x])return u;y[N++]=x,g[x]=1}e=y,i=e.length}if(!i)return u;t||(t=100);let m,h=this.depth&&1<i&&l!==!1,p=0;h?(m=e[0],p=1):1<i&&e.sort(rL);for(let g,y;p<i;p++){if(y=e[p],h?(g=this.add_result(u,o,t,d,i===2,y,m),(!o||g!==!1||!u.length)&&(m=y)):g=this.add_result(u,o,t,d,i===1,y),g)return g;if(o&&p==i-1){let x=u.length;if(!x){if(h){h=0,p=-1;continue}return u}if(x===1)return nv(u[0],t,d)}}return bL(u,t,d,o)},_n.prototype.add_result=function(e,t,n,i,l,o,u){let d=[],m=u?this.ctx:this.map;if(this.optimize||(m=sv(m,o,u,this.bidirectional)),m){let h=0;const p=Math.min(m.length,u?this.resolution_ctx:this.resolution);for(let g,y,x=0,v=0;x<p&&(g=m[x],!(g&&(this.optimize&&(g=sv(g,o,u,this.bidirectional)),i&&g&&l&&(y=g.length,y<=i?(i-=y,g=null):(g=g.slice(i),i=0)),g&&(d[h++]=g,l&&(v+=g.length,v>=n)))));x++);if(h)return l?nv(d,n,0):void(e[e.length]=d)}return!t&&d};function nv(e,t,n){return e=e.length===1?e[0]:iL(e),n||e.length>t?e.slice(n,n+t):e}function sv(e,t,n,i){if(n){const l=i&&t>n;e=e[l?t:n],e=e&&e[l?n:t]}else e=e[t];return e}_n.prototype.contain=function(e){return!!this.register[e]},_n.prototype.update=function(e,t){return this.remove(e).add(e,t)},_n.prototype.remove=function(e,t){const n=this.register[e];if(n){if(this.fastupdate)for(let i,l=0;l<n.length;l++)i=n[l],i.splice(i.indexOf(e),1);else gu(this.map,e,this.resolution,this.optimize),this.depth&&gu(this.ctx,e,this.resolution_ctx,this.optimize);t||delete this.register[e],this.cache&&this.cache.del(e)}return this};function gu(e,t,n,i,l){let o=0;if(lL(e))if(l){const u=e.indexOf(t);u===-1?o++:1<e.length&&(e.splice(u,1),o++)}else{l=Math.min(e.length,n);for(let u,d=0;d<l;d++)u=e[d],u&&(o=gu(u,t,n,i,l),!i&&!o&&delete e[d])}else for(let u in e)o=gu(e[u],t,n,i,l),o||delete e[u];return o}_n.prototype.searchCache=yL,_n.prototype.export=SL,_n.prototype.import=CL,xL(_n.prototype);const jL=Object.freeze(Object.defineProperty({__proto__:null,default:_n},Symbol.toStringTag,{value:"Module"})),ha=[{key:"label",label:"Label",description:"Human-readable name for the resource",minLevel:"simple",category:"core",indexable:!0,searchWeight:10,exportable:!0,displayPriority:1,dataType:"string"},{key:"summary",label:"Summary",description:"Brief description of the resource",minLevel:"simple",category:"core",indexable:!0,searchWeight:5,exportable:!0,displayPriority:2,dataType:"string"},{key:"thumbnail",label:"Thumbnail",description:"Preview image for the resource",minLevel:"simple",category:"core",indexable:!1,searchWeight:0,exportable:!1,displayPriority:3,dataType:"uri"},{key:"metadata",label:"Metadata",description:"Descriptive key-value pairs",minLevel:"standard",category:"descriptive",indexable:!1,searchWeight:0,exportable:!1,displayPriority:10,multiValue:!0},{key:"rights",label:"Rights",description:"License or rights statement URL",minLevel:"standard",category:"descriptive",indexable:!1,searchWeight:0,exportable:!0,displayPriority:11,dataType:"uri"},{key:"requiredStatement",label:"Attribution",description:"Required attribution text",minLevel:"standard",category:"descriptive",indexable:!1,searchWeight:0,exportable:!0,displayPriority:12},{key:"navDate",label:"Navigation Date",description:"Date for timeline navigation",minLevel:"standard",category:"descriptive",indexable:!0,searchWeight:2,exportable:!0,displayPriority:13,dataType:"date"},{key:"provider",label:"Provider",description:"Institution or person providing resource",minLevel:"standard",category:"descriptive",indexable:!0,searchWeight:2,exportable:!0,displayPriority:14},{key:"behavior",label:"Behavior",description:"Presentation hints for viewers",minLevel:"advanced",category:"technical",indexable:!1,searchWeight:0,exportable:!1,displayPriority:20,multiValue:!0},{key:"viewingDirection",label:"Viewing Direction",description:"Reading order (LTR, RTL, etc.)",minLevel:"advanced",category:"technical",indexable:!1,searchWeight:0,exportable:!1,displayPriority:21},{key:"services",label:"Services",description:"Linked API services",minLevel:"advanced",category:"technical",indexable:!1,searchWeight:0,exportable:!1,displayPriority:22,multiValue:!0},{key:"seeAlso",label:"See Also",description:"Related external resources",minLevel:"advanced",category:"technical",indexable:!1,searchWeight:0,exportable:!1,displayPriority:23,multiValue:!0,dataType:"uri"},{key:"rendering",label:"Rendering",description:"Alternate representations (PDF, etc.)",minLevel:"advanced",category:"technical",indexable:!1,searchWeight:0,exportable:!1,displayPriority:24,multiValue:!0},{key:"partOf",label:"Part Of",description:"Parent collection reference",minLevel:"advanced",category:"structural",indexable:!1,searchWeight:0,exportable:!1,displayPriority:30,dataType:"uri"},{key:"start",label:"Start Canvas",description:"Initial canvas to display",minLevel:"advanced",category:"structural",indexable:!1,searchWeight:0,exportable:!1,displayPriority:31,dataType:"uri"},{key:"structures",label:"Structures",description:"Table of contents (Ranges)",minLevel:"advanced",category:"structural",indexable:!1,searchWeight:0,exportable:!1,displayPriority:32,multiValue:!0},{key:"metadata.title",label:"Title",description:"Dublin Core title field",minLevel:"standard",category:"dublin-core",indexable:!0,searchWeight:8,exportable:!0,displayPriority:40,dublinCoreMapping:"dc:title",dataType:"string"},{key:"metadata.creator",label:"Creator",description:"Dublin Core creator/author field",minLevel:"standard",category:"dublin-core",indexable:!0,searchWeight:6,exportable:!0,displayPriority:41,dublinCoreMapping:"dc:creator",dataType:"string"},{key:"metadata.date",label:"Date",description:"Dublin Core date field",minLevel:"standard",category:"dublin-core",indexable:!0,searchWeight:4,exportable:!0,displayPriority:42,dublinCoreMapping:"dc:date",dataType:"date"},{key:"metadata.description",label:"Description",description:"Dublin Core description field",minLevel:"standard",category:"dublin-core",indexable:!0,searchWeight:4,exportable:!0,displayPriority:43,dublinCoreMapping:"dc:description",dataType:"string"},{key:"metadata.subject",label:"Subject",description:"Dublin Core subject/keywords field",minLevel:"standard",category:"dublin-core",indexable:!0,searchWeight:5,exportable:!0,displayPriority:44,dublinCoreMapping:"dc:subject",dataType:"string",multiValue:!0},{key:"metadata.rights",label:"Rights",description:"Dublin Core rights field",minLevel:"standard",category:"dublin-core",indexable:!1,searchWeight:0,exportable:!0,displayPriority:45,dublinCoreMapping:"dc:rights",dataType:"string"},{key:"metadata.source",label:"Source",description:"Dublin Core source field",minLevel:"standard",category:"dublin-core",indexable:!0,searchWeight:2,exportable:!0,displayPriority:46,dublinCoreMapping:"dc:source",dataType:"string"},{key:"metadata.type",label:"Type",description:"Dublin Core type field",minLevel:"standard",category:"dublin-core",indexable:!0,searchWeight:3,exportable:!0,displayPriority:47,dublinCoreMapping:"dc:type",dataType:"string"},{key:"metadata.format",label:"Format",description:"Dublin Core format field",minLevel:"standard",category:"dublin-core",indexable:!1,searchWeight:0,exportable:!0,displayPriority:48,dublinCoreMapping:"dc:format",dataType:"string"},{key:"metadata.identifier",label:"Identifier",description:"Dublin Core identifier field",minLevel:"standard",category:"dublin-core",indexable:!0,searchWeight:3,exportable:!0,displayPriority:49,dublinCoreMapping:"dc:identifier",dataType:"string"},{key:"metadata.language",label:"Language",description:"Dublin Core language field",minLevel:"standard",category:"dublin-core",indexable:!1,searchWeight:0,exportable:!0,displayPriority:50,dublinCoreMapping:"dc:language",dataType:"string"},{key:"metadata.coverage",label:"Coverage",description:"Dublin Core coverage/location field",minLevel:"standard",category:"dublin-core",indexable:!0,searchWeight:3,exportable:!0,displayPriority:51,dublinCoreMapping:"dc:coverage",dataType:"string"},{key:"metadata.publisher",label:"Publisher",description:"Dublin Core publisher field",minLevel:"standard",category:"dublin-core",indexable:!0,searchWeight:2,exportable:!0,displayPriority:52,dublinCoreMapping:"dc:publisher",dataType:"string"},{key:"requiredStatement.label",label:"Attribution Label",description:"Label for required attribution",minLevel:"standard",category:"descriptive",indexable:!1,searchWeight:0,exportable:!0,displayPriority:60,dataType:"string"},{key:"requiredStatement.value",label:"Attribution Value",description:"Value for required attribution",minLevel:"standard",category:"descriptive",indexable:!1,searchWeight:0,exportable:!0,displayPriority:61,dataType:"string"}],EL=["label","summary","metadata.title","metadata.creator","metadata.date","metadata.description","metadata.subject"],H1={fields:EL,boosts:{label:10,"metadata.title":8,"metadata.creator":6,summary:5,"metadata.subject":5,"metadata.description":4,"metadata.date":4},normalizeDiacritics:!0};ha.filter(e=>e.exportable).map(e=>e.key);class AL{constructor(){this.fields=new Map;for(const t of ha)this.fields.set(t.key,t)}getField(t){return this.fields.get(t)}getAllFields(){return[...ha]}getVisibleFields(t){const n=["simple","standard","advanced"],i=n.indexOf(t);return ha.filter(l=>n.indexOf(l.minLevel)<=i)}getFieldsByCategory(t){return ha.filter(n=>n.category===t)}getIndexableFields(){return ha.filter(t=>t.indexable)}getExportableFields(){return ha.filter(t=>t.exportable)}getFieldsGroupedByCategory(){const t={};for(const n of ha)t[n.category]||(t[n.category]=[]),t[n.category].push(n);for(const n of Object.keys(t))t[n].sort((i,l)=>i.displayPriority-l.displayPriority);return t}buildSearchConfig(t){const n={};for(const i of t){const l=this.fields.get(i);l&&l.indexable&&(n[i]=l.searchWeight)}return{fields:t.filter(i=>this.fields.get(i)?.indexable),boosts:n,normalizeDiacritics:!0}}buildExportConfig(t,n=!0,i=!0){return{fields:t.filter(l=>this.fields.get(l)?.exportable),includeId:n,includeType:i}}isFieldVisible(t,n){const i=this.fields.get(t);if(!i)return!0;const l=["simple","standard","advanced"],o=l.indexOf(n);return l.indexOf(i.minLevel)<=o}getDublinCoreMapping(t){return this.fields.get(t)?.dublinCoreMapping}getDublinCoreFields(){return ha.filter(t=>t.dublinCoreMapping!==void 0)}normalizeForSearch(t){if(!t)return"";const n="",i="AAAAAAaaaaaaCcEEEEeeeeIIIIiiiiNnOOOOOOooooooUUUUuuuuYyy";let l=t;for(let o=0;o<n.length;o++)l=l.replace(new RegExp(n[o],"g"),i[o]);return l.toLowerCase().replace(/<[^>]+>/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim()}generatePid(t){return t&&this.normalizeForSearch(t).replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"").replace(/^-+|-+$/g,"").slice(0,50)||"item"}}const Dc=new AL,TL=_n||jL,av="iiif-field-recent-searches",iv=10;class _L{constructor(){this.index=null,this.isHealthy=!1,this.itemMap=new Map,this.labelIndex=new Map,this.typeCount=new Map,this.recentSearches=[],this.reset(),this.loadRecentSearches()}reset(){this.index=null,this.isHealthy=!1,this.itemMap.clear(),this.labelIndex.clear(),this.typeCount.clear();const t=TL,n=t.Document||t.default?.Document||t.default||(typeof t=="function"?t:null);if(!n){console.error("FlexSearch Document constructor not found. Keys:",Object.keys(t));return}try{this.index=new n({document:{id:"id",index:["label","text"],store:["id","type","label","context"]},tokenize:"forward"}),this.isHealthy=!0}catch(i){console.error("Failed to initialize FlexSearch index",i),this.index=null,this.isHealthy=!1}}buildIndex(t){this.reset(),!(!t||!this.isHealthy)&&(this.traverse(t,[]),console.log(`Indexed ${this.itemMap.size} items.`))}traverse(t,n){const i=Le(t.label,"none")||Le(t.label,"en")||"Untitled",l=Le(t.summary,"none")||Le(t.summary,"en")||"";this.index.add({id:t.id,label:i,text:l,type:t.type,context:n.join(" > ")}),this.itemMap.set(t.id,{item:t}),this.typeCount.set(t.type,(this.typeCount.get(t.type)||0)+1),this.indexWordsForAutocomplete(i,t.id),l&&this.indexWordsForAutocomplete(l,t.id);const o=[...n,i];if(t.items)for(const u of t.items)this.traverse(u,o);Wt(t)&&t.annotations&&t.annotations.forEach(u=>{u.items.forEach(d=>{let m="";if(Array.isArray(d.body)||d.body.type==="TextualBody"&&(m=d.body.value),m){const h=d.label||"Annotation";this.index.add({id:d.id,label:h,text:m,type:"Annotation",context:[...o,"Annotations"].join(" > ")}),this.itemMap.set(d.id,{item:d,parent:t.id}),this.indexWordsForAutocomplete(m,d.id)}})})}indexWordsForAutocomplete(t,n){const i=t.toLowerCase().split(/[\s\-_.,;:!?'"()\[\]{}]+/).filter(l=>l.length>=3);for(const l of i)this.labelIndex.has(l)||this.labelIndex.set(l,new Set),this.labelIndex.get(l).add(n)}async searchWorker(t){return this.search(t)}async buildIndexWorker(t){{this.buildIndex(t);return}}collectItemsForWorker(t,n,i){const l=Le(t.label,"none")||Le(t.label,"en")||"Untitled",o=Le(t.summary,"none")||Le(t.summary,"en")||"";i.push({id:t.id,text:`${l} ${o}`,type:t.type,label:l,context:n.join(" > ")});const u=[...n,l];if(t.items)for(const d of t.items)this.collectItemsForWorker(d,u,i);Wt(t)&&t.annotations&&t.annotations.forEach(d=>{d.items.forEach(m=>{let h="";Array.isArray(m.body)||m.body.type==="TextualBody"&&(h=m.body.value),h&&i.push({id:m.id,text:h,type:"Annotation",label:m.label||"Annotation",context:[...u,"Annotations"].join(" > "),parent:t.id})})})}search(t,n){if(!t||!this.isHealthy)return[];this.addRecentSearch(t);const i=this.index.search(t,{limit:50,enrich:!0}),l=[],o=new Set;for(const u of i)for(const d of u.result)o.has(d.doc.id)||n&&d.doc.type!==n||(o.add(d.doc.id),l.push({id:d.doc.id,type:d.doc.type,label:d.doc.label,context:d.doc.context,match:t}));return l}autocomplete(t,n=8){const i=[],l=t.toLowerCase().trim();if(!l)return this.recentSearches.slice(0,n).map(m=>({value:m,type:"recent",icon:"history"}));const o=this.recentSearches.filter(m=>m.toLowerCase().includes(l)).slice(0,3);for(const m of o)i.push({value:m,type:"recent",icon:"history"});const u=["Collection","Manifest","Canvas","Annotation","Range"].filter(m=>m.toLowerCase().startsWith(l));for(const m of u){const h=this.typeCount.get(m)||0;h>0&&i.push({value:`type:${m}`,type:"type",count:h,icon:this.getTypeIcon(m)})}const d=this.getWordSuggestions(l,n-i.length);for(const m of d)i.some(h=>h.value.toLowerCase()===m.toLowerCase())||i.push({value:m,type:"suggestion",icon:"search"});if(i.length<4&&l.length>=3){const m=this.getFuzzySuggestions(l,3);for(const h of m)i.some(p=>p.value.toLowerCase()===h.toLowerCase())||i.push({value:h,type:"suggestion",icon:"lightbulb"})}return i.slice(0,n)}getScoredSuggestions(t,n,i){const l=[];for(const[o,u]of this.labelIndex){const d=t(o,u);d&&l.push(d)}return l.sort(n),l.slice(0,i).map(o=>o.word)}getWordSuggestions(t,n){return this.getScoredSuggestions((i,l)=>i.startsWith(t)&&i!==t?{word:i,count:l.size}:null,(i,l)=>l.count-i.count,n)}getFuzzySuggestions(t,n){const i=Math.min(2,Math.floor(t.length/3));return this.getScoredSuggestions((l,o)=>{if(Math.abs(l.length-t.length)>i)return null;const u=this.levenshteinDistance(t,l);return u>0&&u<=i?{word:l,distance:u,count:o.size}:null},(l,o)=>l.distance!==o.distance?l.distance-o.distance:o.count-l.count,n)}levenshteinDistance(t,n){const i=[];for(let l=0;l<=n.length;l++)i[l]=[l];for(let l=0;l<=t.length;l++)i[0][l]=l;for(let l=1;l<=n.length;l++)for(let o=1;o<=t.length;o++)n.charAt(l-1)===t.charAt(o-1)?i[l][o]=i[l-1][o-1]:i[l][o]=Math.min(i[l-1][o-1]+1,i[l][o-1]+1,i[l-1][o]+1);return i[n.length][t.length]}getTypeIcon(t){return{Collection:"folder",Manifest:"description",Canvas:"image",Annotation:"comment",Range:"segment"}[t]||"article"}loadRecentSearches(){try{const t=localStorage.getItem(av);t&&(this.recentSearches=JSON.parse(t))}catch{this.recentSearches=[]}}saveRecentSearches(){try{localStorage.setItem(av,JSON.stringify(this.recentSearches))}catch{}}addRecentSearch(t){const n=t.trim();!n||n.length<2||(this.recentSearches=this.recentSearches.filter(i=>i!==n),this.recentSearches.unshift(n),this.recentSearches.length>iv&&(this.recentSearches=this.recentSearches.slice(0,iv)),this.saveRecentSearches())}clearRecentSearches(){this.recentSearches=[],this.saveRecentSearches()}getRecentSearches(){return[...this.recentSearches]}searchWithSyntax(t){const n=t.match(/^type:(\w+)$/i);if(n)return this.search("",n[1]);const i=t.match(/^type:(\w+)\s+(.+)$/i);return i?this.search(i[2],i[1]):this.search(t)}getParentId(t){return this.itemMap.get(t)?.parent}getStats(){return{totalItems:this.itemMap.size,typeCounts:Object.fromEntries(this.typeCount),uniqueWords:this.labelIndex.size}}exportLunrIndex(t,n=H1,i="",l="objects"){const o=[];let u=0;const d=this.collectIndexableItems(t);for(const p of d){const g=Dc.generatePid(p.id),y=Le(p.label)||"";Le(p.summary);const x=[];for(const j of n.fields){const C=this.extractFieldValue(p,j);C&&x.push(C)}const v=n.normalizeDiacritics?Dc.normalizeForSearch(y):y,N=n.normalizeDiacritics?Dc.normalizeForSearch(x.join(" ")):x.join(" ");o.push({lunr_id:String(u),pid:g,title:v,content:N,thumbnail:`img/derivatives/iiif/${g}/full/150,/0/default.jpg`,url:`${l}/${g}.html`}),u++}n.fields.filter(p=>Dc.getField(p)?.indexable!==!1).map(p=>({name:p==="label"?"title":p==="summary"?"content":p,boost:n.boosts[p]||1}));const m=[{name:"title",boost:n.boosts.label||10},{name:"content",boost:n.boosts.summary||1}],h=this.generateLunrConfigJs(i,m);return{documents:o,fields:m,ref:"lunr_id",lunrConfigJs:h}}collectIndexableItems(t){return qE(t)}extractFieldValue(t,n){if(n==="label")return Le(t.label)||"";if(n==="summary")return Le(t.summary)||"";if(n==="navDate")return t.navDate||"";if(n==="rights")return t.rights||"";if(n.startsWith("metadata.")){const i=n.replace("metadata.","").toLowerCase(),l=t.metadata||[];for(const o of l)if(Le(o.label)?.toLowerCase()===i)return Le(o.value)||"";return""}return""}generateLunrConfigJs(t,n){const i=n.map(l=>`      this.field('${l.name}'${l.boost!==1?`, { boost: ${l.boost} }`:""});`).join(`
`);return`// Lunr.js Search Configuration
// Generated by IIIF Field Studio (WAX-compatible)

var store = [];
var idx;

fetch('${t}/search/index.json')
  .then(response => response.json())
  .then(data => {
    store = data.documents;
    idx = lunr(function() {
      this.ref('lunr_id');
${i}

      data.documents.forEach(doc => {
        this.add(doc);
      });
    });
  });

function search(query) {
  if (!idx) return [];
  return idx.search(query).map(result => {
    return store.find(doc => doc.lunr_id === result.ref);
  });
}

function searchWithHighlight(query) {
  if (!idx) return [];
  return idx.search(query).map(result => {
    const doc = store.find(d => d.lunr_id === result.ref);
    return {
      ...doc,
      score: result.score,
      matchData: result.matchData
    };
  });
}
`}}const Ni=new _L;H1.fields;class kL{constructor(){this.cache=new Map,this.autocompleteCache=new Map}extractSearchService(t){if(!t)return null;const n=t.service||t.services||[],i=Array.isArray(n)?n:[n];for(const l of i)if(l.type==="SearchService2"||l["@type"]?.includes("SearchService"))return l;return null}extractAutocompleteService(t){if(!t.service)return null;for(const n of t.service)if(n.type==="AutoCompleteService2"||n["@type"]?.includes("AutoComplete"))return n;return null}async search(t,n,i={}){const l=new URL(t);l.searchParams.set("q",n),i.motivation&&l.searchParams.set("motivation",i.motivation),i.date&&l.searchParams.set("date",i.date),i.user&&l.searchParams.set("user",i.user);const o=l.toString();if(this.cache.has(o))return this.cache.get(o);try{const u=await fetch(l.toString(),{headers:{Accept:"application/ld+json, application/json"}});if(!u.ok)throw new Error(`Search failed: ${u.status} ${u.statusText}`);const d=await u.json();return this.cache.set(o,d),d}catch(u){throw console.error("[ContentSearch] Search failed:",u),u}}async autocomplete(t,n,i={}){const l=new URL(t);l.searchParams.set("q",n),i.motivation&&l.searchParams.set("motivation",i.motivation),i.min!==void 0&&l.searchParams.set("min",String(i.min));const o=l.toString();if(this.autocompleteCache.has(o))return this.autocompleteCache.get(o);try{const u=await fetch(l.toString(),{headers:{Accept:"application/ld+json, application/json"}});if(!u.ok)throw new Error(`Autocomplete failed: ${u.status}`);const d=await u.json();return this.autocompleteCache.set(o,d),setTimeout(()=>this.autocompleteCache.delete(o),3e4),d}catch(u){throw console.error("[ContentSearch] Autocomplete failed:",u),u}}parseResults(t){const n=[];for(const i of t.items){const l=this.parseAnnotation(i);l&&n.push(l)}return n}parseAnnotation(t){const l=(Array.isArray(t.body)?t.body:[t.body]).find(h=>h.type==="TextualBody")?.value||"";let o="",u,d,m;if(typeof t.target=="string"){o=t.target.split("#")[0];const h=t.target.split("#")[1];if(h){const p=this.parseFragment(h);d=p.region,m=p.time}}else if(t.target.type==="SpecificResource"){const h=t.target.source;o=typeof h=="string"?h:h.id;const p=Array.isArray(t.target.selector)?t.target.selector:t.target.selector?[t.target.selector]:[];for(const g of p)if(g.type==="TextQuoteSelector")u=g;else if(g.type==="FragmentSelector"){const y=this.parseFragment(g.value);d=y.region,m=y.time}}return o?{annotation:t,canvasId:o,text:l,selector:u,region:d,time:m}:null}parseFragment(t){const n={},i=t.match(/xywh=(\d+),(\d+),(\d+),(\d+)/);i&&(n.region={x:parseInt(i[1]),y:parseInt(i[2]),w:parseInt(i[3]),h:parseInt(i[4])});const l=t.match(/t=([\d.]+)(?:,([\d.]+))?/);return l&&(n.time={start:parseFloat(l[1]),end:l[2]?parseFloat(l[2]):void 0}),n}highlightText(t,n){const{exact:i,prefix:l,suffix:o}=n;let u=0;if(l){const m=t.indexOf(l);if(m===-1)return null;u=m+l.length}const d=t.indexOf(i,u);return d===-1||o&&!t.substring(d+i.length).startsWith(o)?null:{before:t.substring(0,d),match:i,after:t.substring(d+i.length)}}resultsToOverlayAnnotations(t,n){return t.filter(i=>i.canvasId===n&&i.region).map((i,l)=>({id:`search-result-${l}`,type:"Annotation",motivation:"highlighting",body:{type:"TextualBody",value:i.text,format:"text/plain"},target:i.region?`${n}#xywh=${i.region.x},${i.region.y},${i.region.w},${i.region.h}`:n}))}async getNextPage(t){if(!t.next)return null;const n=typeof t.next=="string"?t.next:t.next.id;return this.fetchPage(n)}async getPreviousPage(t){if(!t.prev)return null;const n=typeof t.prev=="string"?t.prev:t.prev.id;return this.fetchPage(n)}async fetchPage(t){if(this.cache.has(t))return this.cache.get(t);const n=await fetch(t,{headers:{Accept:"application/ld+json, application/json"}});if(!n.ok)throw new Error(`Failed to fetch page: ${n.status}`);const i=await n.json();return this.cache.set(t,i),i}clearCache(){this.cache.clear(),this.autocompleteCache.clear()}createLocalSearchService(t,n,i){const l=[];for(const u of n){const d=i.get(u.id)||"";d&&l.push({canvasId:u.id,text:d,words:d.toLowerCase().split(/\s+/).filter(m=>m.length>2)})}const o=new Map;for(const u of l)for(const d of u.words)o.set(d,(o.get(d)||0)+1);return{search:u=>{const d=u.toLowerCase(),m=[];for(const h of l){const p=h.text.toLowerCase();let g=0;for(;(g=p.indexOf(d,g))!==-1;){const y=Math.max(0,g-50),x=Math.min(h.text.length,g+u.length+50);m.push({id:`local-${h.canvasId}-${g}`,type:"Annotation",motivation:"highlighting",body:{type:"TextualBody",value:h.text.substring(y,x)},target:{type:"SpecificResource",source:h.canvasId,selector:{type:"TextQuoteSelector",exact:h.text.substring(g,g+u.length),prefix:h.text.substring(Math.max(0,g-20),g),suffix:h.text.substring(g+u.length,g+u.length+20)}}}),g+=u.length}}return{"@context":kt.SEARCH_2.CONTEXT,id:`${t}/search?q=${encodeURIComponent(u)}`,type:"AnnotationPage",partOf:{id:`${t}/search`,type:"AnnotationCollection",total:m.length},items:m}},autocomplete:u=>{const d=u.toLowerCase(),m=[];for(const[p,g]of o.entries())p.startsWith(d)&&p!==d&&m.push({value:p,count:g});m.sort((p,g)=>(g.count||0)-(p.count||0));const h=m.slice(0,10);return{"@context":kt.SEARCH_2.CONTEXT,id:`${t}/autocomplete?q=${encodeURIComponent(u)}`,type:"TermList",terms:h}}}}}const Ml=new kL;function W1(e){try{if(typeof structuredClone=="function")return structuredClone(e)}catch{}try{return JSON.parse(JSON.stringify(e))}catch(t){return console.error("[ValidationHealer] Failed to clone item:",t),null}}function Um(e,t=new WeakMap){if(e===null||typeof e!="object")return e;if(t.has(e))return t.get(e);if(e instanceof Date)return new Date(e.getTime());if(Array.isArray(e)){const i=[];t.set(e,i);for(let l=0;l<e.length;l++){const o=Um(e[l],t);o===null&&e[l]!==null?i[l]=e[l]:i[l]=o}return i}const n={};t.set(e,n);for(const i of Object.keys(e))if(e.hasOwnProperty(i)){const l=e[i];if(l!==void 0){const o=Um(l,t);o===null&&l!==null?n[i]=l:n[i]=o}}return n}function Rh(e,t,n="none"){if(!e)return vn(t,n);if(typeof e=="string")return vn(e,n);if(Array.isArray(e))return{[n]:e.filter(i=>typeof i=="string")};if(typeof e=="object"&&!Array.isArray(e)){if(Object.keys(e).some(o=>typeof o=="string"&&(o==="none"||o.includes("-")||/^[a-z]{2}$/.test(o)))&&Object.values(e).every(o=>Array.isArray(o)))return e;const l={};for(const[o,u]of Object.entries(e))Array.isArray(u)?l[o]=u.filter(d=>typeof d=="string"):typeof u=="string"&&(l[o]=[u]);if(Object.keys(l).length>0)return l}return vn(t,n)}function OL(){return Tj["CC0 1.0"]}function IL(e){try{const t=Le(e.label)||"Untitled Resource";return[{id:Bc("Agent"),type:"Agent",label:vn("Unknown Institution")}]}catch{return[{id:`http://archive.local/iiif/agent/${Date.now()}`,type:"Agent",label:{none:["Unknown Institution"]}}]}}function DL(){return[{id:"http://archive.local/iiif/thumbnail/placeholder",type:"Image",format:"image/jpeg"}]}function LL(){return{label:vn("Attribution"),value:vn("Provided by Example Institution")}}function dp(e){return e?typeof e!="object"?{valid:!1,error:"Item is not an object"}:e.type?{valid:!0}:{valid:!1,error:"Item has no type"}:{valid:!1,error:"Item is null or undefined"}}function $u(e,t){if(!e)return{success:!1,error:"Cannot heal null item"};if(!t)return{success:!1,error:"Cannot heal without issue"};if(!t.fixable)return{success:!1,message:"Issue is not auto-fixable"};try{const n=dp(e);if(!n.valid)return{success:!1,error:n.error};const i=e.id,l=W1(e);if(!l){const u=Um(e);if(!u)return{success:!1,error:"Failed to clone item for healing"};const d=rv(u,t);return d.success&&d.updatedItem&&d.updatedItem.id!==i&&(console.warn(`[ValidationHealer] ID changed during healing, restoring original: ${i}`),d.updatedItem.id=i),d}const o=rv(l,t);return o.success&&o.updatedItem&&o.updatedItem.id!==i&&(console.warn(`[ValidationHealer] ID changed during healing, restoring original: ${i}`),o.updatedItem.id=i),o}catch(n){return console.error("[ValidationHealer] Unexpected error during healing:",n),{success:!1,error:n instanceof Error?n.message:"Unknown error during healing"}}}function rv(e,t){const n=(t.message||"").toLowerCase();if(n.includes("missing required field: type")||n.includes("type is required"))return e.type||(e.type="ContentResource"),{success:!0,updatedItem:e,message:"Added default type"};if(n.includes("missing required field: id")||n.includes("id is required"))return e.id||(e.id=Bc(e.type||"Resource")),{success:!0,updatedItem:e,message:"Generated valid ID"};if(n.includes("id must be a valid http")||n.includes("http")&&n.includes("uri")){if(!e.id||!e.id.startsWith("http")){const l=e.id||Bc("Resource").split("/").pop();e.id=Bc(e.type||"Resource",encodeURIComponent(l||"item"))}return{success:!0,updatedItem:e,message:"Converted ID to valid HTTP URI"}}if(n.includes("duplicate id"))return console.warn(`[ValidationHealer] Duplicate ID detected: ${e.id}. This requires manual fix to avoid breaking references.`),{success:!1,message:"Duplicate ID requires manual fix - ID must remain stable for vault sync"};if(n.includes("canvas id must not contain a fragment"))return e.id=e.id.split("#")[0],{success:!0,updatedItem:e,message:"Removed fragment from Canvas ID"};if(n.includes("label")){if(n.includes("missing required")||n.includes("must have")){const l=e.id?e.id.split("/").pop()||"Untitled":"Untitled Resource";return e.label=vn(l,"none"),{success:!0,updatedItem:e,message:"Added required label from ID"}}if(n.includes("must be a language map")||n.includes("language map")){const l=typeof e.label=="string"?e.label:e.id?e.id.split("/").pop():"Untitled";return e.label=vn(l||"Untitled","none"),{success:!0,updatedItem:e,message:"Converted label to language map"}}}if(n.includes("summary")){const l=Le(e.label)||e.type||"resource";return e.summary=vn(`Summary for ${l}`,"none"),{success:!0,updatedItem:e,message:"Added placeholder summary"}}if(n.includes("metadata")){if(n.includes("must have both label and value"))return Array.isArray(e.metadata)&&(e.metadata=e.metadata.filter(l=>l&&(l.label||l.value)).map(l=>({label:Rh(l.label,"Field","en"),value:Rh(l.value,"","none")}))),{success:!0,updatedItem:e,message:"Fixed metadata entry structure"};if(!e.metadata)return e.metadata=[],{success:!0,updatedItem:e,message:"Initialized empty metadata array"}}if((n.includes("dimensions")||n.includes("width")||n.includes("height"))&&Wt(e))return e.width&&!e.height?(e.height=e.width,{success:!0,updatedItem:e,message:"Set height to match width"}):e.height&&!e.width?(e.width=e.height,{success:!0,updatedItem:e,message:"Set width to match height"}):(e.width=Qt.defaultCanvasWidth,e.height=Qt.defaultCanvasHeight,{success:!0,updatedItem:e,message:"Set default canvas dimensions"});if(n.includes("duration")&&Wt(e)&&!e.duration)return e.duration=0,{success:!0,updatedItem:e,message:"Added zero duration (update manually)"};if(n.includes("items")){if(n.includes("must have at least one item")||n.includes("items array")){if(e.items||(e.items=[]),zt(e)&&e.items.length===0){const l=`${e.id}/canvas/1`;return e.items.push({id:l,type:"Canvas",label:vn("Page 1","none"),width:Qt.defaultCanvasWidth,height:Qt.defaultCanvasHeight,items:[]}),{success:!0,updatedItem:e,message:"Added placeholder canvas to empty Manifest"}}if(Mt(e)&&e.items.length===0){const l=`${e.id}/manifest/1`;return e.items.push({id:l,type:"Manifest",label:vn("Placeholder Manifest","none"),items:[]}),{success:!0,updatedItem:e,message:"Added placeholder manifest to empty Collection"}}return{success:!0,updatedItem:e,message:"Initialized items array"}}if(n.includes("invalid type")&&n.includes("parent type")){const l=Cj(e.type);if(l.length>0&&e.items)return e.items=e.items.filter(o=>o&&l.includes(o.type)),{success:!0,updatedItem:e,message:"Removed items with invalid types"}}}if(n.includes("structures")&&Mt(e))return delete e.structures,{success:!0,updatedItem:e,message:"Removed invalid structures property from Collection"};if(n.includes("structures")&&e.type!=="Manifest")return delete e.structures,{success:!0,updatedItem:e,message:`Removed structures from ${e.type}`};if(n.includes("rights"))return e.rights=OL(),{success:!0,updatedItem:e,message:"Added CC0 rights statement"};if(n.includes("requiredstatement")||n.includes("required statement"))return e.requiredStatement=LL(),{success:!0,updatedItem:e,message:"Added default required statement"};if(n.includes("provider"))return e.provider=IL(e),{success:!0,updatedItem:e,message:"Added default provider"};if((n.includes("behavior not allowed")||n.includes("not valid for"))&&e.behavior){const l=yw(e.type);return e.behavior=e.behavior.filter(o=>l.includes(o)),e.behavior.length===0&&delete e.behavior,{success:!0,updatedItem:e,message:"Removed invalid behaviors for resource type"}}if(n.includes("behavior")&&n.includes("conflict")&&e.behavior){const l=new Set,o=[];for(const u of e.behavior){const d=vw(u);d?l.has(d.name)||(l.add(d.name),o.push(u)):o.push(u)}return e.behavior=o.length>0?o:void 0,{success:!0,updatedItem:e,message:"Resolved behavior conflicts"}}if(n.includes("viewingdirection")||n.includes("viewing direction")){if(n.includes("not allowed"))return delete e.viewingDirection,{success:!0,updatedItem:e,message:"Removed viewingDirection from invalid resource type"};if(n.includes("invalid"))return e.viewingDirection="left-to-right",{success:!0,updatedItem:e,message:"Set default viewingDirection to left-to-right"}}if(n.includes("navdate")||n.includes("nav date"))return n.includes("not allowed")?(delete e.navDate,{success:!0,updatedItem:e,message:"Removed navDate from invalid resource type"}):(e.navDate=new Date().toISOString(),{success:!0,updatedItem:e,message:"Set navDate to current date"});if(n.includes("thumbnail"))return e.thumbnail=DL(),{success:!0,updatedItem:e,message:"Added placeholder thumbnail"};if(n.includes("format")){if(n.includes("not allowed"))return delete e.format,{success:!0,updatedItem:e,message:"Removed format from invalid resource type"};const l=(e.type||"").toLowerCase();return l.includes("image")?e.format="image/jpeg":l.includes("video")?e.format="video/mp4":l.includes("sound")||l.includes("audio")?e.format="audio/mp3":l.includes("text")?e.format="text/html":e.format="application/octet-stream",{success:!0,updatedItem:e,message:"Added default format"}}if(n.includes("@context")||n.includes("context")){if((n.includes("must have")||n.includes("missing"))&&(Mt(e)||zt(e)))return e["@context"]=kt.PRESENTATION_3.CONTEXT,{success:!0,updatedItem:e,message:"Added IIIF Presentation API 3.0 context"};if(n.includes("should only be on top-level"))return delete e["@context"],{success:!0,updatedItem:e,message:"Removed @context from embedded resource"}}if(n.includes("motivation")){if(n.includes("not allowed"))return delete e.motivation,{success:!0,updatedItem:e,message:"Removed motivation from invalid resource type"};if(n.includes("invalid")||n.includes("missing"))return e.motivation="painting",{success:!0,updatedItem:e,message:"Set default motivation to painting"}}if(n.includes("annotations")&&n.includes("not allowed"))return delete e.annotations,{success:!0,updatedItem:e,message:"Removed annotations from invalid resource type"};if(n.includes("service")&&n.includes("not allowed"))return delete e.service,{success:!0,updatedItem:e,message:"Removed service from invalid resource type"};const i=["label","summary"];for(const l of i)if(n.includes(l)&&n.includes("must be a language map")){const o=e[l];return e[l]=Rh(o,l==="label"?"Untitled":""),{success:!0,updatedItem:e,message:`Converted ${l} to valid language map`}}return n.includes("image")&&(n.includes("height")||n.includes("width"))&&e.type==="Image"?(e.width||(e.width=1e3),e.height||(e.height=800),{success:!0,updatedItem:e,message:"Added default image dimensions"}):{success:!1,message:"No auto-fix available for this issue type"}}function G1(e,t){if(!e)return console.error("[ValidationHealer] healAllIssues called with null item"),{item:null,healed:0,failed:0,errors:["Null item provided"]};if(!Array.isArray(t))return console.error("[ValidationHealer] healAllIssues called with invalid issues array"),{item:e,healed:0,failed:0,errors:["Invalid issues array"]};let n=e,i=0,l=0;const o=[],u=t.filter(d=>d&&d.fixable);for(const d of u)try{const m=$u(n,d);if(m.success&&m.updatedItem){const h=dp(m.updatedItem);h.valid?(n=m.updatedItem,i++):(l++,o.push(`Structure validation failed after healing: ${h.error}`))}else l++,m.error&&o.push(m.error)}catch(m){l++;const h=m instanceof Error?m.message:"Unknown error";o.push(`Exception during healing: ${h}`),console.error("[ValidationHealer] Exception in healAllIssues:",m)}return{item:n,healed:i,failed:l,errors:o}}function Bm(e,t,n){if(!e)return console.error("[ValidationHealer] applyHealToTree called with null root"),null;if(!t)return console.error("[ValidationHealer] applyHealToTree called with null itemId"),null;if(!n)return console.error("[ValidationHealer] applyHealToTree called with null healedItem"),null;try{const i=dp(n);if(!i.valid)return console.error("[ValidationHealer] Cannot apply invalid healed item:",i.error),null;const l=W1(e);if(!l)return console.error("[ValidationHealer] Failed to clone root in applyHealToTree"),null;const o=Yv(l,t);if(!o)return console.warn(`[ValidationHealer] Could not find item with ID ${t} in tree`),l;try{return Object.assign(o,n),l}catch(u){return console.error("[ValidationHealer] Object.assign failed:",u),null}}catch(i){return console.error("[ValidationHealer] Exception in applyHealToTree:",i),null}}function Y1(e,t){if(!e)return{success:!1,error:"No item to heal"};if(!t||t.length===0)return{success:!0,updatedItem:e,message:"No issues to heal"};try{const n=G1(e,t);return n.errors.length>0&&console.warn("[ValidationHealer] Healing completed with errors:",n.errors),n.healed===0&&n.failed>0?{success:!1,error:`Failed to heal any issues. Errors: ${n.errors.join(", ")}`}:{success:!0,updatedItem:n.item,message:`Healed ${n.healed} issues${n.failed>0?`, ${n.failed} failed`:""}`}}catch(n){const i=n instanceof Error?n.message:"Unknown error in batch healing";return console.error("[ValidationHealer] safeHealAll exception:",n),{success:!1,error:i}}}function q1(e){const t=(e.message||"").toLowerCase();return t.includes("missing required field: type")?"Add default resource type":t.includes("missing required field: id")?"Generate valid HTTP URI ID":t.includes("id must be a valid http")?"Convert ID to HTTP(S) URI":t.includes("duplicate id")?"Append unique suffix to ID":t.includes("canvas id must not contain a fragment")?"Remove fragment identifier from Canvas ID":t.includes("label")&&t.includes("required")?"Add label derived from ID":t.includes("label")&&t.includes("language map")?"Convert label to language map format":t.includes("summary")?"Add placeholder summary":t.includes("metadata")&&t.includes("label and value")?"Fix metadata entry structure":t.includes("metadata")?"Initialize metadata array":t.includes("dimensions")||t.includes("width")||t.includes("height")?e.itemLabel?.toLowerCase().includes("canvas")?"Set default canvas dimensions":e.itemLabel?.toLowerCase().includes("image")?"Set default image dimensions":"Set default dimensions":t.includes("duration")?"Add duration field (update value manually)":t.includes("items")&&t.includes("must have at least one")?"Add placeholder item":t.includes("items")&&t.includes("invalid type")?"Remove items with invalid types":t.includes("items")?"Initialize items array":t.includes("structures")&&e.itemLabel?.toLowerCase().includes("collection")?"Remove invalid structures property":t.includes("structures")?"Remove structures from invalid resource type":t.includes("rights")?"Add CC0 rights statement":t.includes("requiredstatement")||t.includes("required statement")?"Add default attribution statement":t.includes("provider")?"Add default provider/institution":t.includes("behavior")&&t.includes("not allowed")?"Remove invalid behaviors for resource type":t.includes("behavior")&&t.includes("conflict")?"Resolve conflicting behaviors (keep first from each group)":t.includes("behavior")?"Clear or fix behaviors":t.includes("viewingdirection")&&t.includes("not allowed")?"Remove viewingDirection from this resource type":t.includes("viewingdirection")?"Set default viewingDirection to left-to-right":t.includes("navdate")&&t.includes("not allowed")?"Remove navDate from this resource type":t.includes("navdate")?"Set navDate to current date":t.includes("thumbnail")?"Add placeholder thumbnail reference":t.includes("format")&&t.includes("not allowed")?"Remove format from invalid resource type":t.includes("format")?"Add default format based on content type":t.includes("@context")&&t.includes("must have")?"Add IIIF Presentation API 3.0 context":t.includes("@context")?"Remove @context from embedded resource":t.includes("motivation")&&t.includes("not allowed")?"Remove motivation from invalid resource type":t.includes("motivation")?"Set default motivation to painting":t.includes("annotations")&&t.includes("not allowed")?"Remove annotations from invalid resource type":t.includes("service")&&t.includes("not allowed")?"Remove service from invalid resource type":t.includes("must be a language map")?"Convert to valid language map format":t.includes("http")&&t.includes("uri")?"Generate valid HTTP URI":"Auto-fix available"}const RL=Object.freeze(Object.defineProperty({__proto__:null,applyHealToTree:Bm,getFixDescription:q1,healAllIssues:G1,healIssue:$u,safeHealAll:Y1},Symbol.toStringTag,{value:"Module"})),ML="biiif-activity-db",FL=2,Lc=100,Mh=1e4,PL=5e3;class $L{constructor(){this.actor=null,this.dbPromise=tp(ML,FL,{upgrade(t,n,i,l){if(!t.objectStoreNames.contains("activities")){const o=t.createObjectStore("activities");o.createIndex("by-time","endTime"),o.createIndex("by-object","object.id"),o.createIndex("by-type","type")}if(t.objectStoreNames.contains("metadata")||t.createObjectStore("metadata"),!t.objectStoreNames.contains("archived")){const o=t.createObjectStore("archived");o.createIndex("by-time","endTime"),o.createIndex("by-object","object.id")}}}),this.initializeActor()}async initializeActor(){const t=await this.dbPromise;let n=await t.get("metadata","deviceId");n||(n=`device-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,await t.put("metadata",n,"deviceId")),this.actor={id:n,type:"Application",name:"IIIF Field Archive Studio"}}setActor(t){this.actor=t}generateActivityId(){return`urn:uuid:${crypto.randomUUID()}`}async recordCreate(t,n,i){const l={"@context":"https://www.w3.org/ns/activitystreams",id:this.generateActivityId(),type:"Create",endTime:new Date().toISOString(),object:{id:t,type:n,modified:new Date().toISOString()},actor:this.actor||void 0,summary:i||`Created ${n}`};return await this.saveActivity(l),l}async recordUpdate(t,n,i){const l={"@context":"https://www.w3.org/ns/activitystreams",id:this.generateActivityId(),type:"Update",endTime:new Date().toISOString(),object:{id:t,type:n,modified:new Date().toISOString()},actor:this.actor||void 0,summary:i||`Updated ${n}`};return await this.saveActivity(l),l}async recordDelete(t,n,i){const l={"@context":"https://www.w3.org/ns/activitystreams",id:this.generateActivityId(),type:"Delete",endTime:new Date().toISOString(),object:{id:t,type:n,deleted:new Date().toISOString()},actor:this.actor||void 0,summary:i||`Deleted ${n}`};return await this.saveActivity(l),l}async recordMove(t,n,i,l,o,u,d){const m={"@context":"https://www.w3.org/ns/activitystreams",id:this.generateActivityId(),type:"Move",endTime:new Date().toISOString(),object:{id:t,type:n,modified:new Date().toISOString()},origin:{id:i,type:l},target:{id:o,type:u},actor:this.actor||void 0,summary:d||`Moved ${n}`};return await this.saveActivity(m),m}async recordAdd(t,n,i,l,o){const u={"@context":"https://www.w3.org/ns/activitystreams",id:this.generateActivityId(),type:"Add",endTime:new Date().toISOString(),object:{id:t,type:n,modified:new Date().toISOString()},target:{id:i,type:l},actor:this.actor||void 0,summary:o||`Added ${n} to ${l}`};return await this.saveActivity(u),u}async recordRemove(t,n,i,l,o){const u={"@context":"https://www.w3.org/ns/activitystreams",id:this.generateActivityId(),type:"Remove",endTime:new Date().toISOString(),object:{id:t,type:n,modified:new Date().toISOString()},origin:{id:i,type:l},actor:this.actor||void 0,summary:o||`Removed ${n} from ${l}`};return await this.saveActivity(u),u}async saveActivity(t){await(await this.dbPromise).put("activities",t,t.id),this.checkAndRotateIfNeeded().catch(i=>{console.warn("[ActivityStream] Log rotation check failed:",i)})}async checkAndRotateIfNeeded(){const t=await this.dbPromise,n=await t.count("activities");if(n<=Mh)return;console.log(`[ActivityStream] Rotating activities: ${n} entries exceeds limit of ${Mh}`);const i=await t.getAllFromIndex("activities","by-time"),l=n-PL,o=i.slice(0,l),u=t.transaction(["activities","archived"],"readwrite"),d=u.objectStore("activities"),m=u.objectStore("archived");for(const h of o)await m.put(h,h.id),await d.delete(h.id);await u.done,console.log(`[ActivityStream] Archived ${o.length} activities`)}async getArchivedActivitiesForObject(t){return(await this.dbPromise).getAllFromIndex("archived","by-object",t)}async getAllActivitiesForObject(t){const[n,i]=await Promise.all([this.getActivitiesForObject(t),this.getArchivedActivitiesForObject(t)]);return[...n,...i].sort((l,o)=>new Date(l.endTime).getTime()-new Date(o.endTime).getTime())}async getArchivedActivities(t={}){const n=await this.dbPromise;let i;return t.objectId?i=await n.getAllFromIndex("archived","by-object",t.objectId):i=await n.getAllFromIndex("archived","by-time"),t.since&&(i=i.filter(l=>l.endTime>=t.since)),t.until&&(i=i.filter(l=>l.endTime<=t.until)),i.sort((l,o)=>new Date(o.endTime).getTime()-new Date(l.endTime).getTime()),t.limit&&t.limit>0&&(i=i.slice(0,t.limit)),i}async getArchiveStats(){const t=await this.dbPromise,[n,i]=await Promise.all([t.count("activities"),t.count("archived")]);return{mainCount:n,archivedCount:i,totalCount:n+i,rotationThreshold:Mh}}async getActivitiesForObject(t){return(await this.dbPromise).getAllFromIndex("activities","by-object",t)}async getActivitiesByType(t){return(await this.dbPromise).getAllFromIndex("activities","by-type",t)}async getRecentActivities(t=50){return(await(await this.dbPromise).getAllFromIndex("activities","by-time")).reverse().slice(0,t)}async getActivitiesSince(t){return(await(await this.dbPromise).getAllFromIndex("activities","by-time")).filter(l=>l.endTime>t)}async getCount(){return(await this.dbPromise).count("activities")}async exportAsChangeDiscovery(t){const n=await this.getCount(),i=`${t}/activity/collection`;return{"@context":["https://www.w3.org/ns/activitystreams",kt.DISCOVERY_1.CONTEXT],id:i,type:"OrderedCollection",totalItems:n,first:n>0?{id:`${i}/page/0`,type:"OrderedCollectionPage"}:void 0,last:n>0?{id:`${i}/page/${Math.floor((n-1)/Lc)}`,type:"OrderedCollectionPage"}:void 0}}async exportPage(t,n){const l=await(await this.dbPromise).getAllFromIndex("activities","by-time"),o=l.length,u=Math.ceil(o/Lc),d=`${t}/activity/collection`,m=`${d}/page/${n}`,h=n*Lc,p=l.slice(h,h+Lc),g={"@context":["https://www.w3.org/ns/activitystreams",kt.DISCOVERY_1.CONTEXT],id:m,type:"OrderedCollectionPage",partOf:{id:d,type:"OrderedCollection"},orderedItems:p,startIndex:h};return n>0&&(g.prev={id:`${d}/page/${n-1}`,type:"OrderedCollectionPage"}),n<u-1&&(g.next={id:`${d}/page/${n+1}`,type:"OrderedCollectionPage"}),g}async exportAll(){return(await this.dbPromise).getAllFromIndex("activities","by-time")}async importActivities(t){const n=await this.dbPromise;let i=0,l=0;for(const o of t)await n.get("activities",o.id)?l++:(await n.put("activities",o,o.id),i++);return{imported:i,skipped:l}}async clear(){await(await this.dbPromise).clear("activities")}async getStats(){const n=await(await this.dbPromise).getAllFromIndex("activities","by-time"),i={Create:0,Update:0,Delete:0,Move:0,Add:0,Remove:0};for(const l of n)i[l.type]++;return{total:n.length,byType:i,oldest:n.length>0?n[0].endTime:null,newest:n.length>0?n[n.length-1].endTime:null}}}const Fh=new $L;class zL{isTimeBasedMedia(t){return t.duration!==void 0&&t.duration>0}getDuration(t){return t.duration||0}getPlaceholderCanvas(t){return t.placeholderCanvas||null}getAccompanyingCanvas(t){return t.accompanyingCanvas||null}getPosterImageUrl(t){if(!t.items?.length)return null;const n=t.items[0];if(!n.items?.length)return null;const i=n.items[0];if(!i.body)return null;const l=Array.isArray(i.body)?i.body[0]:i.body;return typeof l=="string"?l:l?.id||null}getAccompanyingContent(t){const n=[];if(!t.items)return n;for(const i of t.items)i.items&&n.push(...i.items);return n}parseTimeMode(t){if(!t)return null;for(const n of t)if(n==="trim"||n==="scale"||n==="loop")return{mode:n};return null}applyTimeMode(t,n,i){switch(n.mode){case"trim":const l=n.start||0,o=n.end||t;return{effectiveDuration:Math.min(o-l,t-l),startOffset:l};case"scale":return{effectiveDuration:n.targetDuration||i||t,startOffset:0};case"loop":return i&&i>t?{effectiveDuration:i,startOffset:0}:{effectiveDuration:t,startOffset:0};default:return{effectiveDuration:t,startOffset:0}}}calculatePlaybackRate(t,n){return n<=0||t<=0?1:t/n}generateSyncPoints(t){const n=[];for(const i of t){const l=i.target;if(typeof l!="string")continue;const o=l.match(/#t=([\d.]+)(?:,([\d.]+))?/);if(!o)continue;const u=parseFloat(o[1]),d=i.body,m=typeof d=="string"?d:Array.isArray(d)?d[0]?.value||"":d?.value||"";n.push({mainTime:u,accompanyingPosition:m,label:i.label?Object.values(i.label)[0]?.[0]:void 0})}return n.sort((i,l)=>i.mainTime-l.mainTime),n}findCurrentSyncPoint(t,n){let i=null;for(const l of t)if(l.mainTime<=n)i=l;else break;return i}createPlaceholderCanvas(t,n,i,l){return{id:`${t}/placeholder`,type:"Canvas",width:i,height:l,items:[{id:`${t}/placeholder/page`,type:"AnnotationPage",items:[{id:`${t}/placeholder/anno`,type:"Annotation",motivation:"painting",body:{id:n,type:"Image",format:"image/jpeg",width:i,height:l},target:`${t}/placeholder`}]}]}}createAccompanyingCanvas(t,n,i){const l=i.map((o,u)=>({id:`${t}/accompanying/anno/${u}`,type:"Annotation",motivation:"supplementing",body:{type:"TextualBody",value:o.text,format:"text/plain"},target:o.endTime?`${t}#t=${o.time},${o.endTime}`:`${t}#t=${o.time}`}));return{id:`${t}/accompanying`,type:"Canvas",label:{en:[n]},items:[{id:`${t}/accompanying/page`,type:"AnnotationPage",items:l}]}}parseVTTToAnnotations(t){const n=[],i=t.split(`
`);let l=null;for(const o of i){if(o.startsWith("WEBVTT")||o.trim()===""){l&&l.text&&(n.push(l),l=null);continue}const u=o.match(/(\d{2}):(\d{2}):(\d{2})[.,](\d{3})\s*-->\s*(\d{2}):(\d{2}):(\d{2})[.,](\d{3})/);if(u){l&&l.text&&n.push(l);const m=parseInt(u[1])*3600+parseInt(u[2])*60+parseInt(u[3])+parseInt(u[4])/1e3,h=parseInt(u[5])*3600+parseInt(u[6])*60+parseInt(u[7])+parseInt(u[8])/1e3;l={time:m,endTime:h,text:""};continue}const d=o.match(/(\d{2}):(\d{2})[.,](\d{3})\s*-->\s*(\d{2}):(\d{2})[.,](\d{3})/);if(d){l&&l.text&&n.push(l);const m=parseInt(d[1])*60+parseInt(d[2])+parseInt(d[3])/1e3,h=parseInt(d[4])*60+parseInt(d[5])+parseInt(d[6])/1e3;l={time:m,endTime:h,text:""};continue}l&&(l.text+=(l.text?`
`:"")+o)}return l&&l.text&&n.push(l),n}async generateThumbnailAtTime(t,n,i=320){return new Promise((l,o)=>{const u=document.createElement("canvas"),d=u.getContext("2d");if(!d){o(new Error("Canvas context not available"));return}const m=t.currentTime,h=t.paused,p=()=>{const g=t.videoWidth/t.videoHeight,y=Math.round(i/g);u.width=i,u.height=y,d.drawImage(t,0,0,i,y);const x=u.toDataURL("image/jpeg",Wv.preview);t.currentTime=m,h||t.play(),l(x)};t.addEventListener("seeked",p,{once:!0}),t.pause(),t.currentTime=n})}formatTime(t,n=!1){const i=Math.floor(t/3600),l=Math.floor(t%3600/60),o=Math.floor(t%60);return n||i>0?`${i}:${l.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`:`${l}:${o.toString().padStart(2,"0")}`}parseTime(t){const n=t.split(":").map(Number);return n.length===3?n[0]*3600+n[1]*60+n[2]:n.length===2?n[0]*60+n[1]:parseFloat(t)||0}}const Es=new zL;class UL{constructor(){this.tokens=new Map,this.pendingMessages=new Map,typeof window<"u"&&window.addEventListener("message",this.handlePostMessage.bind(this))}extractAuthServices(t){const n=[],i=l=>{if(!l)return;const o=l.service||l.services;if(Array.isArray(o))for(const u of o)this.isAuthService(u)&&n.push(u),i(u);if(Array.isArray(l.items))for(const u of l.items)i(u)};return i(t),n}isAuthService(t){if(!t||typeof t!="object")return!1;const n=t.type||t["@type"];return n&&(n.includes("AuthProbeService")||n.includes("AuthAccessService")||n.includes("AuthAccessTokenService")||n.includes("AuthLogoutService"))}findProbeService(t){return t.find(n=>n.type==="AuthProbeService2")||null}findAccessService(t){return t.find(n=>n.type==="AuthAccessService2")||null}findTokenService(t){for(const n of t){if(n.type==="AuthAccessTokenService2")return n;if(n.service){const i=this.findTokenService(n.service);if(i)return i}}return null}async probe(t,n){const i=this.getValidToken(n),l={Accept:"application/json"};i&&(l.Authorization=`Bearer ${i}`);try{return await(await fetch(t.id,{method:"GET",headers:l,credentials:"include"})).json()}catch(o){return console.error("[AuthService] Probe failed:",o),{"@context":kt.AUTH_2.CONTEXT,type:"AuthProbeResult2",status:500,note:{en:["Failed to probe authentication service"]}}}}openLoginWindow(t,n={}){const{width:i=600,height:l=700,onComplete:o}=n,u=window.screenX+(window.outerWidth-i)/2,d=window.screenY+(window.outerHeight-l)/2,m=window.open(t.id,"iiif-auth-login",`width=${i},height=${l},left=${u},top=${d},toolbar=no,menubar=no,scrollbars=yes`);if(m){const h=setInterval(()=>{m.closed&&(clearInterval(h),o?.(!1))},500)}return m}async requestToken(t){return new Promise((n,i)=>{const l=`auth-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,o=document.createElement("iframe");o.style.display="none";const u=new URL(t.id);u.searchParams.set("messageId",l),u.searchParams.set("origin",window.location.origin),this.pendingMessages.set(l,{resolve:n,reject:i});const d=setTimeout(()=>{this.pendingMessages.delete(l),o.remove(),i(new Error("Token request timed out"))},3e4);this.pendingMessages.set(l,{resolve:m=>{clearTimeout(d),o.remove(),n(m)},reject:m=>{clearTimeout(d),o.remove(),i(m)}}),o.src=u.toString(),document.body.appendChild(o)})}handlePostMessage(t){const n=t.data;if(!n||typeof n!="object"||n.type!=="AuthAccessToken2"&&n.type!=="AuthAccessTokenError2")return;const i=n.messageId;if(!i)return;const l=this.pendingMessages.get(i);if(l)if(this.pendingMessages.delete(i),n.type==="AuthAccessToken2"){const o=n.expiresIn?Date.now()+n.expiresIn*1e3:Date.now()+36e5;this.tokens.set(i,{token:n.accessToken,expiresAt:o}),l.resolve(n)}else l.reject(n)}storeToken(t,n,i){const l=i?Date.now()+i*1e3:Date.now()+36e5;this.tokens.set(t,{token:n,expiresAt:l})}getValidToken(t){const n=this.tokens.get(t);return n?Date.now()>=n.expiresAt?(this.tokens.delete(t),null):n.token:null}getStoredToken(t){return this.getValidToken(t)}clearToken(t){this.tokens.delete(t)}clearAllTokens(){this.tokens.clear()}async authenticateResource(t,n,i){const l={status:"probing"};i?.(l);const o=this.findProbeService(n);if(!o)return{status:"error",errorMessage:"No probe service found"};const u=await this.probe(o,t);return l.probeResult=u,u.status===200?(l.status="authenticated",i?.(l),l):u.status===401?(l.status="unauthenticated",u.substitute&&(l.substitute=u.substitute,l.status="degraded"),i?.(l),l):(l.status="error",l.errorMessage=`Probe returned status ${u.status}`,i?.(l),l)}getLabel(t,n="en"){if(!t)return"";if(t[n]?.length)return t[n][0];if(t.none?.length)return t.none[0];if(t["@none"]?.length)return t["@none"][0];const i=Object.keys(t)[0];return i&&t[i]?.length?t[i][0]:""}}const Vn=new UL,Ph=["jpg","jpeg","png","gif","webp","tiff","tif","bmp","svg"],$h=["mp3","wav","ogg","flac","aac","m4a","weba"],zh=["mp4","webm","ogv","mov","avi","mkv"],lv=["pdf"],BL={pdf:"application/pdf",mov:"video/quicktime",avi:"video/x-msvideo",mkv:"video/x-matroska"};class HL{isMediaUrl(t){const n=this.getExtension(t);return Ph.includes(n)||$h.includes(n)||zh.includes(n)||lv.includes(n)}isImageUrl(t){return Ph.includes(this.getExtension(t))}isAudioUrl(t){return $h.includes(this.getExtension(t))}isVideoUrl(t){return zh.includes(this.getExtension(t))}getExtension(t){return KE(t)}getFilename(t){try{const l=new URL(t).pathname.split("/");return decodeURIComponent(l[l.length-1]||"resource")}catch{const n=t.split("/");return n[n.length-1]?.split("?")[0]||"resource"}}detectMediaType(t){const n=this.getExtension(t);return Ph.includes(n)?"image":$h.includes(n)?"audio":zh.includes(n)?"video":lv.includes(n)?"pdf":"unknown"}getMimeType(t){const n=IE(t);if(n)return n;const i=this.getExtension(t);return BL[i]||"application/octet-stream"}async probeMedia(t){const n=this.detectMediaType(t),i=this.getMimeType(t),l=this.getFilename(t),o={url:t,type:n,mimeType:i,filename:l};try{if(n==="image"){const u=await this.probeImageDimensions(t);o.width=u.width,o.height=u.height}else if(n==="video"){const u=await this.probeVideoDimensions(t);o.width=u.width,o.height=u.height,o.duration=u.duration}else if(n==="audio"){const u=await this.probeAudioDuration(t);o.duration=u.duration}}catch(u){console.warn("[VirtualManifestFactory] Media probe failed:",u),n==="image"?(o.width=1e3,o.height=1e3):n==="video"?(o.width=1920,o.height=1080,o.duration=0):n==="audio"&&(o.duration=0)}return o}probeImageDimensions(t){return new Promise((n,i)=>{const l=new Image;l.crossOrigin="anonymous",l.onload=()=>{n({width:l.naturalWidth,height:l.naturalHeight})},l.onerror=()=>{i(new Error("Failed to load image"))},l.src=t,setTimeout(()=>i(new Error("Image load timeout")),1e4)})}probeVideoDimensions(t){return new Promise((n,i)=>{const l=document.createElement("video");l.crossOrigin="anonymous",l.preload="metadata",l.onloadedmetadata=()=>{n({width:l.videoWidth,height:l.videoHeight,duration:l.duration}),l.src=""},l.onerror=()=>{i(new Error("Failed to load video metadata"))},l.src=t,setTimeout(()=>i(new Error("Video metadata load timeout")),15e3)})}probeAudioDuration(t){return new Promise((n,i)=>{const l=document.createElement("audio");l.crossOrigin="anonymous",l.preload="metadata",l.onloadedmetadata=()=>{n({duration:l.duration}),l.src=""},l.onerror=()=>{i(new Error("Failed to load audio metadata"))},l.src=t,setTimeout(()=>i(new Error("Audio metadata load timeout")),15e3)})}toLanguageMap(t,n="none"){return typeof t=="string"?{[n]:[t]}:t}generateId(){return`urn:uuid:${crypto.randomUUID()}`}async createManifest(t,n={}){const i=await this.probeMedia(t),l=n.language||"none",o=this.generateId(),u=`${o}/canvas/1`,d=i.filename?.replace(/\.[^/.]+$/,"")||"Untitled",m=this.toLanguageMap(n.label||d,l),h={"@context":kt.PRESENTATION_3.CONTEXT,id:o,type:"Manifest",label:m,items:[]};n.summary&&(h.summary=this.toLanguageMap(n.summary,l)),n.rights&&(h.rights=n.rights),n.requiredStatement&&(h.requiredStatement=n.requiredStatement),n.provider&&(h.provider=n.provider),n.metadata&&(h.metadata=n.metadata);const p=this.createCanvas(u,i,m);return h.items=[p],h}createCanvas(t,n,i){const l={id:t,type:"Canvas",label:i,width:n.width||1e3,height:n.height||1e3,items:[]};n.duration!==void 0&&n.duration>0&&(l.duration=n.duration);const o=`${t}/page/1`,d={id:`${t}/annotation/1`,type:"Annotation",motivation:"painting",body:this.createBody(n),target:t};return l.items=[{id:o,type:"AnnotationPage",items:[d]}],l}createBody(t){const n={id:t.url,type:this.getBodyType(t.type),format:t.mimeType};return t.width&&(n.width=t.width),t.height&&(n.height=t.height),t.duration&&(n.duration=t.duration),n}getBodyType(t){switch(t){case"image":return"Image";case"audio":return"Sound";case"video":return"Video";default:return"Dataset"}}async createManifestFromMultiple(t,n={}){const i=n.language||"none",l=this.generateId(),o=this.toLanguageMap(n.label||`Collection of ${t.length} items`,i),u={"@context":kt.PRESENTATION_3.CONTEXT,id:l,type:"Manifest",label:o,items:[]};n.summary&&(u.summary=this.toLanguageMap(n.summary,i)),n.metadata&&(u.metadata=n.metadata);const d=[];for(let m=0;m<t.length;m++){const h=t[m],p=await this.probeMedia(h),g=`${l}/canvas/${m+1}`,y=this.toLanguageMap(p.filename||`Item ${m+1}`,i),x=this.createCanvas(g,p,y);d.push(x)}return u.items=d,u}async createManifestFromFile(t,n={}){const i=URL.createObjectURL(t);let l="unknown";t.type.startsWith("image/")?l="image":t.type.startsWith("audio/")?l="audio":t.type.startsWith("video/")?l="video":t.type==="application/pdf"&&(l="pdf");const o={url:i,type:l,mimeType:t.type,filename:t.name};try{if(l==="image"){const d=await this.probeImageDimensions(i);o.width=d.width,o.height=d.height}else if(l==="video"){const d=await this.probeVideoDimensions(i);o.width=d.width,o.height=d.height,o.duration=d.duration}else if(l==="audio"){const d=await this.probeAudioDuration(i);o.duration=d.duration}}catch(d){console.warn("[VirtualManifestFactory] File probe failed:",d),l==="image"&&(o.width=1e3,o.height=1e3)}const u=await this.createManifest(i,{...n,label:n.label||t.name.replace(/\.[^/.]+$/,"")});return u.items?.[0]&&(u.items[0]._fileRef=t,u.items[0]._blobUrl=i),{manifest:u,blobUrl:i}}}const Uh=new HL,WL=e=>"requiresAuth"in e&&e.requiresAuth===!0,GL=async(e,t)=>{if(Uh.isMediaUrl(e)){console.log("[RemoteLoader] Detected media URL, creating virtual manifest:",e);try{return{item:await Uh.createManifest(e),isVirtualManifest:!0,originalUrl:e}}catch(i){console.warn("[RemoteLoader] Virtual manifest creation failed, trying as IIIF:",i)}}const n=async(i,l)=>{const o={};l&&(o.Authorization=`Bearer ${l}`);const u=await fetch(i,{headers:o,signal:t?.signal});if(u.status===401){try{const g=await u.json(),y=Vn.extractAuthServices(g);if(y.length>0)return{requiresAuth:!0,resourceId:e,authServices:y,status:401}}catch{}throw new Error("HTTP error! status: 401 - Authentication required")}if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);const d=u.headers.get("content-type")||"";if(d.startsWith("image/")||d.startsWith("audio/")||d.startsWith("video/"))return console.log("[RemoteLoader] Response is media type, creating virtual manifest"),{data:await Uh.createManifest(e),isVirtual:!0};if(d.includes("text/html"))throw new Error(`Expected JSON but received HTML. The URL may not point to a valid IIIF resource: ${i}`);let m;try{const g=await u.text();if(!g||g.trim().length===0)throw new Error("Empty response received");if(g.trim().startsWith("<")||g.trim().startsWith("<!DOCTYPE"))throw new Error("Received HTML instead of JSON. The URL may not point to a valid IIIF resource.");m=JSON.parse(g)}catch(g){throw g.message.includes("HTML")?g:new Error(`Failed to parse JSON response: ${g.message}`)}const h=_D.importManifest(m);if(h.type||(h.sequences||h.items)&&(h.type="Manifest"),!zt(h)&&!Mt(h))throw new Error("Resource does not appear to be a valid IIIF Manifest or Collection");const p=Qv(h);return p.length>0&&console.warn("[RemoteLoader] IIIF validation issues:",p),{data:h,isVirtual:!1}};try{const i=Vn.getStoredToken(e),l=await n(e,i||void 0);return"requiresAuth"in l?l:{item:l.data,isVirtualManifest:l.isVirtual,originalUrl:e}}catch(i){if(console.error("Failed to fetch remote manifest directly:",i),i.name==="TypeError"&&(i.message.includes("NetworkError")||i.message.includes("Failed to fetch"))){console.warn(`[RemoteLoader] CORS restriction detected for ${e}. Attempting fallback via proxy.`);try{const o=`https://api.allorigins.win/raw?url=${encodeURIComponent(e)}`,u=await n(o);return"requiresAuth"in u?u:{item:u.data,isVirtualManifest:u.isVirtual,originalUrl:e}}catch(o){throw console.error("[RemoteLoader] Proxy fetch also failed:",o),new Error("CORS Error: Unable to access resource directly or via proxy. The server likely blocks cross-origin requests.")}}throw i}},YL=[{name:"Simple numerical sequence",regex:/^(.+?)[\s._\-]?(\d{1,5})(?:\.\w+)?$/i,description:"Extracts base name and number for sequences like 'file1.txt', 'document_001.pdf'",groups:["base","sequence"],tags:"sequence,numerical,incremental"},{name:"Padded numerical sequence",regex:/^(.+?)[\s._\-]?(\d{2,8})(?:\.\w+)?$/i,description:"Matches zero-padded sequences like 'img_001.jpg', 'scan_000045.tif'",groups:["base","padded_sequence"],tags:"sequence,padded,incremental"},{name:"Alphabetical sequence",regex:/^(.+?)[\s._\-]?([a-zA-Z])(?:\.\w+)?$/i,description:"Matches alphabetical sequences like 'chapter_a.pdf', 'appendix_B.docx'",groups:["base","letter"],tags:"sequence,alphabetical"},{name:"Roman numeral sequence",regex:/^(.+?)[\s._\-]?(i{1,3}|iv|v|vi{1,3}|ix|x{1,3}|x[cl]|l?x{0,3})(?:\.\w+)?$/i,description:"Matches Roman numeral sequences like 'volume_I.pdf', 'act_iv.txt'",groups:["base","roman"],tags:"sequence,roman"},{name:"Date-based sequence",regex:/^(.+?)[\s._\-]?(\d{4}[._\-]?\d{2}[._\-]?\d{2})(?:\.\w+)?$/i,description:"Extracts dates for sequenced files like 'log_2023-01-15.txt', 'report20231231.pdf'",groups:["base","date"],tags:"sequence,date,temporal"},{name:"Versioned sequence",regex:/^(.+?)[\s._\-]?([vV]?\d+(?:\.\d+)*)(?:\.\w+)?$/i,description:"Matches version numbers like 'document_v1.2.pdf', 'app_2.1.3.zip'",groups:["base","version"],tags:"sequence,version,semver"},{name:"Common prefix groups",regex:/^([a-zA-Z0-9_-]{3,})[\s._\-].+\.\w+$/i,description:"Identifies files sharing a common prefix for grouping",groups:["prefix"],tags:"similarity,prefix,grouping"},{name:"Common suffix groups",regex:/^.+[\s._\-]([a-zA-Z0-9_-]+)(?:\.\w+)?$/i,description:"Identifies files sharing a common suffix before extension",groups:["suffix"],tags:"similarity,suffix,grouping"},{name:"Similar patterns with variations",regex:/^(.+?)(?:_(?:copy|dup|backup|old|new|final|rev|draft))(?:\d*)(?:\.\w+)?$/i,description:"Matches variant files indicating edits, copies, or backups",groups:["original_base"],tags:"similarity,variants,derivatives"},{name:"Page range indicators",regex:/^(.+?)[\s._\-]?(\d+)[\s._\-]?to[\s._\-]?(\d+)(?:\.\w+)?$/i,description:"Matches files indicating page ranges like 'document_1to50.pdf'",groups:["base","start","end"],tags:"adjacency,range,pagination"},{name:"Part/segment indicators",regex:/^(.+?)[\s._\-]?(?:part|pt|segment|sec|section)[\s._\-]?(\d+)(?:of\d+)?(?:\.\w+)?$/i,description:"Matches segmented files like 'book_part1.pdf', 'archive_sec3of5.zip'",groups:["base","part_number","total_parts"],tags:"adjacency,segments,parts"}];function ov(e,t){return new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}).compare(e,t)}function qL(e){const t=e.split(".").pop()?.toLowerCase()||"",n=Ln[t];return n&&n.motivation==="painting"}function VL(e){const t=e.map(n=>n.name);for(const n of YL){if(!n.tags.includes("sequence"))continue;const i=t.map(l=>{const o=l.match(n.regex);return o?{name:l,base:o[1],seq:o[2]}:null}).filter(Boolean);if(i.length>t.length*.5&&new Set(i.map(o=>o.base.toLowerCase())).size===1)return{orderedFiles:[...e].sort((u,d)=>{const m=u.name.match(n.regex),h=d.name.match(n.regex);return!m||!h?0:ov(m[2],h[2])}),detectedPattern:n.name}}return{orderedFiles:[...e].sort((n,i)=>ov(n.name,i.name)),detectedPattern:null}}function KL(e){const t=P1(e),n=[],i=(o,u)=>{const d=o.name==="root"?[]:[...u,o.name],m=Array.from(o.files.values()).filter(h=>qL(h.name));if(m.length>0){const{orderedFiles:h,detectedPattern:p}=VL(m);n.push({id:crypto.randomUUID(),name:d.join(" / ")||"Root Files",breadcrumbs:d,files:h,canvasOrder:h.map(g=>g.name),detectedPattern:p||void 0})}o.directories.forEach(h=>i(h,d))};i(t,[]);const l=t.directories.size>0?Array.from(t.directories.keys())[0]:t.name;return{id:crypto.randomUUID(),rootPath:l,manifests:n,createdAt:new Date().toISOString()}}function XL(e){return{id:crypto.randomUUID(),root:{id:crypto.randomUUID(),name:e.rootPath||"My Archive",manifestRefs:[],children:[]},unassignedManifests:e.manifests.map(t=>t.id)}}function ZL(e,t,n){const i={id:crypto.randomUUID(),name:n,manifestRefs:[],children:[]},l={...e,root:{...e.root}};if(!t||t===e.root.id)l.root={...l.root,children:[...l.root.children,i]};else{const o=u=>u.id===t?{...u,children:[...u.children,i]}:{...u,children:u.children.map(o)};l.root=o(l.root)}return{layout:l,newCollectionId:i.id}}function JL(e,t,n){const i=o=>{if(o.id===t){const u=new Set(o.manifestRefs),d=n.filter(m=>!u.has(m));return{...o,manifestRefs:[...o.manifestRefs,...d]}}return{...o,children:o.children.map(i)}},l=e.unassignedManifests.filter(o=>!n.includes(o));return{...e,root:i(e.root),unassignedManifests:l}}function QL(e,t,n){const i=d=>d.id===t?{...d,manifestRefs:d.manifestRefs.filter(m=>!n.includes(m))}:{...d,children:d.children.map(i)},l=(d,m)=>{const h=p=>p.manifestRefs.includes(m)?!0:p.children.some(h);return h(d.root)},o={...e,root:i(e.root)},u=[...o.unassignedManifests];for(const d of n)!l(o,d)&&!u.includes(d)&&u.push(d);return{...o,unassignedManifests:u}}function eR(e,t,n){return{...e,manifests:e.manifests.map(i=>{if(i.id===t){const l=new Map(i.files.map(u=>[u.name,u])),o=n.map(u=>l.get(u)).filter(u=>u!==void 0);return{...i,canvasOrder:n,files:o}}return i})}}function tR(e,t,n){const i=l=>l.id===t?{...l,name:n}:{...l,children:l.children.map(i)};return{...e,root:i(e.root)}}function nR(e,t){if(t===e.root.id)return e;const n=m=>[...m.manifestRefs,...m.children.flatMap(n)];let i=[];const l=m=>{const h=m.children.find(p=>p.id===t);return h?(i=n(h),{...m,children:m.children.filter(p=>p.id!==t)}):{...m,children:m.children.map(l)}},o={...e,root:l(e.root)},u=m=>{const h=p=>p.manifestRefs.includes(m)?!0:p.children.some(h);return h(o.root)},d=[...o.unassignedManifests,...i.filter(m=>!u(m)&&!o.unassignedManifests.includes(m))];return{...o,unassignedManifests:d}}function sR(e,t,n){if(t===e.root.id||t===n)return e;let i=null;const l=d=>{const m=d.children.find(h=>h.id===t);return m?(i=m,{...d,children:d.children.filter(h=>h.id!==t)}):{...d,children:d.children.map(l)}},o={...e,root:l(e.root)};if(!i)return e;const u=d=>d.id===n?{...d,children:[...d.children,i]}:{...d,children:d.children.map(u)};return{...o,root:u(o.root)}}function cv(e){const t=[],n=i=>{t.push(i),i.children.forEach(n)};return n(e.root),t}function xu(e,t){return e.manifests.find(n=>n.id===t)}function fp(e){switch(e){case"iiif":return wc("iiif");case"dublin-core":return wc("dublin-core");case"both":return wc("both");default:return wc("iiif")}}function uv(e){return e?e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e:""}function aR(e,t){const n=fp(t.vocabulary),l=[["filename","manifest",...n.map(o=>o.key)].join(",")];for(const o of e.manifests)for(const u of o.files){const d=[uv(u.name),uv(o.name),...n.map(()=>"")];l.push(d.join(","))}return l.join(`
`)}function iR(e){return`
IIIF Field Studio - Metadata Template Instructions
================================================

This CSV file contains your archive structure with columns for adding metadata.
Fill in the values and re-import to apply metadata to your items.

FILE STRUCTURE
--------------
- filename: The original file name (DO NOT MODIFY)
- manifest: The manifest/folder this file belongs to (DO NOT MODIFY)

COLUMN DESCRIPTIONS
-------------------
${fp(e.vocabulary).map(i=>`${i.key}: ${i.description}`).join(`
`)}

FORMATTING GUIDELINES
--------------------
1. Dates should be in ISO 8601 format: YYYY-MM-DD (e.g., 2024-01-15)
2. Rights URLs should be complete URLs (e.g., https://creativecommons.org/licenses/by/4.0/)
3. For multiple values, separate with semicolons (e.g., "keyword1; keyword2; keyword3")
4. Language is set to: ${e.language}
5. Text can include Unicode characters

VOCABULARY USED
---------------
${e.vocabulary==="iiif"?"IIIF Presentation API 3.0 properties":e.vocabulary==="dublin-core"?"Dublin Core Metadata Element Set (metadata.* format)":"Combined IIIF and Dublin Core vocabularies"}

COLUMN FORMAT
-------------
- IIIF core properties use their standard names: label, summary, rights, navDate
- Dublin Core properties use the format: metadata.{property} (e.g., metadata.creator, metadata.date)
- This format is compatible with the CSV Import feature in the Catalog view

RE-IMPORTING
------------
1. Save your edited CSV file
2. In Field Studio, go to the Metadata view
3. Use the "Import CSV" option
4. Select your edited file
5. Review the preview and confirm

TIPS
----
- Empty cells will be ignored (existing metadata preserved)
- You can delete rows for files you don't want to update
- The manifest column determines which IIIF Manifest the metadata applies to
- For batch operations, copy values down to apply to multiple files

Generated: ${new Date().toISOString()}
`.trim()}function rR(e,t={vocabulary:"both",language:"en",includeInstructions:!0}){return{csv:aR(e,t),instructions:t.includeInstructions?iR(t):""}}function lR(e,t,n=5){const i=fp(t.vocabulary),o=[["filename","manifest",...i.map(d=>d.key)]];let u=0;for(const d of e.manifests){for(const m of d.files){if(u>=n)break;o.push([m.name,d.name,...i.map(()=>"")]),u++}if(u>=n)break}return o}function oR(){return[{value:"iiif",label:"IIIF Only",description:"Core IIIF Presentation API properties (label, summary, rights, etc.)"},{value:"dublin-core",label:"Dublin Core Only",description:"Standard Dublin Core metadata elements (dc:title, dc:creator, etc.)"},{value:"both",label:"IIIF + Dublin Core",description:"Full vocabulary with both IIIF properties and Dublin Core elements"}]}function cR(e,t,n="metadata-template"){const{csv:i,instructions:l}=rR(e,t),o=new Blob([i],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(o),d=document.createElement("a");if(d.href=u,d.download=`${n}.csv`,d.click(),URL.revokeObjectURL(u),l){const m=new Blob([l],{type:"text/plain;charset=utf-8;"}),h=URL.createObjectURL(m),p=document.createElement("a");p.href=h,p.download=`${n}-instructions.txt`,setTimeout(()=>{p.click(),URL.revokeObjectURL(h)},100)}}const dv=({value:e,onChange:t,validation:n,label:i,id:l,type:o="text",placeholder:u,disabled:d=!1,rows:m=3,fieldMode:h=!1,onFocus:p,onBlur:g})=>{const[y,x]=S.useState(e??""),[v,N]=S.useState(!1),j=S.useRef(null),C=S.useRef(!1),A=S.useRef(!1),_=S.useRef(t);_.current=t,S.useEffect(()=>{!C.current&&!A.current&&x(e??"")},[e]),S.useEffect(()=>(n.status==="valid"?(N(!0),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{N(!1)},2e3)):(N(!1),j.current&&(clearTimeout(j.current),j.current=null)),()=>{j.current&&clearTimeout(j.current)}),[n.status]);const T=S.useCallback(I=>{const D=I.target.value;C.current=!0,x(D),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{_.current(D),C.current=!1},300)},[]),L=S.useCallback(I=>{A.current=!0,p?.(I)},[p]),H=S.useCallback(I=>{A.current=!1,j.current&&(clearTimeout(j.current),_.current(y),C.current=!1),g?.(I)},[g,y]),k=()=>{if(d)return h?"border-slate-700":"border-slate-200";switch(n.status){case"invalid":return"border-red-500 focus:border-red-500 focus:ring-2 focus:ring-red-200";case"valid":return v?"border-green-500 focus:border-green-500 focus:ring-2 focus:ring-green-200":h?"border-slate-800 focus:border-yellow-400":"border-slate-300 focus:ring-2 focus:ring-blue-500";case"validating":return"border-amber-400 focus:border-amber-400 focus:ring-2 focus:ring-amber-200";case"pristine":default:return h?"border-slate-800 focus:border-yellow-400":"border-slate-300 focus:ring-2 focus:ring-blue-500"}},R=()=>{switch(n.status){case"invalid":return a.jsx($,{name:"error",className:"text-red-500 text-sm"});case"valid":return v?a.jsx($,{name:"check_circle",className:"text-green-500 text-sm"}):null;case"validating":return a.jsx("span",{className:"inline-block animate-spin",children:a.jsx($,{name:"sync",className:"text-amber-400 text-sm"})});case"pristine":default:return null}},z=()=>{const I={"aria-describedby":`${l}-help`};return n.status==="invalid"?(I["aria-invalid"]="true",I["aria-errormessage"]=`${l}-error`):n.status==="valid"&&(I["aria-invalid"]="false"),I},P=`w-full text-sm p-3 rounded-lg outline-none border transition-colors duration-200 ${k()} ${h?"bg-slate-900 text-white placeholder-slate-600":"bg-white placeholder-slate-400"} ${d?"opacity-50 cursor-not-allowed":""}`,K=o==="url"?"url":"text";return a.jsxs("div",{className:"space-y-1.5",children:[a.jsxs("label",{htmlFor:l,className:`block text-[10px] font-bold uppercase tracking-wider flex items-center gap-1.5 ${h?"text-slate-500":"text-slate-400"}`,children:[i,R()]}),a.jsx("div",{className:"relative",children:o==="textarea"?a.jsx("textarea",{id:l,value:y,onChange:T,onFocus:L,onBlur:H,disabled:d,placeholder:u,rows:m,className:`${P} resize-none`,...z()}):a.jsx("input",{id:l,type:K,value:y,onChange:T,onFocus:L,onBlur:H,disabled:d,placeholder:u,className:P,...z()})}),a.jsxs("div",{id:`${l}-help`,className:"min-h-[20px]","aria-live":"polite","aria-atomic":"true",children:[n.status==="invalid"&&n.message&&a.jsxs("div",{id:`${l}-error`,className:"flex items-start gap-1.5 text-[10px] text-red-500",role:"alert",children:[a.jsx($,{name:"error",className:"text-[10px] mt-0.5 shrink-0"}),a.jsx("span",{className:"flex-1",children:n.message}),n.fix&&a.jsx("button",{onClick:n.fix,className:"shrink-0 ml-1 px-2 py-0.5 bg-green-100 text-green-700 rounded text-[9px] font-bold uppercase hover:bg-green-200 transition-colors","aria-label":`Fix: ${n.fixDescription||"Auto-fix this issue"}`,title:n.fixDescription||"Auto-fix this issue",children:"Fix"})]}),n.status==="validating"&&a.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-amber-600",children:[a.jsx("span",{className:"inline-block animate-spin",children:a.jsx($,{name:"sync",className:"text-[10px]"})}),a.jsx("span",{children:"Validating..."})]}),n.status==="valid"&&v&&a.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-green-600",children:[a.jsx($,{name:"check_circle",className:"text-[10px]"}),a.jsx("span",{children:"Valid"})]})]})]})},uR={Collection:{desc:"The master container for multiple research units. It groups Manifests into a cohesive archive.",implication:"Treats nested items as part of a curated series. This level cannot have its own visual pixels, only child links."},Manifest:{desc:"The primary unit of description. Represents a single physical artifact, document, or field notebook.",implication:'The "Atomic" unit of research. All internal views are considered parts of ONE cohesive physical object.'},Canvas:{desc:"A virtual workspace where media is pinned. It defines the coordinates for all your scholarly notes.",implication:"Pins media to a specific coordinate grid. Annotations created here are forever linked to these pixel addresses."},Range:{desc:"A structural division within a manifest, like a chapter or section.",implication:"Provides navigation structure for long or complex objects."}},fv=({value:e,onChange:t,onFocus:n,onBlur:i,...l})=>{const[o,u]=S.useState(e??""),d=S.useRef(t),m=S.useRef(null),h=S.useRef(!1),p=S.useRef(!1);d.current=t,S.useEffect(()=>{!h.current&&!p.current&&u(e??"")},[e]);const g=S.useCallback(v=>{const N=v.target.value;h.current=!0,u(N),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{d.current(N),h.current=!1},300)},[]),y=S.useCallback(v=>{p.current=!0,n?.(v)},[n]),x=S.useCallback(v=>{p.current=!1,m.current&&(clearTimeout(m.current),d.current(o),h.current=!1),i?.(v)},[i,o]);return S.useEffect(()=>()=>{m.current&&clearTimeout(m.current)},[]),a.jsx("input",{...l,value:o,onChange:g,onFocus:y,onBlur:x})},dR=({anno:e,isSelected:t,onSelect:n,fieldMode:i})=>{const l=e.body,o=e.target,u=l?.value||Le(l?.label,"en")||"Untitled",d=Array.isArray(e.motivation)?e.motivation[0]:e.motivation||"commenting",m=o?.selector?.type==="SvgSelector"||(o?.selector?.value||"").includes("xywh="),h={commenting:i?"text-blue-400 border-blue-400/30":"text-blue-600 border-blue-200",tagging:i?"text-green-400 border-green-400/30":"text-green-600 border-green-200",describing:i?"text-purple-400 border-purple-400/30":"text-purple-600 border-purple-200",painting:i?"text-pink-400 border-pink-400/30":"text-pink-600 border-pink-200"};return a.jsxs("div",{onClick:n,className:`p-3 rounded-lg border cursor-pointer transition-all ${t?i?"bg-blue-900/20 border-blue-500":"bg-blue-50 border-blue-500":i?"bg-slate-900 border-slate-800 hover:border-slate-700":"bg-slate-50 border-slate-200 hover:border-slate-300"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[a.jsx("span",{className:`text-[9px] font-bold uppercase px-1.5 py-0.5 rounded border ${h[d]||"text-slate-500 border-slate-300"}`,children:d}),m&&a.jsx($,{name:"crop_free",className:`text-xs ${i?"text-slate-600":"text-slate-400"}`})]}),a.jsx("p",{className:`text-xs truncate ${i?"text-slate-300":"text-slate-700"}`,children:u})]})},fR=({resource:e,onUpdateResource:t,settings:n,visible:i,onClose:l,isMobile:o,designTab:u,annotations:d=[]})=>{const{t:m}=Cu({level:n.abstractionLevel}),{isResizing:h,handleProps:p,panelStyle:g}=qm({id:"inspector",defaultSize:320,minSize:280,maxSize:480,direction:"horizontal",side:"left",collapseThreshold:0,persist:!0}),y=U=>{try{const V=localStorage.getItem(`inspector-tab-${U}`);if(V&&["metadata","annotations","structure","learn","design"].includes(V))return V}catch{}return"metadata"},[x,v]=S.useState(()=>e?y(e.type):"metadata"),[N,j]=S.useState(!1),[C,A]=S.useState([]),[_,T]=S.useState(null);S.useEffect(()=>{A(e?Jl.validateItem(e):[])},[e]);const L=U=>{if(!e||!U.fixable)return;const V=$u(e,U);V.success&&V.updatedItem&&t(V.updatedItem)},H=()=>{if(!e)return;const U=C.filter(V=>V.fixable);U.length!==0&&Xc(async()=>{const{safeHealAll:V}=await Promise.resolve().then(()=>RL);return{safeHealAll:V}},void 0).then(({safeHealAll:V})=>{const O=V(e,U);O.success&&O.updatedItem&&t(O.updatedItem)})};if(S.useEffect(()=>{e?.type&&v(y(e.type))},[e?.type]),S.useEffect(()=>{if(e?.type&&x)try{localStorage.setItem(`inspector-tab-${e.type}`,x)}catch{}},[x,e?.type]),!i||!e)return null;const k=Ht[e.type]||Ht.Content,R=uR[e.type],z=U=>bj(e.type,U),P=()=>{if(!e)return;const U={hasDuration:!!e.duration,hasPageSequence:zt(e)&&e.items?.length>1,hasWidth:!!e.width,hasHeight:!!e.height},V=kE(e.type,U);V.length>0&&t({behavior:Array.from(new Set([...e.behavior||[],...V]))})},K=Le(e.label,n.language)||"",I=Le(e.summary,n.language)||"",D=WE(e,400),E=(U,V,O)=>{const B=[...e.metadata||[]];B[U]={label:{[n.language]:[V]},value:{[n.language]:[O]}},t({metadata:B})},q=U=>{const V=U.charAt(0).toLowerCase()+U.slice(1);if(["rights","navDate","behavior","viewingDirection","requiredStatement","navPlace"].includes(V))t(V==="navPlace"?{navPlace:{type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{}}}:{[V]:V==="behavior"?[]:""});else{const O=[...e.metadata||[],{label:{[n.language]:[U]},value:{[n.language]:[""]}}];t({metadata:O})}j(!1)},W=U=>{const V=e.metadata?.filter((O,B)=>B!==U);t({metadata:V})},G=["metadata","annotations"];e&&zt(e)&&G.push("structure"),G.push("learn"),u&&G.push("design");const te=o?"fixed inset-0 z-[1100] bg-white flex flex-col animate-slide-in-right":"bg-white border-l border-slate-200 flex flex-col h-full shadow-xl z-30 animate-slide-in-right shrink-0 relative";return a.jsxs("aside",{className:te,style:o?void 0:g,"aria-label":"Resource Inspector",children:[a.jsxs("div",{className:`h-14 flex items-center justify-between px-4 border-b shrink-0 ${n.fieldMode?"bg-black text-white border-slate-800":"bg-slate-50 border-slate-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx($,{name:k.icon,className:`${k.colorClass} text-sm`}),a.jsx("span",{className:`text-xs font-black uppercase tracking-widest ${n.fieldMode?"text-yellow-400":k.colorClass}`,children:m("Inspector")})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(rj,{item:e,fieldMode:n.fieldMode}),a.jsx("button",{"aria-label":"Close Inspector",onClick:l,className:`p-2 rounded-lg ${n.fieldMode?"hover:bg-slate-800":"hover:bg-slate-200"}`,children:a.jsx($,{name:"close"})})]})]}),a.jsx("div",{role:"tablist","aria-label":"Inspector tabs",className:`flex border-b shrink-0 ${n.fieldMode?"bg-black border-slate-800":"bg-white"}`,children:G.map(U=>a.jsx("button",{className:`flex-1 py-3 text-[10px] font-black uppercase tracking-wider transition-all ${x===U?n.fieldMode?"text-yellow-400 border-b-2 border-yellow-400":"text-blue-600 border-b-2 border-blue-600 bg-blue-50/20":"text-slate-400 hover:text-slate-600"}`,onClick:()=>v(U),"aria-selected":x===U,role:"tab",children:U==="annotations"?a.jsxs("span",{className:"flex items-center justify-center gap-1",children:[U,d.length>0&&a.jsx("span",{className:`text-[8px] px-1.5 py-0.5 rounded-full ${n.fieldMode?"bg-slate-800":"bg-slate-200"}`,children:d.length})]}):U},U))}),a.jsxs("div",{className:`flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar min-h-0 ${n.fieldMode?"bg-black":"bg-white"}`,children:[x==="metadata"&&a.jsxs("div",{role:"tabpanel",className:"space-y-4",children:[C.length>0&&a.jsxs("div",{className:`p-3 rounded-lg border text-[10px] space-y-2 ${n.fieldMode?"bg-slate-900 border-slate-800":"bg-orange-50 border-orange-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2 font-bold uppercase tracking-wider text-orange-600",children:[a.jsx($,{name:"report_problem",className:"text-sm"}),a.jsxs("span",{children:["Issues (",C.length,")"]})]}),C.some(U=>U.fixable)&&a.jsx("button",{onClick:H,className:`text-[8px] font-bold uppercase px-2 py-1 rounded ${n.fieldMode?"bg-green-900 text-green-400":"bg-green-100 text-green-700"}`,children:"Fix All"})]}),C.map(U=>a.jsxs("div",{className:`flex items-start gap-2 text-[10px] ${U.level==="error"?"text-red-500":n.fieldMode?"text-slate-400":"text-orange-700"}`,children:[a.jsx("span",{className:"shrink-0",children:U.message}),U.fixable&&a.jsx("button",{onClick:()=>L(U),className:"text-[8px] text-green-600 hover:underline",children:"Fix"})]},U.id))]}),D&&a.jsx("div",{className:`aspect-video rounded-lg overflow-hidden border ${n.fieldMode?"bg-slate-900 border-slate-800":"bg-slate-100 border-slate-200"}`,children:a.jsx("img",{src:D,className:"w-full h-full object-contain",alt:"Preview"})}),a.jsxs("div",{className:"space-y-3",children:[a.jsx(dv,{id:"inspector-label",label:m("Label"),value:K,onChange:U=>t({label:{[n.language]:[U]}}),validation:S.useMemo(()=>Xy(C,"label",L)||{status:"pristine"},[C]),type:"text",fieldMode:n.fieldMode}),a.jsx(dv,{id:"inspector-summary",label:m("Summary"),value:I,onChange:U=>t({summary:{[n.language]:[U]}}),validation:S.useMemo(()=>Xy(C,"summary",L)||{status:"pristine"},[C]),type:"textarea",rows:3,fieldMode:n.fieldMode})]}),a.jsxs("div",{className:`pt-4 border-t ${n.fieldMode?"border-slate-800":"border-slate-100"}`,children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsx("label",{className:`text-[10px] font-bold uppercase tracking-wider ${n.fieldMode?"text-slate-500":"text-slate-400"}`,children:m("Metadata")}),a.jsxs("div",{className:"relative",children:[a.jsxs("button",{onClick:()=>j(!N),className:`text-[10px] font-bold uppercase flex items-center gap-1 ${n.fieldMode?"text-yellow-400":"text-blue-600"}`,children:["Add ",a.jsx($,{name:"add",className:"text-[10px]"})]}),N&&a.jsx("div",{className:"absolute right-0 top-full mt-1 bg-white border border-slate-200 shadow-xl rounded-lg py-2 z-50 min-w-[160px] max-h-[250px] overflow-y-auto",children:wi(e.type).filter(U=>!["id","type","items","annotations","structures","label","summary","metadata"].includes(U)).map(U=>a.jsx("button",{onClick:()=>q(U),className:"w-full px-3 py-1.5 text-left text-[10px] font-bold text-slate-600 hover:bg-blue-50",children:U},U))})]})]}),a.jsx("div",{className:"space-y-2",children:(e.metadata||[]).map((U,V)=>{const O=Le(U.label,n.language),B=Le(U.value,n.language);return a.jsxs("div",{className:`group relative p-2.5 rounded-lg border ${n.fieldMode?"bg-slate-900 border-slate-800":"bg-slate-50 border-slate-200"}`,children:[a.jsx(fv,{className:`w-full text-[10px] font-bold uppercase bg-transparent outline-none mb-1 border-b ${n.fieldMode?"text-slate-500 border-slate-800":"text-slate-500 border-transparent"}`,value:O,onChange:Y=>E(V,Y,B)}),a.jsx(fv,{className:`w-full text-xs bg-transparent outline-none ${n.fieldMode?"text-white":"text-slate-800"}`,value:B,onChange:Y=>E(V,O,Y)}),a.jsx("button",{onClick:()=>W(V),className:"absolute top-2 right-2 text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100",children:a.jsx($,{name:"close",className:"text-xs"})})]},V)})})]}),z("rights")&&a.jsxs("div",{className:`pt-4 border-t ${n.fieldMode?"border-slate-800":"border-slate-100"}`,children:[a.jsx("label",{className:`block text-[10px] font-bold mb-1.5 uppercase tracking-wider ${n.fieldMode?"text-slate-500":"text-slate-400"}`,children:m("Rights")}),a.jsxs("select",{value:e.rights||"",onChange:U=>t({rights:U.target.value||void 0}),className:`w-full text-xs p-2.5 rounded-lg border ${n.fieldMode?"bg-slate-900 text-white border-slate-800":"bg-white border-slate-300"}`,children:[a.jsx("option",{value:"",children:"None"}),a.jsx("option",{value:"https://creativecommons.org/publicdomain/zero/1.0/",children:"CC0"}),a.jsx("option",{value:"https://creativecommons.org/licenses/by/4.0/",children:"CC BY 4.0"}),a.jsx("option",{value:"https://creativecommons.org/licenses/by-nc/4.0/",children:"CC BY-NC 4.0"}),a.jsx("option",{value:"http://rightsstatements.org/vocab/InC/1.0/",children:"In Copyright"})]})]}),e.navPlace&&a.jsxs("div",{className:`pt-4 border-t ${n.fieldMode?"border-slate-800":"border-slate-100"}`,children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("label",{className:`text-[10px] font-bold uppercase tracking-wider ${n.fieldMode?"text-slate-500":"text-slate-400"}`,children:"Location"}),a.jsx("button",{onClick:()=>t({navPlace:void 0}),className:"text-[10px] text-red-400 hover:text-red-600 font-bold uppercase",children:"Remove"})]}),a.jsx("div",{className:`border rounded-lg overflow-hidden ${n.fieldMode?"border-slate-800":"border-slate-200"}`,children:a.jsx(oj,{item:e,onChange:U=>t({navPlace:U}),height:150,editable:!0})})]}),z("behavior")&&a.jsxs("div",{className:`pt-4 border-t ${n.fieldMode?"border-slate-800":"border-slate-100"}`,children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("label",{className:`block text-[10px] font-bold uppercase tracking-wider ${n.fieldMode?"text-slate-500":"text-slate-400"}`,children:"Behaviors"}),a.jsx("button",{onClick:P,className:`text-[9px] font-bold uppercase px-2 py-1 rounded border ${n.fieldMode?"border-slate-700 text-yellow-400":"border-slate-200 text-blue-600"}`,children:"Auto"})]}),a.jsx("div",{className:"flex flex-wrap gap-1",children:(e.behavior||[]).map((U,V)=>a.jsxs("span",{className:`text-[9px] font-bold px-2 py-1 rounded-full ${n.fieldMode?"bg-slate-800 text-yellow-400":"bg-purple-100 text-purple-700"}`,children:[U,a.jsx("button",{onClick:()=>{const O=e.behavior?.filter((B,Y)=>Y!==V);t({behavior:O?.length?O:void 0})},className:"ml-1 hover:text-red-500",children:""})]},V))})]})]}),x==="annotations"&&a.jsxs("div",{role:"tabpanel",className:"space-y-4",children:[a.jsxs("div",{className:`p-3 rounded-lg border ${n.fieldMode?"bg-slate-900 border-slate-800":"bg-blue-50 border-blue-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:`text-[10px] font-bold uppercase ${n.fieldMode?"text-blue-400":"text-blue-600"}`,children:n.abstractionLevel==="simple"?m("Notes"):"W3C Web Annotations"}),a.jsxs("span",{className:"text-[10px] text-slate-500",children:[d.length," total"]})]}),a.jsx("p",{className:`text-[10px] mt-1 ${n.fieldMode?"text-slate-500":"text-slate-600"}`,children:"Linked to specific regions with JSON-LD serialization"})]}),d.length===0?a.jsxs("div",{className:"text-center py-12",children:[a.jsx($,{name:"sticky_note_2",className:`text-4xl mb-3 mx-auto ${n.fieldMode?"text-slate-700":"text-slate-300"}`}),a.jsx("p",{className:`text-sm ${n.fieldMode,"text-slate-500"}`,children:"No annotations yet"}),a.jsx("p",{className:`text-[10px] mt-1 ${n.fieldMode?"text-slate-600":"text-slate-400"}`,children:"Use the annotation tool to create region-linked notes"})]}):a.jsx("div",{className:"space-y-2",children:d.map(U=>a.jsx(dR,{anno:U,isSelected:_===U.id,onSelect:()=>T(U.id),fieldMode:n.fieldMode},U.id))})]}),x==="structure"&&e&&zt(e)&&a.jsx("div",{role:"tabpanel",className:"space-y-4",children:a.jsxs("div",{className:`p-3 rounded-lg border ${n.fieldMode?"bg-slate-900 border-slate-800":"bg-slate-50 border-slate-200"}`,children:[a.jsx("h3",{className:`text-xs font-bold uppercase mb-2 ${n.fieldMode?"text-yellow-400":"text-blue-600"}`,children:"Table of Contents"}),e.structures&&e.structures.length>0?a.jsx("div",{className:"space-y-2",children:e.structures.map((U,V)=>a.jsx("div",{className:`p-2 rounded border text-[10px] ${n.fieldMode?"bg-black border-slate-800":"bg-white border-slate-200"}`,children:a.jsxs("div",{className:"flex items-center gap-2 font-bold",children:[a.jsx($,{name:"segment",className:"text-xs opacity-50"}),Le(U.label,n.language)||`Range ${V+1}`]})},U.id))}):a.jsx("div",{className:"text-[10px] text-slate-400 italic py-4 text-center",children:"No structural ranges defined"})]})}),x==="learn"&&R&&a.jsxs("div",{role:"tabpanel",className:"space-y-4",children:[a.jsxs("div",{className:`border p-4 rounded-xl ${n.fieldMode?"bg-slate-900 border-slate-800":`${k.bgClass} ${k.borderClass}`}`,children:[a.jsxs("h3",{className:`text-sm font-bold uppercase mb-2 flex items-center gap-2 ${n.fieldMode?"text-yellow-400":k.colorClass}`,children:[a.jsx($,{name:k.icon,className:"text-xs"})," ",e.type," Model"]}),a.jsx("p",{className:`text-xs leading-relaxed font-medium mb-3 ${n.fieldMode?"text-slate-400":"text-slate-600"}`,children:R.desc})]}),a.jsx(Kv,{title:"Archival Implication",type:n.fieldMode?"spec":"exhibit",children:R.implication})]}),x==="design"&&u&&a.jsx("div",{role:"tabpanel",children:u})]}),!o&&a.jsx("div",{...p,className:`
            absolute left-0 top-0 bottom-0 w-1 z-30 group
            cursor-col-resize
            transition-colors duration-150
            hover:bg-slate-500/20
            ${h?n.fieldMode?"bg-yellow-400/30":"bg-iiif-blue/30":""}
            ${p.className}
          `,children:a.jsx("div",{className:`
              absolute left-0 top-1/2 -translate-y-1/2
              w-1 h-12 rounded-full
              transition-all duration-150
              opacity-0 group-hover:opacity-100 group-focus:opacity-100
              ${h?n.fieldMode?"bg-yellow-400 opacity-100":"bg-iiif-blue opacity-100":n.fieldMode?"bg-slate-600 group-hover:bg-yellow-400":"bg-slate-500 group-hover:bg-iiif-blue"}
            `})})]})},V1=An.memo(fR,(e,t)=>e.resource?.id===t.resource?.id&&e.settings.fieldMode===t.settings.fieldMode);function hp(){const[e,t]=S.useState(new Set),[n,i]=S.useState(null),[l,o]=S.useState(new Map),u=S.useMemo(()=>e.size,[e]),d=S.useMemo(()=>e.size>0,[e]),m=S.useCallback((_,T,L)=>{T&&o(H=>{const k=new Map(H);return _.forEach((R,z)=>{const P=T[z];if(!P)return;const K=k.get(P)||0;if(L==="add")k.set(P,K+1);else{const I=Math.max(0,K-1);I===0?k.delete(P):k.set(P,I)}}),k})},[]),h=S.useCallback((_,T)=>{t(new Set([_])),i(_),o(T?new Map([[T,1]]):new Map)},[]),p=S.useCallback((_,T)=>{t(L=>{const H=new Set(L);return H.has(_)?(H.delete(_),T&&o(k=>{const R=new Map(k),z=R.get(T)||0,P=Math.max(0,z-1);return P===0?R.delete(T):R.set(T,P),R})):(H.add(_),T&&o(k=>{const R=new Map(k);return R.set(T,(R.get(T)||0)+1),R})),H}),i(_)},[]),g=S.useCallback((_,T)=>{t(L=>{const H=new Set(L);return _.forEach(k=>H.add(k)),H}),_.length>0&&i(_[_.length-1]),m(_,T,"add")},[m]),y=S.useCallback(_=>{t(T=>{const L=new Set(T);return _.forEach(H=>L.delete(H)),L})},[]),x=S.useCallback((_,T)=>{t(L=>{const H=new Set(L);return _.forEach(k=>H.add(k)),H}),_.length>0&&i(_[_.length-1]),m(_,T,"add")},[m]),v=S.useCallback(()=>{t(new Set),i(null),o(new Map)},[]),N=S.useCallback(_=>e.has(_),[e]),j=S.useCallback(_=>l.get(_)||0,[l]),C=S.useCallback((_,T)=>{if(t(new Set(_)),_.length>0&&i(_[_.length-1]),T){const L=new Map;T.forEach((H,k)=>{_[k]&&L.set(H,(L.get(H)||0)+1)}),o(L)}else o(new Map)},[]),A=S.useCallback((_,T,L)=>{const{shiftKey:H,metaKey:k,ctrlKey:R}=T,P=L.find(K=>K.id===_)?.type;if(H&&n){const K=L.findIndex(D=>D.id===n),I=L.findIndex(D=>D.id===_);if(K!==-1&&I!==-1){const D=Math.min(K,I),E=Math.max(K,I),q=L.slice(D,E+1),W=q.map(te=>te.id),G=q.map(te=>te.type).filter(te=>!!te);x(W,G)}else p(_,P)}else k||R?p(_,P):h(_,P)},[n,h,p,x]);return{selectedIds:e,count:u,hasSelection:d,lastSelectedId:n,lastClickedId:n,typeCounts:l,select:h,toggle:p,add:g,remove:y,selectRange:x,selectAll:C,clear:v,isSelected:N,getTypeCount:j,handleSelectWithModifier:A}}const Bh=(e,t=1)=>{if(e===0)return"0 B";const n=1024,i=t<0?0:t,l=["B","KB","MB","GB","TB"],o=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,o)).toFixed(i))+" "+l[o]},hR=({totalItems:e,selectedItem:t,validationIssues:n,storageUsage:i,onOpenQC:l,saveStatus:o,selectionCount:u,showSelectionCount:d=!0,onClearSelection:m})=>{const h=n.filter(A=>A.level==="error").length,p=n.filter(A=>A.level==="warning").length,g=h>0?"text-red-500":p>0?"text-amber-500":"text-green-500",y=h>0?"error":p>0?"warning":"verified",x=h>0?`${h} Errors`:p>0?`${p} Warnings`:"IIIF Valid",v=i&&i.quota>0?Math.min(100,i.usage/i.quota*100):0;let N=0;try{N=hp().count}catch{}const j=u??N,C=j>0;return a.jsxs("div",{className:"h-7 bg-slate-950 border-t border-slate-800 flex items-center justify-between px-3 text-[11px] text-slate-400 select-none z-50",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-1.5 hover:text-slate-200 cursor-pointer transition-colors",title:"Total items in archive",children:[a.jsx($,{name:"inventory_2",className:"text-[14px]"}),a.jsxs("span",{children:[e," Items"]})]}),d&&C&&a.jsxs("div",{className:"flex items-center gap-1.5 pl-3 border-l border-slate-800",children:[a.jsx($,{name:"check_box",className:"text-[14px] text-iiif-blue"}),a.jsxs("span",{className:"text-iiif-blue font-medium",children:[j," selected"]}),m&&a.jsx("button",{onClick:m,className:"ml-1 hover:text-white transition-colors",title:"Clear selection",children:a.jsx($,{name:"close",className:"text-[12px]"})})]}),t&&!C&&a.jsxs("div",{className:"flex items-center gap-1.5 pl-3 border-l border-slate-800 text-slate-300",children:[a.jsx($,{name:"check_circle",className:"text-[14px] text-green-500"}),a.jsxs("span",{className:"truncate max-w-[200px]",children:["Selected: ",Le(t.label,"none")||"Untitled"]})]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-1.5 px-3 border-r border-slate-800",title:"Project Save Status",children:[o==="saving"&&a.jsx($,{name:"sync",className:"text-[14px] animate-spin text-blue-400"}),o==="saved"&&a.jsx($,{name:"cloud_done",className:"text-[14px] text-slate-500"}),o==="error"&&a.jsx($,{name:"cloud_off",className:"text-[14px] text-red-500"}),a.jsx("span",{className:o==="error"?"text-red-500":o==="saving"?"text-blue-400":"text-slate-500",children:o==="saving"?"Saving...":o==="error"?"Save Failed":"Saved"})]}),a.jsxs("div",{className:`flex items-center gap-1.5 font-medium cursor-pointer hover:underline ${g}`,title:"Click to open QC Dashboard",onClick:l,children:[a.jsx($,{name:y,className:"text-[14px]"}),a.jsx("span",{children:x})]}),a.jsxs("div",{className:"pl-3 border-l border-slate-800 flex items-center gap-2",title:i?`${Bh(i.usage)} / ${Bh(i.quota)}`:"Storage unknown",children:[a.jsx("span",{children:"Storage"}),a.jsx("div",{className:"w-16 h-1.5 bg-slate-800 rounded-full overflow-hidden",children:a.jsx("div",{className:`h-full ${v>80?"bg-red-500":v>50?"bg-amber-500":"bg-slate-500"}`,style:{width:`${v}%`}})}),i&&a.jsx("span",{className:"text-[9px]",children:Bh(i.usage)})]})]})]})};function mR(e){const[t,n]=S.useState(e),[i,l]=S.useState(()=>XL(e)),[o,u]=S.useState(new Set),[d,m]=S.useState("source"),h=S.useCallback(P=>{u(K=>{const I=new Set(K);return I.has(P)?I.delete(P):I.add(P),I})},[]),p=S.useCallback((P,K,I)=>{const D=I.indexOf(P),E=I.indexOf(K);if(D===-1||E===-1)return;const q=Math.min(D,E),W=Math.max(D,E),G=I.slice(q,W+1);u(te=>{const U=new Set(te);return G.forEach(V=>U.add(V)),U})},[]),g=S.useCallback(()=>{u(new Set)},[]),y=S.useCallback(P=>{u(new Set(P))},[]),x=S.useCallback((P,K)=>{const{layout:I,newCollectionId:D}=ZL(i,K||null,P);return l(I),D},[i]),v=S.useCallback((P,K)=>{const I=K||Array.from(o);I.length!==0&&(l(D=>JL(D,P,I)),K||g())},[o,g]),N=S.useCallback((P,K)=>{l(I=>QL(I,P,K))},[]),j=S.useCallback((P,K)=>{l(I=>tR(I,P,K))},[]),C=S.useCallback(P=>{l(K=>nR(K,P))},[]),A=S.useCallback((P,K)=>{l(I=>sR(I,P,K))},[]),_=S.useCallback((P,K)=>{n(I=>eR(I,P,K))},[]),T=S.useCallback(P=>xu(t,P),[t]),L=S.useCallback(P=>cv(i).find(I=>I.id===P),[i]),H=S.useCallback(()=>cv(i),[i]),k=S.useMemo(()=>i.unassignedManifests.map(P=>xu(t,P)).filter(P=>P!==void 0),[i.unassignedManifests,t]),R=S.useMemo(()=>i.unassignedManifests.length>0,[i.unassignedManifests]);return{state:S.useMemo(()=>({sourceManifests:t,archiveLayout:i,selectedIds:o,focusedPane:d}),[t,i,o,d]),selectedIds:Array.from(o),toggleSelection:h,selectRange:p,clearSelection:g,selectAll:y,focusedPane:d,setFocusedPane:m,createNewCollection:x,addToCollection:v,removeFromCollection:N,renameCollectionAction:j,deleteCollectionAction:C,moveCollectionAction:A,reorderCanvases:_,getManifest:T,getCollection:L,getAllCollectionsList:H,unassignedManifests:k,hasUnassigned:R,archiveLayout:i,sourceManifests:t}}function K1(e){const{items:t,onReorder:n,onMove:i,getItemId:l,canDropOn:o}=e,[u,d]=S.useState(null),[m,h]=S.useState(null),[p,g]=S.useState(null),[y,x]=S.useState(""),v=S.useRef(null),N=S.useRef(!0);S.useEffect(()=>()=>{N.current=!1},[]),S.useEffect(()=>{let P=document.getElementById("keyboard-dnd-announcer");return P||(P=document.createElement("div"),P.id="keyboard-dnd-announcer",P.setAttribute("role","status"),P.setAttribute("aria-live","polite"),P.setAttribute("aria-atomic","true"),P.className="sr-only",document.body.appendChild(P)),v.current=P,()=>{}},[]);const j=S.useCallback(P=>{v.current&&N.current&&(v.current.textContent=P,setTimeout(()=>{v.current&&(v.current.textContent="")},1e3)),x(P)},[]),C=S.useCallback(P=>t.findIndex(K=>l(K)===P),[t,l]),A=S.useCallback((P,K)=>P===K?!1:o?o(P,K):!0,[o]);S.useCallback((P,K)=>{if(P===K)return;const I=[...t],[D]=I.splice(P,1);I.splice(K,0,D),n(I)},[t,n]);const _=S.useCallback((P,K)=>{const I=l(K),D=C(I);switch(P.key){case"ArrowUp":if(P.preventDefault(),D>0){const E=l(t[D-1]);if(d(E),m&&p){g(E);const q=k(t[D-1]);j(`Drop target: ${q}`)}}break;case"ArrowDown":if(P.preventDefault(),D<t.length-1){const E=l(t[D+1]);if(d(E),m&&p){g(E);const q=k(t[D+1]);j(`Drop target: ${q}`)}}break;case" ":case"Spacebar":if(P.preventDefault(),m)if(m===I){h(null),g(null);const E=k(K);j(`${E} deselected.`)}else if(A(m,I)){g(I);const E=k(K);j(`Drop target: ${E}`)}else j("Cannot drop here");else{h(I),g(I);const E=k(K);j(`${E} selected. Use arrow keys to choose drop target, Enter to confirm, Escape to cancel.`)}break;case"Enter":if(P.preventDefault(),m&&p&&m!==p){const E=C(m),q=C(p);if(A(m,p)){const W=t[E],G=t[q];if(W&&G){i(m,p);const te=k(W);j(`${te} moved.`)}}h(null),g(null)}break;case"Escape":P.preventDefault(),m&&(h(null),g(null),j("Drag operation cancelled."));break;case"Home":if(P.preventDefault(),t.length>0){const E=l(t[0]);d(E)}break;case"End":if(P.preventDefault(),t.length>0){const E=l(t[t.length-1]);d(E)}break}},[t,m,p,C,l,A,i,j]),T=S.useCallback(P=>{const K=l(P);d(K)},[l]),L=S.useCallback(()=>{},[]),H=S.useCallback(()=>{h(null),g(null),d(null)},[]),k=P=>{const K=P;return K.label?.none?.[0]?K.label.none[0]:K.label?.en?.[0]?K.label.en[0]:K.name?K.name:K.title?K.title:l(P)},R=m!==null;return{handlers:{onKeyDown:_,onFocus:T,onBlur:L},state:{focusedId:u,selectedId:m,isDragging:R,dropTargetId:p,instructions:R?"Use arrow keys to choose drop target, Space to select target, Enter to confirm, Escape to cancel":"Use arrow keys to navigate, Space to select item for moving"},announce:j,reset:H,setFocusedId:d}}function pR(e){if(e.length===0)return{overallProgress:0,totalFiles:0,completedFiles:0,errorFiles:0,currentStage:"complete",speed:0,etaSeconds:0,isPaused:!1,isActive:!1,activeOperations:0};const t=e.filter(y=>y.progress.stage!=="complete"&&y.progress.stage!=="cancelled"&&y.progress.stage!=="error"),n=e.reduce((y,x)=>y+x.progress.filesTotal,0),i=e.reduce((y,x)=>y+x.progress.filesCompleted,0),l=e.reduce((y,x)=>y+x.progress.filesError,0),o=n>0?Math.round(e.reduce((y,x)=>y+x.progress.overallProgress*x.progress.filesTotal,0)/n):0,u=e.reduce((y,x)=>y+x.progress.speed,0),d=e.length>0?u/e.length:0,m=n-i,h=d>0?Math.round(m/d):0,p=["error","processing","scanning","saving","derivatives","complete","cancelled"],g=e.length>0&&p.find(y=>e.some(x=>x.progress.stage===y))||"complete";return{overallProgress:o,totalFiles:n,completedFiles:i,errorFiles:l,currentStage:g,speed:d,etaSeconds:h,isPaused:e.some(y=>y.isPaused),isActive:t.length>0,activeOperations:t.length}}function hv(e){if(e<60)return`${e}s`;if(e<3600)return`${Math.ceil(e/60)} min`;const t=Math.floor(e/3600),n=Math.ceil(e%3600/60);return`${t}h ${n}m`}function mv(e){return e<1?`${(e*60).toFixed(1)} files/min`:`${e.toFixed(1)} files/sec`}function gR(){const[e,t]=S.useState([]),n=S.useRef(new Map),i=S.useMemo(()=>pR(e),[e]),l=S.useMemo(()=>e.length===0?null:e[e.length-1].progress,[e]),o=S.useCallback((N,j)=>{t(C=>C.map(A=>{if(A.id!==N)return A;const _={...A.progress,...j,updatedAt:Date.now()},T={...A,progress:_};return n.current.set(N,T),T}))},[]),u=S.useCallback(N=>{const j=N||e[e.length-1]?.id;j&&(t(C=>C.map(A=>{if(A.id!==j)return A;const _={...A,isPaused:!0};return n.current.set(j,_),_})),o(j,{isPaused:!0}))},[e,o]),d=S.useCallback(N=>{const j=N||e[e.length-1]?.id;if(!j)return;const C=n.current.get(j);C?.resumeResolver&&C.resumeResolver(),t(A=>A.map(_=>{if(_.id!==j)return _;const T={..._,isPaused:!1,resumeResolver:void 0};return n.current.set(j,T),T})),o(j,{isPaused:!1})},[e,o]),m=S.useCallback(N=>{const j=N||e[e.length-1]?.id;if(!j)return;const C=n.current.get(j);C&&C.abortController.abort(),o(j,{isCancelled:!0,stage:"cancelled"})},[e,o]),h=S.useCallback(()=>{e.forEach(N=>{N.abortController.abort(),o(N.id,{isCancelled:!0,stage:"cancelled"})})},[e,o]),p=S.useCallback((N,j)=>{const C=j||e[e.length-1]?.id;C&&t(A=>A.map(_=>{if(_.id!==C)return _;const T=_.progress.files.map(k=>k.id===N?{...k,status:"pending",error:void 0,progress:0}:k),L={..._.progress,files:T},H={..._,progress:L};return n.current.set(C,H),H}))},[e]),g=S.useCallback(async(N,j)=>{const C=j||`ingest-${Date.now()}`,A=new AbortController,_={id:C,abortController:A,isPaused:!1,progress:{operationId:C,stage:"scanning",stageProgress:0,filesTotal:0,filesCompleted:0,filesProcessing:0,filesError:0,files:[],speed:0,etaSeconds:0,startedAt:Date.now(),updatedAt:Date.now(),isPaused:!1,isCancelled:!1,activityLog:[{timestamp:Date.now(),level:"info",message:"Ingest operation started"}],overallProgress:0}};n.current.set(C,_),t(T=>[...T,_]);try{const T={signal:A.signal,paused:!1,onProgress:H=>{if(o(C,H),n.current.get(C)?.isPaused)return new Promise(R=>{const z=setInterval(()=>{n.current.get(C)?.isPaused||(clearInterval(z),R())},100)})}},L=await N(T);return o(C,{stage:"complete",stageProgress:100,overallProgress:100}),L}catch(T){throw o(C,{stage:"error",isCancelled:A.signal.aborted}),T}},[o]),y=S.useCallback(N=>n.current.get(N)?.progress||null,[]),x=S.useCallback(()=>{t(N=>{const j=N.filter(C=>C.progress.stage!=="complete"&&C.progress.stage!=="cancelled"&&C.progress.stage!=="error");return N.forEach(C=>{j.find(A=>A.id===C.id)||n.current.delete(C.id)}),j})},[]);return{aggregate:i,progress:l,operations:e,controls:{pause:u,resume:d,cancel:m,cancelAll:h,retryFile:p},startIngest:g,getOperationProgress:y,clearCompleted:x}}const at=e=>typeof e=="string",Dl=()=>{let e,t;const n=new Promise((i,l)=>{e=i,t=l});return n.resolve=e,n.reject=t,n},pv=e=>e==null?"":""+e,xR=(e,t,n)=>{e.forEach(i=>{t[i]&&(n[i]=t[i])})},bR=/###/g,gv=e=>e&&e.indexOf("###")>-1?e.replace(bR,"."):e,xv=e=>!e||at(e),zl=(e,t,n)=>{const i=at(t)?t.split("."):t;let l=0;for(;l<i.length-1;){if(xv(e))return{};const o=gv(i[l]);!e[o]&&n&&(e[o]=new n),Object.prototype.hasOwnProperty.call(e,o)?e=e[o]:e={},++l}return xv(e)?{}:{obj:e,k:gv(i[l])}},bv=(e,t,n)=>{const{obj:i,k:l}=zl(e,t,Object);if(i!==void 0||t.length===1){i[l]=n;return}let o=t[t.length-1],u=t.slice(0,t.length-1),d=zl(e,u,Object);for(;d.obj===void 0&&u.length;)o=`${u[u.length-1]}.${o}`,u=u.slice(0,u.length-1),d=zl(e,u,Object),d?.obj&&typeof d.obj[`${d.k}.${o}`]<"u"&&(d.obj=void 0);d.obj[`${d.k}.${o}`]=n},yR=(e,t,n,i)=>{const{obj:l,k:o}=zl(e,t,Object);l[o]=l[o]||[],l[o].push(n)},bu=(e,t)=>{const{obj:n,k:i}=zl(e,t);if(n&&Object.prototype.hasOwnProperty.call(n,i))return n[i]},vR=(e,t,n)=>{const i=bu(e,n);return i!==void 0?i:bu(t,n)},X1=(e,t,n)=>{for(const i in t)i!=="__proto__"&&i!=="constructor"&&(i in e?at(e[i])||e[i]instanceof String||at(t[i])||t[i]instanceof String?n&&(e[i]=t[i]):X1(e[i],t[i],n):e[i]=t[i]);return e},yr=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var wR={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const NR=e=>at(e)?e.replace(/[&<>"'\/]/g,t=>wR[t]):e;class SR{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const n=this.regExpMap.get(t);if(n!==void 0)return n;const i=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,i),this.regExpQueue.push(t),i}}const CR=[" ",",","?","!",";"],jR=new SR(20),ER=(e,t,n)=>{t=t||"",n=n||"";const i=CR.filter(u=>t.indexOf(u)<0&&n.indexOf(u)<0);if(i.length===0)return!0;const l=jR.getRegExp(`(${i.map(u=>u==="?"?"\\?":u).join("|")})`);let o=!l.test(e);if(!o){const u=e.indexOf(n);u>0&&!l.test(e.substring(0,u))&&(o=!0)}return o},Hm=(e,t,n=".")=>{if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const i=t.split(n);let l=e;for(let o=0;o<i.length;){if(!l||typeof l!="object")return;let u,d="";for(let m=o;m<i.length;++m)if(m!==o&&(d+=n),d+=i[m],u=l[d],u!==void 0){if(["string","number","boolean"].indexOf(typeof u)>-1&&m<i.length-1)continue;o+=m-o+1;break}l=u}return l},Ql=e=>e?.replace("_","-"),AR={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console?.[e]?.apply?.(console,t)}};class yu{constructor(t,n={}){this.init(t,n)}init(t,n={}){this.prefix=n.prefix||"i18next:",this.logger=t||AR,this.options=n,this.debug=n.debug}log(...t){return this.forward(t,"log","",!0)}warn(...t){return this.forward(t,"warn","",!0)}error(...t){return this.forward(t,"error","")}deprecate(...t){return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(t,n,i,l){return l&&!this.debug?null:(at(t[0])&&(t[0]=`${i}${this.prefix} ${t[0]}`),this.logger[n](t))}create(t){return new yu(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new yu(this.logger,t)}}var Us=new yu;class zu{constructor(){this.observers={}}on(t,n){return t.split(" ").forEach(i=>{this.observers[i]||(this.observers[i]=new Map);const l=this.observers[i].get(n)||0;this.observers[i].set(n,l+1)}),this}off(t,n){if(this.observers[t]){if(!n){delete this.observers[t];return}this.observers[t].delete(n)}}emit(t,...n){this.observers[t]&&Array.from(this.observers[t].entries()).forEach(([l,o])=>{for(let u=0;u<o;u++)l(...n)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([l,o])=>{for(let u=0;u<o;u++)l.apply(l,[t,...n])})}}class yv extends zu{constructor(t,n={ns:["translation"],defaultNS:"translation"}){super(),this.data=t||{},this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const n=this.options.ns.indexOf(t);n>-1&&this.options.ns.splice(n,1)}getResource(t,n,i,l={}){const o=l.keySeparator!==void 0?l.keySeparator:this.options.keySeparator,u=l.ignoreJSONStructure!==void 0?l.ignoreJSONStructure:this.options.ignoreJSONStructure;let d;t.indexOf(".")>-1?d=t.split("."):(d=[t,n],i&&(Array.isArray(i)?d.push(...i):at(i)&&o?d.push(...i.split(o)):d.push(i)));const m=bu(this.data,d);return!m&&!n&&!i&&t.indexOf(".")>-1&&(t=d[0],n=d[1],i=d.slice(2).join(".")),m||!u||!at(i)?m:Hm(this.data?.[t]?.[n],i,o)}addResource(t,n,i,l,o={silent:!1}){const u=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator;let d=[t,n];i&&(d=d.concat(u?i.split(u):i)),t.indexOf(".")>-1&&(d=t.split("."),l=n,n=d[1]),this.addNamespaces(n),bv(this.data,d,l),o.silent||this.emit("added",t,n,i,l)}addResources(t,n,i,l={silent:!1}){for(const o in i)(at(i[o])||Array.isArray(i[o]))&&this.addResource(t,n,o,i[o],{silent:!0});l.silent||this.emit("added",t,n,i)}addResourceBundle(t,n,i,l,o,u={silent:!1,skipCopy:!1}){let d=[t,n];t.indexOf(".")>-1&&(d=t.split("."),l=i,i=n,n=d[1]),this.addNamespaces(n);let m=bu(this.data,d)||{};u.skipCopy||(i=JSON.parse(JSON.stringify(i))),l?X1(m,i,o):m={...m,...i},bv(this.data,d,m),u.silent||this.emit("added",t,n,i)}removeResourceBundle(t,n){this.hasResourceBundle(t,n)&&delete this.data[t][n],this.removeNamespaces(n),this.emit("removed",t,n)}hasResourceBundle(t,n){return this.getResource(t,n)!==void 0}getResourceBundle(t,n){return n||(n=this.options.defaultNS),this.getResource(t,n)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const n=this.getDataByLanguage(t);return!!(n&&Object.keys(n)||[]).find(l=>n[l]&&Object.keys(n[l]).length>0)}toJSON(){return this.data}}var Z1={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,n,i,l){return e.forEach(o=>{t=this.processors[o]?.process(t,n,i,l)??t}),t}};const J1=Symbol("i18next/PATH_KEY");function TR(){const e=[],t=Object.create(null);let n;return t.get=(i,l)=>(n?.revoke?.(),l===J1?e:(e.push(l),n=Proxy.revocable(i,t),n.proxy)),Proxy.revocable(Object.create(null),t).proxy}function Wm(e,t){const{[J1]:n}=e(TR());return n.join(t?.keySeparator??".")}const vv={},Hh=e=>!at(e)&&typeof e!="boolean"&&typeof e!="number";class vu extends zu{constructor(t,n={}){super(),xR(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Us.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t,n={interpolation:{}}){const i={...n};if(t==null)return!1;const l=this.resolve(t,i);if(l?.res===void 0)return!1;const o=Hh(l.res);return!(i.returnObjects===!1&&o)}extractFromKey(t,n){let i=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;i===void 0&&(i=":");const l=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let o=n.ns||this.options.defaultNS||[];const u=i&&t.indexOf(i)>-1,d=!this.options.userDefinedKeySeparator&&!n.keySeparator&&!this.options.userDefinedNsSeparator&&!n.nsSeparator&&!ER(t,i,l);if(u&&!d){const m=t.match(this.interpolator.nestingRegexp);if(m&&m.length>0)return{key:t,namespaces:at(o)?[o]:o};const h=t.split(i);(i!==l||i===l&&this.options.ns.indexOf(h[0])>-1)&&(o=h.shift()),t=h.join(l)}return{key:t,namespaces:at(o)?[o]:o}}translate(t,n,i){let l=typeof n=="object"?{...n}:n;if(typeof l!="object"&&this.options.overloadTranslationOptionHandler&&(l=this.options.overloadTranslationOptionHandler(arguments)),typeof l=="object"&&(l={...l}),l||(l={}),t==null)return"";typeof t=="function"&&(t=Wm(t,{...this.options,...l})),Array.isArray(t)||(t=[String(t)]);const o=l.returnDetails!==void 0?l.returnDetails:this.options.returnDetails,u=l.keySeparator!==void 0?l.keySeparator:this.options.keySeparator,{key:d,namespaces:m}=this.extractFromKey(t[t.length-1],l),h=m[m.length-1];let p=l.nsSeparator!==void 0?l.nsSeparator:this.options.nsSeparator;p===void 0&&(p=":");const g=l.lng||this.language,y=l.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(g?.toLowerCase()==="cimode")return y?o?{res:`${h}${p}${d}`,usedKey:d,exactUsedKey:d,usedLng:g,usedNS:h,usedParams:this.getUsedParamsDetails(l)}:`${h}${p}${d}`:o?{res:d,usedKey:d,exactUsedKey:d,usedLng:g,usedNS:h,usedParams:this.getUsedParamsDetails(l)}:d;const x=this.resolve(t,l);let v=x?.res;const N=x?.usedKey||d,j=x?.exactUsedKey||d,C=["[object Number]","[object Function]","[object RegExp]"],A=l.joinArrays!==void 0?l.joinArrays:this.options.joinArrays,_=!this.i18nFormat||this.i18nFormat.handleAsObject,T=l.count!==void 0&&!at(l.count),L=vu.hasDefaultValue(l),H=T?this.pluralResolver.getSuffix(g,l.count,l):"",k=l.ordinal&&T?this.pluralResolver.getSuffix(g,l.count,{ordinal:!1}):"",R=T&&!l.ordinal&&l.count===0,z=R&&l[`defaultValue${this.options.pluralSeparator}zero`]||l[`defaultValue${H}`]||l[`defaultValue${k}`]||l.defaultValue;let P=v;_&&!v&&L&&(P=z);const K=Hh(P),I=Object.prototype.toString.apply(P);if(_&&P&&K&&C.indexOf(I)<0&&!(at(A)&&Array.isArray(P))){if(!l.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const D=this.options.returnedObjectHandler?this.options.returnedObjectHandler(N,P,{...l,ns:m}):`key '${d} (${this.language})' returned an object instead of string.`;return o?(x.res=D,x.usedParams=this.getUsedParamsDetails(l),x):D}if(u){const D=Array.isArray(P),E=D?[]:{},q=D?j:N;for(const W in P)if(Object.prototype.hasOwnProperty.call(P,W)){const G=`${q}${u}${W}`;L&&!v?E[W]=this.translate(G,{...l,defaultValue:Hh(z)?z[W]:void 0,joinArrays:!1,ns:m}):E[W]=this.translate(G,{...l,joinArrays:!1,ns:m}),E[W]===G&&(E[W]=P[W])}v=E}}else if(_&&at(A)&&Array.isArray(v))v=v.join(A),v&&(v=this.extendTranslation(v,t,l,i));else{let D=!1,E=!1;!this.isValidLookup(v)&&L&&(D=!0,v=z),this.isValidLookup(v)||(E=!0,v=d);const W=(l.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&E?void 0:v,G=L&&z!==v&&this.options.updateMissing;if(E||D||G){if(this.logger.log(G?"updateKey":"missingKey",g,h,d,G?z:v),u){const O=this.resolve(d,{...l,keySeparator:!1});O&&O.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let te=[];const U=this.languageUtils.getFallbackCodes(this.options.fallbackLng,l.lng||this.language);if(this.options.saveMissingTo==="fallback"&&U&&U[0])for(let O=0;O<U.length;O++)te.push(U[O]);else this.options.saveMissingTo==="all"?te=this.languageUtils.toResolveHierarchy(l.lng||this.language):te.push(l.lng||this.language);const V=(O,B,Y)=>{const X=L&&Y!==v?Y:W;this.options.missingKeyHandler?this.options.missingKeyHandler(O,h,B,X,G,l):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(O,h,B,X,G,l),this.emit("missingKey",O,h,B,v)};this.options.saveMissing&&(this.options.saveMissingPlurals&&T?te.forEach(O=>{const B=this.pluralResolver.getSuffixes(O,l);R&&l[`defaultValue${this.options.pluralSeparator}zero`]&&B.indexOf(`${this.options.pluralSeparator}zero`)<0&&B.push(`${this.options.pluralSeparator}zero`),B.forEach(Y=>{V([O],d+Y,l[`defaultValue${Y}`]||z)})}):V(te,d,z))}v=this.extendTranslation(v,t,l,x,i),E&&v===d&&this.options.appendNamespaceToMissingKey&&(v=`${h}${p}${d}`),(E||D)&&this.options.parseMissingKeyHandler&&(v=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${h}${p}${d}`:d,D?v:void 0,l))}return o?(x.res=v,x.usedParams=this.getUsedParamsDetails(l),x):v}extendTranslation(t,n,i,l,o){if(this.i18nFormat?.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||l.usedLng,l.usedNS,l.usedKey,{resolved:l});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const m=at(t)&&(i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let h;if(m){const g=t.match(this.interpolator.nestingRegexp);h=g&&g.length}let p=i.replace&&!at(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(p={...this.options.interpolation.defaultVariables,...p}),t=this.interpolator.interpolate(t,p,i.lng||this.language||l.usedLng,i),m){const g=t.match(this.interpolator.nestingRegexp),y=g&&g.length;h<y&&(i.nest=!1)}!i.lng&&l&&l.res&&(i.lng=this.language||l.usedLng),i.nest!==!1&&(t=this.interpolator.nest(t,(...g)=>o?.[0]===g[0]&&!i.context?(this.logger.warn(`It seems you are nesting recursively key: ${g[0]} in key: ${n[0]}`),null):this.translate(...g,n),i)),i.interpolation&&this.interpolator.reset()}const u=i.postProcess||this.options.postProcess,d=at(u)?[u]:u;return t!=null&&d?.length&&i.applyPostProcessor!==!1&&(t=Z1.handle(d,t,n,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...l,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),t}resolve(t,n={}){let i,l,o,u,d;return at(t)&&(t=[t]),t.forEach(m=>{if(this.isValidLookup(i))return;const h=this.extractFromKey(m,n),p=h.key;l=p;let g=h.namespaces;this.options.fallbackNS&&(g=g.concat(this.options.fallbackNS));const y=n.count!==void 0&&!at(n.count),x=y&&!n.ordinal&&n.count===0,v=n.context!==void 0&&(at(n.context)||typeof n.context=="number")&&n.context!=="",N=n.lngs?n.lngs:this.languageUtils.toResolveHierarchy(n.lng||this.language,n.fallbackLng);g.forEach(j=>{this.isValidLookup(i)||(d=j,!vv[`${N[0]}-${j}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(d)&&(vv[`${N[0]}-${j}`]=!0,this.logger.warn(`key "${l}" for languages "${N.join(", ")}" won't get resolved as namespace "${d}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),N.forEach(C=>{if(this.isValidLookup(i))return;u=C;const A=[p];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(A,p,C,j,n);else{let T;y&&(T=this.pluralResolver.getSuffix(C,n.count,n));const L=`${this.options.pluralSeparator}zero`,H=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(y&&(n.ordinal&&T.indexOf(H)===0&&A.push(p+T.replace(H,this.options.pluralSeparator)),A.push(p+T),x&&A.push(p+L)),v){const k=`${p}${this.options.contextSeparator||"_"}${n.context}`;A.push(k),y&&(n.ordinal&&T.indexOf(H)===0&&A.push(k+T.replace(H,this.options.pluralSeparator)),A.push(k+T),x&&A.push(k+L))}}let _;for(;_=A.pop();)this.isValidLookup(i)||(o=_,i=this.getResource(C,j,_,n))}))})}),{res:i,usedKey:l,exactUsedKey:o,usedLng:u,usedNS:d}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,n,i,l={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(t,n,i,l):this.resourceStore.getResource(t,n,i,l)}getUsedParamsDetails(t={}){const n=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=t.replace&&!at(t.replace);let l=i?t.replace:t;if(i&&typeof t.count<"u"&&(l.count=t.count),this.options.interpolation.defaultVariables&&(l={...this.options.interpolation.defaultVariables,...l}),!i){l={...l};for(const o of n)delete l[o]}return l}static hasDefaultValue(t){const n="defaultValue";for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&n===i.substring(0,n.length)&&t[i]!==void 0)return!0;return!1}}class wv{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Us.create("languageUtils")}getScriptPartFromCode(t){if(t=Ql(t),!t||t.indexOf("-")<0)return null;const n=t.split("-");return n.length===2||(n.pop(),n[n.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(n.join("-"))}getLanguagePartFromCode(t){if(t=Ql(t),!t||t.indexOf("-")<0)return t;const n=t.split("-");return this.formatLanguageCode(n[0])}formatLanguageCode(t){if(at(t)&&t.indexOf("-")>-1){let n;try{n=Intl.getCanonicalLocales(t)[0]}catch{}return n&&this.options.lowerCaseLng&&(n=n.toLowerCase()),n||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let n;return t.forEach(i=>{if(n)return;const l=this.formatLanguageCode(i);(!this.options.supportedLngs||this.isSupportedCode(l))&&(n=l)}),!n&&this.options.supportedLngs&&t.forEach(i=>{if(n)return;const l=this.getScriptPartFromCode(i);if(this.isSupportedCode(l))return n=l;const o=this.getLanguagePartFromCode(i);if(this.isSupportedCode(o))return n=o;n=this.options.supportedLngs.find(u=>{if(u===o)return u;if(!(u.indexOf("-")<0&&o.indexOf("-")<0)&&(u.indexOf("-")>0&&o.indexOf("-")<0&&u.substring(0,u.indexOf("-"))===o||u.indexOf(o)===0&&o.length>1))return u})}),n||(n=this.getFallbackCodes(this.options.fallbackLng)[0]),n}getFallbackCodes(t,n){if(!t)return[];if(typeof t=="function"&&(t=t(n)),at(t)&&(t=[t]),Array.isArray(t))return t;if(!n)return t.default||[];let i=t[n];return i||(i=t[this.getScriptPartFromCode(n)]),i||(i=t[this.formatLanguageCode(n)]),i||(i=t[this.getLanguagePartFromCode(n)]),i||(i=t.default),i||[]}toResolveHierarchy(t,n){const i=this.getFallbackCodes((n===!1?[]:n)||this.options.fallbackLng||[],t),l=[],o=u=>{u&&(this.isSupportedCode(u)?l.push(u):this.logger.warn(`rejecting language code not found in supportedLngs: ${u}`))};return at(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&o(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&o(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&o(this.getLanguagePartFromCode(t))):at(t)&&o(this.formatLanguageCode(t)),i.forEach(u=>{l.indexOf(u)<0&&o(this.formatLanguageCode(u))}),l}}const Nv={zero:0,one:1,two:2,few:3,many:4,other:5},Sv={select:e=>e===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class _R{constructor(t,n={}){this.languageUtils=t,this.options=n,this.logger=Us.create("pluralResolver"),this.pluralRulesCache={}}clearCache(){this.pluralRulesCache={}}getRule(t,n={}){const i=Ql(t==="dev"?"en":t),l=n.ordinal?"ordinal":"cardinal",o=JSON.stringify({cleanedCode:i,type:l});if(o in this.pluralRulesCache)return this.pluralRulesCache[o];let u;try{u=new Intl.PluralRules(i,{type:l})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),Sv;if(!t.match(/-|_/))return Sv;const m=this.languageUtils.getLanguagePartFromCode(t);u=this.getRule(m,n)}return this.pluralRulesCache[o]=u,u}needsPlural(t,n={}){let i=this.getRule(t,n);return i||(i=this.getRule("dev",n)),i?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(t,n,i={}){return this.getSuffixes(t,i).map(l=>`${n}${l}`)}getSuffixes(t,n={}){let i=this.getRule(t,n);return i||(i=this.getRule("dev",n)),i?i.resolvedOptions().pluralCategories.sort((l,o)=>Nv[l]-Nv[o]).map(l=>`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${l}`):[]}getSuffix(t,n,i={}){const l=this.getRule(t,i);return l?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${l.select(n)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",n,i))}}const Cv=(e,t,n,i=".",l=!0)=>{let o=vR(e,t,n);return!o&&l&&at(n)&&(o=Hm(e,n,i),o===void 0&&(o=Hm(t,n,i))),o},Wh=e=>e.replace(/\$/g,"$$$$");class jv{constructor(t={}){this.logger=Us.create("interpolator"),this.options=t,this.format=t?.interpolation?.format||(n=>n),this.init(t)}init(t={}){t.interpolation||(t.interpolation={escapeValue:!0});const{escape:n,escapeValue:i,useRawValueToEscape:l,prefix:o,prefixEscaped:u,suffix:d,suffixEscaped:m,formatSeparator:h,unescapeSuffix:p,unescapePrefix:g,nestingPrefix:y,nestingPrefixEscaped:x,nestingSuffix:v,nestingSuffixEscaped:N,nestingOptionsSeparator:j,maxReplaces:C,alwaysFormat:A}=t.interpolation;this.escape=n!==void 0?n:NR,this.escapeValue=i!==void 0?i:!0,this.useRawValueToEscape=l!==void 0?l:!1,this.prefix=o?yr(o):u||"{{",this.suffix=d?yr(d):m||"}}",this.formatSeparator=h||",",this.unescapePrefix=p?"":g||"-",this.unescapeSuffix=this.unescapePrefix?"":p||"",this.nestingPrefix=y?yr(y):x||yr("$t("),this.nestingSuffix=v?yr(v):N||yr(")"),this.nestingOptionsSeparator=j||",",this.maxReplaces=C||1e3,this.alwaysFormat=A!==void 0?A:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(n,i)=>n?.source===i?(n.lastIndex=0,n):new RegExp(i,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(t,n,i,l){let o,u,d;const m=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},h=x=>{if(x.indexOf(this.formatSeparator)<0){const C=Cv(n,m,x,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(C,void 0,i,{...l,...n,interpolationkey:x}):C}const v=x.split(this.formatSeparator),N=v.shift().trim(),j=v.join(this.formatSeparator).trim();return this.format(Cv(n,m,N,this.options.keySeparator,this.options.ignoreJSONStructure),j,i,{...l,...n,interpolationkey:N})};this.resetRegExp();const p=l?.missingInterpolationHandler||this.options.missingInterpolationHandler,g=l?.interpolation?.skipOnVariables!==void 0?l.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:x=>Wh(x)},{regex:this.regexp,safeValue:x=>this.escapeValue?Wh(this.escape(x)):Wh(x)}].forEach(x=>{for(d=0;o=x.regex.exec(t);){const v=o[1].trim();if(u=h(v),u===void 0)if(typeof p=="function"){const j=p(t,o,l);u=at(j)?j:""}else if(l&&Object.prototype.hasOwnProperty.call(l,v))u="";else if(g){u=o[0];continue}else this.logger.warn(`missed to pass in variable ${v} for interpolating ${t}`),u="";else!at(u)&&!this.useRawValueToEscape&&(u=pv(u));const N=x.safeValue(u);if(t=t.replace(o[0],N),g?(x.regex.lastIndex+=u.length,x.regex.lastIndex-=o[0].length):x.regex.lastIndex=0,d++,d>=this.maxReplaces)break}}),t}nest(t,n,i={}){let l,o,u;const d=(m,h)=>{const p=this.nestingOptionsSeparator;if(m.indexOf(p)<0)return m;const g=m.split(new RegExp(`${p}[ ]*{`));let y=`{${g[1]}`;m=g[0],y=this.interpolate(y,u);const x=y.match(/'/g),v=y.match(/"/g);((x?.length??0)%2===0&&!v||v.length%2!==0)&&(y=y.replace(/'/g,'"'));try{u=JSON.parse(y),h&&(u={...h,...u})}catch(N){return this.logger.warn(`failed parsing options string in nesting for key ${m}`,N),`${m}${p}${y}`}return u.defaultValue&&u.defaultValue.indexOf(this.prefix)>-1&&delete u.defaultValue,m};for(;l=this.nestingRegexp.exec(t);){let m=[];u={...i},u=u.replace&&!at(u.replace)?u.replace:u,u.applyPostProcessor=!1,delete u.defaultValue;const h=/{.*}/.test(l[1])?l[1].lastIndexOf("}")+1:l[1].indexOf(this.formatSeparator);if(h!==-1&&(m=l[1].slice(h).split(this.formatSeparator).map(p=>p.trim()).filter(Boolean),l[1]=l[1].slice(0,h)),o=n(d.call(this,l[1].trim(),u),u),o&&l[0]===t&&!at(o))return o;at(o)||(o=pv(o)),o||(this.logger.warn(`missed to resolve ${l[1]} for nesting ${t}`),o=""),m.length&&(o=m.reduce((p,g)=>this.format(p,g,i.lng,{...i,interpolationkey:l[1].trim()}),o.trim())),t=t.replace(l[0],o),this.regexp.lastIndex=0}return t}}const kR=e=>{let t=e.toLowerCase().trim();const n={};if(e.indexOf("(")>-1){const i=e.split("(");t=i[0].toLowerCase().trim();const l=i[1].substring(0,i[1].length-1);t==="currency"&&l.indexOf(":")<0?n.currency||(n.currency=l.trim()):t==="relativetime"&&l.indexOf(":")<0?n.range||(n.range=l.trim()):l.split(";").forEach(u=>{if(u){const[d,...m]=u.split(":"),h=m.join(":").trim().replace(/^'+|'+$/g,""),p=d.trim();n[p]||(n[p]=h),h==="false"&&(n[p]=!1),h==="true"&&(n[p]=!0),isNaN(h)||(n[p]=parseInt(h,10))}})}return{formatName:t,formatOptions:n}},Ev=e=>{const t={};return(n,i,l)=>{let o=l;l&&l.interpolationkey&&l.formatParams&&l.formatParams[l.interpolationkey]&&l[l.interpolationkey]&&(o={...o,[l.interpolationkey]:void 0});const u=i+JSON.stringify(o);let d=t[u];return d||(d=e(Ql(i),l),t[u]=d),d(n)}},OR=e=>(t,n,i)=>e(Ql(n),i)(t);class IR{constructor(t={}){this.logger=Us.create("formatter"),this.options=t,this.init(t)}init(t,n={interpolation:{}}){this.formatSeparator=n.interpolation.formatSeparator||",";const i=n.cacheInBuiltFormats?Ev:OR;this.formats={number:i((l,o)=>{const u=new Intl.NumberFormat(l,{...o});return d=>u.format(d)}),currency:i((l,o)=>{const u=new Intl.NumberFormat(l,{...o,style:"currency"});return d=>u.format(d)}),datetime:i((l,o)=>{const u=new Intl.DateTimeFormat(l,{...o});return d=>u.format(d)}),relativetime:i((l,o)=>{const u=new Intl.RelativeTimeFormat(l,{...o});return d=>u.format(d,o.range||"day")}),list:i((l,o)=>{const u=new Intl.ListFormat(l,{...o});return d=>u.format(d)})}}add(t,n){this.formats[t.toLowerCase().trim()]=n}addCached(t,n){this.formats[t.toLowerCase().trim()]=Ev(n)}format(t,n,i,l={}){const o=n.split(this.formatSeparator);if(o.length>1&&o[0].indexOf("(")>1&&o[0].indexOf(")")<0&&o.find(d=>d.indexOf(")")>-1)){const d=o.findIndex(m=>m.indexOf(")")>-1);o[0]=[o[0],...o.splice(1,d)].join(this.formatSeparator)}return o.reduce((d,m)=>{const{formatName:h,formatOptions:p}=kR(m);if(this.formats[h]){let g=d;try{const y=l?.formatParams?.[l.interpolationkey]||{},x=y.locale||y.lng||l.locale||l.lng||i;g=this.formats[h](d,x,{...p,...l,...y})}catch(y){this.logger.warn(y)}return g}else this.logger.warn(`there was no format function for ${h}`);return d},t)}}const DR=(e,t)=>{e.pending[t]!==void 0&&(delete e.pending[t],e.pendingCount--)};class LR extends zu{constructor(t,n,i,l={}){super(),this.backend=t,this.store=n,this.services=i,this.languageUtils=i.languageUtils,this.options=l,this.logger=Us.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=l.maxParallelReads||10,this.readingCalls=0,this.maxRetries=l.maxRetries>=0?l.maxRetries:5,this.retryTimeout=l.retryTimeout>=1?l.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(i,l.backend,l)}queueLoad(t,n,i,l){const o={},u={},d={},m={};return t.forEach(h=>{let p=!0;n.forEach(g=>{const y=`${h}|${g}`;!i.reload&&this.store.hasResourceBundle(h,g)?this.state[y]=2:this.state[y]<0||(this.state[y]===1?u[y]===void 0&&(u[y]=!0):(this.state[y]=1,p=!1,u[y]===void 0&&(u[y]=!0),o[y]===void 0&&(o[y]=!0),m[g]===void 0&&(m[g]=!0)))}),p||(d[h]=!0)}),(Object.keys(o).length||Object.keys(u).length)&&this.queue.push({pending:u,pendingCount:Object.keys(u).length,loaded:{},errors:[],callback:l}),{toLoad:Object.keys(o),pending:Object.keys(u),toLoadLanguages:Object.keys(d),toLoadNamespaces:Object.keys(m)}}loaded(t,n,i){const l=t.split("|"),o=l[0],u=l[1];n&&this.emit("failedLoading",o,u,n),!n&&i&&this.store.addResourceBundle(o,u,i,void 0,void 0,{skipCopy:!0}),this.state[t]=n?-1:2,n&&i&&(this.state[t]=0);const d={};this.queue.forEach(m=>{yR(m.loaded,[o],u),DR(m,t),n&&m.errors.push(n),m.pendingCount===0&&!m.done&&(Object.keys(m.loaded).forEach(h=>{d[h]||(d[h]={});const p=m.loaded[h];p.length&&p.forEach(g=>{d[h][g]===void 0&&(d[h][g]=!0)})}),m.done=!0,m.errors.length?m.callback(m.errors):m.callback())}),this.emit("loaded",d),this.queue=this.queue.filter(m=>!m.done)}read(t,n,i,l=0,o=this.retryTimeout,u){if(!t.length)return u(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:n,fcName:i,tried:l,wait:o,callback:u});return}this.readingCalls++;const d=(h,p)=>{if(this.readingCalls--,this.waitingReads.length>0){const g=this.waitingReads.shift();this.read(g.lng,g.ns,g.fcName,g.tried,g.wait,g.callback)}if(h&&p&&l<this.maxRetries){setTimeout(()=>{this.read.call(this,t,n,i,l+1,o*2,u)},o);return}u(h,p)},m=this.backend[i].bind(this.backend);if(m.length===2){try{const h=m(t,n);h&&typeof h.then=="function"?h.then(p=>d(null,p)).catch(d):d(null,h)}catch(h){d(h)}return}return m(t,n,d)}prepareLoading(t,n,i={},l){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),l&&l();at(t)&&(t=this.languageUtils.toResolveHierarchy(t)),at(n)&&(n=[n]);const o=this.queueLoad(t,n,i,l);if(!o.toLoad.length)return o.pending.length||l(),null;o.toLoad.forEach(u=>{this.loadOne(u)})}load(t,n,i){this.prepareLoading(t,n,{},i)}reload(t,n,i){this.prepareLoading(t,n,{reload:!0},i)}loadOne(t,n=""){const i=t.split("|"),l=i[0],o=i[1];this.read(l,o,"read",void 0,void 0,(u,d)=>{u&&this.logger.warn(`${n}loading namespace ${o} for language ${l} failed`,u),!u&&d&&this.logger.log(`${n}loaded namespace ${o} for language ${l}`,d),this.loaded(t,u,d)})}saveMissing(t,n,i,l,o,u={},d=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(n)){this.logger.warn(`did not save key "${i}" as the namespace "${n}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(i==null||i==="")){if(this.backend?.create){const m={...u,isUpdate:o},h=this.backend.create.bind(this.backend);if(h.length<6)try{let p;h.length===5?p=h(t,n,i,l,m):p=h(t,n,i,l),p&&typeof p.then=="function"?p.then(g=>d(null,g)).catch(d):d(null,p)}catch(p){d(p)}else h(t,n,i,l,d,m)}!t||!t[0]||this.store.addResource(t[0],n,i,l)}}}const Gh=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if(typeof e[1]=="object"&&(t=e[1]),at(e[1])&&(t.defaultValue=e[1]),at(e[2])&&(t.tDescription=e[2]),typeof e[2]=="object"||typeof e[3]=="object"){const n=e[3]||e[2];Object.keys(n).forEach(i=>{t[i]=n[i]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Av=e=>(at(e.ns)&&(e.ns=[e.ns]),at(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),at(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),typeof e.initImmediate=="boolean"&&(e.initAsync=e.initImmediate),e),Rc=()=>{},RR=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(n=>{typeof e[n]=="function"&&(e[n]=e[n].bind(e))})};class Ul extends zu{constructor(t={},n){if(super(),this.options=Av(t),this.services={},this.logger=Us,this.modules={external:[]},RR(this),n&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,n),this;setTimeout(()=>{this.init(t,n)},0)}}init(t={},n){this.isInitializing=!0,typeof t=="function"&&(n=t,t={}),t.defaultNS==null&&t.ns&&(at(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const i=Gh();this.options={...i,...this.options,...Av(t)},this.options.interpolation={...i.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator),typeof this.options.overloadTranslationOptionHandler!="function"&&(this.options.overloadTranslationOptionHandler=i.overloadTranslationOptionHandler),this.options.debug===!0&&typeof console<"u"&&console.warn("i18next is maintained with support from locize.com  consider powering your project with managed localization (AI, CDN, integrations): https://locize.com");const l=h=>h?typeof h=="function"?new h:h:null;if(!this.options.isClone){this.modules.logger?Us.init(l(this.modules.logger),this.options):Us.init(null,this.options);let h;this.modules.formatter?h=this.modules.formatter:h=IR;const p=new wv(this.options);this.store=new yv(this.options.resources,this.options);const g=this.services;g.logger=Us,g.resourceStore=this.store,g.languageUtils=p,g.pluralResolver=new _R(p,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==i.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),h&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(g.formatter=l(h),g.formatter.init&&g.formatter.init(g,this.options),this.options.interpolation.format=g.formatter.format.bind(g.formatter)),g.interpolator=new jv(this.options),g.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},g.backendConnector=new LR(l(this.modules.backend),g.resourceStore,g,this.options),g.backendConnector.on("*",(x,...v)=>{this.emit(x,...v)}),this.modules.languageDetector&&(g.languageDetector=l(this.modules.languageDetector),g.languageDetector.init&&g.languageDetector.init(g,this.options.detection,this.options)),this.modules.i18nFormat&&(g.i18nFormat=l(this.modules.i18nFormat),g.i18nFormat.init&&g.i18nFormat.init(this)),this.translator=new vu(this.services,this.options),this.translator.on("*",(x,...v)=>{this.emit(x,...v)}),this.modules.external.forEach(x=>{x.init&&x.init(this)})}if(this.format=this.options.interpolation.format,n||(n=Rc),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const h=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);h.length>0&&h[0]!=="dev"&&(this.options.lng=h[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(h=>{this[h]=(...p)=>this.store[h](...p)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(h=>{this[h]=(...p)=>(this.store[h](...p),this)});const d=Dl(),m=()=>{const h=(p,g)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),d.resolve(g),n(p,g)};if(this.languages&&!this.isInitialized)return h(null,this.t.bind(this));this.changeLanguage(this.options.lng,h)};return this.options.resources||!this.options.initAsync?m():setTimeout(m,0),d}loadResources(t,n=Rc){let i=n;const l=at(t)?t:this.language;if(typeof t=="function"&&(i=t),!this.options.resources||this.options.partialBundledLanguages){if(l?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return i();const o=[],u=d=>{if(!d||d==="cimode")return;this.services.languageUtils.toResolveHierarchy(d).forEach(h=>{h!=="cimode"&&o.indexOf(h)<0&&o.push(h)})};l?u(l):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(m=>u(m)),this.options.preload?.forEach?.(d=>u(d)),this.services.backendConnector.load(o,this.options.ns,d=>{!d&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),i(d)})}else i(null)}reloadResources(t,n,i){const l=Dl();return typeof t=="function"&&(i=t,t=void 0),typeof n=="function"&&(i=n,n=void 0),t||(t=this.languages),n||(n=this.options.ns),i||(i=Rc),this.services.backendConnector.reload(t,n,o=>{l.resolve(),i(o)}),l}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&Z1.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1)){for(let n=0;n<this.languages.length;n++){const i=this.languages[n];if(!(["cimode","dev"].indexOf(i)>-1)&&this.store.hasLanguageSomeTranslations(i)){this.resolvedLanguage=i;break}}!this.resolvedLanguage&&this.languages.indexOf(t)<0&&this.store.hasLanguageSomeTranslations(t)&&(this.resolvedLanguage=t,this.languages.unshift(t))}}changeLanguage(t,n){this.isLanguageChangingTo=t;const i=Dl();this.emit("languageChanging",t);const l=d=>{this.language=d,this.languages=this.services.languageUtils.toResolveHierarchy(d),this.resolvedLanguage=void 0,this.setResolvedLanguage(d)},o=(d,m)=>{m?this.isLanguageChangingTo===t&&(l(m),this.translator.changeLanguage(m),this.isLanguageChangingTo=void 0,this.emit("languageChanged",m),this.logger.log("languageChanged",m)):this.isLanguageChangingTo=void 0,i.resolve((...h)=>this.t(...h)),n&&n(d,(...h)=>this.t(...h))},u=d=>{!t&&!d&&this.services.languageDetector&&(d=[]);const m=at(d)?d:d&&d[0],h=this.store.hasLanguageSomeTranslations(m)?m:this.services.languageUtils.getBestMatchFromCodes(at(d)?[d]:d);h&&(this.language||l(h),this.translator.language||this.translator.changeLanguage(h),this.services.languageDetector?.cacheUserLanguage?.(h)),this.loadResources(h,p=>{o(p,h)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?u(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(u):this.services.languageDetector.detect(u):u(t),i}getFixedT(t,n,i){const l=(o,u,...d)=>{let m;typeof u!="object"?m=this.options.overloadTranslationOptionHandler([o,u].concat(d)):m={...u},m.lng=m.lng||l.lng,m.lngs=m.lngs||l.lngs,m.ns=m.ns||l.ns,m.keyPrefix!==""&&(m.keyPrefix=m.keyPrefix||i||l.keyPrefix);const h=this.options.keySeparator||".";let p;return m.keyPrefix&&Array.isArray(o)?p=o.map(g=>(typeof g=="function"&&(g=Wm(g,{...this.options,...u})),`${m.keyPrefix}${h}${g}`)):(typeof o=="function"&&(o=Wm(o,{...this.options,...u})),p=m.keyPrefix?`${m.keyPrefix}${h}${o}`:o),this.t(p,m)};return at(t)?l.lng=t:l.lngs=t,l.ns=n,l.keyPrefix=i,l}t(...t){return this.translator?.translate(...t)}exists(...t){return this.translator?.exists(...t)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t,n={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=n.lng||this.resolvedLanguage||this.languages[0],l=this.options?this.options.fallbackLng:!1,o=this.languages[this.languages.length-1];if(i.toLowerCase()==="cimode")return!0;const u=(d,m)=>{const h=this.services.backendConnector.state[`${d}|${m}`];return h===-1||h===0||h===2};if(n.precheck){const d=n.precheck(this,u);if(d!==void 0)return d}return!!(this.hasResourceBundle(i,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||u(i,t)&&(!l||u(o,t)))}loadNamespaces(t,n){const i=Dl();return this.options.ns?(at(t)&&(t=[t]),t.forEach(l=>{this.options.ns.indexOf(l)<0&&this.options.ns.push(l)}),this.loadResources(l=>{i.resolve(),n&&n(l)}),i):(n&&n(),Promise.resolve())}loadLanguages(t,n){const i=Dl();at(t)&&(t=[t]);const l=this.options.preload||[],o=t.filter(u=>l.indexOf(u)<0&&this.services.languageUtils.isSupportedCode(u));return o.length?(this.options.preload=l.concat(o),this.loadResources(u=>{i.resolve(),n&&n(u)}),i):(n&&n(),Promise.resolve())}dir(t){if(t||(t=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!t)return"rtl";try{const l=new Intl.Locale(t);if(l&&l.getTextInfo){const o=l.getTextInfo();if(o&&o.direction)return o.direction}}catch{}const n=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],i=this.services?.languageUtils||new wv(Gh());return t.toLowerCase().indexOf("-latn")>1?"ltr":n.indexOf(i.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(t={},n){const i=new Ul(t,n);return i.createInstance=Ul.createInstance,i}cloneInstance(t={},n=Rc){const i=t.forkResourceStore;i&&delete t.forkResourceStore;const l={...this.options,...t,isClone:!0},o=new Ul(l);if((t.debug!==void 0||t.prefix!==void 0)&&(o.logger=o.logger.clone(t)),["store","services","language"].forEach(d=>{o[d]=this[d]}),o.services={...this.services},o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},i){const d=Object.keys(this.store.data).reduce((m,h)=>(m[h]={...this.store.data[h]},m[h]=Object.keys(m[h]).reduce((p,g)=>(p[g]={...m[h][g]},p),m[h]),m),{});o.store=new yv(d,l),o.services.resourceStore=o.store}if(t.interpolation){const m={...Gh().interpolation,...this.options.interpolation,...t.interpolation},h={...l,interpolation:m};o.services.interpolator=new jv(h)}return o.translator=new vu(o.services,l),o.translator.on("*",(d,...m)=>{o.emit(d,...m)}),o.init(l,n),o.translator.options=l,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Zn=Ul.createInstance();Zn.createInstance;Zn.dir;Zn.init;Zn.loadResources;Zn.reloadResources;Zn.use;Zn.changeLanguage;Zn.getFixedT;Zn.t;Zn.exists;Zn.setDefaultNamespace;Zn.hasLoadedNamespace;Zn.loadNamespaces;Zn.loadLanguages;const ki=({icon:e,title:t,message:n,action:i,variant:l="default",className:o=""})=>{const u=l==="field-mode";return a.jsxs("div",{className:`
        flex flex-col items-center justify-center 
        min-h-[300px] p-8
        ${u?"text-slate-500":"text-slate-400"}
        ${o}
      `,children:[a.jsx($,{name:e,className:`
          text-6xl mb-4 
          ${u?"opacity-30":"opacity-20"}
        `}),a.jsx("p",{className:`
        font-bold uppercase tracking-widest text-xs
        ${u?"text-yellow-400":"text-slate-600"}
      `,children:t}),n&&a.jsx("p",{className:`
          text-sm mt-2 max-w-md text-center
          ${u?"text-slate-400":"text-slate-500"}
        `,children:n}),i&&a.jsxs("button",{onClick:i.onClick,className:`
            mt-6 px-4 py-2 rounded-lg text-sm font-medium
            transition-all duration-200
            flex items-center gap-2
            ${u?"bg-yellow-400 text-black hover:bg-yellow-300":"bg-iiif-blue text-white hover:bg-iiif-blue/90"}
          `,children:[i.icon&&a.jsx($,{name:i.icon,className:"text-sm"}),i.label]})]})},Q1={noItems:e=>({icon:"inbox",title:"No Items",message:"This area is empty. Add items to get started.",action:e?.onAction?{label:"Add Item",icon:"add",onClick:e.onAction}:void 0}),noResults:e=>({icon:"search_off",title:"No Results",message:"No items match your search. Try different terms or filters.",action:e?.onAction?{label:"Clear Filters",onClick:e.onAction}:void 0}),noSelection:()=>({icon:"touch_app",title:"Nothing Selected",message:"Select an item from the list to view details and edit."}),error:e=>({icon:"error_outline",title:"Something Went Wrong",message:"We encountered an error. Please try again or contact support.",action:e?.onRetry?{label:"Retry",icon:"refresh",onClick:e.onRetry}:void 0}),loading:()=>({icon:"hourglass_empty",title:"Loading...",message:"Please wait while we load your data."}),noData:e=>({icon:"cloud_upload",title:"No Data Yet",message:"Import files or create new items to populate this view.",action:e?.onAction?{label:"Import",icon:"upload_file",onClick:e.onAction}:void 0})},MR={scanning:{icon:"search",label:"Scanning files...",color:"text-blue-500"},processing:{icon:"memory",label:"Processing files...",color:"text-blue-500"},saving:{icon:"save",label:"Saving to storage...",color:"text-amber-500"},derivatives:{icon:"image",label:"Generating derivatives...",color:"text-purple-500"},complete:{icon:"check_circle",label:"Complete!",color:"text-green-500"},cancelled:{icon:"cancel",label:"Cancelled",color:"text-slate-500"},error:{icon:"error",label:"Error occurred",color:"text-red-500"}},FR={pending:{icon:"hourglass_empty",color:"text-slate-400",label:"Pending"},processing:{icon:"sync",color:"text-blue-500",label:"Processing"},completed:{icon:"check_circle",color:"text-green-500",label:"Completed"},error:{icon:"error",color:"text-red-500",label:"Error"},skipped:{icon:"skip_next",color:"text-amber-500",label:"Skipped"}},PR={info:{icon:"info",color:"text-blue-400"},warning:{icon:"warning",color:"text-amber-400"},error:{icon:"error",color:"text-red-400"},success:{icon:"check_circle",color:"text-green-400"}},Mc=({progress:e,className:t=""})=>a.jsx("div",{className:`relative h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden ${t}`,children:a.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-blue-400 rounded-full transition-all duration-300 ease-out",style:{width:`${Math.min(100,Math.max(0,e))}%`}})}),Yh=({stage:e})=>{const t=MR[e];return a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx($,{name:t.icon,className:`text-lg ${t.color} ${e==="processing"?"animate-pulse":""}`}),a.jsx("span",{className:`font-medium ${t.color}`,children:t.label})]})},$R=({status:e})=>{const t=FR[e];return a.jsxs("div",{className:`flex items-center gap-1 text-xs ${t.color}`,children:[a.jsx($,{name:t.icon,className:`text-sm ${e==="processing"?"animate-spin":""}`}),a.jsx("span",{children:t.label})]})},zR=({entry:e})=>{const t=PR[e.level],n=new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return a.jsxs("div",{className:"flex items-start gap-2 py-1.5 px-2 hover:bg-slate-50 dark:hover:bg-slate-800/50 rounded transition-colors",children:[a.jsx($,{name:t.icon,className:`text-sm mt-0.5 shrink-0 ${t.color}`}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 truncate",children:e.message}),a.jsx("p",{className:"text-xs text-slate-400",children:n})]})]})},Fc=({file:e,onRetry:t})=>a.jsxs("div",{className:"flex items-center justify-between py-2 px-3 hover:bg-slate-50 dark:hover:bg-slate-800/50 rounded transition-colors",children:[a.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[a.jsx($R,{status:e.status}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 truncate",title:e.name,children:e.name}),e.error&&a.jsx("p",{className:"text-xs text-red-500 truncate",title:e.error,children:e.error})]})]}),a.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.status==="processing"&&a.jsx("div",{className:"w-16 h-1 bg-slate-200 rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-200",style:{width:`${e.progress}%`}})}),e.status==="error"&&t&&a.jsx("button",{onClick:t,className:"p-1 hover:bg-slate-200 dark:hover:bg-slate-700 rounded transition-colors",title:"Retry",children:a.jsx($,{name:"refresh",className:"text-sm text-slate-500"})})]})]}),UR=({progress:e,controls:t,variant:n="full",showLogByDefault:i=!1,showFilesByDefault:l=!1,onRetryFile:o,onCancel:u,className:d=""})=>{const[m,h]=S.useState(i),[p,g]=S.useState(l);S.useMemo(()=>e?{completedPercent:e.filesTotal>0?Math.round(e.filesCompleted/e.filesTotal*100):0,hasErrors:e.filesError>0,hasFailedFiles:e.files.some(C=>C.status==="error"),recentLog:e.activityLog.slice(-5)}:null,[e]);const y=()=>{t.cancel(),u?.()};if(n==="minimal")return e?a.jsxs("div",{className:`bg-white dark:bg-slate-800 rounded-lg p-3 shadow-sm border border-slate-200 dark:border-slate-700 ${d}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx(Yh,{stage:e.stage}),a.jsxs("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:[e.overallProgress,"%"]})]}),a.jsx(Mc,{progress:e.overallProgress})]}):null;if(n==="compact")return e?a.jsxs("div",{className:`bg-white dark:bg-slate-800 rounded-lg p-4 shadow-sm border border-slate-200 dark:border-slate-700 ${d}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx(Yh,{stage:e.stage}),a.jsxs("div",{className:"flex items-center gap-2",children:[!e.isPaused&&e.stage!=="complete"&&e.stage!=="cancelled"&&e.stage!=="error"&&a.jsx("button",{onClick:()=>t.pause(),className:"p-1.5 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",title:"Pause",children:a.jsx($,{name:"pause",className:"text-sm text-slate-500"})}),e.isPaused&&a.jsx("button",{onClick:()=>t.resume(),className:"p-1.5 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",title:"Resume",children:a.jsx($,{name:"play_arrow",className:"text-sm text-green-500"})}),e.stage!=="complete"&&e.stage!=="cancelled"&&e.stage!=="error"&&a.jsx("button",{onClick:y,className:"p-1.5 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",title:"Cancel",children:a.jsx($,{name:"cancel",className:"text-sm text-red-500"})})]})]}),a.jsx(Mc,{progress:e.overallProgress,className:"mb-3"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[a.jsxs("div",{children:[a.jsxs("p",{className:"text-2xl font-bold text-slate-700 dark:text-slate-300",children:[e.filesCompleted,a.jsxs("span",{className:"text-sm font-normal text-slate-400",children:[" / ",e.filesTotal]})]}),a.jsx("p",{className:"text-xs text-slate-500",children:"Files"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-slate-700 dark:text-slate-300",children:mv(e.speed)}),a.jsx("p",{className:"text-xs text-slate-500",children:"Speed"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-slate-700 dark:text-slate-300",children:hv(e.etaSeconds)}),a.jsx("p",{className:"text-xs text-slate-500",children:"ETA"})]})]}),e.filesError>0&&a.jsxs("div",{className:"mt-3 p-2 bg-red-50 dark:bg-red-900/20 rounded flex items-center gap-2",children:[a.jsx($,{name:"error",className:"text-red-500"}),a.jsxs("span",{className:"text-sm text-red-600 dark:text-red-400",children:[e.filesError," file(s) failed"]})]})]}):null;if(!e)return a.jsx(ki,{icon:"hourglass_empty",title:"No Active Ingest",message:"Start an ingest operation to see progress here",className:d});const x=e.files.filter(C=>C.status==="pending"),v=e.files.filter(C=>C.status==="processing"),N=e.files.filter(C=>C.status==="completed"),j=e.files.filter(C=>C.status==="error");return a.jsxs("div",{className:`bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden ${d}`,children:[a.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx(Yh,{stage:e.stage}),a.jsxs("div",{className:"flex items-center gap-1",children:[!e.isPaused&&e.stage!=="complete"&&e.stage!=="cancelled"&&e.stage!=="error"&&a.jsx("button",{onClick:()=>t.pause(),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",title:"Pause",children:a.jsx($,{name:"pause",className:"text-slate-500"})}),e.isPaused&&a.jsx("button",{onClick:()=>t.resume(),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",title:"Resume",children:a.jsx($,{name:"play_arrow",className:"text-green-500"})}),e.stage!=="complete"&&e.stage!=="cancelled"&&e.stage!=="error"&&a.jsx("button",{onClick:y,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",title:"Cancel",children:a.jsx($,{name:"cancel",className:"text-red-500"})})]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsx(Mc,{progress:e.overallProgress})}),a.jsxs("span",{className:"text-lg font-bold text-slate-700 dark:text-slate-300 w-12 text-right",children:[e.overallProgress,"%"]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 p-4 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50",children:[a.jsxs("div",{className:"text-center",children:[a.jsxs("p",{className:"text-2xl font-bold text-slate-700 dark:text-slate-300",children:[e.filesCompleted,a.jsxs("span",{className:"text-sm font-normal text-slate-400",children:["/",e.filesTotal]})]}),a.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Files"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-2xl font-bold text-slate-700 dark:text-slate-300",children:mv(e.speed)}),a.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Speed"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-2xl font-bold text-slate-700 dark:text-slate-300",children:hv(e.etaSeconds)}),a.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"ETA"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-2xl font-bold text-slate-700 dark:text-slate-300",children:e.filesError>0?a.jsx("span",{className:"text-red-500",children:e.filesError}):"0"}),a.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Errors"})]})]}),e.currentFile&&e.stage==="processing"&&a.jsxs("div",{className:"px-4 py-3 border-b border-slate-200 dark:border-slate-700",children:[a.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wide mb-1",children:"Current File"}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx($,{name:"image",className:"text-slate-400"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 truncate",children:e.currentFile.name}),a.jsxs("p",{className:"text-xs text-slate-500",children:[(e.currentFile.size/1024/1024).toFixed(2)," MB"]})]}),a.jsx("div",{className:"w-24",children:a.jsx(Mc,{progress:e.currentFile.progress})})]})]}),a.jsxs("div",{className:"border-b border-slate-200 dark:border-slate-700",children:[a.jsxs("button",{onClick:()=>h(!m),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx($,{name:"history",className:"text-slate-400"}),a.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:"Activity Log"}),a.jsxs("span",{className:"text-xs text-slate-400",children:["(",e.activityLog.length," entries)"]})]}),a.jsx($,{name:m?"expand_less":"expand_more",className:"text-slate-400 transition-transform"})]}),m&&a.jsx("div",{className:"max-h-48 overflow-y-auto",children:e.activityLog.length===0?a.jsx("p",{className:"px-4 py-3 text-sm text-slate-400 italic",children:"No activity yet"}):e.activityLog.slice().reverse().map((C,A)=>a.jsx(zR,{entry:C},`${C.timestamp}-${A}`))})]}),a.jsxs("div",{children:[a.jsxs("button",{onClick:()=>g(!p),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx($,{name:"folder_open",className:"text-slate-400"}),a.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:"Files"}),a.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[N.length>0&&a.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-700 rounded",children:N.length}),v.length>0&&a.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded",children:v.length}),j.length>0&&a.jsx("span",{className:"px-1.5 py-0.5 bg-red-100 text-red-700 rounded",children:j.length}),x.length>0&&a.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 text-slate-600 rounded",children:x.length})]})]}),a.jsx($,{name:p?"expand_less":"expand_more",className:"text-slate-400 transition-transform"})]}),p&&a.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.files.length===0?a.jsx("p",{className:"px-4 py-3 text-sm text-slate-400 italic",children:"No files to process"}):a.jsxs("div",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:[j.map(C=>a.jsx(Fc,{file:C,onRetry:o?()=>o(C.id):void 0},C.id)),v.map(C=>a.jsx(Fc,{file:C},C.id)),N.map(C=>a.jsx(Fc,{file:C},C.id)),x.map(C=>a.jsx(Fc,{file:C},C.id))]})})]})]})},BR=({file:e,index:t,isSelected:n,isDragTarget:i,onSelect:l,onDragStart:o,onDragOver:u,onDragEnd:d,onDrop:m})=>{const[h,p]=S.useState(null);S.useEffect(()=>{if(e.type.startsWith("image/")){const x=URL.createObjectURL(e);return p(x),()=>URL.revokeObjectURL(x)}},[e]);const g=()=>e.type.startsWith("image/")?"image":e.type.startsWith("video/")?"movie":e.type.startsWith("audio/")?"audio_file":"description",y=x=>x<1024?`${x} B`:x<1024*1024?`${(x/1024).toFixed(1)} KB`:`${(x/(1024*1024)).toFixed(1)} MB`;return a.jsxs("div",{draggable:!0,onClick:l,onDragStart:x=>o(x,t),onDragOver:x=>u(x,t),onDragEnd:d,onDrop:x=>m(x,t),className:`
        group flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-all
        ${n?"bg-blue-100 border-2 border-blue-400 shadow-sm":"bg-white border border-slate-200 hover:border-slate-300 hover:shadow-sm"}
        ${i?"border-blue-500 border-dashed bg-blue-50":""}
      `,children:[a.jsx("div",{className:"flex-shrink-0 cursor-grab active:cursor-grabbing text-slate-300 hover:text-slate-500",children:a.jsx($,{name:"drag_indicator",className:"text-lg"})}),a.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-slate-100 rounded text-[10px] font-bold text-slate-500 flex items-center justify-center",children:t+1}),a.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-slate-100 rounded overflow-hidden flex items-center justify-center",children:h?a.jsx("img",{src:h,alt:e.name,className:"w-full h-full object-cover"}):a.jsx($,{name:g(),className:"text-xl text-slate-400"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-sm font-medium text-slate-700 truncate",title:e.name,children:e.name}),a.jsx("div",{className:"text-[10px] text-slate-400",children:y(e.size)})]}),n&&a.jsx("div",{className:"flex-shrink-0",children:a.jsx($,{name:"check_circle",className:"text-blue-500 text-lg"})})]})},HR=({manifest:e,isSelected:t,selectedCanvasIndices:n,onSelect:i,onCanvasSelect:l,onReorderCanvases:o,onDragStart:u})=>{const[d,m]=S.useState(!1),[h,p]=S.useState(null),[g,y]=S.useState(null),x=S.useCallback((C,A)=>{C.stopPropagation(),y(A),C.dataTransfer.effectAllowed="move",C.dataTransfer.setData("text/plain",String(A))},[]),v=S.useCallback((C,A)=>{C.preventDefault(),C.stopPropagation(),g!==null&&A!==g&&p(A)},[g]),N=S.useCallback(()=>{y(null),p(null)},[]),j=S.useCallback((C,A)=>{if(C.preventDefault(),C.stopPropagation(),g===null||g===A){N();return}const _=[...e.canvasOrder],[T]=_.splice(g,1);_.splice(A,0,T),o(_),N()},[g,e.canvasOrder,o,N]);return a.jsxs("div",{className:`
        border rounded-xl overflow-hidden transition-all
        ${t?"border-blue-400 bg-blue-50 shadow-md ring-2 ring-blue-200":"border-slate-200 bg-white hover:border-slate-300 hover:shadow-sm"}
      `,children:[a.jsxs("div",{draggable:!0,onClick:i,onDragStart:u,className:`
          flex items-center gap-3 p-3 cursor-pointer transition-colors
          ${t?"bg-blue-100":"hover:bg-slate-50"}
        `,children:[a.jsx("button",{onClick:C=>{C.stopPropagation(),m(!d)},className:"p-1 rounded hover:bg-white/50 transition-colors",children:a.jsx($,{name:d?"expand_more":"chevron_right",className:"text-lg text-slate-500"})}),a.jsx("div",{className:`
          w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0
          ${t?"bg-blue-200":"bg-emerald-100"}
        `,children:a.jsx($,{name:"menu_book",className:`text-xl ${t?"text-blue-600":"text-emerald-600"}`})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-slate-800 truncate",title:e.name,children:e.name}),a.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-500",children:[a.jsxs("span",{children:[e.files.length," ",e.files.length===1?"canvas":"canvases"]}),e.detectedPattern&&a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-slate-300",children:"|"}),a.jsxs("span",{className:"text-emerald-600 font-medium flex items-center gap-1",children:[a.jsx($,{name:"auto_awesome",className:"text-[10px]"}),e.detectedPattern]})]})]})]}),t&&a.jsx("div",{className:"flex-shrink-0",children:a.jsx($,{name:"check_circle",className:"text-blue-500 text-xl"})}),a.jsx("div",{className:"flex-shrink-0 text-slate-300 hover:text-slate-500 cursor-grab",children:a.jsx($,{name:"drag_indicator",className:"text-lg"})})]}),e.breadcrumbs.length>0&&a.jsx("div",{className:"px-4 pb-2 -mt-1",children:a.jsx("div",{className:"flex items-center gap-1 text-[10px] text-slate-400",children:e.breadcrumbs.map((C,A)=>a.jsxs(An.Fragment,{children:[A>0&&a.jsx($,{name:"chevron_right",className:"text-[10px]"}),a.jsx("span",{children:C})]},A))})}),d&&a.jsxs("div",{className:"border-t border-slate-200 bg-slate-50 p-3 space-y-2",children:[a.jsxs("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 flex items-center gap-2",children:[a.jsx($,{name:"layers",className:"text-sm"}),"Canvas Order (drag to reorder)"]}),e.files.map((C,A)=>a.jsx(BR,{file:C,index:A,isSelected:n.includes(A),isDragTarget:h===A,onSelect:_=>l(A,_),onDragStart:x,onDragOver:v,onDragEnd:N,onDrop:j},C.name))]})]})},WR=10080*60*1e3;async function GR(){try{const e=await qt.listCheckpoints(),t=Date.now();return e.filter(i=>t-i.timestamp<WR).sort((i,l)=>l.timestamp-i.timestamp)}catch(e){return console.error("Failed to list checkpoints:",e),[]}}function YR(e){const t=Date.now()-e;if(t<6e4)return"Just now";if(t<36e5){const n=Math.floor(t/6e4);return`${n} minute${n!==1?"s":""} ago`}else if(t<864e5){const n=Math.floor(t/36e5);return`${n} hour${n!==1?"s":""} ago`}else{const n=Math.floor(t/864e5);return`${n} day${n!==1?"s":""} ago`}}function Tv(e){return{in_progress:"blue",completed:"green",failed:"red",paused:"amber"}[e]}const qR=({sourceManifests:e,selectedIds:t,onToggleSelection:n,onSelectRange:i,onClearSelection:l,onSelectAll:o,onReorderCanvases:u,onDragStart:d,onFocus:m,isFocused:h,onResumeImport:p,enableKeyboardDnd:g=!1,keyboardDnd:y})=>{const{t:x}=Cu({level:"standard"}),[v,N]=S.useState(""),[j,C]=S.useState(null),[A,_]=S.useState(new Map),[T,L]=S.useState([]),[H,k]=S.useState(!1);S.useEffect(()=>{(async()=>{const E=await GR();L(E.filter(q=>q.status==="in_progress"||q.status==="paused"))})()},[]);const R=S.useMemo(()=>{if(!v.trim())return e.manifests;const D=v.toLowerCase();return e.manifests.filter(E=>E.name.toLowerCase().includes(D)||E.breadcrumbs.some(q=>q.toLowerCase().includes(D)))},[e.manifests,v]);S.useMemo(()=>R.map(D=>D.id),[R]);const z=S.useCallback((D,E)=>{m(),E.shiftKey&&j?i(j,D.id):(E.ctrlKey||E.metaKey||l(),n(D.id)),C(D.id)},[j,m,i,n,l]),P=S.useCallback((D,E,q)=>{const W=A.get(D)||[];if(q.ctrlKey||q.metaKey){const G=W.includes(E)?W.filter(te=>te!==E):[...W,E];_(new Map(A).set(D,G))}else _(new Map([[D,[E]]]))},[A]),K=S.useCallback((D,E)=>{const q=t.includes(E)?t:[E];D.dataTransfer.setData("application/iiif-manifest-ids",JSON.stringify(q)),D.dataTransfer.effectAllowed="copyMove",d(D,q)},[t,d]),I=S.useMemo(()=>({totalManifests:e.manifests.length,totalFiles:e.manifests.reduce((D,E)=>D+E.files.length,0),patternsDetected:e.manifests.filter(D=>D.detectedPattern).length}),[e.manifests]);return a.jsxs("div",{className:`
        flex flex-col h-full border-r transition-colors
        ${h?"border-blue-200 bg-blue-50/30":"border-slate-200 bg-white"}
      `,onClick:m,children:[a.jsxs("div",{className:"flex-shrink-0 p-4 border-b border-slate-200 bg-white",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[a.jsx($,{name:"source",className:"text-blue-500"}),"Your Files"]}),a.jsx("p",{className:"text-[11px] text-slate-500 mt-0.5",children:"Files from your selected folder"})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-lg font-bold text-slate-800",children:I.totalManifests}),a.jsxs("div",{className:"text-[10px] text-slate-400",children:[I.totalFiles," files"]})]})]}),T.length>0&&p&&a.jsxs("div",{className:"mb-3",children:[a.jsxs("button",{onClick:()=>k(!H),className:"w-full p-2 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-700 flex items-center justify-between hover:bg-amber-100 transition-colors",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx($,{name:"history",className:"text-amber-500"}),a.jsxs("span",{children:[T.length," unfinished import",T.length!==1?"s":""," available"]})]}),a.jsx($,{name:H?"expand_less":"expand_more",className:"text-amber-500"})]}),H&&a.jsx("div",{className:"mt-2 space-y-2",children:T.map(D=>a.jsxs("div",{className:"p-3 bg-white border border-slate-200 rounded-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("span",{className:"font-medium text-sm text-slate-700 truncate",children:D.sourceName}),a.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full bg-${Tv(D.status)}-100 text-${Tv(D.status)}-700`,children:D.status==="in_progress"?"In Progress":"Paused"})]}),a.jsxs("div",{className:"text-[10px] text-slate-500 mb-2",children:[YR(D.timestamp),"  ",D.processedFiles," of ",D.totalFiles," files processed"]}),a.jsx("div",{className:"w-full bg-slate-200 h-1.5 rounded-full overflow-hidden mb-2",children:a.jsx("div",{className:"bg-amber-500 h-full transition-all",style:{width:`${D.progress}%`}})}),a.jsx("button",{onClick:()=>p(D),className:"w-full py-1.5 bg-amber-500 text-white rounded text-xs font-medium hover:bg-amber-600 transition-colors",children:"Resume Import"})]},D.id))})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",value:v,onChange:D=>N(D.target.value),placeholder:`Filter ${x("Manifest").toLowerCase()}s...`,className:"w-full pl-8 pr-3 py-2 text-sm bg-slate-100 border border-slate-200 rounded-lg outline-none focus:border-blue-400 focus:bg-white transition-colors"}),a.jsx($,{name:"search",className:"absolute left-2.5 top-2.5 text-slate-400 text-sm"}),v&&a.jsx("button",{onClick:()=>N(""),className:"absolute right-2 top-2 p-0.5 rounded hover:bg-slate-200",children:a.jsx($,{name:"close",className:"text-sm text-slate-400"})})]}),t.length>0&&a.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-slate-100",children:[a.jsxs("span",{className:"text-[11px] font-medium text-blue-600",children:[t.length," selected"]}),a.jsx("button",{onClick:l,className:"text-[11px] text-slate-500 hover:text-slate-700 underline",children:"Clear"}),a.jsx("button",{onClick:o,className:"text-[11px] text-slate-500 hover:text-slate-700 underline",children:"Select All"})]}),I.patternsDetected>0&&a.jsxs("div",{className:"mt-3 p-2 bg-emerald-50 border border-emerald-200 rounded-lg text-[11px] text-emerald-700 flex items-center gap-2",children:[a.jsx($,{name:"auto_awesome",className:"text-emerald-500"}),I.patternsDetected," ",x("Manifest").toLowerCase(),I.patternsDetected!==1?"s":""," with detected sequence patterns"]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:R.length===0?a.jsx("div",{className:"text-center py-12 px-4",children:v?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx($,{name:"search_off",className:"text-3xl text-slate-400"})}),a.jsxs("p",{className:"text-sm font-medium text-slate-700 mb-1",children:["No ",x("Manifest").toLowerCase(),"s match your filter"]}),a.jsx("p",{className:"text-xs text-slate-500",children:"Try adjusting your search terms"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx($,{name:"folder_open",className:"text-3xl text-blue-400"})}),a.jsx("p",{className:"text-sm font-medium text-slate-700 mb-1",children:"No files found"}),a.jsx("p",{className:"text-xs text-slate-500 mb-4",children:"Start by adding files to organize your archive"}),a.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 text-left",children:[a.jsx("p",{className:"text-[11px] font-medium text-slate-600 mb-2",children:"Tips for getting started:"}),a.jsxs("ul",{className:"text-[11px] text-slate-500 space-y-1",children:[a.jsxs("li",{className:"flex items-start gap-1.5",children:[a.jsx($,{name:"check_circle",className:"text-xs text-emerald-500 mt-0.5 flex-shrink-0"}),a.jsx("span",{children:"Drag and drop a folder of images"})]}),a.jsxs("li",{className:"flex items-start gap-1.5",children:[a.jsx($,{name:"check_circle",className:"text-xs text-emerald-500 mt-0.5 flex-shrink-0"}),a.jsx("span",{children:'Use the "Add Files" button to browse'})]}),a.jsxs("li",{className:"flex items-start gap-1.5",children:[a.jsx($,{name:"check_circle",className:"text-xs text-emerald-500 mt-0.5 flex-shrink-0"}),a.jsx("span",{children:"Files are automatically grouped into items"})]})]})]})]})}):R.map(D=>a.jsx(HR,{manifest:D,isSelected:t.includes(D.id),selectedCanvasIndices:A.get(D.id)||[],onSelect:E=>z(D,E),onCanvasSelect:(E,q)=>P(D.id,E,q),onReorderCanvases:E=>u(D.id,E),onDragStart:E=>K(E,D.id)},D.id))}),a.jsx("div",{className:"flex-shrink-0 p-3 border-t border-slate-200 bg-slate-50 text-[10px] text-slate-500",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("span",{children:["Imported: ",new Date(e.createdAt).toLocaleString()]}),a.jsx("span",{className:"font-medium",children:e.rootPath})]})})]})},VR=({collection:e,manifests:t,isRoot:n=!1,isDragOver:i,onDrop:l,onDragEnter:o,onDragLeave:u,onRemoveManifest:d,onRename:m,onDelete:h,onAddSubCollection:p})=>{const[g,y]=S.useState(!1),[x,v]=S.useState(e.name),[N,j]=S.useState(!1),C=k=>{k.preventDefault(),k.dataTransfer.dropEffect="copy"},A=k=>{k.preventDefault();const R=k.dataTransfer.getData("application/iiif-manifest-ids");if(R)try{const z=JSON.parse(R);l(z)}catch{const z=k.dataTransfer.getData("text/plain");z&&l([z])}u()},_=()=>{x.trim()&&x!==e.name&&m(x.trim()),y(!1)},T=k=>{k.key==="Enter"?_():k.key==="Escape"&&(v(e.name),y(!1))},L=e.manifestRefs.length,H=e.children.length;return a.jsxs("div",{onDragOver:C,onDragEnter:o,onDragLeave:u,onDrop:A,className:`
        relative border-2 rounded-xl p-4 transition-all
        ${i?"border-blue-400 bg-blue-50 shadow-lg scale-[1.02]":"border-slate-200 bg-white hover:border-slate-300 hover:shadow-sm"}
        ${n?"border-amber-300 bg-amber-50/50":""}
      `,children:[i&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-blue-100/80 rounded-xl z-10",children:a.jsxs("div",{className:"text-center",children:[a.jsx($,{name:"add_circle",className:"text-4xl text-blue-500 mb-2"}),a.jsx("div",{className:"text-sm font-bold text-blue-700",children:"Drop to add"})]})}),a.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[a.jsx("div",{className:`
          w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0
          ${n?"bg-amber-200":"bg-amber-100"}
        `,children:a.jsx($,{name:n?"folder_special":"folder",className:"text-xl text-amber-600"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[g?a.jsx("input",{type:"text",value:x,onChange:k=>v(k.target.value),onBlur:_,onKeyDown:T,autoFocus:!0,className:"w-full px-2 py-1 text-sm font-medium border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-400"}):a.jsxs("div",{className:"font-medium text-slate-800 truncate cursor-pointer hover:text-blue-600",onClick:()=>!n&&y(!0),title:n?e.name:"Click to rename",children:[e.name,n&&a.jsx("span",{className:"ml-2 text-[10px] text-amber-600 font-bold",children:"(ROOT)"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-500",children:[a.jsxs("span",{children:[L," ",L===1?"manifest":"manifests"]}),H>0&&a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-slate-300",children:"|"}),a.jsxs("span",{children:[H," sub-",H===1?"collection":"collections"]})]})]})]}),a.jsxs("div",{className:"relative",children:[a.jsx("button",{onClick:()=>j(!N),className:"p-1 rounded hover:bg-slate-100 text-slate-400 hover:text-slate-600",children:a.jsx($,{name:"more_vert"})}),N&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>j(!1)}),a.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg z-20 py-1 min-w-[160px]",children:[a.jsxs("button",{onClick:()=>{p(),j(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-slate-50 flex items-center gap-2",children:[a.jsx($,{name:"create_new_folder",className:"text-slate-400"}),"Add Sub-Collection"]}),!n&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>{y(!0),j(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-slate-50 flex items-center gap-2",children:[a.jsx($,{name:"edit",className:"text-slate-400"}),"Rename"]}),a.jsxs("button",{onClick:()=>{h(),j(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-red-50 text-red-600 flex items-center gap-2",children:[a.jsx($,{name:"delete",className:"text-red-400"}),"Delete Collection"]})]})]})]})]})]}),t.length>0&&a.jsxs("div",{className:"space-y-1 mt-3 pt-3 border-t border-slate-100",children:[t.slice(0,5).map(k=>a.jsxs("div",{className:"group flex items-center gap-2 p-2 bg-slate-50 rounded-lg text-sm",children:[a.jsx($,{name:"menu_book",className:"text-emerald-500 text-sm"}),a.jsx("span",{className:"flex-1 truncate text-slate-600",title:k.name,children:k.name}),a.jsxs("span",{className:"text-[10px] text-slate-400",children:[k.files.length," files"]}),a.jsx("button",{onClick:()=>d(k.id),className:"opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-red-100 text-red-400 hover:text-red-600 transition-opacity",title:"Remove from collection",children:a.jsx($,{name:"close",className:"text-sm"})})]},k.id)),t.length>5&&a.jsxs("div",{className:"text-[11px] text-slate-400 text-center py-1",children:["+",t.length-5," more manifests"]})]}),t.length===0&&!i&&a.jsxs("div",{className:"mt-3 pt-3 border-t border-dashed border-slate-200 text-center py-4",children:[a.jsx($,{name:"drag_indicator",className:"text-2xl text-slate-300 mb-1"}),a.jsx("div",{className:"text-[11px] text-slate-400",children:"Drag manifests here"})]})]})},KR=({archiveLayout:e,sourceManifests:t,onAddToCollection:n,onRemoveFromCollection:i,onCreateCollection:l,onRenameCollection:o,onDeleteCollection:u,onOpenSendToModal:d,onFocus:m,isFocused:h})=>{const{t:p}=Cu({level:"standard"}),[g,y]=S.useState(null),[x,v]=S.useState(""),[N,j]=S.useState(!1),[C,A]=S.useState(null),_=Hv.USE_KEYBOARD_DND,T=S.useCallback(D=>{const E=[D];return D.children.forEach(q=>{E.push(...T(q))}),E},[]),L=S.useMemo(()=>T(e.root),[e.root,T]),H=K1({items:L,onReorder:()=>{},onMove:(D,E)=>{n(E,[D])},getItemId:D=>D.id}),k=S.useCallback(D=>D.manifestRefs.map(E=>xu(t,E)).filter(E=>E!==void 0),[t]),R=S.useMemo(()=>e.unassignedManifests.map(D=>xu(t,D)).filter(D=>D!==void 0),[e.unassignedManifests,t]),z=S.useCallback(()=>{x.trim()&&(l(x.trim()),v(""),j(!1))},[x,l]),P=S.useCallback(D=>{D.preventDefault(),y(null)},[]),K=S.useCallback((D,E=!1,q=0)=>{const W=k(D),G=C===D.id,te=_,U=_;return a.jsxs("div",{className:"space-y-3",role:"treeitem","aria-level":q+1,"aria-selected":te,tabIndex:G?0:-1,onKeyDown:void 0,onFocus:()=>{A(D.id)},children:[a.jsx(VR,{collection:D,manifests:W,isRoot:E,isDragOver:g===D.id||U,onDrop:V=>n(D.id,V),onDragEnter:()=>y(D.id),onDragLeave:()=>y(null),onRemoveManifest:V=>i(D.id,[V]),onRename:V=>o(D.id,V),onDelete:()=>u(D.id),onAddSubCollection:()=>{const V=prompt("New sub-collection name:");V&&l(V,D.id)}}),D.children.length>0&&a.jsx("div",{className:"ml-6 pl-4 border-l-2 border-slate-200 space-y-3",children:D.children.map(V=>K(V,!1,q+1))})]},D.id)},[k,g,n,i,o,u,l,C,_,H]),I=S.useMemo(()=>{const D=q=>1+q.children.reduce((W,G)=>W+D(G),0),E=q=>q.manifestRefs.length+q.children.reduce((W,G)=>W+E(G),0);return{totalCollections:D(e.root),assignedManifests:E(e.root),unassignedCount:e.unassignedManifests.length}},[e]);return a.jsxs("div",{className:`
        flex flex-col h-full transition-colors
        ${h?"border-amber-200 bg-amber-50/30":"bg-slate-50"}
      `,onClick:m,children:[a.jsxs("div",{className:"flex-shrink-0 p-4 border-b border-slate-200 bg-white",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[a.jsx($,{name:"account_tree",className:"text-amber-500"}),"Your Archive"]}),a.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:["Organize ",p("Manifest").toLowerCase(),"s into ",p("Collection").toLowerCase(),"s"]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-lg font-bold text-slate-800",children:I.totalCollections}),a.jsxs("div",{className:"text-[10px] text-slate-400",children:[p("Collection").toLowerCase(),"s"]})]})]}),N?a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:x,onChange:D=>v(D.target.value),onKeyDown:D=>D.key==="Enter"&&z(),placeholder:`${p("Collection")} name...`,autoFocus:!0,className:"flex-1 px-3 py-2 text-sm bg-white border border-slate-300 rounded-lg outline-none focus:border-amber-400"}),a.jsx("button",{onClick:z,disabled:!x.trim(),className:"px-4 py-2 bg-amber-500 text-white rounded-lg font-medium text-sm hover:bg-amber-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Create"}),a.jsx("button",{onClick:()=>{j(!1),v("")},className:"px-3 py-2 text-slate-500 hover:text-slate-700",children:a.jsx($,{name:"close"})})]}):a.jsxs("button",{onClick:()=>j(!0),className:"w-full py-2 border-2 border-dashed border-slate-300 rounded-lg text-sm text-slate-500 hover:border-amber-400 hover:text-amber-600 hover:bg-amber-50 transition-colors flex items-center justify-center gap-2",children:[a.jsx($,{name:"create_new_folder"}),"New ",p("Collection")]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[K(e.root,!0),R.length>0&&a.jsxs("div",{onDragOver:D=>D.preventDefault(),onDrop:P,className:"mt-6 pt-4 border-t border-slate-200",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx($,{name:"inbox",className:"text-slate-400"}),a.jsxs("h4",{className:"font-medium text-slate-600",children:["Unassigned ",p("Manifest"),"s"]}),a.jsx("span",{className:"ml-auto text-[11px] text-slate-400 bg-slate-200 px-2 py-0.5 rounded-full",children:R.length})]}),a.jsx("div",{className:"space-y-2",children:R.map(D=>a.jsxs("div",{draggable:!0,onDragStart:E=>{E.dataTransfer.setData("application/iiif-manifest-ids",JSON.stringify([D.id]))},className:"group flex items-center gap-3 p-3 bg-white border border-slate-200 rounded-lg cursor-grab active:cursor-grabbing hover:border-slate-300 hover:shadow-sm transition-all",children:[a.jsx($,{name:"drag_indicator",className:"text-slate-300 group-hover:text-slate-500"}),a.jsx("div",{className:"w-8 h-8 bg-emerald-100 rounded flex items-center justify-center flex-shrink-0",children:a.jsx($,{name:"menu_book",className:"text-emerald-600 text-sm"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-sm font-medium text-slate-700 truncate",children:D.name}),a.jsxs("div",{className:"text-[10px] text-slate-400",children:[D.files.length," files"]})]}),a.jsxs("button",{onClick:()=>d([D.id]),className:"opacity-0 group-hover:opacity-100 px-2 py-1 bg-amber-100 text-amber-700 rounded text-[10px] font-medium hover:bg-amber-200 transition-opacity",children:["Add to ",p("Collection"),"..."]})]},D.id))})]}),e.root.children.length===0&&R.length===0&&a.jsxs("div",{className:"text-center py-12 px-4",children:[a.jsx("div",{className:"w-16 h-16 bg-amber-50 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx($,{name:"create_new_folder",className:"text-3xl text-amber-400"})}),a.jsxs("p",{className:"text-sm font-medium text-slate-700 mb-1",children:["No ",p("Collection").toLowerCase(),"s yet"]}),a.jsxs("p",{className:"text-xs text-slate-500 mb-4",children:["Create your first ",p("Collection").toLowerCase()," to organize your files"]}),a.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 text-left",children:[a.jsx("p",{className:"text-[11px] font-medium text-slate-600 mb-2",children:"How to organize:"}),a.jsxs("ul",{className:"text-[11px] text-slate-500 space-y-1",children:[a.jsxs("li",{className:"flex items-start gap-1.5",children:[a.jsx($,{name:"drag_indicator",className:"text-xs text-blue-500 mt-0.5 flex-shrink-0"}),a.jsx("span",{children:"Drag files from the left to add them"})]}),a.jsxs("li",{className:"flex items-start gap-1.5",children:[a.jsx($,{name:"create_new_folder",className:"text-xs text-amber-500 mt-0.5 flex-shrink-0"}),a.jsxs("span",{children:["Create ",p("Collection").toLowerCase(),"s to group related files"]})]}),a.jsxs("li",{className:"flex items-start gap-1.5",children:[a.jsx($,{name:"account_tree",className:"text-xs text-emerald-500 mt-0.5 flex-shrink-0"}),a.jsxs("span",{children:["Nest ",p("Collection").toLowerCase(),"s for hierarchy"]})]})]})]})]})]}),a.jsx("div",{className:"flex-shrink-0 p-3 border-t border-slate-200 bg-white",children:a.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[I.unassignedCount>0?a.jsxs("div",{className:"flex items-center gap-1 text-amber-600",children:[a.jsx($,{name:"warning",className:"text-sm"}),I.unassignedCount," ",p("Manifest").toLowerCase(),I.unassignedCount!==1?"s":""," not in any ",p("Collection").toLowerCase()]}):a.jsxs("div",{className:"flex items-center gap-1 text-emerald-600",children:[a.jsx($,{name:"check_circle",className:"text-sm"}),"All ",p("Manifest").toLowerCase(),"s assigned"]}),a.jsxs("span",{className:"text-slate-400",children:[I.assignedManifests," in ",p("Collection").toLowerCase(),"s"]})]})})]})},XR=({manifests:e,collections:t,onSend:n,onCreateAndSend:i,onClose:l})=>{const[o,u]=S.useState(""),[d,m]=S.useState(""),[h,p]=S.useState(!1),g=S.useMemo(()=>{if(!o.trim())return t;const v=o.toLowerCase();return t.filter(N=>N.name.toLowerCase().includes(v))},[t,o]),y=S.useMemo(()=>{const v=[],N=(j,C)=>{v.push({collection:j,level:C}),j.children.forEach(A=>N(A,C+1))};return g.forEach(j=>N(j,0)),v},[g]),x=()=>{d.trim()&&i(d.trim())};return a.jsx("div",{className:"fixed inset-0 z-[600] flex items-center justify-center bg-black/50 backdrop-blur-sm",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[80vh] flex flex-col",onClick:v=>v.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[a.jsx($,{name:"drive_file_move",className:"text-amber-500"}),"Send to Collection"]}),a.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:[e.length," manifest",e.length!==1?"s":""," selected"]})]}),a.jsx("button",{onClick:l,className:"p-2 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600",children:a.jsx($,{name:"close"})})]}),a.jsx("div",{className:"px-4 py-3 bg-slate-50 border-b border-slate-200",children:a.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.slice(0,3).map(v=>a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-white border border-slate-200 rounded text-[11px] text-slate-600",children:[a.jsx($,{name:"menu_book",className:"text-emerald-500 text-xs"}),a.jsx("span",{className:"truncate max-w-[120px]",children:v.name})]},v.id)),e.length>3&&a.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-slate-200 rounded text-[11px] text-slate-600",children:["+",e.length-3," more"]})]})}),a.jsx("div",{className:"p-4 border-b border-slate-200",children:a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",value:o,onChange:v=>u(v.target.value),placeholder:"Search collections...",className:"w-full pl-8 pr-3 py-2 text-sm bg-slate-100 border border-slate-200 rounded-lg outline-none focus:border-amber-400 focus:bg-white"}),a.jsx($,{name:"search",className:"absolute left-2.5 top-2.5 text-slate-400 text-sm"})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:y.length===0?a.jsxs("div",{className:"text-center py-8 text-slate-400",children:[a.jsx($,{name:"folder_off",className:"text-3xl mb-2"}),a.jsx("p",{className:"text-sm",children:o?"No collections match your search":"No collections available"})]}):a.jsx("div",{className:"space-y-1",children:y.map(({collection:v,level:N})=>a.jsxs("button",{onClick:()=>n(v.id),className:"w-full flex items-center gap-3 p-3 rounded-lg hover:bg-amber-50 hover:border-amber-200 border border-transparent transition-colors text-left",style:{paddingLeft:12+N*20},children:[a.jsx("div",{className:`
                    w-8 h-8 rounded flex items-center justify-center flex-shrink-0
                    ${N===0?"bg-amber-200":"bg-amber-100"}
                  `,children:a.jsx($,{name:N===0?"folder_special":"folder",className:"text-amber-600 text-sm"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-slate-700 truncate",children:v.name}),a.jsxs("div",{className:"text-[10px] text-slate-400",children:[v.manifestRefs.length," manifests |"," ",v.children.length," sub-collections"]})]}),a.jsx($,{name:"arrow_forward",className:"text-slate-300"})]},v.id))})}),a.jsx("div",{className:"p-4 border-t border-slate-200 bg-slate-50",children:h?a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:d,onChange:v=>m(v.target.value),onKeyDown:v=>v.key==="Enter"&&x(),placeholder:"New collection name...",autoFocus:!0,className:"flex-1 px-3 py-2 text-sm bg-white border border-slate-300 rounded-lg outline-none focus:border-amber-400"}),a.jsx("button",{onClick:x,disabled:!d.trim(),className:"px-4 py-2 bg-amber-500 text-white rounded-lg font-medium text-sm hover:bg-amber-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Create & Send"}),a.jsx("button",{onClick:()=>{p(!1),m("")},className:"px-2 text-slate-400 hover:text-slate-600",children:a.jsx($,{name:"close"})})]}):a.jsxs("button",{onClick:()=>p(!0),className:"w-full py-2 border-2 border-dashed border-slate-300 rounded-lg text-sm text-slate-500 hover:border-amber-400 hover:text-amber-600 hover:bg-amber-50/50 transition-colors flex items-center justify-center gap-2",children:[a.jsx($,{name:"add"}),"Create New Collection"]})})]})})},ZR=({sourceManifests:e,onClose:t})=>{const[n,i]=S.useState("both"),[l,o]=S.useState("en"),[u,d]=S.useState(!0),m=oR(),h=S.useMemo(()=>lR(e,{vocabulary:n},5),[e,n,l,u]),p=()=>{const y={vocabulary:n,language:l,includeInstructions:u},x=`${e.rootPath.replace(/[^a-zA-Z0-9-_]/g,"-")}-metadata`;cR(e,y,x),t()},g=e.manifests.reduce((y,x)=>y+x.files.length,0);return a.jsx("div",{className:"fixed inset-0 z-[600] flex items-center justify-center bg-black/50 backdrop-blur-sm",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col",onClick:y=>y.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[a.jsx($,{name:"table_chart",className:"text-blue-500"}),"Export Metadata Template"]}),a.jsx("p",{className:"text-[11px] text-slate-500 mt-0.5",children:"CSV template for offline metadata editing"})]}),a.jsx("button",{onClick:t,className:"p-2 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600",children:a.jsx($,{name:"close"})})]}),a.jsx("div",{className:"p-4 border-b border-slate-200 space-y-4",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Vocabulary"}),a.jsx("div",{className:"space-y-2",children:m.map(y=>a.jsxs("label",{className:`
                      flex items-start gap-3 p-3 rounded-lg border-2 cursor-pointer transition-colors
                      ${n===y.value?"border-blue-400 bg-blue-50":"border-slate-200 hover:border-slate-300"}
                    `,children:[a.jsx("input",{type:"radio",name:"vocabulary",value:y.value,checked:n===y.value,onChange:x=>i(x.target.value),className:"mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium text-sm text-slate-700",children:y.label}),a.jsx("div",{className:"text-[11px] text-slate-500 mt-0.5",children:y.description})]})]},y.value))})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Default Language"}),a.jsx("select",{value:l,onChange:y=>o(y.target.value),className:"w-full px-3 py-2 text-sm bg-white border border-slate-300 rounded-lg outline-none focus:border-blue-400",children:FC.map(y=>a.jsxs("option",{value:y.code,children:[y.label," (",y.code,")"]},y.code))})]}),a.jsx("div",{children:a.jsxs("label",{className:"flex items-center gap-3 p-3 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50",children:[a.jsx("input",{type:"checkbox",checked:u,onChange:y=>d(y.target.checked)}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-sm text-slate-700",children:"Include Instructions File"}),a.jsx("div",{className:"text-[11px] text-slate-500",children:"Download a .txt file explaining each column"})]})]})}),a.jsxs("div",{className:"p-3 bg-slate-100 rounded-lg",children:[a.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Export Summary"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-500",children:"Manifests:"})," ",a.jsx("span",{className:"font-medium text-slate-700",children:e.manifests.length})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-500",children:"Files:"})," ",a.jsx("span",{className:"font-medium text-slate-700",children:g})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-500",children:"CSV rows:"})," ",a.jsx("span",{className:"font-medium text-slate-700",children:g+1})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-slate-500",children:"Columns:"})," ",a.jsx("span",{className:"font-medium text-slate-700",children:h[0]?.length||0})]})]})]})]})]})}),a.jsxs("div",{className:"flex-1 overflow-hidden p-4",children:[a.jsxs("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[a.jsx($,{name:"preview",className:"text-sm"}),"Preview (first 5 rows)"]}),a.jsx("div",{className:"border border-slate-200 rounded-lg overflow-auto h-48",children:a.jsxs("table",{className:"w-full text-[11px] border-collapse",children:[a.jsx("thead",{children:a.jsx("tr",{className:"bg-slate-100 sticky top-0",children:h[0]?.map((y,x)=>a.jsx("th",{className:"px-3 py-2 text-left font-bold text-slate-600 border-b border-slate-200 whitespace-nowrap",children:y},x))})}),a.jsx("tbody",{children:h.slice(1).map((y,x)=>a.jsx("tr",{className:x%2===0?"bg-white":"bg-slate-50",children:y.map((v,N)=>a.jsx("td",{className:"px-3 py-2 text-slate-700 border-b border-slate-100 truncate max-w-[150px]",title:v,children:v||a.jsx("span",{className:"text-slate-300 italic",children:"(empty)"})},N))},x))})]})}),g>5&&a.jsxs("div",{className:"text-[10px] text-slate-400 mt-2 text-center",children:["...and ",g-5," more rows"]})]}),a.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-slate-200 bg-slate-50",children:[a.jsxs("div",{className:"text-[11px] text-slate-500 flex items-center gap-2",children:[a.jsx($,{name:"info",className:"text-slate-400"}),"Fill in the template and re-import to apply metadata"]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:t,className:"px-4 py-2 text-sm text-slate-600 hover:text-slate-800",children:"Cancel"}),a.jsxs("button",{onClick:p,className:"px-6 py-2 bg-blue-500 text-white rounded-lg font-medium text-sm hover:bg-blue-600 flex items-center gap-2",children:[a.jsx($,{name:"download"}),"Download Template"]})]})]})]})})},JR=({initialTree:e,existingRoot:t,onIngest:n,onCancel:i,abstractionLevel:l="standard"})=>{const[o,u]=S.useState(null),[d,m]=S.useState(!0),[h,p]=S.useState({message:"Analyzing files...",percent:0});return S.useEffect(()=>{(async()=>{m(!0),p({message:"Building file tree...",percent:20});try{await new Promise(N=>setTimeout(N,100)),p({message:"Detecting file sequences...",percent:50}),await new Promise(N=>setTimeout(N,100));const y=N=>{const j=[];return N.files.forEach(C=>j.push(C)),N.directories.forEach(C=>j.push(...y(C))),j},x=y(e);if(x.length===0)throw new Error("No files found in the selected directory");const v=KL(x);if(!v||!v.manifests)throw new Error("Failed to build manifests from files");p({message:`Found ${v.manifests.length} manifests`,percent:100}),await new Promise(N=>setTimeout(N,300)),u(v)}catch(y){console.error("Error building source manifests:",y),p({message:`Error: ${y instanceof Error?y.message:"Unknown error"}`,percent:0})}finally{m(!1)}})()},[e]),S.useEffect(()=>{const g=y=>{y.key==="Escape"&&!d&&i()};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[i,d]),d||!o?a.jsxs("div",{className:"fixed inset-0 bg-white z-[500] flex flex-col items-center justify-center",children:[a.jsx("div",{className:"w-20 h-20 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center mb-6 animate-pulse",children:a.jsx($,{name:"folder_open",className:"text-4xl"})}),a.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Analyzing Content..."}),a.jsx("p",{className:"text-sm text-slate-500 mb-4",children:h.message}),a.jsx("div",{className:"w-64 bg-slate-200 h-2 rounded-full overflow-hidden",children:a.jsx("div",{className:"bg-blue-500 h-full transition-all duration-300",style:{width:`${h.percent}%`}})})]}):a.jsx(QR,{sourceManifests:o,initialTree:e,existingRoot:t,onIngest:n,onCancel:i,abstractionLevel:l})},QR=({sourceManifests:e,initialTree:t,existingRoot:n,onIngest:i,onCancel:l,abstractionLevel:o})=>{const{t:u,formatCount:d}=Cu({level:o}),{aggregate:m,progress:h,controls:p,startIngest:g,clearCompleted:y}=gR(),x=mR(e),{selectedIds:v,toggleSelection:N,selectRange:j,clearSelection:C,selectAll:A,focusedPane:_,setFocusedPane:T,createNewCollection:L,addToCollection:H,removeFromCollection:k,renameCollectionAction:R,deleteCollectionAction:z,reorderCanvases:P,getAllCollectionsList:K,getManifest:I,archiveLayout:D,sourceManifests:E,hasUnassigned:q}=x,[W,G]=S.useState(!1),[te,U]=S.useState([]),[V,O]=S.useState(!1),[B,Y]=S.useState(!!n),[X,Q]=S.useState(50),ue=K1({items:E.manifests,onReorder:()=>{},onMove:(Z,se)=>{H(se,[Z])},getItemId:Z=>Z.id}),be=Nu.USE_KEYBOARD_DND,de=S.useMemo(()=>E.manifests.map(Z=>Z.id),[E.manifests]),ye=S.useCallback(Z=>{U(Z),G(!0)},[]),le=S.useCallback(Z=>{H(Z,te),G(!1),U([])},[H,te]),we=S.useCallback(Z=>{const se=L(Z);H(se,te),G(!1),U([])},[L,H,te]),He=S.useCallback((Z,se)=>{Z.dataTransfer.setData("application/iiif-manifest-ids",JSON.stringify(se)),Z.dataTransfer.effectAllowed="copyMove"},[]),Ke=S.useCallback(async()=>{try{if(XC){const Z=await g(async se=>await gD(t,{generateThumbnails:!0,extractMetadata:!0,calculateHashes:!1,onProgress:se.onProgress,signal:se.signal}));return i(t,B,(se,Te)=>{}),setTimeout(()=>y(),3e3),Z}}catch(Z){console.error("Ingest failed:",Z)}},[t,B,i,g,y,E.manifests,D.root.children.length]),F=S.useMemo(()=>te.map(Z=>I(Z)).filter(Z=>Z!==void 0),[te,I]),me=S.useMemo(()=>({totalManifests:E.manifests.length,totalFiles:E.manifests.reduce((Z,se)=>Z+se.files.length,0),totalCollections:K().length}),[E.manifests,K]),he=d(me.totalManifests,"Manifest"),ee=d(me.totalCollections,"Collection");return m.isActive?a.jsx("div",{className:"fixed inset-0 bg-white/95 dark:bg-slate-900/95 z-[500] flex items-center justify-center p-4",children:a.jsx("div",{className:"w-full max-w-2xl",children:a.jsx(UR,{progress:h,controls:p,variant:"full",showLogByDefault:!1,showFilesByDefault:!1,onCancel:()=>{p.cancel(),setTimeout(()=>l(),500)}})})}):a.jsxs("div",{className:"fixed inset-0 bg-white z-[500] flex flex-col",children:[a.jsxs("div",{className:"flex-shrink-0 h-14 border-b border-slate-200 bg-slate-50 flex items-center justify-between px-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded flex items-center justify-center",children:a.jsx($,{name:"construction",className:"text-white text-lg"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"font-bold text-slate-800",children:"Organize Your Files"}),a.jsxs("p",{className:"text-[10px] text-slate-500",children:[he," | ",me.totalFiles," files | ",ee]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>O(!0),className:"px-3 py-2 text-sm text-slate-600 hover:bg-slate-100 rounded-lg flex items-center gap-2",children:[a.jsx($,{name:"table_chart",className:"text-slate-400"}),"Export Template"]}),n&&a.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 text-sm text-slate-600 cursor-pointer hover:bg-slate-100 rounded-lg",children:[a.jsx("input",{type:"checkbox",checked:B,onChange:Z=>Y(Z.target.checked)}),"Merge with existing"]}),a.jsxs("button",{onClick:Ke,className:"px-6 py-2 bg-blue-500 text-white rounded-lg font-medium text-sm hover:bg-blue-600 flex items-center gap-2 shadow-lg",children:[a.jsx($,{name:"publish"}),"Import ",u("Archive")]}),a.jsx("button",{onClick:l,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg",children:a.jsx($,{name:"close"})})]})]}),q&&a.jsxs("div",{className:"flex-shrink-0 px-4 py-2 bg-amber-50 border-b border-amber-200 text-amber-700 text-sm flex items-center gap-2",children:[a.jsx($,{name:"warning",className:"text-amber-500"}),"Some ",u("Manifest").toLowerCase(),"s are not in any ",u("Collection").toLowerCase(),". They will still be imported but won't appear in the organization."]}),be,a.jsxs("div",{className:"flex-1 flex min-h-0",children:[a.jsx("div",{style:{width:`${X}%`},className:"min-w-[300px]",children:a.jsx(qR,{sourceManifests:E,selectedIds:v,onToggleSelection:N,onSelectRange:(Z,se)=>j(Z,se,de),onClearSelection:C,onSelectAll:()=>A(de),onReorderCanvases:P,onDragStart:He,onFocus:()=>T("source"),isFocused:_==="source",enableKeyboardDnd:be,keyboardDnd:ue})}),a.jsx("div",{className:"w-1 bg-slate-200 hover:bg-blue-400 cursor-col-resize transition-colors flex-shrink-0",onMouseDown:Z=>{Z.preventDefault();const se=Z.clientX,Te=X,_e=ge=>{const Se=ge.clientX-se,Ce=Z.target.parentElement?.clientWidth||1,Me=Te+Se/Ce*100;Q(Math.max(25,Math.min(75,Me)))},ne=()=>{document.removeEventListener("mousemove",_e),document.removeEventListener("mouseup",ne)};document.addEventListener("mousemove",_e),document.addEventListener("mouseup",ne)}}),a.jsx("div",{style:{width:`${100-X}%`},className:"min-w-[300px]",children:a.jsx(KR,{archiveLayout:D,sourceManifests:E,onAddToCollection:(Z,se)=>H(Z,se),onRemoveFromCollection:k,onCreateCollection:L,onRenameCollection:R,onDeleteCollection:z,onOpenSendToModal:ye,onFocus:()=>T("archive"),isFocused:_==="archive"})})]}),W&&a.jsx(XR,{manifests:F,collections:K(),onSend:le,onCreateAndSend:we,onClose:()=>{G(!1),U([])}}),V&&a.jsx(ZR,{sourceManifests:E,onClose:()=>O(!1)})]})},e5=({files:e})=>{const[t,n]=S.useState(e[0]||null);return a.jsxs("div",{className:"flex h-[500px] border rounded-xl overflow-hidden bg-white shadow-inner",children:[a.jsxs("div",{className:"w-1/3 border-r bg-slate-50 flex flex-col",children:[a.jsxs("div",{className:"p-3 border-b bg-slate-100 flex items-center justify-between",children:[a.jsx("span",{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest",children:"Bundle Structure"}),a.jsxs("span",{className:"text-[10px] font-bold text-iiif-blue bg-blue-50 px-1.5 rounded",children:[e.length," Files"]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar",children:[e.slice(0,500).map(i=>a.jsxs("div",{onClick:()=>n(i),className:`flex items-center gap-2 p-2 rounded cursor-pointer text-xs transition-all ${t?.path===i.path?"bg-iiif-blue text-white shadow-md":"hover:bg-slate-200 text-slate-600"}`,children:[a.jsx($,{name:i.type==="json"?"description":i.type==="html"?"html":"image",className:t?.path===i.path?"text-white":"text-slate-400"}),a.jsx("span",{className:"truncate font-mono",children:i.path})]},i.path)),e.length>500&&a.jsxs("div",{className:"p-4 text-center text-xs text-slate-400 italic",children:["... and ",e.length-500," more files"]})]})]}),a.jsxs("div",{className:"flex-1 bg-slate-900 flex flex-col overflow-hidden",children:[a.jsxs("div",{className:"p-3 bg-slate-800 border-b border-white/10 flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx($,{name:"visibility",className:"text-blue-400 text-sm"}),a.jsx("span",{className:"text-xs font-bold text-slate-300 font-mono truncate max-w-[200px]",children:t?.path})]}),t?.type==="json"&&a.jsx("div",{className:"text-[9px] font-black bg-green-500/20 text-green-400 px-1.5 py-0.5 rounded border border-green-500/30 uppercase",children:"Synthesized"})]}),a.jsx("div",{className:"flex-1 overflow-auto p-4 custom-scrollbar",children:t?t.content instanceof Blob?a.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-500 gap-4",children:[a.jsx($,{name:"image",className:"text-6xl opacity-20"}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-xs font-bold uppercase text-slate-400",children:"Binary Asset"}),a.jsx("p",{className:"text-[10px] opacity-60",children:"File contents hidden in preview"})]})]}):a.jsx("pre",{className:"text-[11px] font-mono text-blue-200 leading-relaxed whitespace-pre-wrap break-all",children:typeof t.content=="string"&&t.content.length>5e4?t.content.slice(0,5e4)+`
... [Preview Truncated]`:t.content}):a.jsx("div",{className:"h-full flex items-center justify-center text-slate-600 italic text-sm",children:"Select a file to preview output"})})]})]})};class t5{constructor(){this.seenTopics=new Set,this.STORAGE_KEY="iiif-field-guidance",this.listeners=new Set,this.load()}load(){try{const t=localStorage.getItem(this.STORAGE_KEY);t&&(this.seenTopics=new Set(JSON.parse(t)))}catch{console.warn("Failed to load guidance state")}}save(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(Array.from(this.seenTopics))),this.notifyListeners()}notifyListeners(){this.listeners.forEach(t=>t())}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}hasSeen(t){return this.seenTopics.has(t)}markSeen(t){this.seenTopics.has(t)||(this.seenTopics.add(t),this.save())}getSeenCount(){return this.seenTopics.size}reset(){this.seenTopics.clear(),this.save()}resetTooltips(){const t=[];this.seenTopics.forEach(n=>{(n.startsWith("tooltip-")||n.startsWith("hint-"))&&t.push(n)}),t.forEach(n=>this.seenTopics.delete(n)),this.save()}hasCompletedSetup(){return localStorage.getItem("iiif-field-setup-complete")==="true"}completeSetup(){localStorage.setItem("iiif-field-setup-complete","true")}resetSetup(){localStorage.removeItem("iiif-field-setup-complete")}}const Ka=new t5,n5=({title:e,items:t,isOpen:n,onToggle:i})=>a.jsxs("div",{className:"fixed bottom-4 left-4 z-50",children:[a.jsxs("button",{onClick:i,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${n?"bg-slate-800 text-white":"bg-white/90 text-slate-600 hover:bg-white shadow-lg border border-slate-200"}`,children:[a.jsx($,{name:"help_outline",className:"text-sm"}),a.jsx("span",{children:n?"Close":"Quick Help"}),!n&&a.jsx("kbd",{className:"ml-1 px-1 py-0.5 bg-slate-100 rounded text-[9px] font-mono",children:"?"})]}),n&&a.jsxs("div",{className:"absolute bottom-full left-0 mb-2 w-72 bg-white rounded-xl shadow-2xl border border-slate-200 overflow-hidden animate-in slide-in-from-bottom-2 duration-200",children:[a.jsx("div",{className:"px-4 py-2.5 bg-slate-50 border-b border-slate-100",children:a.jsx("h3",{className:"text-xs font-bold text-slate-700 uppercase tracking-wide",children:e})}),a.jsx("div",{className:"p-2 max-h-80 overflow-y-auto",children:t.map((l,o)=>a.jsxs("div",{className:"flex items-start gap-3 p-2 rounded-lg hover:bg-slate-50 transition-colors",children:[a.jsx($,{name:l.icon,className:"text-slate-400 text-sm mt-0.5"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xs font-medium text-slate-700",children:l.label}),l.shortcut&&a.jsx("kbd",{className:"px-1 py-0.5 bg-slate-100 rounded text-[9px] font-mono text-slate-500",children:l.shortcut})]}),l.description&&a.jsx("p",{className:"text-[10px] text-slate-400 mt-0.5",children:l.description})]})]},o))})]})]}),s5=({id:e,message:t,icon:n="lightbulb",className:i=""})=>{const[l,o]=S.useState(!1);S.useEffect(()=>{Ka.hasSeen(`hint-${e}`)||o(!0)},[e]);const u=()=>{Ka.markSeen(`hint-${e}`),o(!1)};return l?a.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 bg-blue-50 border border-blue-100 rounded-lg text-xs text-blue-700 ${i}`,children:[a.jsx($,{name:n,className:"text-blue-500 text-sm shrink-0"}),a.jsx("span",{className:"flex-1",children:t}),a.jsx("button",{onClick:u,className:"text-blue-400 hover:text-blue-600 shrink-0",title:"Dismiss",children:a.jsx($,{name:"close",className:"text-xs"})})]}):null};var Gc={exports:{}},a5=Gc.exports,_v;function i5(){return _v||(_v=1,(function(e,t){(function(n,i){i()})(a5,function(){function n(h,p){return typeof p>"u"?p={autoBom:!1}:typeof p!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),p={autoBom:!p}),p.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(h.type)?new Blob(["\uFEFF",h],{type:h.type}):h}function i(h,p,g){var y=new XMLHttpRequest;y.open("GET",h),y.responseType="blob",y.onload=function(){m(y.response,p,g)},y.onerror=function(){console.error("could not download file")},y.send()}function l(h){var p=new XMLHttpRequest;p.open("HEAD",h,!1);try{p.send()}catch{}return 200<=p.status&&299>=p.status}function o(h){try{h.dispatchEvent(new MouseEvent("click"))}catch{var p=document.createEvent("MouseEvents");p.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),h.dispatchEvent(p)}}var u=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof qa=="object"&&qa.global===qa?qa:void 0,d=u.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),m=u.saveAs||(typeof window!="object"||window!==u?function(){}:"download"in HTMLAnchorElement.prototype&&!d?function(h,p,g){var y=u.URL||u.webkitURL,x=document.createElement("a");p=p||h.name||"download",x.download=p,x.rel="noopener",typeof h=="string"?(x.href=h,x.origin===location.origin?o(x):l(x.href)?i(h,p,g):o(x,x.target="_blank")):(x.href=y.createObjectURL(h),setTimeout(function(){y.revokeObjectURL(x.href)},4e4),setTimeout(function(){o(x)},0))}:"msSaveOrOpenBlob"in navigator?function(h,p,g){if(p=p||h.name||"download",typeof h!="string")navigator.msSaveOrOpenBlob(n(h,g),p);else if(l(h))i(h,p,g);else{var y=document.createElement("a");y.href=h,y.target="_blank",setTimeout(function(){o(y)})}}:function(h,p,g,y){if(y=y||open("","_blank"),y&&(y.document.title=y.document.body.innerText="downloading..."),typeof h=="string")return i(h,p,g);var x=h.type==="application/octet-stream",v=/constructor/i.test(u.HTMLElement)||u.safari,N=/CriOS\/[\d]+/.test(navigator.userAgent);if((N||x&&v||d)&&typeof FileReader<"u"){var j=new FileReader;j.onloadend=function(){var _=j.result;_=N?_:_.replace(/^data:[^;]*;/,"data:attachment/file;"),y?y.location.href=_:location=_,y=null},j.readAsDataURL(h)}else{var C=u.URL||u.webkitURL,A=C.createObjectURL(h);y?y.location=A:location.href=A,y=null,setTimeout(function(){C.revokeObjectURL(A)},4e4)}});u.saveAs=m.saveAs=m,e.exports=m})})(Gc)),Gc.exports}var Er=i5();const Yc=wu(Er),r5=({root:e,onClose:t})=>{const[n,i]=S.useState("config"),[l,o]=S.useState("canopy"),[u,d]=S.useState(!0),[m,h]=S.useState(!1),[p,g]=S.useState(!1),[y,x]=S.useState({status:"",percent:0}),[v,N]=S.useState(null);S.useEffect(()=>{const U=V=>{V.key==="Escape"&&!p&&t()};return document.addEventListener("keydown",U),()=>document.removeEventListener("keydown",U)},[t,p]);const[j,C]=S.useState([]),[A,_]=S.useState([]),[T,L]=S.useState({title:e&&Le(e.label)||"IIIF Collection",baseUrl:"",port:8765,theme:{accentColor:"indigo",grayColor:"slate",appearance:"light"},search:{enabled:!0,indexSummary:!0},metadata:[],featured:[]}),[H,k]=S.useState({includeWebP:!1,includeGrayscale:!1,includeSquare:!1,tileSize:512}),[R,z]=S.useState({includeMedia:!0,digestAlgorithm:"sha256",organization:"",description:"",externalId:"",versionMessage:"Initial export from IIIF Field Studio",user:{name:"",email:""}});S.useEffect(()=>{e&&n==="dry-run"&&P()},[n,l,u]);const P=async()=>{if(e){if(l==="ocfl"||l==="bagit"||l==="activity-log"){const U=Jl.validateTree(e);_(Object.values(U).flat()),C([]);return}g(!0);try{const U=l==="canopy"?"canopy":"raw-iiif",V=await Zy.prepareExport(e,{format:U,includeAssets:u,ignoreErrors:m,canopyConfig:l==="canopy"?T:void 0,imageApiOptions:l==="canopy"?H:void 0});C(V);const O=Jl.validateTree(e);_(Object.values(O).flat())}catch(U){N(U.message)}finally{g(!1)}}},K=async()=>{if(e){i("exporting"),N(null);try{const U=l==="canopy"?"canopy":"raw-iiif",V=await Zy.exportArchive(e,{format:U,includeAssets:u,ignoreErrors:m,canopyConfig:l==="canopy"?T:void 0,imageApiOptions:l==="canopy"?H:void 0},O=>{x(O)});Yc.saveAs(V,`canopy-export-${new Date().toISOString().split("T")[0]}.zip`),t()}catch(U){N(U.message),i("dry-run")}}},I=async()=>{if(T.metadata.length===0&&e){const U=new Set,V=O=>{O.metadata?.forEach(B=>{const Y=Le(B.label);Y&&U.add(Y)}),O.items?.forEach(V)};V(e),L(O=>({...O,metadata:Array.from(U)}))}i("dry-run")},D=async()=>{i("exporting"),N(null),x({status:"Gathering activity history...",percent:0});try{x({status:"Exporting activity log...",percent:30});const U=await Fh.exportAll();if(U.length===0)throw new Error("No activities recorded yet. Make some changes to your manifests first.");x({status:"Generating Change Discovery collection...",percent:50});const V=window.location.origin,O=await Fh.exportAsChangeDiscovery(V);x({status:"Creating download...",percent:80});const B=new Zl;if(B.file("collection.json",JSON.stringify(O,null,2)),B.file("activities.json",JSON.stringify(U,null,2)),U.length>100){const Q=Math.ceil(U.length/100);for(let ue=0;ue<Q;ue++){const be=await Fh.exportPage(V,ue);B.file(`page-${ue}.json`,JSON.stringify(be,null,2))}}const Y=await B.generateAsync({type:"blob"});Yc.saveAs(Y,`activity-log-${new Date().toISOString().split("T")[0]}.zip`),x({status:"Complete!",percent:100}),await new Promise(X=>setTimeout(X,500)),t()}catch(U){N(U.message||"Failed to export activity log"),i("config")}},E=async()=>{if(e){i("exporting"),N(null),x({status:"Initializing archival package...",percent:0});try{const U={includeMedia:R.includeMedia??!0,digestAlgorithm:R.digestAlgorithm||"sha256",organization:R.organization,description:R.description,externalId:R.externalId,versionMessage:R.versionMessage,user:R.user?.name?R.user:void 0};x({status:`Creating ${l.toUpperCase()} package...`,percent:20});const V=l==="ocfl"?await Jy.exportOCFL(e,U):await Jy.exportBagIt(e,U);if(!V.success&&V.errors.length>0)throw new Error(V.errors.join("; "));x({status:"Compressing files...",percent:60});const O=new Zl;for(const X of V.files)X.content,O.file(X.path,X.content);x({status:"Generating download...",percent:80});const B=await O.generateAsync({type:"blob"}),Y=l==="ocfl"?`ocfl-${new Date().toISOString().split("T")[0]}.zip`:`bagit-${new Date().toISOString().split("T")[0]}.zip`;Yc.saveAs(B,Y),x({status:"Complete!",percent:100}),await new Promise(X=>setTimeout(X,500)),t()}catch(U){N(U.message||`Failed to create ${l.toUpperCase()} package`),i("archival-config")}}},q=A.filter(U=>U.level==="error"),G=e?(U=>{const V=[],O=B=>{zt(B)&&V.push({id:B.id,label:Le(B.label)||B.id.split("/").pop()||"Untitled"}),B.items?.forEach(Y=>{(Mt(Y)||zt(Y))&&O(Y)})};return O(U),V})(e):[],te=U=>{L(V=>V.featured.includes(U)?{...V,featured:V.featured.filter(B=>B!==U)}:V.featured.length<6?{...V,featured:[...V.featured,U]}:V)};return a.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",role:"none",children:a.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"export-dialog-title",className:`bg-white rounded-3xl shadow-2xl transition-all duration-500 overflow-hidden flex flex-col ${n==="dry-run"?"max-w-5xl w-full":"max-w-md w-full"}`,children:[a.jsxs("div",{className:"p-6 border-b flex justify-between items-center bg-slate-50",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-iiif-blue rounded-xl flex items-center justify-center text-white shadow-lg",children:a.jsx($,{name:"publish"})}),a.jsxs("div",{children:[a.jsx("h2",{id:"export-dialog-title",className:"text-lg font-black text-slate-800 uppercase tracking-tighter",children:"Archive Export"}),a.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:n==="config"?"Step 1: Format Selection":n==="canopy-config"?"Step 2: Site Configuration":n==="archival-config"?"Step 2: Package Configuration":n==="dry-run"?"Step 2: Integrity & Preview":"Step 3: Generating"})]})]}),n!=="exporting"&&a.jsx("button",{onClick:t,"aria-label":"Close dialog",className:"p-2 hover:bg-slate-200 rounded-full text-slate-400 transition-colors",children:a.jsx($,{name:"close"})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-8",children:[v&&a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-4 text-red-800 text-sm mb-6 flex gap-3 animate-in shake",role:"alert",children:[a.jsx($,{name:"error",className:"shrink-0 mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-bold mb-1 uppercase tracking-tighter",children:"Integrity Failure"}),a.jsx("p",{className:"opacity-80",children:v})]})]}),n==="config"&&a.jsxs("div",{className:"space-y-8 animate-in slide-in-from-right-4",children:[a.jsx(s5,{id:"export-intro",message:"Choose how to package your archive. Canopy creates a ready-to-deploy website. Raw IIIF gives you just the JSON files.",icon:"info",className:"mb-4"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",role:"radiogroup","aria-labelledby":"export-format-label",children:[a.jsx("span",{id:"export-format-label",className:"sr-only",children:"Choose Export Format"}),a.jsxs("button",{role:"radio","aria-checked":l==="canopy",className:`p-5 rounded-2xl border-2 text-left transition-all relative group ${l==="canopy"?"border-iiif-blue bg-blue-50":"border-slate-100 hover:border-slate-200"}`,onClick:()=>o("canopy"),children:[a.jsx($,{name:"public",className:`text-2xl mb-3 ${l==="canopy"?"text-iiif-blue":"text-slate-400"}`}),a.jsx("div",{className:"font-bold text-sm text-slate-800 mb-1",children:"Canopy IIIF Site"}),a.jsx("p",{className:"text-[10px] text-slate-500 leading-tight",children:"Modern Next.js static site with search, mapping, and themes."}),l==="canopy"&&a.jsx("div",{className:"absolute top-4 right-4 text-iiif-blue",children:a.jsx($,{name:"check_circle"})})]}),a.jsxs("button",{role:"radio","aria-checked":l==="raw-iiif",className:`p-5 rounded-2xl border-2 text-left transition-all relative group ${l==="raw-iiif"?"border-iiif-blue bg-blue-50":"border-slate-100 hover:border-slate-200"}`,onClick:()=>o("raw-iiif"),children:[a.jsx($,{name:"code",className:`text-2xl mb-3 ${l==="raw-iiif"?"text-iiif-blue":"text-slate-400"}`}),a.jsx("div",{className:"font-bold text-sm text-slate-800 mb-1",children:"Raw IIIF"}),a.jsx("p",{className:"text-[10px] text-slate-500 leading-tight",children:"JSON documents and assets only."}),l==="raw-iiif"&&a.jsx("div",{className:"absolute top-4 right-4 text-iiif-blue",children:a.jsx($,{name:"check_circle"})})]})]}),a.jsxs("div",{children:[a.jsxs("h3",{className:"text-xs font-black text-slate-500 uppercase tracking-widest mb-3 flex items-center gap-2",children:[a.jsx($,{name:"archive",className:"text-sm"})," Digital Preservation"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("button",{role:"radio","aria-checked":l==="ocfl",className:`p-5 rounded-2xl border-2 text-left transition-all relative group ${l==="ocfl"?"border-amber-600 bg-amber-50":"border-slate-100 hover:border-slate-200"}`,onClick:()=>o("ocfl"),children:[a.jsx($,{name:"inventory_2",className:`text-2xl mb-3 ${l==="ocfl"?"text-amber-600":"text-slate-400"}`}),a.jsx("div",{className:"font-bold text-sm text-slate-800 mb-1",children:"OCFL Package"}),a.jsx("p",{className:"text-[10px] text-slate-500 leading-tight",children:"Oxford Common File Layout 1.1 with versioning."}),l==="ocfl"&&a.jsx("div",{className:"absolute top-4 right-4 text-amber-600",children:a.jsx($,{name:"check_circle"})})]}),a.jsxs("button",{role:"radio","aria-checked":l==="bagit",className:`p-5 rounded-2xl border-2 text-left transition-all relative group ${l==="bagit"?"border-purple-600 bg-purple-50":"border-slate-100 hover:border-slate-200"}`,onClick:()=>o("bagit"),children:[a.jsx($,{name:"shopping_bag",className:`text-2xl mb-3 ${l==="bagit"?"text-purple-600":"text-slate-400"}`}),a.jsx("div",{className:"font-bold text-sm text-slate-800 mb-1",children:"BagIt Bag"}),a.jsx("p",{className:"text-[10px] text-slate-500 leading-tight",children:"RFC 8493 compliant with checksums."}),l==="bagit"&&a.jsx("div",{className:"absolute top-4 right-4 text-purple-600",children:a.jsx($,{name:"check_circle"})})]})]})]}),a.jsxs("div",{children:[a.jsxs("h3",{className:"text-xs font-black text-slate-500 uppercase tracking-widest mb-3 flex items-center gap-2",children:[a.jsx($,{name:"history",className:"text-sm"})," Change Tracking"]}),a.jsxs("button",{role:"radio","aria-checked":l==="activity-log",className:`p-5 rounded-2xl border-2 text-left transition-all relative group w-full ${l==="activity-log"?"border-cyan-600 bg-cyan-50":"border-slate-100 hover:border-slate-200"}`,onClick:()=>o("activity-log"),children:[a.jsx($,{name:"sync_alt",className:`text-2xl mb-3 ${l==="activity-log"?"text-cyan-600":"text-slate-400"}`}),a.jsx("div",{className:"font-bold text-sm text-slate-800 mb-1",children:"Activity Log (Change Discovery)"}),a.jsx("p",{className:"text-[10px] text-slate-500 leading-tight",children:"IIIF Change Discovery API 1.0 format. Tracks all create/update/delete operations for sync."}),l==="activity-log"&&a.jsx("div",{className:"absolute top-4 right-4 text-cyan-600",children:a.jsx($,{name:"check_circle"})})]})]}),l==="canopy"&&a.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-2xl",children:[a.jsxs("div",{className:"flex items-center gap-2 text-blue-800 font-bold text-sm mb-2",children:[a.jsx($,{name:"auto_awesome"})," Plug & Play Compatible"]}),a.jsxs("p",{className:"text-xs text-blue-700",children:["Generates a ",a.jsx("code",{children:"canopy-export"})," package ready to drop into the Canopy IIIF template. Includes ",a.jsx("code",{children:"canopy.yml"})," configuration and correctly structured IIIF data."]})]}),l!=="canopy"&&a.jsxs("label",{className:"flex items-center gap-4 p-5 bg-slate-50 rounded-2xl border border-slate-100 cursor-pointer group hover:bg-slate-100 transition-colors",children:[a.jsx("input",{type:"checkbox",checked:u,onChange:U=>d(U.target.checked),className:"w-6 h-6 text-iiif-blue rounded-lg border-slate-300 focus:ring-iiif-blue"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-bold text-sm text-slate-700",children:"Include Physical Assets"}),a.jsx("div",{className:"text-xs text-slate-500",children:"Zip images and media files along with metadata."})]})]})]}),n==="archival-config"&&a.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx($,{name:l==="ocfl"?"inventory_2":"shopping_bag",className:`text-4xl mb-2 ${l==="ocfl"?"text-amber-600":"text-purple-600"}`}),a.jsx("h3",{className:"text-lg font-bold text-slate-800",children:l==="ocfl"?"OCFL Package Settings":"BagIt Bag Settings"}),a.jsx("p",{className:"text-sm text-slate-500",children:"Configure your digital preservation package"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"Digest Algorithm"}),a.jsxs("select",{value:R.digestAlgorithm||"sha256",onChange:U=>z({...R,digestAlgorithm:U.target.value}),className:"w-full border rounded-lg p-2 text-sm",children:[a.jsx("option",{value:"sha256",children:"SHA-256 (Recommended)"}),a.jsx("option",{value:"sha512",children:"SHA-512"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"Organization"}),a.jsx("input",{type:"text",value:R.organization||"",onChange:U=>z({...R,organization:U.target.value}),className:"w-full border rounded-lg p-2 text-sm",placeholder:"Your Institution"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"Description"}),a.jsx("textarea",{value:R.description||"",onChange:U=>z({...R,description:U.target.value}),className:"w-full border rounded-lg p-2 text-sm",rows:2,placeholder:"Description of this archival package..."})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"External Identifier"}),a.jsx("input",{type:"text",value:R.externalId||"",onChange:U=>z({...R,externalId:U.target.value}),className:"w-full border rounded-lg p-2 text-sm",placeholder:"Optional external ID"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"Version Message"}),a.jsx("input",{type:"text",value:R.versionMessage||"",onChange:U=>z({...R,versionMessage:U.target.value}),className:"w-full border rounded-lg p-2 text-sm",placeholder:"Initial version"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"User Name"}),a.jsx("input",{type:"text",value:R.user?.name||"",onChange:U=>z({...R,user:{...R.user,name:U.target.value}}),className:"w-full border rounded-lg p-2 text-sm",placeholder:"Your name"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"User Email"}),a.jsx("input",{type:"email",value:R.user?.email||"",onChange:U=>z({...R,user:{...R.user,email:U.target.value}}),className:"w-full border rounded-lg p-2 text-sm",placeholder:"your@email.com"})]})]}),a.jsxs("label",{className:"flex items-center gap-3 cursor-pointer p-4 bg-slate-50 rounded-xl border",children:[a.jsx("input",{type:"checkbox",checked:R.includeMedia??!0,onChange:U=>z({...R,includeMedia:U.target.checked}),className:`rounded ${l==="ocfl"?"text-amber-600":"text-purple-600"}`}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-bold text-slate-700",children:"Include Media Files"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Bundle original images/audio/video with the package"})]})]}),a.jsxs("div",{className:`p-4 rounded-xl border ${l==="ocfl"?"bg-amber-50 border-amber-200":"bg-purple-50 border-purple-200"}`,children:[a.jsxs("div",{className:`flex items-center gap-2 font-bold text-sm mb-2 ${l==="ocfl"?"text-amber-800":"text-purple-800"}`,children:[a.jsx($,{name:"info"})," About ",l==="ocfl"?"OCFL":"BagIt"]}),a.jsx("p",{className:`text-xs ${l==="ocfl"?"text-amber-700":"text-purple-700"}`,children:l==="ocfl"?"OCFL (Oxford Common File Layout) is a specification for storing digital objects in repositories with versioning, fixity, and long-term preservation in mind.":"BagIt is a hierarchical file packaging format for storage and transfer of arbitrary digital content. It includes manifest files with checksums for integrity verification."})]})]}),n==="canopy-config"&&a.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx($,{name:"public",className:"text-4xl text-iiif-blue mb-2"}),a.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Canopy Configuration"}),a.jsx("p",{className:"text-sm text-slate-500",children:"Configure your site settings and visual theme"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"Site Title"}),a.jsx("input",{type:"text",value:T.title,onChange:U=>L({...T,title:U.target.value}),className:"w-full border rounded-lg p-2 text-sm",placeholder:"My Collection"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"Base URL"}),a.jsx("input",{type:"text",value:T.baseUrl,onChange:U=>L({...T,baseUrl:U.target.value}),className:"w-full border rounded-lg p-2 text-sm",placeholder:"Optional (e.g. https://...)"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"IIIF Server Port"}),a.jsx("input",{type:"number",value:T.port||8765,onChange:U=>L({...T,port:parseInt(U.target.value)||8765}),className:"w-full border rounded-lg p-2 text-sm",min:1024,max:65535,placeholder:"8765"}),a.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Change if port 8765 is in use"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Theme Colors"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-slate-500 block mb-1",children:"Accent Color"}),a.jsx("select",{value:T.theme.accentColor,onChange:U=>L({...T,theme:{...T.theme,accentColor:U.target.value}}),className:"w-full border rounded-lg p-2 text-sm capitalize",children:["indigo","violet","purple","plum","pink","tomato","orange","amber","lime","grass","teal","cyan"].map(U=>a.jsx("option",{value:U,children:U},U))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-slate-500 block mb-1",children:"Background Tone"}),a.jsx("select",{value:T.theme.grayColor,onChange:U=>L({...T,theme:{...T.theme,grayColor:U.target.value}}),className:"w-full border rounded-lg p-2 text-sm capitalize",children:["slate","gray","zinc","neutral","stone","sand","mauve","olive","sage"].map(U=>a.jsx("option",{value:U,children:U},U))})]})]})]}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-slate-50 p-3 rounded-lg border border-slate-200 flex-1",children:[a.jsx("input",{type:"checkbox",checked:T.theme.appearance==="dark",onChange:U=>L({...T,theme:{...T.theme,appearance:U.target.checked?"dark":"light"}}),className:"rounded text-iiif-blue"}),a.jsx("span",{className:"text-sm text-slate-700",children:"Dark Mode Default"})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-slate-50 p-3 rounded-lg border border-slate-200 flex-1",children:[a.jsx("input",{type:"checkbox",checked:T.search.enabled,onChange:U=>L({...T,search:{...T.search,enabled:U.target.checked}}),className:"rounded text-iiif-blue"}),a.jsx("span",{className:"text-sm text-slate-700",children:"Enable Search"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Image Processing Options"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-slate-50 p-3 rounded-lg border border-slate-200",children:[a.jsx("input",{type:"checkbox",checked:H.includeWebP,onChange:U=>k({...H,includeWebP:U.target.checked}),className:"rounded text-iiif-blue"}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm text-slate-700",children:"WebP Format"}),a.jsx("p",{className:"text-[10px] text-slate-400",children:"Smaller file sizes"})]})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-slate-50 p-3 rounded-lg border border-slate-200",children:[a.jsx("input",{type:"checkbox",checked:H.includeGrayscale,onChange:U=>k({...H,includeGrayscale:U.target.checked}),className:"rounded text-iiif-blue"}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm text-slate-700",children:"Grayscale"}),a.jsx("p",{className:"text-[10px] text-slate-400",children:"Gray quality option"})]})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-slate-50 p-3 rounded-lg border border-slate-200",children:[a.jsx("input",{type:"checkbox",checked:H.includeSquare,onChange:U=>k({...H,includeSquare:U.target.checked}),className:"rounded text-iiif-blue"}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm text-slate-700",children:"Square Crops"}),a.jsx("p",{className:"text-[10px] text-slate-400",children:"For thumbnails"})]})]}),a.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 p-3 rounded-lg border border-slate-200",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:"text-sm text-slate-700",children:"Tile Size"}),a.jsx("p",{className:"text-[10px] text-slate-400",children:"Deep zoom tiles"})]}),a.jsxs("select",{value:H.tileSize||512,onChange:U=>k({...H,tileSize:parseInt(U.target.value)}),className:"border rounded p-1 text-sm w-20",children:[a.jsx("option",{value:256,children:"256"}),a.jsx("option",{value:512,children:"512"}),a.jsx("option",{value:1024,children:"1024"})]})]})]})]}),G.length>0&&a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:["Featured Items ",a.jsxs("span",{className:"font-normal text-slate-400",children:["(",T.featured.length,"/6 selected)"]})]}),a.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"Select up to 6 manifests to feature on the homepage."}),a.jsx("div",{className:"max-h-48 overflow-y-auto border border-slate-200 rounded-lg divide-y divide-slate-100",children:G.map(U=>a.jsxs("label",{className:`flex items-center gap-3 p-3 cursor-pointer hover:bg-slate-50 transition-colors ${T.featured.includes(U.id)?"bg-blue-50":""} ${!T.featured.includes(U.id)&&T.featured.length>=6?"opacity-50 cursor-not-allowed":""}`,children:[a.jsx("input",{type:"checkbox",checked:T.featured.includes(U.id),onChange:()=>te(U.id),disabled:!T.featured.includes(U.id)&&T.featured.length>=6,className:"rounded text-iiif-blue"}),a.jsx("span",{className:"text-sm text-slate-700 truncate flex-1",children:U.label}),T.featured.includes(U.id)&&a.jsxs("span",{className:"text-xs text-iiif-blue font-medium",children:["#",T.featured.indexOf(U.id)+1]})]},U.id))})]})]}),n==="dry-run"&&a.jsx("div",{className:"space-y-6 animate-in fade-in duration-500",children:p?a.jsxs("div",{className:"h-[500px] flex flex-col items-center justify-center gap-4 text-slate-400","aria-live":"polite",children:[a.jsx("div",{className:"w-12 h-12 border-4 border-slate-100 border-t-iiif-blue rounded-full animate-spin"}),a.jsx("p",{className:"text-xs font-black uppercase tracking-widest",children:"Synthesizing Archive DNA..."})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex gap-4 mb-4",children:[a.jsxs("div",{className:`flex-1 p-4 rounded-2xl border-2 flex items-center gap-4 ${q.length>0?"bg-red-50 border-red-200 text-red-700":"bg-green-50 border-green-200 text-green-700"}`,children:[a.jsx($,{name:q.length>0?"error":"verified",className:"text-2xl"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-bold text-sm",children:q.length>0?`${q.length} Critical Issues`:"Spec Compliance: Valid"}),a.jsx("p",{className:"text-[10px] opacity-75",children:q.length>0?"Fix issues below to ensure interoperability.":"Archive meets IIIF Presentation 3.0 standards."})]})]}),a.jsxs("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-2xl flex flex-col justify-center min-w-[120px]",children:[a.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase",children:"Package Size"}),a.jsxs("span",{className:"text-sm font-bold text-slate-700",children:["~",u?"Calculated":"Small"]})]})]}),a.jsx(e5,{files:j}),q.length>0&&a.jsxs("div",{className:"mt-4 p-4 bg-amber-50 rounded-2xl border border-amber-100 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx($,{name:"warning",className:"text-amber-600"}),a.jsx("span",{className:"text-xs font-medium text-amber-900",children:"Archive has critical issues. You must fix them or override integrity."})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-white px-3 py-1.5 rounded-lg border border-amber-200 shadow-sm",children:[a.jsx("input",{type:"checkbox",checked:m,onChange:U=>h(U.target.checked),className:"rounded text-amber-600"}),a.jsx("span",{className:"text-[9px] font-black uppercase text-amber-700",children:"Ignore Errors"})]})]})]})}),n==="exporting"&&a.jsxs("div",{className:"text-center py-12 space-y-6",children:[a.jsxs("div",{className:"relative w-24 h-24 mx-auto","aria-live":"polite",children:[a.jsx("div",{className:"absolute inset-0 border-8 border-slate-100 rounded-full"}),a.jsx("div",{className:"absolute inset-0 border-8 border-iiif-blue rounded-full transition-all duration-300",style:{clipPath:`polygon(50% 50%, -50% -50%, ${y.percent}% -50%, ${y.percent}% 150%, -50% 150%)`,transform:"rotate(-90deg)"}}),a.jsxs("div",{className:"absolute inset-0 flex items-center justify-center font-black text-iiif-blue",children:[Math.round(y.percent),"%"]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold text-slate-800",children:y.status}),a.jsx("p",{className:"text-xs text-slate-500 mt-1 uppercase tracking-widest font-black",children:"Archive Compression Engine"})]})]})]}),a.jsxs("div",{className:"p-6 bg-slate-50 border-t flex justify-between items-center shrink-0",children:[n==="config"&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:t,className:"px-6 py-2 text-slate-400 font-bold hover:text-slate-600 transition-colors uppercase tracking-widest text-xs",children:"Cancel"}),a.jsxs("button",{onClick:()=>{l==="canopy"?i("canopy-config"):l==="ocfl"||l==="bagit"?i("archival-config"):l==="activity-log"?D():i("dry-run")},className:`text-white px-10 py-3 rounded-2xl font-black uppercase tracking-widest text-xs shadow-xl flex items-center gap-2 transition-all active:scale-95 ${l==="activity-log"?"bg-cyan-600 hover:bg-cyan-700":"bg-iiif-blue hover:bg-blue-700"}`,children:[l==="canopy"?"Configure Site":l==="ocfl"||l==="bagit"?"Configure Package":l==="activity-log"?"Export Log":"Start Dry Run"," ",a.jsx($,{name:l==="activity-log"?"download":"arrow_forward"})]})]}),n==="archival-config"&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>i("config"),className:"px-6 py-2 text-slate-400 font-bold hover:text-slate-600 transition-colors uppercase tracking-widest text-xs",children:"Back"}),a.jsxs("button",{onClick:E,className:`text-white px-10 py-3 rounded-2xl font-black uppercase tracking-widest text-xs shadow-xl flex items-center gap-2 transition-all active:scale-95 ${l==="ocfl"?"bg-amber-600 hover:bg-amber-700":"bg-purple-600 hover:bg-purple-700"}`,children:["Export ",l.toUpperCase()," ",a.jsx($,{name:"download"})]})]}),n==="canopy-config"&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>i("config"),className:"px-6 py-2 text-slate-400 font-bold hover:text-slate-600 transition-colors uppercase tracking-widest text-xs",children:"Back"}),a.jsxs("button",{onClick:I,className:"bg-iiif-blue text-white px-10 py-3 rounded-2xl font-black uppercase tracking-widest text-xs hover:bg-blue-700 shadow-xl flex items-center gap-2 transition-all active:scale-95",children:["Generate Site Config ",a.jsx($,{name:"arrow_forward"})]})]}),n==="dry-run"&&!p&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>i("config"),className:"px-6 py-2 text-slate-400 font-bold hover:text-slate-600 transition-colors uppercase tracking-widest text-xs",children:"Back to Settings"}),a.jsxs("button",{onClick:K,disabled:q.length>0&&!m,className:"bg-green-600 text-white px-10 py-3 rounded-2xl font-black uppercase tracking-widest text-xs hover:bg-green-700 shadow-xl flex items-center gap-2 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:["Finalize & Download ZIP ",a.jsx($,{name:"download"})]})]})]})]})})},l5=[{icon:"folder_open",label:"Open folder",description:"Drag a folder onto the window to ingest files"},{icon:"upload_file",label:"Add files",shortcut:"Cmd+O",description:"Select individual files to add"},{icon:"auto_awesome",label:"Auto-organize",description:"Folder names become Collections automatically"},{icon:"photo_camera",label:"Extract metadata",description:"EXIF data like GPS and dates are captured"}],o5=[{icon:"add",label:"Add item",shortcut:"N",description:"Create a new Manifest or Collection"},{icon:"drag_indicator",label:"Reorder",description:"Drag items to reorganize hierarchy"},{icon:"content_copy",label:"Duplicate",shortcut:"Cmd+D",description:"Clone selected item"},{icon:"delete",label:"Delete",shortcut:"Del",description:"Remove selected item"},{icon:"expand_more",label:"Expand all",shortcut:"Cmd+E",description:"Show all nested items"}],c5=[{icon:"zoom_in",label:"Zoom",shortcut:"Scroll",description:"Scroll to zoom in/out"},{icon:"pan_tool",label:"Pan",shortcut:"Space+Drag",description:"Hold space and drag to pan"},{icon:"draw",label:"Annotate",shortcut:"A",description:"Draw annotations on the canvas"},{icon:"info",label:"Inspector",shortcut:"I",description:"Toggle metadata inspector"},{icon:"fullscreen",label:"Fullscreen",shortcut:"F",description:"Enter fullscreen mode"}],u5=[{icon:"near_me",label:"Select",shortcut:"V",description:"Select and move items"},{icon:"pan_tool",label:"Pan",shortcut:"H",description:"Pan the board view"},{icon:"link",label:"Connect",shortcut:"C",description:"Draw connections between items"},{icon:"sticky_note_2",label:"Note",shortcut:"T",description:"Add a text note"},{icon:"content_copy",label:"Duplicate",shortcut:"Cmd+D",description:"Clone selected item"},{icon:"undo",label:"Undo",shortcut:"Cmd+Z",description:"Undo last action"}],d5=[{icon:"edit",label:"Edit cell",shortcut:"Enter",description:"Press Enter to edit selected cell"},{icon:"tab",label:"Next cell",shortcut:"Tab",description:"Move to next cell"},{icon:"view_column",label:"Add column",description:"Click + to add a metadata field"},{icon:"filter_list",label:"Filter",description:"Type in column header to filter"},{icon:"download",label:"Export CSV",description:"Export metadata as spreadsheet"}],f5={archive:{title:"Welcome to the Archive",body:"This is where you import and organize your raw files. Drag folders to create structure automatically.",tips:["Folder names become Collection labels","GPS and date metadata is extracted from photos","Supported formats: images, audio, video, PDFs"]},structure:{title:"Structure View",body:"See and edit the IIIF hierarchy. Drag items to reorganize, right-click for options.",tips:["Collections contain Manifests","Manifests contain Canvases","Use Ranges to create a table of contents"]},viewer:{title:"Viewer Workbench",body:"Deep inspection mode. Zoom, pan, and annotate your content.",tips:["Scroll to zoom, drag to pan","Press A to start annotating","Annotations are saved with the image"]},board:{title:"Board View",body:"A freeform canvas for visual thinking. Arrange items spatially and draw connections.",tips:["Drag items from the tree to add them","Press C to draw connections","Export the board as a new Manifest"]}},h5=({mode:e})=>{const[t,n]=S.useState(!1),[i,l]=S.useState(null);S.useEffect(()=>{const u=`intro-${e}`,d=f5[e];if(d&&!Ka.hasSeen(u)){l(d);const m=setTimeout(()=>n(!0),300);return()=>clearTimeout(m)}else n(!1),l(null)},[e]);const o=()=>{const u=`intro-${e}`;Ka.markSeen(u),n(!1)};return!t||!i?null:a.jsx("div",{className:"mx-4 mt-4 mb-2 animate-in slide-in-from-top-2 duration-300",children:a.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-100 rounded-xl p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center shrink-0",children:a.jsx($,{name:"lightbulb",className:"text-blue-600 text-sm"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"text-sm font-semibold text-slate-800 mb-1",children:i.title}),a.jsx("p",{className:"text-xs text-slate-600 leading-relaxed mb-2",children:i.body}),i.tips&&i.tips.length>0&&a.jsx("ul",{className:"space-y-1",children:i.tips.slice(0,2).map((u,d)=>a.jsxs("li",{className:"flex items-center gap-1.5 text-[11px] text-slate-500",children:[a.jsx($,{name:"check",className:"text-green-500 text-[10px]"}),u]},d))})]}),a.jsx("button",{onClick:o,className:"text-slate-400 hover:text-slate-600 p-1 shrink-0",title:"Dismiss",children:a.jsx($,{name:"close",className:"text-sm"})})]})})})},Hs=({urls:e,size:t="md",className:n="",icon:i="image",placeholderBg:l="bg-slate-100"})=>{const[o,u]=S.useState(new Set),d=S.useCallback(g=>{u(y=>new Set([...y,g]))},[]),m={xs:"w-6 h-6 rounded",sm:"w-10 h-10 rounded-lg",md:"w-16 h-16 rounded-xl",lg:"w-24 h-24 rounded-2xl",xl:"w-32 h-32 rounded-3xl"},h=e.filter(g=>g&&!o.has(g)),p=h.length;return p===0?a.jsx("div",{className:`${m[t]} ${l} flex items-center justify-center shrink-0 overflow-hidden border border-slate-200/50 ${n}`,children:a.jsx($,{name:i,className:"text-slate-300"})}):p===1?a.jsx("div",{className:`${m[t]} bg-slate-900 shrink-0 overflow-hidden border border-slate-200/50 ${n}`,children:a.jsx("img",{src:h[0],alt:"",className:"w-full h-full object-cover",loading:"lazy",onError:()=>d(h[0])})}):a.jsxs("div",{className:`${m[t]} bg-slate-200 shrink-0 overflow-hidden border border-slate-200/50 grid grid-cols-2 grid-rows-2 gap-0.5 ${n}`,children:[h.slice(0,4).map((g,y)=>a.jsx("div",{className:`bg-slate-900 ${p===2&&y===0?"col-span-1 row-span-2":""} ${p===2&&y===1?"col-span-1 row-span-2":""} ${p===3&&y===0?"col-span-2 row-span-1":""}`,children:a.jsx("img",{src:g,alt:"",className:"w-full h-full object-cover",loading:"lazy",onError:()=>d(g)})},y)),p===3&&a.jsx("div",{className:"bg-slate-800 flex items-center justify-center",children:a.jsx($,{name:i,className:"text-[10px] text-slate-600"})})]})},m5=["Title","Creator","Date","Description","Subject","Rights","Source","Type","Format","Identifier","Language","Coverage","Publisher","Contributor","Relation"],p5=[{id:"Identity",icon:"fingerprint",label:"Identity & IDs"},{id:"Structure",icon:"account_tree",label:"Hierarchy"},{id:"Metadata",icon:"label",label:"Labels & Descriptive"},{id:"Content",icon:"image",label:"Media & Technical"}],g5=({issuesMap:e,totalItems:t,root:n,onSelect:i,onUpdate:l,onClose:o})=>{const[u,d]=S.useState("Identity"),[m,h]=S.useState(null),[p,g]=S.useState(!1);S.useEffect(()=>{const P=K=>{K.key==="Escape"&&o()};return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[o]);const y=S.useMemo(()=>Object.values(e).flat(),[e]),x=S.useMemo(()=>y.filter(P=>P.category===u),[y,u]),v=y.filter(P=>P.level==="error"),N=t>0?Math.max(0,Math.round((t-v.length)/t*100)):100;S.useEffect(()=>{m&&!y.some(P=>P.id===m)&&h(null)},[y,m]);const j=S.useMemo(()=>y.find(P=>P.id===m),[y,m]),C=S.useRef(new Map),A=S.useCallback(P=>{const K=C.current.get(P);if(K)return K;if(!n)return{item:null,path:[]};const I=[];let D=null;const E=new Set,q=(G,te)=>{if(E.has(G.id))return!1;E.add(G.id);const U={id:G.id,label:Le(G.label)||"Untitled",type:G.type};if(G.id===P)return D=G,I.push(...te,U),!0;const V=G.items||G.annotations||[];for(const O of V)if(q(O,[...te,U]))return!0;return!1};q(n,[]);const W={item:D,path:I};return C.current.set(P,W),W},[n]);S.useEffect(()=>{C.current.clear()},[n]);const{item:_,path:T}=S.useMemo(()=>j?A(j.itemId):{item:null,path:[]},[j,n]),L=(P,K)=>{if(!n)return;const I=JSON.parse(JSON.stringify(n)),D=new Set,E=q=>{if(D.has(q.id))return!1;if(D.add(q.id),q.id===P)return Object.assign(q,K),!0;const W=q.items||q.annotations||q.structures||[];for(const G of W)if(E(G))return!0;return!1};E(I)&&l(I)},H=S.useCallback(P=>{if(n)try{const{item:K}=A(P.itemId);if(!K){console.warn("[QCDashboard] Could not find item to heal:",P.itemId);return}const I=$u(K,P);if(I.success&&I.updatedItem){const D=Bm(n,P.itemId,I.updatedItem);D?l(D):console.error("[QCDashboard] Failed to apply heal to tree")}else I.error&&console.error("[QCDashboard] Healing failed:",I.error)}catch(K){console.error("[QCDashboard] Exception during healing:",K)}},[n,A,l]),k=S.useCallback(()=>{if(!n)return;const P=x.filter(E=>E.fixable);if(P.length===0)return;let K=n,I=0,D=0;for(const E of P)try{const{item:q}=A(E.itemId);if(!q){D++;continue}const W=Y1(q,[E]);if(W.success&&W.updatedItem){const G=Bm(K,E.itemId,W.updatedItem);G?(K=G,I++):D++}else D++,W.error&&console.error("[QCDashboard] Batch healing failed for issue:",E.id,W.error)}catch(q){D++,console.error("[QCDashboard] Exception during batch healing:",q)}I>0&&(l(K),console.log(`[QCDashboard] Batch healing complete: ${I} healed, ${D} failed`))},[n,x,A,l]),R=(P,K)=>{if(!_||!_.metadata)return;const I=[..._.metadata];I.splice(K,1),L(P,{metadata:I})},z=(P,K)=>{if(!_)return;const I=[..._.metadata||[],{label:{en:[K]},value:{en:[""]}}];L(P,{metadata:I}),g(!1)};return a.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-xl z-[600] flex items-center justify-center p-8 animate-in fade-in duration-300",onClick:P=>{P.target===P.currentTarget&&o()},children:a.jsxs("div",{className:"bg-white w-full max-w-[1400px] h-[90vh] rounded-3xl shadow-2xl flex overflow-hidden border border-slate-200",children:[a.jsxs("div",{className:"w-64 bg-slate-50 border-r flex flex-col shrink-0",children:[a.jsxs("div",{className:"p-6 border-b",children:[a.jsxs("div",{className:`w-12 h-12 rounded-xl flex flex-col items-center justify-center shadow-lg mb-4 ${N>80?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[a.jsxs("span",{className:"text-lg font-black leading-none",children:[N,"%"]}),a.jsx("span",{className:"text-[7px] font-black uppercase tracking-widest",children:"Health"})]}),a.jsx("h2",{className:"text-sm font-black text-slate-800 uppercase tracking-widest",children:"Integrity Guard"})]}),a.jsx("div",{className:"flex-1 p-3 space-y-1",children:p5.map(P=>{const K=y.filter(I=>I.category===P.id).length;return a.jsxs("button",{onClick:()=>d(P.id),className:`w-full flex items-center justify-between px-4 py-3 rounded-xl transition-all ${u===P.id?"bg-white shadow-md text-iiif-blue font-bold ring-1 ring-slate-200":"text-slate-500 hover:bg-slate-200/50"}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx($,{name:P.icon,className:"text-sm"}),a.jsx("span",{className:"text-xs uppercase tracking-wider",children:P.label})]}),K>0&&a.jsx("span",{className:`text-[10px] px-1.5 rounded-full font-bold ${K>5?"bg-red-100 text-red-600":"bg-slate-200 text-slate-600"}`,children:K})]},P.id)})}),a.jsxs("div",{className:"p-4 bg-slate-900 text-white flex flex-col gap-1",children:[a.jsx("span",{className:"text-[8px] font-black uppercase text-white/40 tracking-widest",children:"Global Status"}),a.jsxs("span",{className:"text-[10px] font-bold text-green-400 flex items-center gap-1",children:[a.jsx($,{name:"verified",className:"text-xs"})," ",t," Resources Monitored"]})]})]}),a.jsxs("div",{className:"flex-1 flex flex-col bg-white overflow-hidden min-w-0 border-r border-slate-100",children:[a.jsxs("div",{className:"p-6 border-b flex justify-between items-center bg-slate-50/50",children:[a.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[a.jsx($,{name:"list",className:"text-slate-400"}),"Detected Violations in ",u]}),a.jsx("button",{onClick:k,className:"text-[10px] font-black uppercase px-4 py-2 bg-iiif-blue text-white rounded-lg hover:bg-blue-700 shadow-md transition-all active:scale-95",children:"Heal All Fixable"})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar",children:x.length===0?a.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300",children:[a.jsx($,{name:"task_alt",className:"text-6xl mb-4 opacity-20"}),a.jsx("p",{className:"font-bold uppercase tracking-widest text-xs",children:"No issues in this category"})]}):x.map(P=>a.jsxs("div",{onClick:()=>h(P.id),className:`p-4 rounded-2xl border transition-all cursor-pointer group flex items-center justify-between ${m===P.id?"bg-blue-50 border-iiif-blue ring-2 ring-blue-100 shadow-lg":"bg-white border-slate-100 hover:border-slate-200"}`,children:[a.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:`text-[8px] font-black uppercase px-1.5 py-0.5 rounded ${P.level==="error"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:P.level}),a.jsx("span",{className:"text-[10px] font-bold text-slate-800 truncate",children:P.itemLabel})]}),a.jsx("p",{className:"text-xs text-slate-500 line-clamp-1",children:P.message})]}),P.fixable&&a.jsx("button",{onClick:K=>{K.stopPropagation(),H(P)},title:q1(P),className:"px-5 py-1.5 bg-green-600 text-white text-[9px] font-black uppercase rounded-lg opacity-0 group-hover:opacity-100 transition-all shadow hover:bg-green-700",children:"Fix It"})]},P.id))})]}),a.jsxs("div",{className:"w-[450px] bg-slate-50 flex flex-col shrink-0",children:[a.jsxs("div",{className:"p-6 border-b flex justify-between items-center bg-white shadow-sm",children:[a.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Archival Context & Tools"}),a.jsx("button",{onClick:o,className:"p-1 hover:bg-slate-100 rounded-full transition-colors",children:a.jsx($,{name:"close",className:"text-slate-400"})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar",children:j&&_?a.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-2",children:[a.jsxs("div",{className:"aspect-video bg-slate-900 rounded-2xl overflow-hidden border shadow-inner relative group ring-4 ring-white flex items-center justify-center",children:[a.jsx(Hs,{urls:Os(_,600),size:"xl",className:"w-full h-full",icon:"image_not_supported"}),a.jsxs("div",{className:"absolute top-2 right-2 bg-black/50 text-[8px] text-white px-1.5 py-0.5 rounded uppercase font-black tracking-widest",children:[_.type," Preview"]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:"Archive Hierarchy Trace"}),a.jsx("div",{className:"bg-white border rounded-xl overflow-hidden shadow-sm",children:T.map((P,K)=>a.jsxs("div",{style:{paddingLeft:K*12+12},className:`flex items-center gap-2 p-2 border-b last:border-b-0 ${K===T.length-1?"bg-blue-50 border-l-4 border-l-iiif-blue":"bg-white opacity-60"}`,children:[a.jsx($,{name:Mt(P)?"folder":zt(P)?"menu_book":"crop_original",className:`text-xs ${K===T.length-1?"text-iiif-blue":"text-slate-400"}`}),a.jsx("span",{className:`text-[10px] truncate ${K===T.length-1?"font-bold text-slate-800":"text-slate-500"}`,children:P.label})]},K))})]}),(u==="Metadata"||u==="Identity")&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:"Interactive Workbench"}),a.jsxs("div",{className:"bg-white border p-5 rounded-2xl space-y-4 shadow-sm",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase mb-1.5 block",children:"Resource Label"}),a.jsx("input",{value:Le(_.label),onChange:P=>L(_.id,{label:{none:[P.target.value]}}),className:"w-full text-xs p-2.5 bg-slate-50 border rounded-lg focus:ring-2 focus:ring-iiif-blue outline-none font-bold"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase mb-1.5 block",children:"Scientific Summary"}),a.jsx("textarea",{value:Le(_.summary),onChange:P=>L(_.id,{summary:{none:[P.target.value]}}),className:"w-full text-xs p-2.5 bg-slate-50 border rounded-lg focus:ring-2 focus:ring-iiif-blue outline-none font-medium min-h-[60px]",placeholder:"Provide a descriptive summary..."})]}),a.jsxs("div",{className:"pt-2 border-t",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase",children:"Archive Metadata"}),a.jsxs("div",{className:"relative",children:[a.jsxs("button",{onClick:()=>g(!p),className:"text-[9px] font-black uppercase text-iiif-blue hover:underline flex items-center gap-1",children:["Add Field ",a.jsx($,{name:"expand_more",className:"text-[10px]"})]}),p&&a.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white border border-slate-200 shadow-xl rounded-lg py-2 z-[700] min-w-[140px] max-h-[200px] overflow-y-auto custom-scrollbar",children:[m5.map(P=>a.jsx("button",{onClick:()=>z(_.id,P),className:"w-full px-4 py-1.5 text-left text-[10px] font-bold text-slate-600 hover:bg-blue-50 transition-colors",children:P},P)),a.jsx("div",{className:"border-t mt-1 pt-1",children:a.jsx("button",{onClick:()=>z(_.id,"New Field"),className:"w-full px-4 py-1.5 text-left text-[10px] font-black text-slate-400 hover:bg-slate-50 italic",children:"Custom..."})})]})]})]}),a.jsx("div",{className:"space-y-2",children:(_.metadata||[]).length===0?a.jsx("p",{className:"text-[10px] text-slate-400 italic",children:"No custom metadata tags."}):_.metadata.map((P,K)=>a.jsxs("div",{className:"flex gap-2 group/meta",children:[a.jsx("input",{value:Le(P.label),className:"w-1/3 text-[9px] font-black uppercase text-slate-500 bg-slate-50 border-none rounded p-1.5",onChange:I=>{if(!_.metadata)return;const D=JSON.parse(JSON.stringify(_.metadata));D[K].label={en:[I.target.value]},L(_.id,{metadata:D})}}),a.jsx("input",{value:Le(P.value),className:"flex-1 text-[10px] font-bold text-slate-700 bg-slate-50 border-none rounded p-1.5",onChange:I=>{if(!_.metadata)return;const D=JSON.parse(JSON.stringify(_.metadata));D[K].value={en:[I.target.value]},L(_.id,{metadata:D})}}),a.jsx("button",{onClick:()=>R(_.id,K),className:"text-slate-300 hover:text-red-500 opacity-0 group-hover/meta:opacity-100 transition-all",children:a.jsx($,{name:"close",className:"text-sm"})})]},K))})]})]})]}),a.jsxs("div",{className:"space-y-2 opacity-50 grayscale hover:grayscale-0 transition-all",children:[a.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:"Technical Signature"}),a.jsxs("div",{className:"bg-slate-900 p-4 rounded-2xl font-mono text-[9px] text-blue-300 leading-relaxed overflow-hidden border border-white/10 shadow-xl",children:[a.jsxs("p",{className:"text-white/40 mb-1",children:["// ",_.type," ID"]}),a.jsx("p",{className:"break-all text-green-400 mb-2",children:_.id}),a.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t border-white/10",children:[a.jsxs("span",{className:"text-white/40",children:["Children: ",(_.items||[]).length]}),a.jsxs("span",{className:"text-white/40",children:["Annotations: ",(_.annotations||[]).length]})]})]})]}),a.jsxs("button",{onClick:()=>{i(j.itemId),o()},className:"w-full bg-slate-800 text-white p-4 rounded-2xl text-xs font-black uppercase hover:bg-slate-700 transition-all flex items-center justify-center gap-2 shadow-xl",children:[a.jsx($,{name:"location_searching"})," Reveal in Workbench"]})]}):a.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 text-center p-8",children:[a.jsx("div",{className:"w-16 h-16 bg-white rounded-3xl flex items-center justify-center mb-6 shadow-md border rotate-3",children:a.jsx($,{name:"biotech",className:"text-3xl opacity-20 text-iiif-blue"})}),a.jsx("h4",{className:"text-sm font-black uppercase text-slate-400 tracking-tighter",children:"Diagnostic Panel Ready"}),a.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-400 mt-2 max-w-[200px]",children:"Select an issue from the list to begin structural repair"})]})}),a.jsx("div",{className:"p-4 bg-white border-t",children:a.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-xl border border-blue-100",children:[a.jsx($,{name:"auto_fix_high",className:"text-blue-500 text-sm mt-0.5"}),a.jsx("p",{className:"text-[10px] text-blue-800 leading-tight italic",children:"Direct healing allows you to patch standard violations without leaving the diagnostic dashboard."})]})})]})]})})},x5=({onComplete:e})=>{const[t,n]=S.useState(!1),i=()=>{e("simple")},l=o=>{e(o)};return a.jsx("div",{className:"fixed inset-0 bg-slate-900/80 z-[200] flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in duration-300",children:a.jsx("div",{className:"bg-white max-w-lg w-full rounded-2xl shadow-2xl overflow-hidden border border-slate-200",children:t?a.jsxs("div",{className:"p-8 animate-in slide-in-from-right-4 duration-300",children:[a.jsxs("button",{onClick:()=>n(!1),className:"flex items-center gap-1 text-slate-400 hover:text-slate-600 text-sm mb-4",children:[a.jsx($,{name:"arrow_back",className:"text-sm"}),"Back"]}),a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-1",children:"Choose your experience"}),a.jsx("p",{className:"text-sm text-slate-500",children:"You can change this anytime in Settings"})]}),a.jsxs("div",{className:"space-y-3 mb-6",children:[a.jsx("button",{onClick:()=>l("simple"),className:"w-full p-4 rounded-xl border-2 border-slate-200 hover:border-blue-300 hover:bg-blue-50/50 transition-all text-left group",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-2xl",children:""}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold text-slate-800",children:"Simple"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Focus on content, hide technical details"})]}),a.jsx($,{name:"arrow_forward",className:"text-slate-300 group-hover:text-blue-500 transition-colors"})]})}),a.jsx("button",{onClick:()=>l("standard"),className:"w-full p-4 rounded-xl border-2 border-slate-200 hover:border-blue-300 hover:bg-blue-50/50 transition-all text-left group",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-2xl",children:""}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold text-slate-800",children:"Standard"}),a.jsx("p",{className:"text-xs text-slate-500",children:"See file names, edit metadata properties"})]}),a.jsx($,{name:"arrow_forward",className:"text-slate-300 group-hover:text-blue-500 transition-colors"})]})}),a.jsx("button",{onClick:()=>l("advanced"),className:"w-full p-4 rounded-xl border-2 border-slate-200 hover:border-blue-300 hover:bg-blue-50/50 transition-all text-left group",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-2xl",children:""}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold text-slate-800",children:"Advanced"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Full IIIF control, JSON editing, custom IDs"})]}),a.jsx($,{name:"arrow_forward",className:"text-slate-300 group-hover:text-blue-500 transition-colors"})]})})]}),a.jsx("p",{className:"text-center text-[10px] text-slate-400",children:"This affects which fields and options are visible in the UI"})]}):a.jsxs("div",{className:"p-8 animate-in fade-in duration-300",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl mb-4 text-white shadow-lg",children:a.jsx($,{name:"auto_awesome",className:"text-2xl"})}),a.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Welcome to Field Studio"}),a.jsx("p",{className:"text-slate-500 text-sm leading-relaxed",children:"Turn your files into organized, shareable digital archives."})]}),a.jsxs("div",{className:"space-y-3 mb-8",children:[a.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-xl",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center shrink-0",children:a.jsx($,{name:"folder",className:"text-amber-600 text-sm"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-700",children:"Drag folders to import"}),a.jsx("p",{className:"text-xs text-slate-400",children:"Structure is preserved automatically"})]})]}),a.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-xl",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center shrink-0",children:a.jsx($,{name:"photo_camera",className:"text-green-600 text-sm"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-700",children:"Metadata extracted"}),a.jsx("p",{className:"text-xs text-slate-400",children:"GPS, dates, and camera info captured"})]})]}),a.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-xl",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center shrink-0",children:a.jsx($,{name:"public",className:"text-blue-600 text-sm"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-700",children:"Export to web"}),a.jsx("p",{className:"text-xs text-slate-400",children:"One-click shareable websites"})]})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("button",{onClick:i,className:"w-full bg-iiif-blue text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:["Get Started",a.jsx($,{name:"arrow_forward"})]}),a.jsx("button",{onClick:()=>n(!0),className:"w-full text-slate-500 px-6 py-2 rounded-xl text-sm hover:text-slate-700 hover:bg-slate-50 transition-colors",children:"I'm an advanced user - customize my experience"})]}),a.jsxs("p",{className:"text-center text-[10px] text-slate-400 mt-6",children:["Press ",a.jsx("kbd",{className:"px-1.5 py-0.5 bg-slate-100 rounded text-[9px] font-mono",children:"?"})," anytime for help"]})]})})})},b5=3e4,y5=({onImport:e,onClose:t,onAuthRequired:n})=>{const[i,l]=S.useState(""),[o,u]=S.useState(!1),[d,m]=S.useState(null),[h,p]=S.useState(null),g=An.useRef(null);An.useEffect(()=>()=>{g.current&&g.current.abort()},[]);const y=async()=>{if(!i)return;g.current&&g.current.abort();const v=new AbortController;g.current=v;const N=setTimeout(()=>v.abort(),b5);u(!0),m(null),p(null);try{const j=await GL(i,{signal:v.signal});if(WL(j)){n?n(j.resourceId,j.authServices):m("This resource requires authentication, but auth is not configured.");return}p(j.item)}catch(j){j.name==="AbortError"?m("Request timed out after 30 seconds. The server may be slow or unavailable."):m(j.message||"Failed to load manifest")}finally{clearTimeout(N),u(!1)}},x=()=>{h&&(e(h),t())};return a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in duration-200",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-lg w-full overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"p-4 border-b bg-slate-50 flex justify-between items-center",children:[a.jsxs("h2",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[a.jsx($,{name:"cloud_download",className:"text-iiif-blue"}),"Import External IIIF"]}),a.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-600",children:a.jsx($,{name:"close"})})]}),a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Manifest or Collection URL"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:i,onChange:v=>l(v.target.value),onKeyDown:v=>v.key==="Enter"&&y(),placeholder:"https://example.org/iiif/manifest.json",className:"flex-1 border border-slate-300 rounded px-3 py-2 text-sm focus:border-iiif-blue focus:ring-1 focus:ring-iiif-blue outline-none"}),a.jsx("button",{onClick:y,disabled:o||!i,className:"bg-slate-100 hover:bg-slate-200 text-slate-700 px-4 py-2 rounded font-bold text-sm disabled:opacity-50",children:o?a.jsx($,{name:"sync",className:"animate-spin"}):"Fetch"})]})]}),d&&a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-3 text-sm text-red-700 flex gap-2 items-start",children:[a.jsx($,{name:"error",className:"mt-0.5 shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-bold",children:"Error loading resource"}),a.jsx("p",{className:"text-xs mt-1 opacity-90",children:d})]})]}),h&&a.jsx("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4 animate-in slide-in-from-bottom-2",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-16 h-16 bg-white rounded border border-slate-200 flex items-center justify-center shrink-0 overflow-hidden",children:h.thumbnail?.[0]?.id?a.jsx("img",{src:h.thumbnail[0].id,className:"w-full h-full object-cover"}):a.jsx($,{name:Mt(h)?"folder":"menu_book",className:"text-slate-300 text-3xl"})}),a.jsxs("div",{children:[a.jsx("div",{className:"flex items-center gap-2 mb-1",children:a.jsx("span",{className:`text-[10px] uppercase font-bold px-1.5 py-0.5 rounded ${Mt(h)?"bg-amber-100 text-amber-700":"bg-green-100 text-green-700"}`,children:h.type})}),a.jsx("h3",{className:"font-bold text-slate-800 line-clamp-1",children:Le(h.label,"none")||Le(h.label,"en")||"Untitled"}),a.jsx("p",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:Le(h.summary,"none")||Le(h.summary,"en")||"No description available."})]})]})})]}),a.jsxs("div",{className:"p-4 border-t bg-slate-50 flex justify-end gap-2",children:[a.jsx("button",{onClick:t,className:"px-4 py-2 text-slate-600 font-bold text-sm hover:bg-slate-200 rounded",children:"Cancel"}),a.jsxs("button",{onClick:x,disabled:!h,className:"bg-iiif-blue text-white px-6 py-2 rounded font-bold text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm flex items-center gap-2",children:[a.jsx($,{name:"add"})," Add to Archive"]})]})]})})},mp="batch-editor-snapshot",v5=(e,t)=>{try{const n={timestamp:Date.now(),itemCount:t,root:JSON.parse(JSON.stringify(e))};return localStorage.setItem(mp,JSON.stringify(n)),!0}catch(n){return console.error("Failed to save batch snapshot:",n),!1}},w5=()=>{try{const e=localStorage.getItem(mp);return e?JSON.parse(e):null}catch(e){return console.error("Failed to load batch snapshot:",e),null}},N5=()=>{try{localStorage.removeItem(mp)}catch{}},S5=["Title","Creator","Date","Description","Subject","Rights","Source","Type","Format","Identifier","Language","Coverage","Publisher","Contributor","Relation"],C5=({ids:e,root:t,onApply:n,onClose:i,onRollback:l})=>{const{showToast:o}=ws(),[u,d]=S.useState("rename"),[m,h]=S.useState(!1),[p,g]=S.useState(null),[y,x]=S.useState(!1);S.useEffect(()=>{const G=w5();g(G)},[]),S.useEffect(()=>{const G=te=>{te.key==="Escape"&&i()};return document.addEventListener("keydown",G),()=>document.removeEventListener("keydown",G)},[i]);const[v,N]=S.useState("{orig}"),[j,C]=S.useState(""),[A,_]=S.useState(""),[T,L]=S.useState(""),[H,k]=S.useState([]),[R,z]=S.useState("(\\d{4})_(\\w+)_(.*)"),[P,K]=S.useState([{group:1,property:"Date"},{group:2,property:"Subject"}]),I=S.useMemo(()=>{const G=[],te=U=>{e.includes(U.id)&&G.push(U),U.items&&U.items.forEach(te)};return te(t),G},[e,t]),D=S.useMemo(()=>{if(u!=="patterns")return[];try{const G=new RegExp(R);return I.map(te=>{const U=te._filename||Le(te.label),V=U.match(G),O={};return V&&P.forEach(B=>{V[B.group]&&(O[B.property]=V[B.group])}),{filename:U,extracted:O,success:!!V}})}catch{return[]}},[I,R,P,u]),E=()=>{v5(t,e.length)&&o('Snapshot saved. Use "Rollback Last Batch" to undo if needed.',"info");const te={};e.forEach((U,V)=>{const O={};if(u==="metadata"&&(j&&(O.summary={en:[j]}),A&&(O.rights=A),T&&(O.navDate=new Date(T).toISOString()),H.length>0&&(O.metadata=H.map(B=>({label:{en:[B.label]},value:{en:[B.value]}})))),u==="patterns"){const B=D[V];B&&B.success&&(O.metadata=Object.entries(B.extracted).map(([Y,X])=>({label:{en:[Y]},value:{en:[X]}})))}te[U]=O}),n(e,te,u==="rename"?v:void 0),i()},q=()=>{!p||!l||(l(p.root),N5(),g(null),x(!1),o("Rolled back to state before last batch operation","success"),i())},W=G=>new Date(G).toLocaleString();return a.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[150] flex items-center justify-center p-8 animate-in fade-in duration-200",children:a.jsxs("div",{className:"bg-white w-full max-w-5xl h-[85vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-slate-200",children:[a.jsxs("div",{className:"p-6 border-b bg-slate-50 flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 bg-iiif-blue rounded-xl flex items-center justify-center text-white shadow-lg",children:a.jsx($,{name:"auto_fix_high",className:"text-2xl"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Batch Archive Toolkit"}),a.jsxs("p",{className:"text-sm text-slate-500",children:["Editing ",e.length," items"]})]})]}),a.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-200 rounded-full text-slate-500 transition-colors",children:a.jsx($,{name:"close"})})]}),a.jsxs("div",{className:"flex border-b bg-white shrink-0",children:[a.jsx("button",{onClick:()=>d("rename"),className:`flex-1 py-4 text-xs font-black uppercase tracking-widest transition-all border-b-2 ${u==="rename"?"border-iiif-blue text-iiif-blue bg-blue-50/20":"border-transparent text-slate-400 hover:text-slate-600"}`,children:"Rename"}),a.jsx("button",{onClick:()=>d("metadata"),className:`flex-1 py-4 text-xs font-black uppercase tracking-widest transition-all border-b-2 ${u==="metadata"?"border-iiif-blue text-iiif-blue bg-blue-50/20":"border-transparent text-slate-400 hover:text-slate-600"}`,children:"Metadata"}),a.jsx("button",{onClick:()=>d("patterns"),className:`flex-1 py-4 text-xs font-black uppercase tracking-widest transition-all border-b-2 ${u==="patterns"?"border-iiif-blue text-iiif-blue bg-blue-50/20":"border-transparent text-slate-400 hover:text-slate-600"}`,children:"Pattern Detector"})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsxs("div",{className:"w-1/2 border-r border-slate-100 overflow-y-auto p-8 bg-white custom-scrollbar",children:[u==="rename"&&a.jsxs("div",{className:"space-y-8",children:[a.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2",children:"Rename Pattern"}),a.jsx("input",{type:"text",value:v,onChange:G=>N(G.target.value),className:"w-full text-lg font-bold p-4 bg-slate-50 border-2 border-transparent focus:border-iiif-blue rounded-xl outline-none"}),a.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[a.jsx(kv,{label:"Original Name",tag:"{orig}",onClick:N,current:v}),a.jsx(kv,{label:"Index (001...)",tag:"{nnn}",onClick:N,current:v})]})]}),u==="metadata"&&a.jsx("div",{className:"space-y-6",children:a.jsx("textarea",{value:j,onChange:G=>C(G.target.value),className:"w-full p-3 bg-slate-50 rounded-xl outline-none text-sm min-h-[100px]",placeholder:"Common Summary..."})}),u==="patterns"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100 mb-6",children:[a.jsxs("h4",{className:"text-xs font-bold text-blue-800 flex items-center gap-2 mb-2",children:[a.jsx($,{name:"biotech"})," Regex Extractor"]}),a.jsxs("p",{className:"text-[10px] text-blue-700 leading-relaxed",children:["Extract metadata from filenames. Use capture groups like ",a.jsx("code",{children:"(\\d+)"})," to find values."]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-2",children:"Regex Pattern"}),a.jsx("input",{value:R,onChange:G=>z(G.target.value),className:"w-full font-mono text-sm p-3 bg-slate-50 rounded-lg border border-slate-200 focus:border-iiif-blue outline-none",placeholder:"e.g. (\\d+)_(\\w+).jpg"})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase",children:"Field Mappings"}),P.map((G,te)=>a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"number",value:G.group,onChange:U=>K(P.map((V,O)=>O===te?{...V,group:parseInt(U.target.value)}:V)),className:"w-16 p-2 border rounded text-xs"}),a.jsx("select",{value:G.property,onChange:U=>K(P.map((V,O)=>O===te?{...V,property:U.target.value}:V)),className:"flex-1 p-2 border rounded text-xs",children:S5.map(U=>a.jsx("option",{value:U,children:U},U))}),a.jsx("button",{onClick:()=>K(P.filter((U,V)=>V!==te)),className:"text-red-400",children:a.jsx($,{name:"delete",className:"text-sm"})})]},te)),a.jsx("button",{onClick:()=>K([...P,{group:P.length+1,property:"Subject"}]),className:"text-[10px] font-bold text-iiif-blue uppercase",children:"+ Add Group Mapping"})]})]})]}),a.jsxs("div",{className:"flex-1 bg-slate-50 overflow-y-auto p-8 custom-scrollbar",children:[a.jsx("h3",{className:"text-xs font-black text-slate-400 uppercase tracking-widest mb-4",children:"Preview"}),a.jsx("div",{className:"space-y-2",children:u==="patterns"?D.map((G,te)=>a.jsxs("div",{className:`p-3 rounded-lg border bg-white ${G.success?"border-green-200":"border-red-100 opacity-50"}`,children:[a.jsx("div",{className:"text-[10px] font-mono text-slate-400",children:G.filename}),G.success?a.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:Object.entries(G.extracted).map(([U,V])=>a.jsxs("span",{className:"text-[9px] bg-blue-50 text-blue-600 px-1.5 py-0.5 rounded border border-blue-100",children:[a.jsxs("b",{children:[U,":"]})," ",V]},U))}):a.jsx("div",{className:"text-[9px] text-red-400 mt-1 italic font-bold",children:"No match found"})]},te)):I.map((G,te)=>a.jsx("div",{className:"bg-white p-3 rounded-lg border border-slate-200 text-sm font-bold truncate",children:Le(G.label)},te))})]})]}),a.jsxs("div",{className:"p-6 bg-slate-50 border-t flex justify-between items-center",children:[a.jsx("div",{children:p&&l&&a.jsxs("button",{onClick:()=>x(!0),className:"px-4 py-2 text-amber-700 bg-amber-50 border border-amber-200 font-bold hover:bg-amber-100 rounded-xl flex items-center gap-2 text-sm",children:[a.jsx($,{name:"history",className:"text-sm"}),"Rollback Last Batch",a.jsxs("span",{className:"text-[10px] text-amber-500 ml-1",children:["(",p.itemCount," items, ",W(p.timestamp),")"]})]})}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:i,className:"px-6 py-2 text-slate-600 font-bold hover:bg-slate-200 rounded-xl",children:"Cancel"}),a.jsxs("button",{onClick:E,className:"px-10 py-2 bg-iiif-blue text-white font-bold rounded-xl shadow-lg hover:bg-blue-600 flex items-center gap-2",children:["Apply Changes ",a.jsx($,{name:"play_arrow"})]})]})]}),y&&p&&a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center text-amber-600",children:a.jsx($,{name:"warning",className:"text-2xl"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Confirm Rollback"}),a.jsx("p",{className:"text-sm text-slate-500",children:"This will restore the previous state"})]})]}),a.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 mb-6 text-sm",children:[a.jsxs("p",{className:"text-slate-600",children:[a.jsxs("strong",{children:[p.itemCount," items"]})," were modified on"," ",a.jsx("strong",{children:W(p.timestamp)}),"."]}),a.jsx("p",{className:"text-slate-500 mt-2",children:"Rolling back will restore the archive to its state before that batch operation. This action cannot be undone."})]}),a.jsxs("div",{className:"flex gap-3 justify-end",children:[a.jsx("button",{onClick:()=>x(!1),className:"px-6 py-2 text-slate-600 font-bold hover:bg-slate-100 rounded-xl",children:"Cancel"}),a.jsxs("button",{onClick:q,className:"px-6 py-2 bg-amber-600 text-white font-bold rounded-xl hover:bg-amber-700 flex items-center gap-2",children:[a.jsx($,{name:"history"})," Rollback"]})]})]})})]})})},kv=({label:e,tag:t,onClick:n,current:i})=>a.jsxs("button",{onClick:()=>n(i+t),className:"flex flex-col items-start p-2 rounded-lg bg-white border border-slate-200 hover:border-iiif-blue transition-all text-left",children:[a.jsx("span",{className:"text-[8px] font-black text-slate-400 uppercase",children:e}),a.jsx("code",{className:"text-xs font-mono font-bold text-iiif-blue",children:t})]}),j5=({settings:e,onUpdate:t,onClose:n})=>{S.useEffect(()=>{const d=m=>{m.key==="Escape"&&n()};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[n]);const i=d=>{let m=Ps.ARCHIVIST,h=!0,p=!1,g="standard";d==="simple"?(m=Ps.RESEARCHER,h=!1,p=!0,g="simple"):d==="advanced"&&(m=Ps.DEVELOPER,h=!0,p=!1,g="advanced"),t({abstractionLevel:d,metadataTemplate:m,showTechnicalIds:h,fieldMode:p,metadataComplexity:g})},l=[{level:"simple",label:"Essential",desc:"Label, summary, thumbnail only"},{level:"standard",label:"Standard",desc:"+ metadata, rights, navDate"},{level:"advanced",label:"Full Spec",desc:"+ behaviors, services, structures"}],o=l.findIndex(d=>d.level===e.metadataComplexity),u=db(e.metadataComplexity).length;return a.jsx("div",{className:"fixed inset-0 z-[700] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md",children:a.jsxs("div",{className:"bg-white w-full max-w-xl rounded-2xl shadow-2xl overflow-hidden border border-slate-200 animate-in zoom-in-95 duration-200",children:[a.jsxs("div",{className:"p-6 border-b flex justify-between items-center bg-slate-50",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center text-white shadow-xl",children:a.jsx($,{name:"psychology"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-black text-slate-800 uppercase tracking-tighter",children:"Studio Persona"}),a.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Global Workbench Configuration"})]})]}),a.jsx("button",{onClick:n,className:"p-2 hover:bg-slate-200 rounded-full text-slate-400",children:a.jsx($,{name:"close"})})]}),a.jsxs("div",{className:"p-8 space-y-8 overflow-y-auto max-h-[70vh] custom-scrollbar",children:[a.jsxs("section",{children:[a.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4",children:"Select Your Role"}),a.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[a.jsx(qh,{icon:"travel_explore",title:"Field Researcher",desc:"Simplified UI. Focus on GPS, high-contrast field modes, and quick capture.",active:e.abstractionLevel==="simple",onClick:()=>i("simple")}),a.jsx(qh,{icon:"inventory",title:"Digital Archivist",desc:"Standard UI. Emphasis on metadata precision, validation, and batching.",active:e.abstractionLevel==="standard",onClick:()=>i("standard")}),a.jsx(qh,{icon:"terminal",title:"IIIF Developer",desc:"Advanced UI. Raw JSON-LD access, direct ID editing, and Image API workbenches.",active:e.abstractionLevel==="advanced",onClick:()=>i("advanced")})]})]}),a.jsxs("section",{className:"pt-6 border-t border-slate-100",children:[a.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4",children:"Affordance Overrides"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase",children:"Auto-Save Frequency"}),a.jsxs("select",{value:e.autoSaveInterval,onChange:d=>t({autoSaveInterval:parseInt(d.target.value)}),className:"w-full text-xs font-bold p-2 bg-slate-50 border rounded-lg",children:[a.jsx("option",{value:30,children:"Every 30 seconds"}),a.jsx("option",{value:60,children:"Every minute"}),a.jsx("option",{value:300,children:"Every 5 minutes"})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase",children:"Base Hosting URL"}),a.jsx("input",{value:e.defaultBaseUrl,onChange:d=>t({defaultBaseUrl:d.target.value}),className:"w-full text-xs font-bold p-2 bg-slate-50 border rounded-lg font-mono",placeholder:"http://localhost"})]})]})]}),a.jsxs("section",{className:"pt-6 border-t border-slate-100",children:[a.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4",children:"Metadata Complexity"}),a.jsxs("div",{className:"bg-slate-50 rounded-xl border p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-xs font-bold text-slate-700",children:"Field Visibility Level"}),a.jsxs("span",{className:"text-[9px] font-mono bg-iiif-blue/10 text-iiif-blue px-2 py-0.5 rounded-full",children:[u," fields"]})]}),a.jsxs("div",{className:"relative pt-2",children:[a.jsx("div",{className:"flex justify-between mb-2",children:l.map((d,m)=>a.jsx("button",{onClick:()=>t({metadataComplexity:d.level}),className:`text-[9px] font-black uppercase tracking-tight transition-colors ${e.metadataComplexity===d.level?"text-iiif-blue":"text-slate-400 hover:text-slate-600"}`,children:d.label},d.level))}),a.jsxs("div",{className:"relative h-2 bg-slate-200 rounded-full",children:[a.jsx("div",{className:"absolute h-2 bg-gradient-to-r from-iiif-blue to-blue-400 rounded-full transition-all",style:{width:`${(o+1)/l.length*100}%`}}),a.jsx("input",{type:"range",min:"0",max:"2",value:o,onChange:d=>t({metadataComplexity:l[parseInt(d.target.value)].level}),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer","aria-label":"Metadata complexity level"}),a.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-white border-2 border-iiif-blue rounded-full shadow-md transition-all pointer-events-none",style:{left:`calc(${o/2*100}% - 8px)`}})]}),a.jsx("p",{className:"text-[10px] text-slate-500 mt-3 text-center",children:l[o]?.desc})]}),a.jsxs("div",{className:"pt-3 border-t border-slate-200",children:[a.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase block mb-2",children:"Visible Fields Preview"}),a.jsxs("div",{className:"flex flex-wrap gap-1",children:[db(e.metadataComplexity).slice(0,8).map(d=>a.jsx("span",{className:"text-[8px] font-bold bg-white border px-1.5 py-0.5 rounded text-slate-600",children:d.label},d.key)),u>8&&a.jsxs("span",{className:"text-[8px] font-bold text-slate-400",children:["+",u-8," more"]})]})]})]})]}),a.jsxs("section",{className:"pt-6 border-t border-slate-100 space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl border",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-xs font-bold text-slate-700 block",children:"Technical Transparency"}),a.jsx("span",{className:"text-[9px] text-slate-400 uppercase font-black",children:"IDs & JSON-LD Visible"})]}),a.jsx("input",{type:"checkbox",checked:e.showTechnicalIds,onChange:d=>t({showTechnicalIds:d.target.checked}),className:"rounded text-iiif-blue w-5 h-5"})]}),a.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl border",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-xs font-bold text-slate-700 block",children:"Field Contrast Mode"}),a.jsx("span",{className:"text-[9px] text-slate-400 uppercase font-black",children:"Optimized for outdoor use"})]}),a.jsx("input",{type:"checkbox",checked:e.fieldMode,onChange:d=>t({fieldMode:d.target.checked}),className:"rounded text-iiif-blue w-5 h-5"})]})]}),a.jsx(E5,{})]}),a.jsx("div",{className:"p-6 bg-slate-50 border-t flex justify-end",children:a.jsx("button",{onClick:n,className:"bg-slate-800 text-white px-10 py-3 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-black transition-all shadow-xl",children:"Commit Environment Profile"})})]})})},qh=({icon:e,title:t,desc:n,active:i,onClick:l})=>a.jsxs("button",{onClick:l,className:`w-full p-4 rounded-xl border-2 text-left transition-all flex items-start gap-4 ${i?"border-iiif-blue bg-blue-50 shadow-md":"border-slate-100 hover:border-slate-200"}`,children:[a.jsx("div",{className:`p-3 rounded-xl ${i?"bg-iiif-blue text-white shadow-lg":"bg-slate-100 text-slate-400"}`,children:a.jsx($,{name:e})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:`font-black uppercase tracking-tighter text-sm ${i?"text-iiif-blue":"text-slate-700"}`,children:t}),a.jsx("p",{className:"text-[10px] text-slate-500 leading-tight mt-1",children:n})]}),i&&a.jsx($,{name:"check_circle",className:"text-iiif-blue"})]}),E5=()=>{const[e,t]=S.useState(Ka.getSeenCount()),[n,i]=S.useState(!1),l=()=>{n?(Ka.reset(),t(0),i(!1)):(i(!0),setTimeout(()=>i(!1),3e3))},o=()=>{Ka.resetTooltips(),t(Ka.getSeenCount())};return a.jsxs("section",{className:"pt-6 border-t border-slate-100",children:[a.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4",children:"Help & Tooltips"}),a.jsxs("div",{className:"bg-slate-50 rounded-xl border p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-xs font-bold text-slate-700 block",children:"Contextual Help"}),a.jsxs("span",{className:"text-[9px] text-slate-400",children:[e," tips dismissed"]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:o,className:"text-[10px] font-bold text-slate-500 hover:text-slate-700 px-3 py-1.5 rounded-lg hover:bg-slate-100 transition-colors",children:"Reset Tooltips"}),a.jsx("button",{onClick:l,className:`text-[10px] font-bold px-3 py-1.5 rounded-lg transition-colors ${n?"bg-red-500 text-white":"text-slate-500 hover:text-slate-700 hover:bg-slate-100"}`,children:n?"Click to Confirm":"Reset All Help"})]})]}),a.jsx("p",{className:"text-[10px] text-slate-400 leading-relaxed",children:"Show all help tooltips and welcome messages again. Useful if you want a refresher on features."})]})]})};function A5(e,t){if(t===0)return!0;const n=e[t-1];return n===" "||n==="-"||n==="_"||n==="."||n==="/"}function Vh(e,t){if(!t)return{score:0,matches:[]};const n=e.toLowerCase(),i=t.toLowerCase();if(n===i)return{score:100,matches:[{start:0,end:e.length}]};if(n.startsWith(i))return{score:50+Math.min(t.length*2,20),matches:[{start:0,end:t.length}]};const l=n.split(/[-_\s\/]+/);let o=0,u=[],d=i,m=0;for(const p of l){if(d.length===0)break;if(p.startsWith(d)){o+=15+Math.min(d.length*3,15),u.push({start:m,end:m+d.length}),d="";break}else d.startsWith(p)&&(o+=15+Math.min(p.length*3,15),u.push({start:m,end:m+p.length}),d=d.slice(p.length));m+=p.length+1}if(d.length===0&&u.length>0)return{score:Math.min(o,80),matches:u};const h={score:10,matches:[],patternIndex:0,textIndex:0,consecutiveCount:0,inMatch:!1,matchStart:-1};for(;h.patternIndex<t.length&&h.textIndex<e.length;){const p=n[h.textIndex],g=i[h.patternIndex];p===g?(h.inMatch?(h.consecutiveCount++,h.score+=5):(h.matchStart=h.textIndex,h.inMatch=!0,h.consecutiveCount=1,A5(e,h.textIndex)&&(h.score+=15)),h.patternIndex++):(h.inMatch&&(h.matches.push({start:h.matchStart,end:h.textIndex}),h.inMatch=!1,h.matchStart=-1),h.score-=1),h.textIndex++}return h.inMatch&&h.matches.push({start:h.matchStart,end:h.textIndex}),h.patternIndex===t.length?{score:Math.max(0,h.score),matches:h.matches}:null}const Kh="field-studio:command-history",T5=10;function _5(e=T5){const[t,n]=S.useState([]),[i,l]=S.useState(!1);S.useEffect(()=>{try{const h=localStorage.getItem(Kh);if(h){const p=JSON.parse(h),g=Array.isArray(p)?p.filter(y=>y&&typeof y.commandId=="string"&&typeof y.usedAt=="number"&&typeof y.useCount=="number"):[];n(g)}}catch{n([])}l(!0)},[]),S.useEffect(()=>{if(i)try{localStorage.setItem(Kh,JSON.stringify(t))}catch{}},[t,i]);const o=S.useCallback(h=>{h&&n(p=>{const g=Date.now(),y=p.findIndex(v=>v.commandId===h);let x;return y!==-1?(x=[...p],x[y]={...x[y],usedAt:g,useCount:x[y].useCount+1}):x=[...p,{commandId:h,usedAt:g,useCount:1}],x.sort((v,N)=>N.useCount!==v.useCount?N.useCount-v.useCount:N.usedAt-v.usedAt),x.length>e&&(x=x.slice(0,e)),x})},[e]),u=S.useCallback((h=24)=>{const p=Date.now(),g=h*60*60*1e3;return t.filter(y=>p-y.usedAt<g).sort((y,x)=>x.usedAt-y.usedAt)},[t]),d=S.useCallback((h=5)=>t.slice(0,h).sort((p,g)=>g.useCount!==p.useCount?g.useCount-p.useCount:g.usedAt-p.usedAt),[t]),m=S.useCallback(()=>{n([]);try{localStorage.removeItem(Kh)}catch{}},[]);return{recordCommand:o,getRecentCommands:u,getFrequentCommands:d,history:t,clearHistory:m}}const k5=24,O5=({isOpen:e,onClose:t,commands:n,maxHistoryEntries:i=10})=>{const[l,o]=S.useState(""),[u,d]=S.useState(0),m=S.useRef(null),h=S.useRef(null),{recordCommand:p,getRecentCommands:g,getFrequentCommands:y,history:x}=_5(i),v=S.useMemo(()=>n.filter(T=>!T.isAvailable||T.isAvailable()),[n]),N=S.useMemo(()=>{const T=g(k5),L=y(5),H=new Set(T.map(z=>z.commandId)),k=new Set(L.map(z=>z.commandId));if(!l.trim()){const z=[];for(const I of T){const D=v.find(E=>E.id===I.commandId);D&&z.push({command:D,score:1e3,matchType:"none",highlightRanges:[],isRecent:!0})}for(const I of L)if(!H.has(I.commandId)){const D=v.find(E=>E.id===I.commandId);D&&z.push({command:D,score:900,matchType:"none",highlightRanges:[],isFrequent:!0})}const P=new Set(z.map(I=>I.command.id)),K=v.filter(I=>!P.has(I.id)).slice(0,10).map(I=>({command:I,score:0,matchType:"none",highlightRanges:[]}));return[...z,...K]}const R=[];for(const z of v){const P=Vh(z.label,l),K=Vh(z.section,l),I=z.description?Vh(z.description,l):null;let D=null,E=0,q="none";if(P&&(D=P,E=P.score,E>=100?q="exact":E>=50?q="prefix":E>=15?q="word":q="fuzzy"),K&&K.score*.8>E&&(D=K,E=K.score*.8,q=K.score>=50?"word":"fuzzy"),I&&I.score*.6>E&&(D=I,E=I.score*.6,q="fuzzy"),D!==null){let W=E;const G=x.find(te=>te.commandId===z.id);G&&(W+=Math.min(G.useCount*5,25),H.has(z.id)&&(W+=20)),R.push({command:z,score:W,matchType:q,highlightRanges:P?.matches??[],isRecent:H.has(z.id),isFrequent:k.has(z.id)&&!H.has(z.id)})}}return R.sort((z,P)=>P.score-z.score),R},[l,v,x,g,y]);S.useEffect(()=>{d(0)},[N.length,l]),S.useEffect(()=>{e&&(setTimeout(()=>m.current?.focus(),0),o(""))},[e]),S.useEffect(()=>{if(!e)return;const T=L=>{switch(L.key){case"Escape":L.preventDefault(),t();break;case"ArrowDown":L.preventDefault(),d(H=>H<N.length-1?H+1:H);break;case"ArrowUp":L.preventDefault(),d(H=>H>0?H-1:0);break;case"Enter":if(L.preventDefault(),N[u]){const H=N[u];H.command.onExecute(),p(H.command.id),t()}break}};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[e,N,u,t,p]),S.useEffect(()=>{if(h.current){const T=h.current.children[u];T&&T.scrollIntoView({block:"nearest"})}},[u]);const j=S.useCallback(T=>{T.command.onExecute(),p(T.command.id),t()},[t,p]),C=S.useCallback((T,L)=>{if(L.length===0)return T;const H=[];let k=0;const R=[...L].sort((z,P)=>z.start-P.start);for(let z=0;z<R.length;z++){const{start:P,end:K}=R[z];P>k&&H.push(T.slice(k,P)),H.push(a.jsx("mark",{className:"bg-yellow-200 text-slate-900 font-semibold rounded px-0.5",children:T.slice(P,K)},z)),k=K}return k<T.length&&H.push(T.slice(k)),H},[]);if(!e)return null;const A=S.useMemo(()=>{if(l.trim())return{"Search Results":N};const T={},L=N.filter(R=>R.isRecent);L.length>0&&(T.Recent=L);const H=N.filter(R=>R.isFrequent);return H.length>0&&(T.Frequent=H),N.filter(R=>!R.isRecent&&!R.isFrequent).forEach(R=>{const z=R.command.section;T[z]||(T[z]=[]),T[z].push(R)}),T},[N,l]);let _=0;return a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[1000] flex items-start justify-center pt-[20vh]",onClick:t,"aria-modal":"true",role:"dialog","aria-label":"Command palette",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden animate-in fade-in zoom-in-95 duration-200",onClick:T=>T.stopPropagation(),children:[a.jsxs("div",{className:"border-b border-slate-200 p-4 flex items-center gap-3",children:[a.jsx($,{name:"search",className:"text-slate-400 text-xl"}),a.jsx("input",{ref:m,type:"text",value:l,onChange:T=>o(T.target.value),placeholder:"Type a command or search...",className:"flex-1 text-lg outline-none placeholder:text-slate-400 bg-transparent","aria-label":"Search commands",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false"}),a.jsx("kbd",{className:"px-2 py-1 bg-slate-100 rounded text-xs text-slate-500 font-mono",children:"ESC"})]}),a.jsx("div",{ref:h,className:"max-h-[400px] overflow-y-auto py-2",role:"listbox","aria-label":"Command results",children:N.length===0?a.jsxs("div",{className:"p-8 text-center text-slate-400",children:[a.jsx($,{name:"search_off",className:"text-4xl mb-2 mx-auto"}),a.jsx("p",{children:"No commands found"})]}):Object.entries(A).map(([T,L])=>a.jsxs("div",{role:"group","aria-label":T,children:[a.jsx("div",{className:"px-4 py-2 text-xs font-bold text-slate-400 uppercase tracking-wider",children:T}),L.map(H=>{const k=_===u,R=_++;return a.jsxs("button",{onClick:()=>j(H),className:`
                        w-full px-4 py-3 flex items-center gap-3 text-left transition-colors
                        ${k?"bg-blue-50":"hover:bg-slate-50"}
                      `,onMouseEnter:()=>d(R),role:"option","aria-selected":k,children:[H.command.icon&&a.jsx($,{name:H.command.icon,className:`text-lg ${k?"text-blue-600":"text-slate-400"}`}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-slate-800 truncate",children:C(H.command.label,H.highlightRanges)}),H.command.description&&a.jsx("div",{className:"text-xs text-slate-400 truncate",children:H.command.description})]}),a.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[H.isRecent&&a.jsx("span",{className:"text-[10px] bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded font-medium",children:"recent"}),H.command.shortcut&&a.jsx("kbd",{className:"px-2 py-1 bg-slate-100 rounded text-xs text-slate-500 font-mono",children:H.command.shortcut})]})]},H.command.id)})]},T))}),a.jsxs("div",{className:"border-t border-slate-200 px-4 py-2 flex items-center gap-4 text-xs text-slate-400",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 bg-slate-100 rounded font-mono",children:""}),a.jsx("span",{children:"Navigate"})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 bg-slate-100 rounded font-mono",children:"Enter"}),a.jsx("span",{children:"Select"})]}),a.jsx("div",{className:"flex-1"}),a.jsxs("span",{children:[N.length," commands"]})]})]})})};function I5(e){const t=S.useRef(null),n=S.useRef(null),{isActive:i,returnFocusTo:l,focusDelay:o=mb.focusDelay,onEscape:u}=e;return S.useEffect(()=>{if(!i)return;const d=t.current;if(!d)return;n.current=document.activeElement;const m=()=>Array.from(d.querySelectorAll(mb.focusableSelector)).filter(y=>{const x=y;return!x.hasAttribute("disabled")&&x.getAttribute("tabindex")!=="-1"&&x.offsetParent!==null}),p=setTimeout(()=>{const y=m();y.length>0&&(y.find(v=>v.hasAttribute("autofocus"))||y[0]).focus()},o),g=y=>{if(y.key===hb.KEYS.ESCAPE&&u){y.preventDefault(),u();return}if(y.key!==hb.KEYS.TAB)return;const x=m();if(x.length===0)return;const v=x[0],N=x[x.length-1];y.shiftKey&&document.activeElement===v?(y.preventDefault(),N.focus()):!y.shiftKey&&document.activeElement===N&&(y.preventDefault(),v.focus())};return document.addEventListener("keydown",g),()=>{clearTimeout(p),document.removeEventListener("keydown",g);const y=l||n.current;y&&typeof y.focus=="function"&&y.focus()}},[i,l,o,u]),t}const Ei=[{id:"open-palette",keys:["Cmd","K"],description:"Open Command Palette",context:"global",category:"navigation",icon:"search"},{id:"go-collections",keys:["Cmd","1"],description:"Go to Archive View",context:"global",category:"navigation",icon:"inventory_2"},{id:"go-structure",keys:["Cmd","2"],description:"Go to Collections",context:"global",category:"navigation",icon:"folder_special"},{id:"go-metadata",keys:["Cmd","3"],description:"Go to Metadata",context:"global",category:"navigation",icon:"table_chart"},{id:"go-search",keys:["Cmd","4"],description:"Go to Search",context:"global",category:"navigation",icon:"search"},{id:"go-viewer",keys:["Cmd","5"],description:"Go to Viewer",context:"global",category:"navigation",icon:"visibility"},{id:"show-shortcuts",keys:["Cmd","?"],description:"Show Keyboard Shortcuts",context:"global",category:"navigation",icon:"keyboard"},{id:"undo",keys:["Cmd","Z"],description:"Undo",context:"global",category:"editing",icon:"undo"},{id:"redo",keys:["Cmd","Shift","Z"],description:"Redo",context:"global",category:"editing",icon:"redo"},{id:"save",keys:["Cmd","S"],description:"Save Project",context:"global",category:"editing",icon:"save"},{id:"delete",keys:["Delete"],description:"Delete Selected",context:"global",category:"editing",icon:"delete"},{id:"duplicate",keys:["Cmd","D"],description:"Duplicate Selected",context:"global",category:"editing",icon:"content_copy"},{id:"copy",keys:["Cmd","C"],description:"Copy",context:"global",category:"editing",icon:"content_copy"},{id:"paste",keys:["Cmd","V"],description:"Paste",context:"global",category:"editing",icon:"content_paste"},{id:"cut",keys:["Cmd","X"],description:"Cut",context:"global",category:"editing",icon:"content_cut"},{id:"select-all",keys:["Cmd","A"],description:"Select All",context:"global",category:"selection",icon:"select_all"},{id:"clear-selection",keys:["Escape"],description:"Clear Selection",context:"global",category:"selection",icon:"deselect"},{id:"select-next",keys:["ArrowDown"],description:"Select Next Item",context:"global",category:"selection",icon:"arrow_downward"},{id:"select-prev",keys:["ArrowUp"],description:"Select Previous Item",context:"global",category:"selection",icon:"arrow_upward"},{id:"multi-select",keys:["Cmd","Click"],description:"Multi-Select (with click)",context:"global",category:"selection",icon:"check_box"},{id:"range-select",keys:["Shift","Click"],description:"Range Select (with click)",context:"global",category:"selection",icon:"linear_scale"},{id:"toggle-sidebar",keys:["Cmd","B"],description:"Toggle Sidebar",context:"global",category:"view",icon:"side_navigation"},{id:"toggle-inspector",keys:["Cmd","I"],description:"Toggle Inspector",context:"global",category:"view",icon:"info"},{id:"toggle-settings",keys:["Cmd",","],description:"Open Settings",context:"global",category:"view",icon:"settings"},{id:"toggle-field-mode",keys:["Cmd","Shift","F"],description:"Toggle Field Mode",context:"global",category:"view",icon:"contrast"},{id:"toggle-fullscreen",keys:["F11"],description:"Toggle Fullscreen",context:"global",category:"view",icon:"fullscreen"},{id:"export",keys:["Cmd","E"],description:"Export Archive",context:"global",category:"actions",icon:"download"},{id:"import",keys:["Cmd","Shift","I"],description:"Import External IIIF",context:"global",category:"actions",icon:"cloud_download"},{id:"quality-control",keys:["Cmd","Q"],description:"Quality Control Dashboard",context:"global",category:"actions",icon:"fact_check"},{id:"batch-edit",keys:["Cmd","Shift","B"],description:"Batch Edit Selected",context:"global",category:"actions",icon:"batch_prediction"},{id:"find",keys:["Cmd","F"],description:"Find in Archive",context:"global",category:"actions",icon:"search"},{id:"expand-all",keys:["Alt","ArrowRight"],description:"Expand All",context:"collections",category:"view",icon:"unfold_more"},{id:"collapse-all",keys:["Alt","ArrowLeft"],description:"Collapse All",context:"collections",category:"view",icon:"unfold_less"},{id:"new-collection",keys:["Cmd","Shift","N"],description:"New Collection",context:"collections",category:"editing",icon:"create_new_folder"},{id:"new-manifest",keys:["Cmd","N"],description:"New Manifest",context:"collections",category:"editing",icon:"note_add"},{id:"reorder-up",keys:["Alt","ArrowUp"],description:"Move Item Up",context:"collections",category:"editing",icon:"move_up"},{id:"reorder-down",keys:["Alt","ArrowDown"],description:"Move Item Down",context:"collections",category:"editing",icon:"move_down"},{id:"zoom-in",keys:["Plus"],description:"Zoom In",context:"viewer",category:"view",icon:"zoom_in"},{id:"zoom-out",keys:["Minus"],description:"Zoom Out",context:"viewer",category:"view",icon:"zoom_out"},{id:"zoom-reset",keys:["0"],description:"Reset Zoom",context:"viewer",category:"view",icon:"zoom_out_map"},{id:"pan-left",keys:["ArrowLeft"],description:"Pan Left",context:"viewer",category:"view",icon:"west"},{id:"pan-right",keys:["ArrowRight"],description:"Pan Right",context:"viewer",category:"view",icon:"east"},{id:"pan-up",keys:["ArrowUp"],description:"Pan Up",context:"viewer",category:"view",icon:"north"},{id:"pan-down",keys:["ArrowDown"],description:"Pan Down",context:"viewer",category:"view",icon:"south"},{id:"next-canvas",keys:["PageDown"],description:"Next Canvas",context:"viewer",category:"navigation",icon:"skip_next"},{id:"prev-canvas",keys:["PageUp"],description:"Previous Canvas",context:"viewer",category:"navigation",icon:"skip_previous"},{id:"rotate-clockwise",keys:["R"],description:"Rotate Clockwise",context:"viewer",category:"view",icon:"rotate_right"},{id:"rotate-counter",keys:["Shift","R"],description:"Rotate Counter-Clockwise",context:"viewer",category:"view",icon:"rotate_left"},{id:"flip-horizontal",keys:["H"],description:"Flip Horizontal",context:"viewer",category:"view",icon:"flip"},{id:"flip-vertical",keys:["V"],description:"Flip Vertical",context:"viewer",category:"view",icon:"flip"},{id:"play-pause",keys:["Space"],description:"Play/Pause Media",context:"viewer",category:"media",icon:"play_arrow"},{id:"mute",keys:["M"],description:"Mute/Unmute",context:"viewer",category:"media",icon:"volume_off"},{id:"seek-forward",keys:["ArrowRight"],description:"Seek Forward",context:"viewer",category:"media",icon:"forward_10"},{id:"seek-backward",keys:["ArrowLeft"],description:"Seek Backward",context:"viewer",category:"media",icon:"replay_10"},{id:"board-zoom-in",keys:["Cmd","Plus"],description:"Board Zoom In",context:"board",category:"view",icon:"zoom_in"},{id:"board-zoom-out",keys:["Cmd","Minus"],description:"Board Zoom Out",context:"board",category:"view",icon:"zoom_out"},{id:"board-fit",keys:["Cmd","0"],description:"Fit to View",context:"board",category:"view",icon:"fit_screen"},{id:"board-select",keys:["V"],description:"Select Tool",context:"board",category:"actions",icon:"mouse"},{id:"board-pan",keys:["Space"],description:"Pan Tool (hold)",context:"board",category:"actions",icon:"pan_tool"},{id:"metadata-add",keys:["Cmd","Shift","M"],description:"Add Metadata Field",context:"metadata",category:"editing",icon:"add_circle"},{id:"metadata-remove",keys:["Cmd","Delete"],description:"Remove Metadata Field",context:"metadata",category:"editing",icon:"remove_circle"},{id:"metadata-next",keys:["Tab"],description:"Next Field",context:"metadata",category:"navigation",icon:"arrow_forward"},{id:"metadata-prev",keys:["Shift","Tab"],description:"Previous Field",context:"metadata",category:"navigation",icon:"arrow_back"}],ti={navigation:{label:"Navigation",icon:"navigation",order:1},editing:{label:"Editing",icon:"edit",order:2},selection:{label:"Selection",icon:"check_box",order:3},view:{label:"View",icon:"visibility",order:4},actions:{label:"Actions",icon:"bolt",order:5},media:{label:"Media Controls",icon:"play_circle",order:6}},D5={global:{label:"Global",description:"Available in all contexts"},collections:{label:"Collections",description:"Structure and organization view"},board:{label:"Board",description:"Visual canvas and layout view"},viewer:{label:"Viewer",description:"Image and media viewer"},metadata:{label:"Metadata",description:"Metadata editing view"}};function L5(){return typeof navigator>"u"?!1:navigator.platform.toUpperCase().indexOf("MAC")>=0}function eN(e){const t=L5(),n={Cmd:t?"":"Ctrl",Command:t?"":"Ctrl",Ctrl:t?"":"Ctrl",Control:t?"":"Ctrl",Alt:t?"":"Alt",Option:t?"":"Alt",Shift:t?"":"Shift",Enter:"",Return:"",Escape:"Esc",Delete:"Del",Backspace:"",ArrowUp:"",ArrowDown:"",ArrowLeft:"",ArrowRight:"",PageUp:"PgUp",PageDown:"PgDn",Home:"Home",End:"End",Tab:"",Space:"Space",Plus:"+",Minus:"-",Click:"Click"};return e.map(l=>n[l]||l).join(t?"":"+")}function R5(e){return e==="global"?Ei.filter(t=>t.context==="global"):Ei.filter(t=>t.context==="global"||t.context===e)}function M5(e){const t=e.toLowerCase().trim();return t?Ei.filter(n=>!!(n.description.toLowerCase().includes(t)||n.id.toLowerCase().includes(t)||n.keys.some(i=>i.toLowerCase().includes(t))||n.category.toLowerCase().includes(t))):Ei}function tN(e){return e.reduce((t,n)=>(t[n.category]||(t[n.category]=[]),t[n.category].push(n),t),{})}function F5(){return["global","collections","board","viewer","metadata"]}function qc(e){return ti[e]?.label||e}function Ov(e){return ti[e]?.icon||"keyboard"}function Gm(e){return D5[e]?.label||e}function P5(e,t){const n=ti[e.category]?.order||99,i=ti[t.category]?.order||99;return n!==i?n-i:e.description.localeCompare(t.description)}function $5(e="global"){const t=R5(e),n=tN(t),i=Object.keys(n).sort((l,o)=>(ti[l]?.order||99)-(ti[o]?.order||99));return{context:Gm(e),generatedAt:new Date().toLocaleDateString(),categories:i.map(l=>({name:qc(l),shortcuts:n[l].sort((o,u)=>o.description.localeCompare(u.description)).map(o=>({keys:eN(o.keys),description:o.description}))}))}}function z5(){return typeof navigator>"u"?!1:navigator.platform.toUpperCase().indexOf("MAC")>=0}const U5=({isOpen:e,onClose:t,currentContext:n="global"})=>{const[i,l]=S.useState(""),[o,u]=S.useState("all"),[d,m]=S.useState(null),h=S.useRef(null),p=S.useMemo(()=>z5(),[]);S.useEffect(()=>{e&&(l(""),u("all"),m(null))},[e]),S.useEffect(()=>{e&&h.current&&setTimeout(()=>h.current?.focus(),100)},[e]);const g=I5({isActive:e,onEscape:t,focusDelay:100}),y=S.useMemo(()=>{let _=Ei;return i.trim()&&(_=M5(i)),o!=="all"&&(_=_.filter(T=>T.context==="global"||T.context===o)),d&&(_=_.filter(T=>T.category===d)),_.sort(P5)},[i,o,d]),x=S.useMemo(()=>tN(y),[y]),v=S.useMemo(()=>Object.keys(x).sort((_,T)=>(ti[_]?.order||99)-(ti[T]?.order||99)),[x]),N=S.useMemo(()=>F5(),[]),j=S.useMemo(()=>{const _={all:Ei.length};return N.forEach(T=>{_[T]=Ei.filter(L=>L.context==="global"||L.context===T).length}),_},[N]),C=S.useCallback(()=>{const T=$5(o==="all"?n:o),L=window.open("","_blank");if(!L)return;const H=p?"macOS":"Windows/Linux",k=p?"?":"Ctrl+?";let R="";T.categories.forEach(P=>{let K="";P.shortcuts.forEach(I=>{K+=`<div class="shortcut"><span class="description">${I.description}</span><span class="keys">${I.keys}</span></div>`}),R+=`<h2>${P.name}</h2><div class="shortcuts-grid">${K}</div>`});const z=`<!DOCTYPE html>
<html>
<head>
<title>Field Studio - Keyboard Shortcuts</title>
<meta charset="utf-8">
<style>
@media print {
  @page { margin: 15mm; }
  body { print-color-adjust: exact; -webkit-print-color-adjust: exact; }
}
* { box-sizing: border-box; }
body { font-family: system-ui, -apple-system, sans-serif; padding: 20px; max-width: 900px; margin: 0 auto; color: #1e293b; line-height: 1.5; }
header { border-bottom: 3px solid #0ea5e9; padding-bottom: 15px; margin-bottom: 25px; }
h1 { font-size: 28px; margin: 0 0 5px 0; color: #0f172a; }
.subtitle { color: #64748b; font-size: 14px; margin: 0; }
.platform { display: inline-block; background: #f1f5f9; padding: 4px 10px; border-radius: 4px; font-size: 12px; color: #475569; margin-top: 10px; }
h2 { font-size: 16px; color: #0f172a; margin: 25px 0 12px 0; padding-bottom: 8px; border-bottom: 2px solid #e2e8f0; display: flex; align-items: center; gap: 8px; }
.shortcuts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px 30px; }
@media (max-width: 600px) { .shortcuts-grid { grid-template-columns: 1fr; } }
.shortcut { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f1f5f9; }
.shortcut:last-child { border-bottom: none; }
.keys { font-family: ui-monospace, SFMono-Regular, monospace; background: #f8fafc; border: 1px solid #e2e8f0; padding: 4px 10px; border-radius: 6px; font-size: 13px; color: #334155; font-weight: 500; white-space: nowrap; }
.description { color: #475569; font-size: 14px; flex: 1; margin-right: 15px; }
.footer { margin-top: 30px; padding-top: 15px; border-top: 1px solid #e2e8f0; color: #94a3b8; font-size: 12px; text-align: center; }
.tip { background: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 12px 15px; margin: 20px 0; border-radius: 0 6px 6px 0; font-size: 13px; color: #0369a1; }
</style>
</head>
<body>
<header>
<h1>Field Studio Keyboard Shortcuts</h1>
<p class="subtitle">Context: ${T.context} - Generated on ${T.generatedAt}</p>
<span class="platform">${H} shortcuts shown</span>
</header>
<div class="tip"><strong>Tip:</strong> Press <strong>${k}</strong> anytime to open this overlay from anywhere in the app.</div>
${R}
<div class="footer">IIIF Field Archive Studio - Press ${k} anytime to view shortcuts</div>
</body>
</html>`;L.document.write(z),L.document.close(),setTimeout(()=>L.print(),250)},[o,n,p]),A=S.useCallback(_=>{if(_.key==="Escape"&&i&&(_.stopPropagation(),l(""),h.current?.focus()),!i&&_.key>="1"&&_.key<="6"){const T=parseInt(_.key)-1,L=v;L[T]&&m(d===L[T]?null:L[T])}},[i,v,d]);return e?a.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[2000] flex items-center justify-center p-4",onClick:t,role:"presentation",children:a.jsxs("div",{ref:g,className:"bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden animate-in fade-in zoom-in-95 duration-200",onClick:_=>_.stopPropagation(),onKeyDown:A,role:"dialog","aria-modal":"true","aria-labelledby":"shortcuts-title",children:[a.jsxs("div",{className:"border-b border-slate-200 dark:border-slate-700 p-4 flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-xl bg-iiif-blue/10 flex items-center justify-center",children:a.jsx($,{name:"keyboard",className:"text-iiif-blue text-xl"})}),a.jsxs("div",{children:[a.jsx("h2",{id:"shortcuts-title",className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"Keyboard Shortcuts"}),a.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Press ",a.jsx("kbd",{className:"px-1 py-0.5 bg-slate-100 dark:bg-slate-800 rounded font-mono text-[10px]",children:"?"})," to toggle - ",a.jsx("kbd",{className:"px-1 py-0.5 bg-slate-100 dark:bg-slate-800 rounded font-mono text-[10px]",children:"Esc"})," to close"]})]})]}),a.jsx("div",{className:"flex-1 w-full sm:w-auto flex items-center gap-3",children:a.jsxs("div",{className:"relative flex-1 max-w-md",children:[a.jsx($,{name:"search",className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),a.jsx("input",{ref:h,type:"text",value:i,onChange:_=>l(_.target.value),placeholder:"Search shortcuts...",className:"w-full pl-10 pr-10 py-2.5 border border-slate-200 dark:border-slate-700 rounded-xl bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-iiif-blue focus:border-iiif-blue outline-none placeholder:text-slate-400 transition-all","aria-label":"Search keyboard shortcuts"}),i&&a.jsx("button",{onClick:()=>{l(""),h.current?.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-full","aria-label":"Clear search",children:a.jsx($,{name:"close",className:"text-slate-400 text-sm"})})]})}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-slate-800 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors","aria-label":"Print cheat sheet",title:"Print cheat sheet",children:[a.jsx($,{name:"print",className:"text-lg"}),a.jsx("span",{className:"hidden sm:inline",children:"Print"})]}),a.jsx("button",{onClick:t,className:"p-2.5 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors","aria-label":"Close shortcuts overlay",children:a.jsx($,{name:"close"})})]})]}),a.jsxs("div",{className:"border-b border-slate-200 dark:border-slate-700 px-4 py-3 flex flex-wrap items-center gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Context:"}),a.jsxs("select",{value:o,onChange:_=>u(_.target.value),className:"px-3 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 focus:ring-2 focus:ring-iiif-blue focus:border-iiif-blue outline-none","aria-label":"Filter by context",children:[a.jsxs("option",{value:"all",children:["All Contexts (",j.all,")"]}),N.map(_=>a.jsxs("option",{value:_,children:[Gm(_)," (",j[_],")"]},_))]})]}),a.jsx("div",{className:"w-px h-6 bg-slate-200 dark:bg-slate-700 hidden sm:block"}),a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsx("span",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider hidden sm:inline",children:"Category:"}),v.slice(0,4).map((_,T)=>a.jsxs("button",{onClick:()=>m(d===_?null:_),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-all flex items-center gap-1.5 ${d===_?"bg-iiif-blue text-white":"bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,title:`Press ${T+1} to toggle`,children:[a.jsx($,{name:Ov(_),className:"text-sm"}),qc(_)]},_)),d&&!v.slice(0,4).includes(d)&&a.jsx("button",{onClick:()=>m(null),className:"px-3 py-1.5 text-xs font-medium rounded-lg bg-iiif-blue text-white transition-all",children:qc(d)}),d&&a.jsx("button",{onClick:()=>m(null),className:"px-2 py-1.5 text-xs text-slate-500 hover:text-slate-700 dark:hover:text-slate-300","aria-label":"Clear category filter",children:"Clear"})]})]}),a.jsx("div",{className:"overflow-y-auto max-h-[60vh] p-4",children:y.length===0?a.jsxs("div",{className:"text-center py-16",children:[a.jsx($,{name:"search_off",className:"text-5xl mb-4 mx-auto text-slate-300 dark:text-slate-600"}),a.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-2",children:"No shortcuts found"}),a.jsx("p",{className:"text-sm text-slate-400 dark:text-slate-500",children:"Try adjusting your search or filters"}),a.jsx("button",{onClick:()=>{l(""),m(null),u("all")},className:"mt-4 px-4 py-2 text-sm text-iiif-blue hover:underline",children:"Clear all filters"})]}):a.jsx("div",{className:"space-y-6",children:v.map(_=>{const T=x[_];return T?.length?a.jsxs("section",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-2xl p-5","aria-labelledby":`category-${_}`,children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg bg-white dark:bg-slate-700 shadow-sm flex items-center justify-center",children:a.jsx($,{name:Ov(_),className:"text-iiif-blue"})}),a.jsx("h3",{id:`category-${_}`,className:"font-bold text-slate-800 dark:text-slate-200 text-lg",children:qc(_)}),a.jsx("span",{className:"text-xs text-slate-400 dark:text-slate-500 bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded-full",children:T.length})]}),a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-2",children:T.map(L=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700 hover:border-iiif-blue/30 dark:hover:border-iiif-blue/30 hover:shadow-sm transition-all group",children:[a.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[L.icon&&a.jsx($,{name:L.icon,className:"text-slate-400 group-hover:text-slate-600 dark:group-hover:text-slate-300 transition-colors"}),a.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300 truncate",children:L.description})]}),a.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[L.context!=="global"&&a.jsx("span",{className:"text-[10px] text-slate-400 dark:text-slate-500 bg-slate-100 dark:bg-slate-700 px-1.5 py-0.5 rounded",children:Gm(L.context)}),a.jsx("kbd",{className:"px-2.5 py-1.5 bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-xs font-mono font-medium text-slate-700 dark:text-slate-300 shadow-sm whitespace-nowrap",children:eN(L.keys)})]})]},L.id))})]},_):null})})}),a.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 px-4 py-3 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 text-xs text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-800/50",children:[a.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.jsxs("span",{className:"flex items-center gap-1.5",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded font-mono text-[10px]",children:"?"}),a.jsx("span",{children:"toggle overlay"})]}),a.jsxs("span",{className:"flex items-center gap-1.5",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded font-mono text-[10px]",children:"Esc"}),a.jsx("span",{children:"close"})]}),a.jsxs("span",{className:"flex items-center gap-1.5",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded font-mono text-[10px]",children:"1-6"}),a.jsx("span",{children:"filter category"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"text-slate-400 dark:text-slate-500",children:[y.length," shortcut",y.length!==1?"s":""]}),a.jsx("span",{className:"text-slate-300 dark:text-slate-600",children:"-"}),a.jsxs("span",{children:[p?"macOS":"Windows/Linux"," shortcuts"]})]})]})]})}):null},B5=({authServices:e,resourceId:t,onComplete:n,onClose:i,preferredLang:l="en"})=>{const[o,u]=S.useState({status:"probing"}),[d,m]=S.useState(null),[h,p]=S.useState(!1),g=Vn.findAccessService(e),y=Vn.findProbeService(e),x=Vn.findTokenService(e);S.useEffect(()=>{y&&v()},[]);const v=async()=>{if(!y)return;u({status:"probing"});const T=await Vn.probe(y,t);m(T),T.status===200?(u({status:"authenticated"}),n({status:"authenticated",probeResult:T})):T.status===401?T.substitute?u({status:"degraded",substitute:T.substitute,probeResult:T}):u({status:"unauthenticated",probeResult:T}):u({status:"error",errorMessage:`Access denied (${T.status})`})},N=()=>{g&&(p(!0),Vn.openLoginWindow(g,{onComplete:async T=>{if(p(!1),x)try{const L=await Vn.requestToken(x);if(L.type==="AuthAccessToken2"&&"accessToken"in L)Vn.storeToken(t,L.accessToken,L.expiresIn);else throw new Error("Invalid token response");await v()}catch(L){console.error("Token request failed:",L),u({status:"error",errorMessage:"Failed to retrieve access token"})}else await v()}}))},j=()=>{o.substitute&&n({status:"degraded",substitute:o.substitute,probeResult:d||void 0})},C=d?.heading?Vn.getLabel(d.heading,l):g?.header?Vn.getLabel(g.header,l):"Authentication Required",A=d?.note?Vn.getLabel(d.note,l):g?.description?Vn.getLabel(g.description,l):"This resource requires authentication to access.",_=g?.confirmLabel?Vn.getLabel(g.confirmLabel,l):"Login";return a.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",children:[a.jsx("div",{className:"p-6 border-b bg-slate-50",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-amber-100 rounded-xl flex items-center justify-center text-amber-600",children:a.jsx($,{name:"lock"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-slate-800",children:C}),a.jsx("p",{className:"text-xs text-slate-500",children:"IIIF Authorization Flow 2.0"})]})]})}),a.jsxs("div",{className:"p-6",children:[o.status==="probing"&&a.jsxs("div",{className:"flex flex-col items-center py-8",children:[a.jsx("div",{className:"w-12 h-12 border-4 border-slate-100 border-t-iiif-blue rounded-full animate-spin mb-4"}),a.jsx("p",{className:"text-sm text-slate-500",children:"Checking access..."})]}),o.status==="unauthenticated"&&a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-slate-600 mb-6",children:A}),g?.profile==="active"&&a.jsx("div",{className:"bg-blue-50 border border-blue-100 rounded-xl p-4 mb-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx($,{name:"info",className:"text-blue-600 mt-0.5"}),a.jsx("div",{className:"text-sm text-blue-800",children:"You will be redirected to a login page. After logging in, return here to continue."})]})}),g?.profile==="kiosk"&&a.jsx("div",{className:"bg-green-50 border border-green-100 rounded-xl p-4 mb-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx($,{name:"verified_user",className:"text-green-600 mt-0.5"}),a.jsx("div",{className:"text-sm text-green-800",children:"Access will be granted automatically based on your network location."})]})}),g?.profile==="external"&&a.jsx("div",{className:"bg-purple-50 border border-purple-100 rounded-xl p-4 mb-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx($,{name:"open_in_new",className:"text-purple-600 mt-0.5"}),a.jsx("div",{className:"text-sm text-purple-800",children:"Authentication is handled by an external service. You may need to log in separately."})]})})]}),o.status==="degraded"&&a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-slate-600 mb-4",children:A}),a.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx($,{name:"warning",className:"text-amber-600 mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-amber-900 mb-1",children:"Restricted Access"}),a.jsx("p",{className:"text-xs text-amber-700",children:"Full access requires authentication. A lower-quality substitute is available."})]})]})}),o.substitute&&a.jsxs("div",{className:"border rounded-lg p-3 mb-4",children:[a.jsx("p",{className:"text-xs font-medium text-slate-500 mb-1",children:"Available substitute:"}),a.jsx("p",{className:"text-sm text-slate-700 font-mono truncate",children:o.substitute.id}),o.substitute.width&&o.substitute.height&&a.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[o.substitute.width," x ",o.substitute.height]})]})]}),o.status==="authenticated"&&a.jsxs("div",{className:"flex flex-col items-center py-8",children:[a.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center text-green-600 mb-4",children:a.jsx($,{name:"check_circle",className:"text-3xl"})}),a.jsx("p",{className:"text-lg font-semibold text-green-800",children:"Access Granted"}),a.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"You can now view this resource."})]}),o.status==="error"&&a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx($,{name:"error",className:"text-red-600 mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-red-900 mb-1",children:"Authentication Error"}),a.jsx("p",{className:"text-xs text-red-700",children:o.errorMessage||"An error occurred during authentication."})]})]})})]}),a.jsxs("div",{className:"p-4 border-t bg-slate-50 flex gap-3 justify-end",children:[a.jsx("button",{onClick:i,className:"px-4 py-2 text-slate-600 hover:text-slate-800 font-medium text-sm",children:"Cancel"}),o.status==="unauthenticated"&&g&&a.jsx("button",{onClick:N,disabled:h,className:"px-6 py-2 bg-iiif-blue text-white rounded-lg font-semibold text-sm hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:h?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Logging in..."]}):a.jsxs(a.Fragment,{children:[a.jsx($,{name:"login"}),_]})}),o.status==="degraded"&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:j,className:"px-4 py-2 border border-slate-300 text-slate-700 rounded-lg font-medium text-sm hover:bg-slate-100",children:"Use Substitute"}),g&&a.jsx("button",{onClick:N,disabled:h,className:"px-6 py-2 bg-iiif-blue text-white rounded-lg font-semibold text-sm hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:h?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Logging in..."]}):a.jsxs(a.Fragment,{children:[a.jsx($,{name:"login"}),_]})})]}),o.status==="authenticated"&&a.jsx("button",{onClick:()=>n(o),className:"px-6 py-2 bg-green-600 text-white rounded-lg font-semibold text-sm hover:bg-green-700",children:"Continue"}),o.status==="error"&&a.jsx("button",{onClick:v,className:"px-4 py-2 border border-slate-300 text-slate-700 rounded-lg font-medium text-sm hover:bg-slate-100",children:"Retry"})]})]})})},Xh=({targetId:e,label:t="Skip to content",shortcut:n,className:i="",position:l="top-left"})=>{const o=d=>{d.preventDefault();const m=document.getElementById(e);m&&(m.hasAttribute("tabindex")||m.setAttribute("tabindex","-1"),m.focus(),m.scrollIntoView({block:"start"}),m.tagName!=="BUTTON"&&m.tagName!=="A"&&m.tagName!=="INPUT"&&m.tagName!=="TEXTAREA"&&m.tagName!=="SELECT"&&setTimeout(()=>{m.removeAttribute("tabindex")},1e3))},u={"top-left":"top-4 left-4","top-center":"top-4 left-1/2 -translate-x-1/2","top-right":"top-4 right-4"};return a.jsxs("a",{href:`#${e}`,onClick:o,className:`
        fixed z-[9999]
        ${u[l]}
        px-4 py-3
        bg-sky-600 text-white
        font-semibold text-sm
        rounded-lg shadow-lg
        transform -translate-y-[200%] focus:translate-y-0
        transition-transform duration-200 ease-out
        focus:outline-none focus:ring-4 focus:ring-sky-500/50
        flex items-center gap-2
        ${i}
      `,children:[a.jsx("span",{children:t}),n&&a.jsx("kbd",{className:"px-2 py-0.5 bg-sky-700 rounded text-xs font-mono",children:n})]})},H5=({root:e,onSelect:t})=>{const n=S.useRef(null),[i,l]=S.useState({width:800,height:600}),[o,u]=S.useState(null),[d,m]=S.useState(null),[h,p]=S.useState(1),[g,y]=S.useState({x:0,y:0});S.useEffect(()=>{const C=()=>{n.current&&l({width:n.current.clientWidth,height:n.current.clientHeight})};return C(),window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[]);const{geoItems:x,bounds:v,clusters:N}=S.useMemo(()=>{if(!e)return{geoItems:[],bounds:null,clusters:[]};const C=[],A=k=>{if(Wt(k)){const R=k,z=R.metadata?.find(P=>Le(P.label,"en")?.toLowerCase()==="location"||Le(P.label,"en")?.toLowerCase()==="gps");if(z){const P=Le(z.value,"en");if(P){const K=W5(P);K&&C.push({canvas:R,lat:K.lat,lng:K.lng})}}}k.items&&k.items.forEach(A)};if(A(e),C.length===0)return{geoItems:[],bounds:null,clusters:[]};const _={minLat:Math.min(...C.map(k=>k.lat)),maxLat:Math.max(...C.map(k=>k.lat)),minLng:Math.min(...C.map(k=>k.lng)),maxLng:Math.max(...C.map(k=>k.lng))},T=(_.maxLat-_.minLat)*.1||.01,L=(_.maxLng-_.minLng)*.1||.01;_.minLat-=T,_.maxLat+=T,_.minLng-=L,_.maxLng+=L;const H=G5(C,_,i,h);return{geoItems:C,bounds:_,clusters:H}},[e,i,h]),j=(C,A)=>{if(!v)return{x:0,y:0};const _=v.maxLat-v.minLat,T=v.maxLng-v.minLng,L=(A-v.minLng)/T*i.width*h+g.x,H=(v.maxLat-C)/_*i.height*h+g.y;return{x:L,y:H}};return!e||x.length===0?a.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center bg-slate-50 text-slate-400 p-8",children:[a.jsx($,{name:"map",className:"text-6xl mb-4 text-slate-300"}),a.jsx("p",{className:"text-lg font-medium",children:"No Geotagged Items"}),a.jsx("p",{className:"text-sm mt-2",children:"Items need GPS coordinates in their metadata to appear on the map."}),a.jsx("p",{className:"text-xs mt-4 text-slate-400",children:'Add a "Location" metadata field with coordinates like "40.7128, -74.0060"'})]}):a.jsxs("div",{className:"flex flex-col h-full bg-slate-200",children:[a.jsxs("div",{className:"h-14 bg-white border-b flex items-center justify-between px-6 shadow-sm",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("h2",{className:"font-bold text-slate-800 flex items-center gap-2",children:[a.jsx($,{name:"map",className:"text-green-500"}),"Map View"]}),a.jsxs("span",{className:"text-sm text-slate-500",children:[x.length," geotagged items"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>p(C=>Math.max(.5,C-.25)),className:"p-2 hover:bg-slate-100 rounded",children:a.jsx($,{name:"remove"})}),a.jsxs("span",{className:"text-sm text-slate-600 w-16 text-center",children:[Math.round(h*100),"%"]}),a.jsx("button",{onClick:()=>p(C=>Math.min(4,C+.25)),className:"p-2 hover:bg-slate-100 rounded",children:a.jsx($,{name:"add"})}),a.jsx("button",{onClick:()=>{p(1),y({x:0,y:0})},className:"p-2 hover:bg-slate-100 rounded ml-2",title:"Reset view",children:a.jsx($,{name:"center_focus_strong"})})]})]}),a.jsxs("div",{ref:n,className:"flex-1 relative overflow-hidden bg-gradient-to-b from-blue-100 to-green-100",style:{backgroundImage:`
            linear-gradient(rgba(100,150,200,0.1) 1px, transparent 1px),
            linear-gradient(90deg, rgba(100,150,200,0.1) 1px, transparent 1px)
          `,backgroundSize:`${50*h}px ${50*h}px`},children:[N.map((C,A)=>{const _=j(C.lat,C.lng),T=C.items.length>1;return a.jsx("div",{className:`absolute transform -translate-x-1/2 -translate-y-full cursor-pointer transition-transform hover:scale-110 z-10 ${o&&C.items.includes(o)?"scale-125 z-20":""}`,style:{left:_.x,top:_.y},onMouseEnter:()=>u(C.items[0]),onMouseLeave:()=>u(null),onClick:()=>{T?m(C.items):t(C.items[0].canvas)},children:a.jsxs("div",{className:`relative ${T?"w-10 h-10":"w-8 h-10"}`,children:[a.jsxs("svg",{viewBox:"0 0 24 32",className:"w-full h-full drop-shadow-lg",children:[a.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12c0 9 12 20 12 20s12-11 12-20c0-6.6-5.4-12-12-12z",fill:T?"#ef4444":"#3b82f6"}),a.jsx("circle",{cx:"12",cy:"12",r:"6",fill:"white"})]}),T?a.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-bold text-red-600 -mt-2",children:C.items.length}):C.items[0].canvas._blobUrl?a.jsx("img",{src:C.items[0].canvas._blobUrl,className:"absolute top-1 left-1 w-6 h-6 rounded-full object-cover border-2 border-white"}):a.jsx($,{name:"image",className:"absolute top-2 left-2 text-blue-600 text-xs"})]})},A)}),o&&!d&&a.jsx("div",{className:"absolute bg-white rounded-lg shadow-xl border p-2 z-30 pointer-events-none",style:{left:j(o.lat,o.lng).x+20,top:j(o.lat,o.lng).y-20},children:a.jsxs("div",{className:"flex gap-2 items-center",children:[o.canvas._blobUrl&&a.jsx("img",{src:o.canvas._blobUrl,className:"w-12 h-12 rounded object-cover"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-bold text-sm text-slate-800",children:Le(o.canvas.label,"none")||"Untitled"}),a.jsxs("div",{className:"text-xs text-slate-500",children:[o.lat.toFixed(4),", ",o.lng.toFixed(4)]})]})]})}),d&&a.jsx("div",{className:"absolute inset-0 bg-black/30 z-40 flex items-center justify-center p-8",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[a.jsxs("div",{className:"p-4 border-b flex justify-between items-center",children:[a.jsxs("h3",{className:"font-bold text-slate-800",children:[d.length," items at this location"]}),a.jsx("button",{onClick:()=>m(null),className:"text-slate-400 hover:text-slate-600",children:a.jsx($,{name:"close"})})]}),a.jsx("div",{className:"p-4 overflow-y-auto max-h-[60vh] grid grid-cols-3 gap-3",children:d.map(C=>a.jsxs("div",{className:"bg-slate-50 rounded-lg overflow-hidden cursor-pointer hover:ring-2 ring-blue-500 transition-all",onClick:()=>{m(null),t(C.canvas)},children:[a.jsx("div",{className:"aspect-square bg-slate-200",children:C.canvas._blobUrl?a.jsx("img",{src:C.canvas._blobUrl,className:"w-full h-full object-cover"}):a.jsx("div",{className:"w-full h-full flex items-center justify-center",children:a.jsx($,{name:"image",className:"text-slate-400 text-3xl"})})}),a.jsx("div",{className:"p-2",children:a.jsx("div",{className:"text-xs font-medium text-slate-700 truncate",children:Le(C.canvas.label,"none")||"Untitled"})})]},C.canvas.id))})]})}),a.jsx("div",{className:"absolute bottom-4 left-4 bg-white/90 backdrop-blur rounded px-3 py-1 text-xs text-slate-600",children:v&&a.jsxs(a.Fragment,{children:["Bounds: ",v.minLat.toFixed(2),", ",v.minLng.toFixed(2)," to ",v.maxLat.toFixed(2),", ",v.maxLng.toFixed(2),""]})})]})]})};function W5(e){const t=e.match(/(-?\d+\.?\d*)\s*[,\s]\s*(-?\d+\.?\d*)/);if(t){const i=parseFloat(t[1]),l=parseFloat(t[2]);if(!isNaN(i)&&!isNaN(l)&&Math.abs(i)<=90&&Math.abs(l)<=180)return{lat:i,lng:l}}const n=e.match(/(\d+\.?\d*)\s*?\s*([NS])?\s*[,\s]\s*(\d+\.?\d*)\s*?\s*([EW])?/i);if(n){let i=parseFloat(n[1]),l=parseFloat(n[3]);if(n[2]?.toUpperCase()==="S"&&(i=-i),n[4]?.toUpperCase()==="W"&&(l=-l),!isNaN(i)&&!isNaN(l))return{lat:i,lng:l}}return null}function G5(e,t,n,i){const o=[],u=t.maxLat-t.minLat,d=t.maxLng-t.minLng,m=h=>({x:(h.lng-t.minLng)/d*n.width*i,y:(t.maxLat-h.lat)/u*n.height*i});for(const h of e){const p=m(h);let g=!1;for(const y of o){const x=m({lat:y.lat,lng:y.lng});if(Math.sqrt(Math.pow(p.x-x.x,2)+Math.pow(p.y-x.y,2))<40){y.items.push(h),y.lat=y.items.reduce((N,j)=>N+j.lat,0)/y.items.length,y.lng=y.items.reduce((N,j)=>N+j.lng,0)/y.items.length,g=!0;break}}g||o.push({lat:h.lat,lng:h.lng,items:[h]})}return o}const Y5=({root:e,onSelect:t})=>{const[n,i]=S.useState("day"),[l,o]=S.useState(null),{groups:u,minDate:d,maxDate:m}=S.useMemo(()=>{if(!e)return{groups:[],minDate:null,maxDate:null};const p=[],g=j=>{Wt(j)&&j.navDate&&p.push(j),j.items&&j.items.forEach(g)};if(g(e),p.length===0)return{groups:[],minDate:null,maxDate:null};p.sort((j,C)=>{const A=new Date(j.navDate).getTime(),_=new Date(C.navDate).getTime();return A-_});const y=new Map;p.forEach(j=>{const C=new Date(j.navDate);let A;switch(n){case"year":A=C.getFullYear().toString();break;case"month":A=`${C.getFullYear()}-${String(C.getMonth()+1).padStart(2,"0")}`,C.toLocaleDateString("en-US",{year:"numeric",month:"long"});break;case"day":default:A=C.toISOString().split("T")[0],C.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"});break}y.has(A)||y.set(A,[]),y.get(A).push(j)});const x=Array.from(y.entries()).map(([j,C])=>({date:j,displayDate:C[0]?q5(new Date(C[0].navDate),n):j,items:C})),v=p[0]?.navDate?new Date(p[0].navDate):null,N=p[p.length-1]?.navDate?new Date(p[p.length-1].navDate):null;return{groups:x,minDate:v,maxDate:N}},[e,n]),h=u.reduce((p,g)=>p+g.items.length,0);return!e||u.length===0?a.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center bg-slate-50 text-slate-400 p-8",children:[a.jsx($,{name:"event",className:"text-6xl mb-4 text-slate-300"}),a.jsx("p",{className:"text-lg font-medium",children:"No Dated Items"}),a.jsx("p",{className:"text-sm mt-2",children:"Items need a navDate property to appear in the timeline."})]}):a.jsxs("div",{className:"flex flex-col h-full bg-slate-100",children:[a.jsxs("div",{className:"h-14 bg-white border-b flex items-center justify-between px-6 shadow-sm",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("h2",{className:"font-bold text-slate-800 flex items-center gap-2",children:[a.jsx($,{name:"timeline",className:"text-purple-500"}),"Timeline"]}),a.jsxs("span",{className:"text-sm text-slate-500",children:[h," dated items"]})]}),a.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 p-1 rounded",children:[a.jsx("button",{onClick:()=>i("day"),className:`px-3 py-1 text-xs font-bold rounded ${n==="day"?"bg-white shadow text-purple-600":"text-slate-500"}`,children:"Day"}),a.jsx("button",{onClick:()=>i("month"),className:`px-3 py-1 text-xs font-bold rounded ${n==="month"?"bg-white shadow text-purple-600":"text-slate-500"}`,children:"Month"}),a.jsx("button",{onClick:()=>i("year"),className:`px-3 py-1 text-xs font-bold rounded ${n==="year"?"bg-white shadow text-purple-600":"text-slate-500"}`,children:"Year"})]})]}),d&&m&&a.jsxs("div",{className:"h-10 bg-slate-200 flex items-center px-6 text-xs text-slate-600",children:[a.jsx("span",{children:d.toLocaleDateString()}),a.jsx("div",{className:"flex-1 mx-4 h-1 bg-slate-300 rounded relative",children:u.map((p,g)=>{const y=d.getTime(),x=m.getTime(),v=new Date(p.items[0].navDate).getTime(),N=x>y?(v-y)/(x-y)*100:0;return a.jsx("div",{className:"absolute w-2 h-2 bg-purple-500 rounded-full -top-0.5 cursor-pointer hover:scale-150 transition-transform",style:{left:`${N}%`},title:`${p.displayDate}: ${p.items.length} items`,onClick:()=>o(l===p.date?null:p.date)},p.date)})}),a.jsx("span",{children:m.toLocaleDateString()})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:a.jsx("div",{className:"max-w-4xl mx-auto",children:u.map((p,g)=>a.jsxs("div",{className:"relative pl-8 pb-8",children:[g<u.length-1&&a.jsx("div",{className:"absolute left-3 top-6 bottom-0 w-0.5 bg-slate-300"}),a.jsx("div",{className:`absolute left-0 top-1 w-6 h-6 rounded-full flex items-center justify-center ${l===p.date?"bg-purple-500":"bg-slate-400"}`,children:a.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),a.jsxs("div",{className:"flex items-center gap-3 mb-3 cursor-pointer group",onClick:()=>o(l===p.date?null:p.date),children:[a.jsx("h3",{className:"font-bold text-slate-800 group-hover:text-purple-600",children:p.displayDate}),a.jsxs("span",{className:"text-xs text-slate-400 bg-slate-200 px-2 py-0.5 rounded",children:[p.items.length," item",p.items.length!==1?"s":""]})]}),a.jsx("div",{className:`grid gap-3 ${n==="day"?"grid-cols-4 md:grid-cols-6":n==="month"?"grid-cols-6 md:grid-cols-8":"grid-cols-8 md:grid-cols-12"}`,children:p.items.map(y=>a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border hover:shadow-md hover:border-purple-300 cursor-pointer transition-all group overflow-hidden",onClick:()=>t(y),children:[a.jsxs("div",{className:"aspect-square bg-slate-100 relative overflow-hidden",children:[y._blobUrl?a.jsx("img",{src:y._blobUrl,className:"w-full h-full object-cover",loading:"lazy"}):a.jsx("div",{className:"w-full h-full flex items-center justify-center",children:a.jsx($,{name:"image",className:"text-slate-300 text-2xl"})}),n!=="day"&&a.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[8px] px-1 py-0.5 truncate",children:new Date(y.navDate).toLocaleDateString()})]}),n==="day"&&a.jsxs("div",{className:"p-1.5",children:[a.jsx("div",{className:"text-[10px] text-slate-600 truncate",children:Le(y.label,"none")||"Untitled"}),a.jsx("div",{className:"text-[9px] text-slate-400",children:new Date(y.navDate).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},y.id))})]},p.date))})})]})};function q5(e,t){switch(t){case"year":return e.getFullYear().toString();case"month":return e.toLocaleDateString("en-US",{year:"numeric",month:"long"});case"day":default:return e.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}}const V5=({className:e="",animate:t=!0})=>a.jsxs("div",{className:`p-4 border border-slate-200 rounded-xl ${e}`,children:[a.jsx("div",{className:`h-32 bg-slate-200 rounded-lg mb-4 ${t?"animate-pulse":""}`}),a.jsx("div",{className:`h-4 bg-slate-200 rounded w-3/4 mb-2 ${t?"animate-pulse":""}`}),a.jsx("div",{className:`h-4 bg-slate-200 rounded w-1/2 ${t?"animate-pulse":""}`})]}),K5=({rows:e=5,cols:t=4})=>a.jsxs("div",{className:"w-full",children:[a.jsx("div",{className:"flex gap-4 mb-4 pb-4 border-b border-slate-200",children:Array.from({length:t}).map((n,i)=>a.jsx("div",{className:"h-4 bg-slate-200 rounded animate-pulse flex-1"},`header-${i}`))}),Array.from({length:e}).map((n,i)=>a.jsx("div",{className:"flex gap-4 mb-3",children:Array.from({length:t}).map((l,o)=>a.jsx("div",{className:"h-4 bg-slate-100 rounded animate-pulse flex-1",style:{animationDelay:`${i*100}ms`}},`cell-${i}-${o}`))},`row-${i}`))]}),Iv=({items:e=8,className:t=""})=>a.jsx("div",{className:`grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 ${t}`,children:Array.from({length:e}).map((n,i)=>a.jsx("div",{style:{animationDelay:`${i*50}ms`},children:a.jsx(V5,{animate:!0})},i))}),X5=["3.0","2.1","2.0"],Dv=[{label:"Full",value:"full",desc:"Entire image"},{label:"Square",value:"square",desc:"Centered square crop"},{label:"Pixels",value:"pixel",desc:"x,y,w,h in pixels"},{label:"Percent",value:"pct",desc:"Percent-based region"}],Lv=[{label:"Max",value:"max",desc:"Maximum available size"},{label:"Percent",value:"pct",desc:"Scale by percentage"},{label:"Width",value:"w",desc:"Width only, auto height"},{label:"Height",value:"h",desc:"Height only, auto width"},{label:"Exact",value:"wh",desc:"Exact width,height"},{label:"Best Fit",value:"bestfit",desc:"Fit within dimensions"}],Rv=[{value:"default",label:"Default",desc:"Recommended quality"},{value:"color",label:"Color",desc:"Full color (if available)"},{value:"gray",label:"Gray",desc:"Grayscale conversion"},{value:"bitonal",label:"Bitonal",desc:"Black and white only"}],Zh=[{value:"jpg",label:"JPEG",desc:"Lossy compression, small files",mime:"image/jpeg"},{value:"png",label:"PNG",desc:"Lossless with alpha support",mime:"image/png"},{value:"webp",label:"WebP",desc:"Modern format, best compression",mime:"image/webp"},{value:"tif",label:"TIFF",desc:"Archive quality, uncompressed",mime:"image/tiff"},{value:"gif",label:"GIF",desc:"Limited colors, animation support",mime:"image/gif"}],nN=({canvas:e,onClose:t,onApply:n})=>{const{showToast:i}=ws(),l=e.items?.[0]?.items?.[0]?.body,o=l?.service?.[0],u=o?.id||l?.id||"",d="/field-studio/",m=S.useMemo(()=>{if(!u)return"";if(u.startsWith("http://")||u.startsWith("https://")){const Y=window.location.origin;return u.startsWith(Y)&&!u.includes(d)?u.replace(Y,Y+d.replace(/\/$/,"")):u}return u.startsWith("/")&&!u.startsWith(d)?d.replace(/\/$/,"")+u:u},[u,d]),h=!!o;S.useEffect(()=>{const Y=X=>{X.key==="Escape"&&t()};return document.addEventListener("keydown",Y),()=>document.removeEventListener("keydown",Y)},[t]);const[p,g]=S.useState("3.0"),[y,x]=S.useState("full"),[v,N]=S.useState("max"),[j,C]=S.useState({x:0,y:0,w:100,h:100}),[A,_]=S.useState({w:1e3,h:1e3,pct:100}),[T,L]=S.useState(0),[H,k]=S.useState(!1),[R,z]=S.useState(!1),[P,K]=S.useState("default"),[I,D]=S.useState("jpg"),[E,q]=S.useState(!1),[W,G]=S.useState("params"),te=S.useMemo(()=>{let Y="full";y==="square"?Y="square":y==="pct"?Y=`pct:${j.x},${j.y},${j.w},${j.h}`:y==="pixel"&&(Y=`${j.x},${j.y},${j.w},${j.h}`);let X="max";const Q=R?"^":"";v==="pct"?X=`${Q}pct:${A.pct}`:v==="w"?X=`${Q}${A.w},`:v==="h"?X=`${Q},${A.h}`:v==="wh"?X=`${Q}${A.w},${A.h}`:v==="bestfit"&&(X=`${Q}!${A.w},${A.h}`);let ue=T.toString();return H&&(ue=`!${ue}`),{region:Y,size:X,rotation:ue,quality:P,format:I}},[y,v,j,A,T,H,R,P,I]),U=h?`${m}/${te.region}/${te.size}/${te.rotation}/${te.quality}.${te.format}`:m,V=h?`${m}/info.json`:null,O=`curl -X GET "${U}" \\
  -H "Accept: ${Zh.find(Y=>Y.value===I)?.mime||"image/jpeg"}"`,B=`<img src="${U}" \\
  alt="IIIF Image" \\
  loading="lazy" />`;return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",onClick:t,children:a.jsxs("div",{className:"bg-white w-full max-w-6xl h-[90vh] rounded-2xl shadow-2xl border border-slate-200 flex overflow-hidden animate-in fade-in zoom-in-95 duration-300",onClick:Y=>Y.stopPropagation(),children:[a.jsxs("div",{className:"flex-1 bg-slate-900 relative flex flex-col overflow-hidden",children:[a.jsxs("div",{className:"h-12 border-b border-white/10 flex items-center px-4 justify-between bg-black/20 shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:["IIIF Image API ",p," Preview"]}),a.jsx("select",{value:p,onChange:Y=>g(Y.target.value),className:"text-[10px] bg-white/10 border border-white/20 rounded px-2 py-1 text-white/70 outline-none",children:X5.map(Y=>a.jsx("option",{value:Y,children:Y},Y))})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>q(!E),className:`text-[10px] px-2 py-1 rounded ${E?"bg-blue-600 text-white":"bg-white/10 text-white/60"}`,children:"info.json"}),a.jsxs("div",{className:"flex items-center gap-1 bg-green-500/20 px-2 py-1 rounded",children:[a.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),a.jsx("span",{className:"text-[9px] text-green-400 font-bold uppercase",children:"Valid"})]})]})]}),a.jsxs("div",{className:"flex-1 flex items-center justify-center p-6 relative group bg-slate-950",children:[a.jsx("div",{className:"absolute inset-0 opacity-5",style:{backgroundImage:"radial-gradient(#64748b 1px, transparent 1px)",backgroundSize:"20px 20px"}}),E&&V?a.jsxs("div",{className:"w-full h-full overflow-auto bg-slate-900 p-4 rounded-lg",children:[a.jsx("div",{className:"text-[10px] text-slate-400 mb-2",children:V}),a.jsx("pre",{className:"text-xs text-green-400 font-mono",children:JSON.stringify({"@context":kt.IMAGE_3.CONTEXT,id:m,type:"ImageService3",protocol:kt.IMAGE_3.PROTOCOL,width:e.width||0,height:e.height||0,profile:"level2",extraFeatures:["regionByPx","regionByPct","sizeByWh","rotationByDegrees","mirroring"]},null,2)})]}):a.jsx("img",{src:U,className:"max-w-[90%] max-h-[90%] object-contain shadow-2xl ring-1 ring-white/20 transition-all duration-300 bg-slate-800",style:{transform:`scaleX(${H?-1:1}) rotate(${T}deg)`},onError:Y=>{Y.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><rect fill="%231e293b" width="400" height="300"/><text fill="%2394a3b8" x="50%" y="50%" text-anchor="middle" font-family="sans-serif">Invalid Request</text></svg>'},alt:"IIIF Image Preview"})]}),a.jsx("div",{className:"p-3 bg-slate-950 text-white font-mono text-xs border-t border-white/10 shrink-0",children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsxs("span",{className:"text-white/30 truncate max-w-[150px]",children:[m,"/"]}),a.jsx("span",{className:"text-green-400 font-bold bg-green-400/10 px-1 rounded",title:"Region",children:te.region}),a.jsx("span",{className:"text-white/30",children:"/"}),a.jsx("span",{className:"text-blue-400 font-bold bg-blue-400/10 px-1 rounded",title:"Size",children:te.size}),a.jsx("span",{className:"text-white/30",children:"/"}),a.jsx("span",{className:"text-orange-400 font-bold bg-orange-400/10 px-1 rounded",title:"Rotation",children:te.rotation}),a.jsx("span",{className:"text-white/30",children:"/"}),a.jsx("span",{className:"text-purple-400 font-bold bg-purple-400/10 px-1 rounded",title:"Quality",children:te.quality}),a.jsx("span",{className:"text-white/30",children:"."}),a.jsx("span",{className:"text-yellow-400 font-bold bg-yellow-400/10 px-1 rounded",title:"Format",children:te.format}),a.jsx("div",{className:"flex-1"}),a.jsx("button",{onClick:()=>{navigator.clipboard.writeText(U),i("URL copied","success")},className:"p-1.5 hover:bg-white/10 rounded transition-all",title:"Copy URL",children:a.jsx($,{name:"content_copy",className:"text-sm"})})]})})]}),a.jsxs("div",{className:"w-96 bg-white border-l border-slate-200 flex flex-col",children:[a.jsx("div",{className:"flex border-b",children:[{id:"params",label:"Parameters",icon:"tune"},{id:"code",label:"Code",icon:"code"}].map(Y=>a.jsxs("button",{onClick:()=>G(Y.id),className:`flex-1 py-3 text-[10px] font-bold uppercase tracking-wider flex items-center justify-center gap-1.5 ${W===Y.id?"text-blue-600 border-b-2 border-blue-600 bg-blue-50/50":"text-slate-500 hover:bg-slate-50"}`,children:[a.jsx($,{name:Y.icon,className:"text-xs"})," ",Y.label]},Y.id))}),a.jsxs("div",{className:"flex-1 overflow-y-auto",children:[W==="params"&&a.jsxs("div",{className:"p-4 space-y-6",children:[a.jsxs("section",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"text-[10px] font-bold text-green-600 uppercase tracking-wider flex items-center gap-1.5",children:[a.jsx($,{name:"crop",className:"text-xs"})," Region"]}),a.jsx("select",{value:y,onChange:Y=>x(Y.target.value),className:"text-xs font-bold border rounded px-2 py-1 bg-slate-50 outline-none",children:Dv.map(Y=>a.jsx("option",{value:Y.value,children:Y.label},Y.value))})]}),a.jsx("p",{className:"text-[10px] text-slate-400",children:Dv.find(Y=>Y.value===y)?.desc}),y!=="full"&&y!=="square"&&a.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{key:"x",label:"X"},{key:"y",label:"Y"},{key:"w",label:y==="pct"?"W %":"Width"},{key:"h",label:y==="pct"?"H %":"Height"}].map(({key:Y,label:X})=>a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-[9px] text-slate-500 uppercase font-bold",children:X}),a.jsx("input",{type:"number",value:j[Y],onChange:Q=>C({...j,[Y]:Number(Q.target.value)}),className:"w-full text-xs p-2 border rounded focus:ring-1 focus:ring-green-500 outline-none"})]},Y))})]}),a.jsxs("section",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"text-[10px] font-bold text-blue-600 uppercase tracking-wider flex items-center gap-1.5",children:[a.jsx($,{name:"aspect_ratio",className:"text-xs"})," Size"]}),a.jsxs("div",{className:"flex gap-2 items-center",children:[a.jsx("button",{onClick:()=>z(!R),className:`text-[9px] font-bold uppercase px-2 py-1 rounded border transition-all ${R?"bg-blue-600 border-blue-700 text-white":"text-slate-400 hover:border-slate-300"}`,title:"Allow upscaling beyond original size",children:"Upscale ^"}),a.jsx("select",{value:v,onChange:Y=>N(Y.target.value),className:"text-xs font-bold border rounded px-2 py-1 bg-slate-50 outline-none",children:Lv.map(Y=>a.jsx("option",{value:Y.value,children:Y.label},Y.value))})]})]}),a.jsx("p",{className:"text-[10px] text-slate-400",children:Lv.find(Y=>Y.value===v)?.desc}),v==="pct"?a.jsxs("div",{className:"space-y-2",children:[a.jsx("input",{type:"range",min:"1",max:"200",value:A.pct,onChange:Y=>_({...A,pct:Number(Y.target.value)}),className:"w-full accent-blue-500"}),a.jsxs("div",{className:"text-center text-xs font-mono text-blue-600",children:[A.pct,"%"]})]}):v!=="max"&&a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[v!=="h"&&a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-[9px] text-slate-500 uppercase font-bold",children:"Width"}),a.jsx("input",{type:"number",value:A.w,onChange:Y=>_({...A,w:Number(Y.target.value)}),className:"p-2 border rounded text-xs"})]}),v!=="w"&&a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-[9px] text-slate-500 uppercase font-bold",children:"Height"}),a.jsx("input",{type:"number",value:A.h,onChange:Y=>_({...A,h:Number(Y.target.value)}),className:"p-2 border rounded text-xs"})]})]})]}),a.jsxs("section",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"text-[10px] font-bold text-orange-600 uppercase tracking-wider flex items-center gap-1.5",children:[a.jsx($,{name:"rotate_right",className:"text-xs"})," Rotation"]}),a.jsx("button",{onClick:()=>k(!H),className:`p-1.5 rounded border transition-all ${H?"bg-orange-500 border-orange-600 text-white":"text-slate-400 hover:border-slate-300"}`,title:"Mirror horizontally",children:a.jsx($,{name:"flip",className:"text-sm"})})]}),a.jsx("div",{className:"grid grid-cols-4 gap-1",children:[0,90,180,270].map(Y=>a.jsxs("button",{onClick:()=>L(Y),className:`py-2 text-xs font-bold border rounded ${T===Y?"bg-orange-50 border-orange-500 text-orange-700":"hover:bg-slate-50"}`,children:[Y,""]},Y))}),a.jsx("input",{type:"range",min:"0",max:"359",value:T,onChange:Y=>L(Number(Y.target.value)),className:"w-full accent-orange-500"})]}),a.jsxs("section",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"text-[10px] font-bold text-purple-600 uppercase tracking-wider flex items-center gap-1.5",children:[a.jsx($,{name:"high_quality",className:"text-xs"})," Quality"]}),a.jsx("select",{value:P,onChange:Y=>K(Y.target.value),className:"w-full text-xs p-2 border rounded font-bold",children:Rv.map(Y=>a.jsx("option",{value:Y.value,children:Y.label},Y.value))}),a.jsx("p",{className:"text-[9px] text-slate-400",children:Rv.find(Y=>Y.value===P)?.desc})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"text-[10px] font-bold text-yellow-600 uppercase tracking-wider flex items-center gap-1.5",children:[a.jsx($,{name:"image",className:"text-xs"})," Format"]}),a.jsx("select",{value:I,onChange:Y=>D(Y.target.value),className:"w-full text-xs p-2 border rounded font-bold",children:Zh.map(Y=>a.jsx("option",{value:Y.value,children:Y.label},Y.value))}),a.jsx("p",{className:"text-[9px] text-slate-400",children:Zh.find(Y=>Y.value===I)?.desc})]})]})]}),W==="code"&&a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-wider",children:"cURL"}),a.jsx("pre",{className:"bg-slate-900 text-green-400 text-xs p-3 rounded-lg overflow-x-auto font-mono",children:O}),a.jsx("button",{onClick:()=>{navigator.clipboard.writeText(O),i("cURL copied","success")},className:"text-xs text-blue-600 hover:text-blue-700 font-bold",children:"Copy cURL"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-wider",children:"HTML"}),a.jsx("pre",{className:"bg-slate-900 text-blue-400 text-xs p-3 rounded-lg overflow-x-auto font-mono",children:B}),a.jsx("button",{onClick:()=>{navigator.clipboard.writeText(B),i("HTML copied","success")},className:"text-xs text-blue-600 hover:text-blue-700 font-bold",children:"Copy HTML"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-wider",children:"IIIF Info URL"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:V||"N/A",readOnly:!0,className:"flex-1 text-xs p-2 border rounded bg-slate-50 font-mono"}),V&&a.jsx("button",{onClick:()=>{navigator.clipboard.writeText(V),i("Info URL copied","success")},className:"px-3 py-2 bg-slate-800 text-white rounded text-xs font-bold",children:"Copy"})]})]})]})]}),a.jsxs("div",{className:"p-4 bg-slate-50 border-t space-y-2",children:[a.jsx("button",{onClick:()=>{n&&n(U),t()},className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-2.5 rounded-lg font-bold shadow-md transition-all",children:"Apply to Canvas"}),a.jsx("button",{onClick:()=>{x("full"),N("max"),L(0),k(!1),z(!1),K("default"),D("jpg")},className:"w-full bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 py-2 rounded-lg font-bold text-sm transition-all",children:"Reset to Defaults"})]})]})]})})},Z5=S.createContext(null),sN=S.createContext(null),aN=S.createContext(null),J5=({children:e,initialRoot:t=null,historySize:n=100})=>{const[i,l]=S.useState(()=>t?Uc(t):fw()),[o]=S.useState(()=>new QE(i,n)),[u,d]=S.useState({canUndo:!1,canRedo:!1});S.useEffect(()=>o.subscribe(j=>{l(j);const C=o.getHistoryStatus();d({canUndo:C.canUndo,canRedo:C.canRedo})}),[o]),S.useEffect(()=>{if(t){const N=Uc(t);l(N)}},[t]);const m=S.useCallback(N=>o.dispatch(N),[o]),h=S.useCallback(()=>o.undo(),[o]),p=S.useCallback(()=>o.redo(),[o]),g=S.useCallback(N=>{Uc(N),o.dispatch(iu.reloadTree(N))},[o]),y=S.useMemo(()=>({state:i,getEntity:N=>Yn(i,N),exportRoot:()=>wE(i),rootId:i.rootId}),[i]),x=S.useMemo(()=>({dispatcher:o,dispatch:m,undo:h,redo:p,canUndo:u.canUndo,canRedo:u.canRedo,loadRoot:g}),[o,m,h,p,u.canUndo,u.canRedo,g]),v=S.useMemo(()=>({...y,...x}),[y,x]);return a.jsx(Z5.Provider,{value:y,children:a.jsx(sN.Provider,{value:x,children:a.jsx(aN.Provider,{value:v,children:e})})})};function iN(){const e=S.useContext(sN);if(!e)throw new Error("useVaultDispatch must be used within a VaultProvider");return e}function Q5(){const e=S.useContext(aN);if(!e)throw new Error("useVault must be used within a VaultProvider");return e}function eM(){const{undo:e,redo:t,canUndo:n,canRedo:i,dispatcher:l}=iN(),o=S.useMemo(()=>l.getHistoryStatus(),[l]);return{undo:e,redo:t,canUndo:n,canRedo:i,position:o.position,total:o.total}}function tM(){const{dispatch:e}=iN(),t=S.useCallback(i=>e(iu.batchUpdate(i)),[e]),n=S.useCallback(i=>{const l=i.map(({id:o,label:u})=>({id:o,changes:{label:u}}));return e(iu.batchUpdate(l))},[e]);return{batchUpdate:t,updateMultipleLabels:n}}function nM(){const{undo:e,redo:t,canUndo:n,canRedo:i}=eM();S.useEffect(()=>{const l=o=>{(o.metaKey||o.ctrlKey)&&o.key==="z"&&(o.shiftKey?i&&(o.preventDefault(),t()):n&&(o.preventDefault(),e())),(o.metaKey||o.ctrlKey)&&o.key==="y"&&i&&(o.preventDefault(),t())};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[e,t,n,i])}const Mv="iiif-field-settings",Jh={defaultBaseUrl:ct.BASE_URL.DEFAULT,language:"en",theme:"light",fieldMode:!1,abstractionLevel:"standard",mapConfig:UC,zoomConfig:BC,height:800,ingestPreferences:Qt,autoSaveInterval:30,showTechnicalIds:!1,metadataTemplate:Ps.ARCHIVIST,metadataComplexity:"standard"};function sM(){const[e,t]=S.useState(()=>{try{const o=localStorage.getItem(Mv);if(o){const u=JSON.parse(o);return{...Jh,...u}}}catch(o){console.warn("Failed to load settings from localStorage:",o)}return Jh});S.useEffect(()=>{try{localStorage.setItem(Mv,JSON.stringify(e))}catch(o){console.warn("Failed to save settings to localStorage:",o)}},[e]);const n=S.useCallback(o=>{t(u=>({...u,...o}))},[]),i=S.useCallback(()=>{t(o=>({...o,fieldMode:!o.fieldMode}))},[]),l=S.useCallback(()=>{t(Jh)},[]);return{settings:e,updateSettings:n,toggleFieldMode:i,resetSettings:l}}function fa(e=!1){const[t,n]=S.useState(e),i=S.useCallback(()=>n(!0),[]),l=S.useCallback(()=>n(!1),[]),o=S.useCallback(()=>n(u=>!u),[]);return{isOpen:t,open:i,close:l,toggle:o}}function rN(){const[e,t]=S.useState({width:window.innerWidth,height:window.innerHeight});S.useEffect(()=>{const o=()=>{t({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]);const n=e.width<768,i=e.width>=768&&e.width<=1024,l=e.width>1024;return{width:e.width,height:e.height,isMobile:n,isTablet:i,isDesktop:l,isTouchDevice:n||i}}const Ts={MIN_SCALE:.1,MAX_SCALE:5,INITIAL_SCALE:1,ZOOM_STEP:1.2,WHEEL_SENSITIVITY:.001,PAN_KEYBOARD_STEP:50,INITIAL_ROTATION:0,ROTATION_STEP:90},js={ZOOM_IN:["+","="],ZOOM_OUT:["-"],RESET:"0",PAN_MODE:" ",ROTATE_CW:"r",ROTATE_CCW:"R",PAN_UP:"ArrowUp",PAN_DOWN:"ArrowDown",PAN_LEFT:"ArrowLeft",PAN_RIGHT:"ArrowRight"};function lN(e={}){const{minScale:t=Ts.MIN_SCALE,maxScale:n=Ts.MAX_SCALE,initialScale:i=Ts.INITIAL_SCALE,initialX:l=0,initialY:o=0,initialRotation:u=Ts.INITIAL_ROTATION,enableRotation:d=!1,zoomStep:m=Ts.ZOOM_STEP}=e,h={x:l,y:o,scale:Math.max(t,Math.min(n,i)),rotation:u},[p,g]=S.useState(h),y=S.useCallback(E=>Math.max(t,Math.min(n,E)),[t,n]),x=S.useCallback(E=>{const q=E%360;return q<0?q+360:q},[]),v=S.useCallback(E=>{g(q=>{const W=typeof E=="function"?E(q):E;return{...W,scale:y(W.scale),rotation:x(W.rotation)}})},[y,x]),N=S.useCallback(()=>{v(E=>({...E,scale:y(E.scale*m)}))},[v,y,m]),j=S.useCallback(()=>{v(E=>({...E,scale:y(E.scale/m)}))},[v,y,m]),C=S.useCallback(E=>{v(q=>({...q,scale:y(E)}))},[v,y]),A=S.useCallback((E,q,W,G=40)=>{const te=E.width-G*2,U=E.height-G*2,V=te/q,O=U/W,B=Math.min(V,O),Y=q*B,X=W*B,Q=(E.width-Y)/2,ue=(E.height-X)/2;v({x:Q,y:ue,scale:y(B),rotation:p.rotation})},[v,y,p.rotation]),_=S.useCallback((E,q,W)=>{v(G=>{const te=y(G.scale*(1-E*Ts.WHEEL_SENSITIVITY)),U=(q.x-W.left-G.x)/G.scale,V=(q.y-W.top-G.y)/G.scale,O=q.x-W.left-U*te,B=q.y-W.top-V*te;return{...G,x:O,y:B,scale:te}})},[v,y]),T=S.useCallback((E,q)=>{v(W=>({...W,x:W.x+E,y:W.y+q}))},[v]),L=S.useCallback((E,q)=>{v(W=>({...W,x:E,y:q}))},[v]),H=S.useCallback(E=>{d&&v(q=>({...q,rotation:x(q.rotation+E)}))},[v,d,x]),k=S.useCallback(()=>{g(h)},[h]),R=S.useCallback(()=>{const{x:E,y:q,scale:W,rotation:G}=p,te=[];return(E!==0||q!==0)&&te.push(`translate(${E}px, ${q}px)`),W!==1&&te.push(`scale(${W})`),G!==0&&te.push(`rotate(${G}deg)`),te.join(" ")||"none"},[p]),z=S.useCallback(()=>({transform:R(),transformOrigin:"0 0"}),[R]),P=S.useCallback((E,q,W)=>{const{x:G,y:te,scale:U,rotation:V}=p;let O=(E-W.left-G)/U,B=(q-W.top-te)/U;if(V!==0){const Y=-V*Math.PI/180,X=Math.cos(Y),Q=Math.sin(Y),ue=O*X-B*Q,be=O*Q+B*X;O=ue,B=be}return{x:O,y:B}},[p]),K=S.useCallback((E,q,W)=>{const{x:G,y:te,scale:U,rotation:V}=p;let O=E,B=q;if(V!==0){const Q=V*Math.PI/180,ue=Math.cos(Q),be=Math.sin(Q),de=O*ue-B*be,ye=O*be+B*ue;O=de,B=ye}const Y=O*U+G+W.left,X=B*U+te+W.top;return{x:Y,y:X}},[p]),I=Math.round(p.scale*100),D=S.useMemo(()=>({minScale:t,maxScale:n,zoomStep:m,enableRotation:d}),[t,n,m,d]);return{viewport:p,setViewport:v,zoomIn:N,zoomOut:j,zoomTo:C,zoomToFit:A,zoomAtPoint:_,pan:T,panTo:L,rotate:H,reset:k,getTransformStyle:z,getTransformString:R,screenToCanvas:P,canvasToScreen:K,scalePercent:I,config:D}}function oN(e,t,n={}){const{onZoom:i,onPan:l,onPanStart:o,onPanEnd:u,enabled:d=!0,panButton:m="middle",zoomSensitivity:h=Ts.WHEEL_SENSITIVITY,preventDefault:p=!0,requireCtrlForZoom:g=!1,enableWheelPan:y=!1}=n,[x,v]=S.useState(!1),[N,j]=S.useState(!1),C=S.useRef(null);S.useCallback(R=>m==="any"?!0:m==="middle"?R.button===1:m==="left"?R.button===0:!1,[m]);const A=S.useCallback(R=>!!(R.button===1||R.button===0&&(N||R.shiftKey)||m==="left"&&R.button===0||m==="any"),[N,m]),_=S.useCallback(R=>{d&&A(R)&&(R.preventDefault(),v(!0),C.current={x:R.clientX,y:R.clientY},o?.())},[d,A,o]),T=S.useCallback(R=>{if(!d||!x||!C.current)return;const z=R.clientX-C.current.x,P=R.clientY-C.current.y;C.current={x:R.clientX,y:R.clientY},t.pan(z,P),l?.(z,P)},[d,x,t,l]),L=S.useCallback(R=>{x&&(v(!1),C.current=null,u?.())},[x,u]),H=S.useCallback(R=>{x&&(v(!1),C.current=null,u?.())},[x,u]),k=S.useCallback(R=>{if(!d)return;const z=e.current;if(!z)return;const P=R.ctrlKey||R.metaKey;if(g?P:!0){p&&R.preventDefault();const I=z.getBoundingClientRect(),D={x:R.clientX,y:R.clientY};t.zoomAtPoint(R.deltaY,D,I),i?.(R.deltaY,D)}else y&&!P&&(p&&R.preventDefault(),t.pan(-R.deltaX,-R.deltaY),l?.(-R.deltaX,-R.deltaY))},[d,e,g,p,y,t,i,l]);return S.useEffect(()=>{const R=()=>{x&&(v(!1),C.current=null,u?.())};return window.addEventListener("mouseup",R),()=>window.removeEventListener("mouseup",R)},[x,u]),{isPanning:x,isPanModeActive:N,handlers:{onMouseDown:_,onMouseMove:T,onMouseUp:L,onMouseLeave:H,onWheel:k},setPanModeActive:j}}function aM(e,t,n,i={}){const{enabled:l=!0,enableZoom:o=!0,enablePan:u=!0,enableRotation:d=!1,enableReset:m=!0,enableSpacePan:h=!0,panStep:p=Ts.PAN_KEYBOARD_STEP,rotationStep:g=Ts.ROTATION_STEP,onShortcut:y}=i,x=S.useCallback(v=>{switch(v){case"zoomIn":t.zoomIn();break;case"zoomOut":t.zoomOut();break;case"reset":t.reset();break;case"panUp":t.pan(0,p);break;case"panDown":t.pan(0,-p);break;case"panLeft":t.pan(p,0);break;case"panRight":t.pan(-p,0);break;case"rotateCW":t.rotate(g);break;case"rotateCCW":t.rotate(-g);break}y?.(v)},[t,p,g,y]);return S.useEffect(()=>{if(!l)return;const v=j=>{const C=e.current;if(!C)return;const A=document.activeElement,_=C.contains(A)||A===document.body||A===null;if(A instanceof HTMLInputElement||A instanceof HTMLTextAreaElement||A instanceof HTMLSelectElement||A?.isContentEditable||!_)return;const T=j.ctrlKey||j.metaKey,L=j.key;if(h&&L===js.PAN_MODE&&!j.repeat){j.preventDefault(),n?.setPanModeActive(!0);return}if(o){if(js.ZOOM_IN.includes(L)){j.preventDefault(),x("zoomIn");return}if(js.ZOOM_OUT.includes(L)){j.preventDefault(),x("zoomOut");return}}if(m&&L===js.RESET&&T){j.preventDefault(),x("reset");return}if(u)switch(L){case js.PAN_UP:j.preventDefault(),x("panUp");return;case js.PAN_DOWN:j.preventDefault(),x("panDown");return;case js.PAN_LEFT:j.preventDefault(),x("panLeft");return;case js.PAN_RIGHT:j.preventDefault(),x("panRight");return}if(d&&t.config.enableRotation){if(L===js.ROTATE_CCW&&j.shiftKey){j.preventDefault(),x("rotateCCW");return}if(L.toLowerCase()===js.ROTATE_CW.toLowerCase()&&!j.shiftKey){j.preventDefault(),x("rotateCW");return}}},N=j=>{h&&j.key===js.PAN_MODE&&n?.setPanModeActive(!1)};return window.addEventListener("keydown",v),window.addEventListener("keyup",N),()=>{window.removeEventListener("keydown",v),window.removeEventListener("keyup",N)}},[l,o,u,d,m,h,e,t,n,x]),{triggerAction:x}}function iM({hasUnsavedChanges:e,confirmMessage:t="You have unsaved changes. Are you sure you want to leave?",onConfirm:n,onCancel:i}){const[l,o]=S.useState(!1),u=S.useRef(null);S.useEffect(()=>{const g=y=>{if(e)return y.preventDefault(),y.returnValue=t,t};return window.addEventListener("beforeunload",g),()=>window.removeEventListener("beforeunload",g)},[e,t]);const d=S.useCallback(g=>e?(u.current=g,o(!0),!1):(g(),!0),[e]),m=S.useCallback(()=>{o(!1),n?.(),u.current&&(u.current(),u.current=null)},[n]),h=S.useCallback(()=>{o(!1),u.current=null,i?.()},[i]),p=S.useCallback(()=>{o(!1),u.current=null},[]);return{isConfirming:l,pendingAction:u.current,requestNavigation:d,confirm:m,cancel:h,reset:p}}function cN(e){const t=S.useRef(null),n=S.useRef(null);return S.useCallback((...i)=>{n.current=i,t.current===null&&(t.current=requestAnimationFrame(()=>{n.current&&e(...n.current),t.current=null,n.current=null}))},[e])}function rM(e,t,n){let i=0,l=n-1;for(;i<=l;){const o=Math.floor((i+l)/2),u=o*t;if(u<=e&&e<u+t)return o;u<e?i=o+1:l=o-1}return Math.min(i,n-1)}function uN(e){const{totalItems:t,itemHeight:n,containerRef:i,overscan:l=5,enableRAFThrottle:o=!0}=e,[u,d]=S.useState({start:0,end:50}),m=t>1e4,h=S.useCallback(j=>m?rM(j,n,t):Math.floor(j/n),[n,t,m]),p=S.useCallback(j=>Math.max(0,Math.min(j,t-1))*n,[n,t]),g=S.useCallback(()=>{const j=i.current;if(!j)return;const C=j.scrollTop,A=j.clientHeight,_=h(C),T=Math.ceil(A/n),L=Math.max(0,_-l),H=Math.min(t,_+T+l);d(k=>k.start===L&&k.end===H?k:{start:L,end:H})},[i,n,l,t,h]),y=cN(g);S.useEffect(()=>{const j=i.current;if(!j)return;const C=m&&o?y:g;return g(),j.addEventListener("scroll",C,{passive:!0}),window.addEventListener("resize",g),()=>{j.removeEventListener("scroll",C),window.removeEventListener("resize",g)}},[i,g,y,m,o]);const x=S.useMemo(()=>t*n,[t,n]),v=u.start*n,N=Math.max(0,x-u.end*n);return{visibleRange:u,totalHeight:x,topSpacer:v,bottomSpacer:N,getItemAtPosition:h,getPositionForItem:p}}function lM(e){const{totalItems:t,itemSize:n,containerRef:i,columnsOverride:l,overscan:o=2,gap:u=16,enableRAFThrottle:d=!0}=e,[m,h]=S.useState({start:0,end:50}),[p,g]=S.useState(l||4),y=t>1e4,x=n.height+u,v=S.useCallback(z=>{if(l)return l;const K=Math.max(0,z-48);return Math.max(1,Math.floor(K/(n.width+u)))},[l,n.width,u]),N=S.useCallback(()=>{const z=i.current;if(!z)return;const P=z.scrollTop,K=z.clientHeight,I=z.clientWidth,D=v(I);g(D);const E=Math.max(0,Math.floor(P/x)-o),q=Math.ceil(K/x),W=E+q+o*2,G=E*D,te=Math.min(t,W*D);h(U=>U.start===G&&U.end===te?U:{start:G,end:te})},[i,x,o,t,v]),j=cN(N);S.useEffect(()=>{const z=i.current;if(!z)return;const P=y&&d?j:N;N(),z.addEventListener("scroll",P,{passive:!0}),window.addEventListener("resize",N);const K=new ResizeObserver(N);return K.observe(z),()=>{z.removeEventListener("scroll",P),window.removeEventListener("resize",N),K.disconnect()}},[i,N,j,y,d]);const C=S.useCallback(z=>{const P=Math.floor(z/x);return Math.min(P*p,t-1)},[x,p,t]),A=S.useCallback(z=>Math.floor(z/p)*x,[x,p]),_=Math.ceil(t/p),T=_*x,H=Math.floor(m.start/p)*x,k=Math.ceil(m.end/p),R=Math.max(0,(_-k)*x);return{visibleRange:m,columns:p,totalHeight:T,topSpacer:H,bottomSpacer:R,rowHeight:x,getItemAtPosition:C,getPositionForItem:A}}const oM=15;function cM(e,t,n){const i=[],l=new Map;l.set(null,[e]);const o=(g,y)=>{const x=g.items||[];l.set(g.id,x),t.has(g.id)&&x.forEach(v=>o(v,g.id))};o(e);const u=new Map,d=(g,y,x)=>{const N=(l.get(x)||[]).filter(A=>x===null?!0:t.has(x)||x===e.id),j=N.findIndex(A=>A.id===g.id);u.set(g.id,{setSize:N.length,posInSet:j+1,level:y+1});const C=g.items||[];t.has(g.id)&&y<n&&C.forEach(A=>d(A,y+1,g.id))},m=l.get(null)||[],h=m.findIndex(g=>g.id===e.id);u.set(e.id,{setSize:m.length,posInSet:h>=0?h+1:1,level:1}),t.has(e.id)&&(e.items||[]).forEach(y=>d(y,1,e.id));const p=(g,y,x)=>{const v=g.items||[],N=v.length>0,j=t.has(g.id),C=u.get(g.id)||{setSize:1,posInSet:1,level:y+1};i.push({id:g.id,node:g,level:y,parentId:x,index:i.length,hasChildren:N,isExpanded:N?j:!1,isLeaf:!N,aria:{setSize:C.setSize,posInSet:C.posInSet,level:C.level}}),j&&N&&y<n&&v.forEach(A=>p(A,y+1,g.id))};return p(e,0,null),i}function uM(e){const{root:t,containerRef:n,estimatedRowHeight:i=40,overscan:l=5,defaultExpanded:o=!1,maxDepth:u=oM,expandedIds:d,onExpandedChange:m}=e,h=d!==void 0,[p,g]=S.useState(()=>{if(!t||!o)return new Set;const D=new Set,E=(q,W)=>{if(W>=3)return;D.add(q.id),(q.items||[]).forEach(te=>E(te,W+1))};return E(t,0),D}),y=h?d:p,x=S.useCallback(D=>{if(h){const E=typeof D=="function"?D(d):D;m?.(E)}else g(D)},[h,m,d]),v=S.useMemo(()=>t?cM(t,y,u):[],[t,y,u]),N=S.useMemo(()=>{const D=new Map;return v.forEach(E=>D.set(E.id,E)),D},[v]),j=uN({totalItems:v.length,itemHeight:i,containerRef:n,overscan:l}),C=S.useMemo(()=>{const{start:D,end:E}=j.visibleRange;return v.slice(D,E)},[v,j.visibleRange]),A=S.useCallback(D=>{x(E=>{const q=new Set(E);return q.has(D)?q.delete(D):q.add(D),q})},[x]),_=S.useCallback(D=>{x(E=>new Set([...E,D]))},[x]),T=S.useCallback(D=>{x(E=>{const q=new Set(E);return q.delete(D),q})},[x]),L=S.useCallback(()=>{if(!t)return;const D=new Set,E=q=>{const W=q.items||[];W.length>0&&(D.add(q.id),W.forEach(G=>E(G)))};E(t),x(D)},[t,x]),H=S.useCallback(()=>{x(new Set)},[x]),k=S.useCallback(D=>y.has(D),[y]),R=S.useCallback(D=>D.parentId&&N.get(D.parentId)||null,[N]),z=S.useCallback(D=>v.filter(E=>E.parentId===D.id),[v]),P=S.useCallback(D=>D.parentId?v.filter(E=>E.parentId===D.parentId&&E.id!==D.id):[],[v]),K=S.useCallback(D=>N.get(D)||null,[N]),I=S.useCallback((D,E)=>{if(!E)return null;const q=K(E);if(!q)return null;switch(D.key){case"ArrowDown":{const W=q.index+1;if(W<v.length)return v[W].id;break}case"ArrowUp":{const W=q.index-1;if(W>=0)return v[W].id;break}case"ArrowRight":{if(D.preventDefault(),q.hasChildren&&!q.isExpanded)return _(E),E;if(q.hasChildren&&q.isExpanded){const W=z(q);if(W.length>0)return W[0].id}break}case"ArrowLeft":{if(D.preventDefault(),q.hasChildren&&q.isExpanded)return T(E),E;{const W=R(q);if(W)return W.id}break}case"Home":{if(D.preventDefault(),v.length>0)return v[0].id;break}case"End":{if(D.preventDefault(),v.length>0)return v[v.length-1].id;break}}return null},[v,K,z,R,_,T]);return S.useEffect(()=>{if(h)return;const D="tree-expansion-state";try{localStorage.setItem(D,JSON.stringify([...p]))}catch{}},[p,h]),{flattenedNodes:v,visibleNodes:C,visibleRange:j.visibleRange,totalHeight:j.totalHeight,topSpacer:j.topSpacer,bottomSpacer:j.bottomSpacer,expandedIds:y,toggleExpanded:A,expand:_,collapse:T,expandAll:L,collapseAll:H,isExpanded:k,getParent:R,getChildren:z,getSiblings:P,findNode:K,handleKeyNavigation:I}}function dN(e){const{nodeMap:t,parentMap:n,depthMap:i,pathMap:l,typeMap:o}=S.useMemo(()=>{const C=new Map,A=new Map,_=new Map,T=new Map,L=new Map;if(!e)return{nodeMap:C,parentMap:A,depthMap:_,pathMap:T,typeMap:L};const H=(k,R,z,P)=>{C.set(k.id,k),A.set(k.id,R),_.set(k.id,z),T.set(k.id,[...P,k.id]);const K=L.get(k.type)||[];L.set(k.type,[...K,k]),(k.items||k.annotations||[]).forEach(D=>H(D,k,z+1,[...P,k.id]))};return H(e,null,0,[]),{nodeMap:C,parentMap:A,depthMap:_,pathMap:T,typeMap:L}},[e]),u=S.useCallback(C=>t.get(C)||null,[t]),d=S.useCallback(C=>o.get(C)||[],[o]),m=S.useCallback(()=>Array.from(t.values()),[t]),h=S.useCallback(C=>{const A=t.get(C);return A?A.items||A.annotations||[]:[]},[t]),p=S.useCallback(C=>n.get(C)||null,[n]),g=S.useCallback(()=>o.get("Canvas")||[],[o]),y=S.useCallback(()=>o.get("Manifest")||[],[o]),x=S.useCallback(()=>o.get("Collection")||[],[o]),v=S.useCallback(C=>t.has(C),[t]),N=S.useCallback(C=>i.get(C)??-1,[i]),j=S.useCallback(C=>l.get(C)||[],[l]);return{findNode:u,findAllByType:d,flattenItems:m,getChildren:h,getParent:p,getAllCanvases:g,getAllManifests:y,getAllCollections:x,hasNode:v,getDepth:N,getPath:j}}function dM(e,t,n,i={}){const{getLabel:l=o=>{if(!o.label)return"Untitled";if(typeof o.label=="string")return o.label;if(Array.isArray(o.label)){const u=o.label[0];if(typeof u=="string")return u;if(u&&typeof u=="object"){const d=Object.values(u);if(d.length>0&&Array.isArray(d[0]))return d[0][0]||"Untitled"}}if(typeof o.label=="object"){const u=Object.values(o.label);if(u.length>0&&Array.isArray(u[0]))return u[0][0]||"Untitled"}return"Untitled"}}=i;return S.useMemo(()=>{if(!e)return[];if(!n.get(e))return[];const u=[],d=new Set;let m=e;for(;m&&!d.has(m);){d.add(m);const h=n.get(m);if(!h||!["Collection","Manifest","Canvas"].includes(h.type))break;u.unshift({id:h.id,label:l(h),type:h.type,isCurrent:h.id===e});const g=t.get(m);if(!g||g.length===0)break;m=g[0]}return u},[e,t,n,l])}const fN=({canvas:e,root:t,onUpdate:n,onClose:i})=>{const{showToast:l}=ws(),[o,u]=S.useState({past:[],present:[],future:[]}),[d,m]=S.useState({w:e.width||Qt.defaultCanvasWidth,h:e.height||Qt.defaultCanvasHeight}),[h,p]=S.useState(null),[g,y]=S.useState("grid"),[x,v]=S.useState("layers"),[N,j]=S.useState(!1),[C,A]=S.useState(null),_=S.useRef(null),T=S.useRef(null),L=lN({minScale:.1,maxScale:2,initialScale:.25}),H=L.viewport.scale,k=oN(T,L,{enabled:!N,panButton:"middle",requireCtrlForZoom:!1});aM(T,L,k,{enabled:!0,enableZoom:!0,enablePan:!0,enableRotation:!1,enableReset:!0,enableSpacePan:!0});const R=o.present,z=S.useCallback(V=>{u(O=>{const B=typeof V=="function"?V(O.present):V;return JSON.stringify(B)===JSON.stringify(O.present)?O:{past:[...O.past.slice(-49),O.present],present:B,future:[]}})},[]),P=S.useCallback(V=>{u({past:[],present:V,future:[]})},[]),K=o.past.length>0,I=o.future.length>0,D=S.useCallback(()=>{u(V=>{if(V.past.length===0)return V;const O=[...V.past],B=O.pop();return{past:O,present:B,future:[V.present,...V.future]}})},[]),E=S.useCallback(()=>{u(V=>{if(V.future.length===0)return V;const O=[...V.future],B=O.shift();return{past:[...V.past,V.present],present:B,future:O}})},[]);S.useEffect(()=>{const V=O=>{(O.metaKey||O.ctrlKey)&&O.key==="z"&&(O.preventDefault(),O.shiftKey?E():D())};return window.addEventListener("keydown",V),()=>window.removeEventListener("keydown",V)},[D,E]),S.useEffect(()=>{const V=[];e.items?.[0]?.items&&e.items[0].items.forEach(O=>{const B=typeof O.target=="string"?O.target:O.target.source,Y=B.includes("#xywh=")?B.split("#xywh=")[1]:null;let[X,Q,ue,be]=[0,0,d.w,d.h];Y&&([X,Q,ue,be]=Y.split(",").map(Number)),V.push({id:O.id,resource:{id:O.body.id||"",type:O.body.type||"Image",_blobUrl:O.body.id?.includes("blob:")?O.body.id:void 0,label:O.body.label||{none:["Archive Layer"]}},x:X,y:Q,w:ue,h:be,opacity:1,locked:!1})}),P(V)},[e.id,P]);const q=()=>{const V=R.map(X=>{let Q;if(X.resource.type==="Text"||X.resource._text)Q={type:"TextualBody",value:X.resource._text||"New Text Layer",format:"text/plain"};else{const ue=X.resource.type==="Video"?"video/mp4":X.resource.type==="Sound"?"audio/mpeg":"image/jpeg";Q={id:X.resource._blobUrl||X.resource.id,type:X.resource.type,format:ue}}return{id:X.id,type:"Annotation",motivation:"painting",body:Q,target:`${e.id}#xywh=${Math.round(X.x)},${Math.round(X.y)},${Math.round(X.w)},${Math.round(X.h)}`}}),O=[];e.items&&e.items.forEach(X=>{X.items&&X.items.forEach(Q=>{const ue=Q.motivation==="painting"||Array.isArray(Q.motivation)&&Q.motivation.includes("painting"),be=R.some(de=>de.id===Q.id);(!ue||!be)&&O.push(Q)})});const B=[{id:`${e.id}/page/painting`,type:"AnnotationPage",items:V}];O.length>0&&B.push({id:`${e.id}/page/annotations`,type:"AnnotationPage",items:O});const Y={...e,width:d.w,height:d.h,items:B};n(Y),l("Composition saved successfully","success"),i()},W=V=>{const O=crypto.randomUUID(),B={id:O,resource:V,x:100,y:100,w:400,h:300,opacity:1,locked:!1};z(Y=>[...Y,B]),p(O),l("Layer added","success")},G=()=>{const V=crypto.randomUUID(),O={id:V,resource:{id:`urn:text:${V}`,type:"Text",label:{none:["Text Layer"]},_text:"Double click to edit text..."},x:100,y:100,w:400,h:100,opacity:1,locked:!1};z(B=>[...B,O]),p(V)},te=(V,O)=>{const B=[...R],Y=V+(O==="up"?-1:1);Y>=0&&Y<R.length&&([B[V],B[Y]]=[B[Y],B[V]],z(B))},U=V=>{h&&z(O=>O.map(B=>{if(B.id!==h)return B;switch(V){case"center":return{...B,x:(d.w-B.w)/2,y:(d.h-B.h)/2};case"top":return{...B,y:0};case"left":return{...B,x:0};case"fill":return{...B,x:0,y:0,w:d.w,h:d.h};default:return B}}))};return a.jsxs("div",{className:"fixed inset-0 z-[500] bg-slate-950 flex flex-col animate-in fade-in duration-300",role:"dialog","aria-modal":"true","aria-label":"Synthesis Workspace",children:[a.jsxs("div",{className:"h-14 bg-slate-900 border-b border-white/10 flex items-center justify-between px-6 shrink-0 shadow-2xl",children:[a.jsxs("div",{className:"flex items-center gap-6",children:[a.jsxs("h2",{className:"text-white font-bold flex items-center gap-2",children:[a.jsx($,{name:"auto_awesome_motion",className:"text-indigo-400"})," Synthesis Workspace"]}),a.jsx("div",{className:"h-6 w-px bg-white/10"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-[10px] font-black text-white/40 uppercase tracking-widest",children:"Dimensions"}),a.jsx("input",{type:"number","aria-label":"Canvas Width",value:d.w,onChange:V=>m({...d,w:Number(V.target.value)}),className:"w-16 bg-white/5 text-white text-[10px] border border-white/10 rounded px-1 outline-none"}),a.jsx("span",{className:"text-white/20",children:""}),a.jsx("input",{type:"number","aria-label":"Canvas Height",value:d.h,onChange:V=>m({...d,h:Number(V.target.value)}),className:"w-16 bg-white/5 text-white text-[10px] border border-white/10 rounded px-1 outline-none"})]}),a.jsx("div",{className:"h-6 w-px bg-white/10"}),a.jsx("div",{className:"flex bg-white/5 border border-white/10 rounded p-1",role:"group","aria-label":"Background Mode",children:["grid","dark","light"].map(V=>a.jsx("button",{onClick:()=>y(V),"aria-pressed":g===V,className:`px-2 py-0.5 text-[9px] font-black uppercase rounded ${g===V?"bg-indigo-600 text-white":"text-slate-500"}`,children:V},V))}),a.jsxs("button",{onClick:G,className:"bg-white/10 hover:bg-white/20 text-white px-3 py-1 rounded text-[10px] font-black uppercase flex items-center gap-1",children:[a.jsx($,{name:"title",className:"text-xs"})," Add Text"]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"flex bg-white/5 border border-white/10 rounded p-1",role:"group","aria-label":"Undo/Redo",children:[a.jsx("button",{onClick:D,disabled:!K,"aria-label":"Undo (Ctrl+Z)",title:"Undo (Ctrl+Z)",className:`p-1 ${K?"text-white/40 hover:text-white":"text-white/10 cursor-not-allowed"}`,children:a.jsx($,{name:"undo"})}),a.jsx("button",{onClick:E,disabled:!I,"aria-label":"Redo (Ctrl+Shift+Z)",title:"Redo (Ctrl+Shift+Z)",className:`p-1 ${I?"text-white/40 hover:text-white":"text-white/10 cursor-not-allowed"}`,children:a.jsx($,{name:"redo"})})]}),a.jsxs("div",{className:"flex bg-white/5 border border-white/10 rounded p-1",children:[a.jsx("button",{onClick:L.zoomOut,"aria-label":"Zoom Out",className:"p-1 text-white/40 hover:text-white",children:a.jsx($,{name:"remove"})}),a.jsxs("span",{className:"px-3 py-1 text-[10px] font-bold text-white/60 min-w-[60px] text-center","aria-live":"polite",children:[L.scalePercent,"%"]}),a.jsx("button",{onClick:L.zoomIn,"aria-label":"Zoom In",className:"p-1 text-white/40 hover:text-white",children:a.jsx($,{name:"add"})})]}),a.jsx("button",{onClick:i,"aria-label":"Cancel and close workspace",className:"px-4 py-2 text-white/40 hover:text-white font-bold text-sm",children:"Cancel"}),a.jsx("button",{onClick:q,"aria-label":"Apply composition to canvas",className:"bg-indigo-600 text-white px-6 py-2 rounded-lg font-black uppercase tracking-widest text-xs hover:bg-indigo-500 shadow-xl transition-all",children:"Apply Composition"})]})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsxs("div",{className:"w-80 bg-slate-900 border-r border-white/10 flex flex-col",children:[a.jsxs("div",{className:"flex border-b border-white/10",children:[a.jsx("button",{onClick:()=>v("layers"),className:`flex-1 py-3 text-[10px] font-black uppercase tracking-widest ${x==="layers"?"text-indigo-400 border-b-2 border-indigo-400":"text-white/40"}`,children:"Layers"}),a.jsx("button",{onClick:()=>v("library"),className:`flex-1 py-3 text-[10px] font-black uppercase tracking-widest ${x==="library"?"text-indigo-400 border-b-2 border-indigo-400":"text-white/40"}`,children:"Library"})]}),x==="layers"?a.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-3 custom-scrollbar",role:"list","aria-label":"Resource Layers",children:R.length===0?a.jsx("div",{className:"text-center py-20 text-slate-600 italic text-sm",children:"No items on canvas."}):R.map((V,O)=>a.jsxs("div",{role:"listitem",tabIndex:0,"aria-selected":h===V.id,onKeyDown:B=>{(B.key==="Enter"||B.key===" ")&&(B.preventDefault(),p(V.id))},onClick:()=>p(V.id),className:`p-4 rounded-xl border transition-all cursor-pointer group outline-none focus:ring-2 focus:ring-indigo-500 ${h===V.id?"bg-indigo-600/20 border-indigo-500":"bg-white/5 border-white/5 hover:border-white/20"}`,children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsx("span",{className:"text-[11px] font-bold text-white truncate max-w-[140px]",children:Le(V.resource.label,"none")}),a.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[a.jsx("button",{onClick:B=>{B.stopPropagation(),z(R.map(Y=>Y.id===V.id?{...Y,locked:!Y.locked}:Y))},className:`p-1 rounded ${V.locked?"text-indigo-400":"text-white/20"}`,title:"Lock Layer","aria-label":V.locked?"Unlock Layer":"Lock Layer",children:a.jsx($,{name:V.locked?"lock":"lock_open",className:"text-[14px]"})}),a.jsx("button",{onClick:B=>{B.stopPropagation(),te(O,"down")},className:"p-1 hover:bg-white/10 rounded",title:"Move Back","aria-label":"Move Layer Back",children:a.jsx($,{name:"arrow_downward",className:"text-[14px]"})}),a.jsx("button",{onClick:B=>{B.stopPropagation(),te(O,"up")},className:"p-1 hover:bg-white/10 rounded",title:"Move Forward","aria-label":"Move Layer Forward",children:a.jsx($,{name:"arrow_upward",className:"text-[14px]"})}),a.jsx("button",{onClick:B=>{B.stopPropagation(),z(Y=>Y.filter(X=>X.id!==V.id))},className:"p-1 hover:bg-red-500 text-white rounded",title:"Remove Layer","aria-label":"Remove Layer",children:a.jsx($,{name:"delete",className:"text-[14px]"})})]})]}),a.jsxs("div",{className:`space-y-3 ${V.locked?"opacity-40 pointer-events-none":""}`,children:[a.jsx("div",{className:"grid grid-cols-4 gap-1",children:["x","y","w","h"].map(B=>a.jsxs("div",{className:"space-y-1",children:[a.jsx("span",{className:"text-[8px] font-black text-white/30 uppercase block",children:B}),a.jsx("input",{type:"number","aria-label":`Layer ${B} coordinate`,value:V[B],onChange:Y=>z(R.map(X=>X.id===V.id?{...X,[B]:Number(Y.target.value)}:X)),className:"w-full bg-black/40 text-white text-[10px] border-none rounded p-1 outline-none"})]},B))}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex justify-between text-[8px] font-black text-white/30 uppercase",children:[a.jsx("span",{children:"Opacity"}),a.jsxs("span",{children:[Math.round(V.opacity*100),"%"]})]}),a.jsx("input",{type:"range","aria-label":"Layer Opacity",min:"0",max:"1",step:"0.05",value:V.opacity,onChange:B=>z(R.map(Y=>Y.id===V.id?{...Y,opacity:Number(B.target.value)}:Y)),className:"w-full accent-indigo-500"})]})]}),h===V.id&&!V.locked&&a.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10 flex gap-2",children:[a.jsx("button",{onClick:B=>{B.stopPropagation(),U("center")},className:"flex-1 bg-white/5 hover:bg-white/10 text-[8px] font-black uppercase py-1 rounded",children:"Center"}),a.jsx("button",{onClick:B=>{B.stopPropagation(),U("fill")},className:"flex-1 bg-white/5 hover:bg-white/10 text-[8px] font-black uppercase py-1 rounded",children:"Fill"})]})]},V.id))}):a.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar",children:[t?.items?.map(V=>a.jsxs("div",{draggable:!0,onDragStart:O=>O.dataTransfer.setData("application/iiif-item-id",V.id),onClick:()=>W(V),className:"p-3 bg-white/5 hover:bg-white/10 rounded-lg cursor-pointer group flex items-center gap-3 border border-transparent hover:border-indigo-500/50",children:[a.jsx("div",{className:"w-10 h-10 bg-black rounded overflow-hidden shrink-0",children:V.thumbnail?.[0]?.id||V._blobUrl?a.jsx("img",{src:V.thumbnail?.[0]?.id||V._blobUrl,className:"w-full h-full object-cover"}):a.jsx($,{name:"image",className:"text-white/20 m-2"})}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"text-xs font-bold text-white truncate",children:Le(V.label,"none")||"Untitled"}),a.jsx("div",{className:"text-[10px] text-white/40 truncate",children:V.type})]}),a.jsx($,{name:"add_circle",className:"text-white/20 group-hover:text-indigo-400 ml-auto"})]},V.id)),!t&&a.jsx("div",{className:"p-4 text-center text-white/30 text-xs",children:"No library source available."})]})]}),a.jsx("div",{ref:T,className:`flex-1 relative overflow-auto flex items-center justify-center p-20 custom-scrollbar shadow-inner ${g==="light"?"bg-slate-200":g==="dark"?"bg-slate-900":"bg-black"}`,onDragOver:V=>V.preventDefault(),onMouseDown:V=>{(V.button===1||V.button===0&&V.shiftKey)&&k.handlers.onMouseDown(V)},onMouseMove:V=>{if(k.isPanning){k.handlers.onMouseMove(V);return}if(N&&h&&C&&_.current){const O=_.current,B=(V.clientX-O.mouseX)/H,Y=(V.clientY-O.mouseY)/H;z(X=>X.map(Q=>{if(Q.id!==h)return Q;let{x:ue,y:be,w:de,h:ye}={x:O.layerX,y:O.layerY,w:O.layerW,h:O.layerH};if(C.includes("e")&&(de=Math.max(10,O.layerW+B)),C.includes("w")){const le=Math.max(10,O.layerW-B);ue=O.layerX+(O.layerW-le),de=le}if(C.includes("s")&&(ye=Math.max(10,O.layerH+Y)),C.includes("n")){const le=Math.max(10,O.layerH-Y);be=O.layerY+(O.layerH-le),ye=le}return{...Q,x:ue,y:be,w:de,h:ye}}))}},onMouseUp:V=>{j(!1),A(null),_.current=null,k.handlers.onMouseUp(V)},onMouseLeave:k.handlers.onMouseLeave,onWheel:V=>{const O=T.current?.getBoundingClientRect();O&&L.zoomAtPoint(V.deltaY,{x:V.clientX,y:V.clientY},O)},onDrop:V=>{V.preventDefault();const O=V.dataTransfer.getData("application/iiif-item-id");if(O){const B=crypto.randomUUID(),Y={id:B,resource:{id:O,type:"Image",label:{none:["Dropped Item"]},_blobUrl:O.startsWith("blob:")?O:void 0},x:100,y:100,w:400,h:300,opacity:1,locked:!1};z(X=>[...X,Y]),p(B),l("Layer added from drop","success")}},children:a.jsxs("div",{className:"relative shadow-[0_0_100px_rgba(79,70,229,0.2)] bg-slate-900 border border-white/5",style:{width:d.w*H,height:d.h*H,backgroundImage:g==="grid"?"radial-gradient(rgba(255,255,255,0.03) 1px, transparent 1px)":"none",backgroundSize:"20px 20px"},"aria-label":"Canvas Area",children:[R.length===0&&a.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white/20 pointer-events-none border-2 border-dashed border-white/10 m-4 rounded-3xl",children:[a.jsx($,{name:"layers",className:"text-6xl mb-4"}),a.jsx("h3",{className:"text-xl font-bold uppercase tracking-widest",children:"Composition Canvas"}),a.jsx("p",{className:"text-sm mt-2",children:"Drag and drop items here to create layers"})]}),R.map((V,O)=>a.jsxs("div",{onClick:()=>p(V.id),className:`absolute group select-none transition-all ${h===V.id?"ring-2 ring-indigo-500 z-50 shadow-2xl":"z-10"}`,style:{left:V.x*H,top:V.y*H,width:V.w*H,height:V.h*H,opacity:V.opacity,zIndex:R.length-O},children:[V.resource.type==="Text"||V.resource._text?a.jsx("textarea",{value:V.resource._text,onChange:B=>z(R.map(Y=>Y.id===V.id?{...Y,resource:{...Y.resource,_text:B.target.value}}:Y)),className:"w-full h-full bg-transparent text-white p-2 resize-none outline-none border-2 border-dashed border-white/20",style:{fontSize:`${24*H}px`}}):V.resource.type==="Video"?a.jsx("video",{src:V.resource._blobUrl||V.resource.id,className:"w-full h-full object-cover pointer-events-none"}):V.resource.type==="Sound"?a.jsxs("div",{className:"w-full h-full bg-slate-800 flex flex-col items-center justify-center border border-slate-600",children:[a.jsx($,{name:"audiotrack",className:"text-4xl text-white/50"}),a.jsx("span",{className:"text-[10px] text-white/50 mt-2",children:"Audio Layer"})]}):V.resource._blobUrl?a.jsx("img",{src:V.resource._blobUrl,className:"w-full h-full object-fill pointer-events-none",alt:Le(V.resource.label,"none")||"Layer Image"}):a.jsx("div",{className:"w-full h-full bg-indigo-500/10 flex items-center justify-center text-indigo-400 border border-indigo-500/20",children:a.jsx($,{name:"image",className:"text-4xl"})}),h===V.id&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"absolute -top-6 left-0 bg-indigo-600 text-white text-[10px] px-2 py-0.5 rounded font-bold shadow-lg flex items-center gap-1",children:[a.jsx($,{name:V.locked?"lock":"auto_fix_high",className:"text-[10px]"})," Synthesis Layer"]}),a.jsx("div",{className:"absolute inset-0 border-2 border-indigo-500/50 pointer-events-none"}),!V.locked&&a.jsx(a.Fragment,{children:["nw","ne","sw","se"].map(B=>a.jsx("div",{className:`absolute w-3 h-3 bg-white border border-indigo-500 rounded-full z-50 cursor-${B}-resize`,style:{top:B.includes("n")?-6:"auto",bottom:B.includes("s")?-6:"auto",left:B.includes("w")?-6:"auto",right:B.includes("e")?-6:"auto"},onMouseDown:Y=>{Y.stopPropagation();const X=R.find(Q=>Q.id===h);X&&(_.current={mouseX:Y.clientX,mouseY:Y.clientY,layerX:X.x,layerY:X.y,layerW:X.w,layerH:X.h},j(!0),A(B))}},B))})]}),V.locked&&a.jsx("div",{className:"absolute top-2 right-2 text-white/50",children:a.jsx($,{name:"lock",className:"text-sm"})})]},V.id))]})})]}),a.jsxs("div",{className:"h-8 bg-slate-950 border-t border-white/5 flex items-center justify-between px-6 text-[10px] text-white/30 uppercase font-black tracking-widest",children:[a.jsxs("div",{className:"flex gap-4",children:[a.jsx("span",{children:"Archive Synthesis Engine"}),a.jsxs("span",{children:[R.length," Active Parts"]})]}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("span",{children:[a.jsx("kbd",{className:"bg-white/10 px-1.5 py-0.5 rounded text-[8px]",children:"Scroll"})," Zoom"]}),a.jsxs("span",{children:[a.jsx("kbd",{className:"bg-white/10 px-1.5 py-0.5 rounded text-[8px]",children:"+/-"})," Zoom"]}),a.jsxs("span",{children:[a.jsx("kbd",{className:"bg-white/10 px-1.5 py-0.5 rounded text-[8px]",children:"Shift+Drag"})," Pan"]}),a.jsxs("span",{children:[a.jsx("kbd",{className:"bg-white/10 px-1.5 py-0.5 rounded text-[8px]",children:"Cmd+Z"})," Undo"]})]})]})]})},fM=({canvas:e,src:t,mediaType:n,poster:i,autoPlay:l=!1,muted:o=!1,showAccompanying:u=!0,onTimeUpdate:d,onEnded:m,className:h=""})=>{const p=S.useRef(null),g=S.useRef(null),[y,x]=S.useState({currentTime:0,duration:0,isPlaying:!1,isMuted:o,volume:1,playbackRate:1,isBuffering:!1,isSeeking:!1}),[v,N]=S.useState(!0),[j,C]=S.useState(!0),[A,_]=S.useState([]),[T,L]=S.useState(null),H=Es.getPlaceholderCanvas(e),k=Es.getAccompanyingCanvas(e),R=Es.parseTimeMode(e.behavior),z=i||(H?Es.getPosterImageUrl(H):null);S.useEffect(()=>{if(k){const le=Es.getAccompanyingContent(k),we=Es.generateSyncPoints(le);_(we)}},[k]),S.useEffect(()=>{if(R&&p.current){const le=p.current;if(R.mode==="scale"&&e.duration){const we=Es.calculatePlaybackRate(y.duration,e.duration);le.playbackRate=we,x(He=>({...He,playbackRate:we}))}R.mode==="trim"&&R.start&&(le.currentTime=R.start)}},[R,y.duration,e.duration]),S.useEffect(()=>{const le=Es.findCurrentSyncPoint(A,y.currentTime);L(le)},[y.currentTime,A]);const P=()=>{const le=p.current;le&&x(we=>({...we,duration:le.duration}))},K=()=>{const le=p.current;if(!le)return;const we=le.currentTime;if(R?.mode==="trim"&&R.end&&we>=R.end){le.pause(),le.currentTime=R.start||0,x(He=>({...He,isPlaying:!1})),m?.();return}R?.mode==="loop"&&e.duration&&we>=le.duration&&(le.currentTime=0,le.play()),x(He=>({...He,currentTime:we})),d?.(we)},I=()=>{x(le=>({...le,isPlaying:!0})),C(!1)},D=()=>{x(le=>({...le,isPlaying:!1}))},E=()=>{R?.mode==="loop"?p.current?.play():(x(le=>({...le,isPlaying:!1})),m?.())},q=()=>{x(le=>({...le,isBuffering:!0}))},W=()=>{x(le=>({...le,isBuffering:!1}))},[G,te]=S.useState(null),U=S.useCallback(le=>{const we=le.currentTarget,He=we?.error?.code,F={1:"Media loading aborted",2:"Network error while loading media",3:"Media decoding failed",4:"Media format not supported"}[He||0]||"Unknown media error";console.warn("[AVPlayer] Media error:",F,we?.error),te(F),x(me=>({...me,isPlaying:!1,isBuffering:!1}))},[]),V=S.useCallback(async()=>{const le=p.current;if(le)try{y.isPlaying?le.pause():await le.play(),te(null)}catch(we){const He=we;console.warn("[AVPlayer] Play failed:",He.message),te("Unable to play media: "+He.message),x(Ke=>({...Ke,isPlaying:!1}))}},[y.isPlaying]),O=S.useCallback(()=>{const le=p.current;le&&(le.muted=!le.muted,x(we=>({...we,isMuted:le.muted})))},[]),B=S.useCallback(le=>{const we=p.current;we&&(we.volume=le,x(He=>({...He,volume:le})))},[]),Y=S.useCallback(le=>{const we=p.current;we&&(R?.mode==="trim"&&(le=Math.max(R.start||0,Math.min(le,R.end||we.duration))),we.currentTime=le,x(He=>({...He,currentTime:le})))},[R]),X=S.useCallback(le=>{const we=p.current;we&&Y(we.currentTime+le)},[Y]),Q=S.useCallback(le=>{if(!(le.target instanceof HTMLInputElement||!p.current))switch(le.key){case" ":case"k":case"K":le.preventDefault(),V();break;case"ArrowLeft":case"j":case"J":le.preventDefault(),X(-10);break;case"ArrowRight":case"l":case"L":le.preventDefault(),X(10);break;case"ArrowUp":le.preventDefault(),B(Math.min(1,y.volume+.1));break;case"ArrowDown":le.preventDefault(),B(Math.max(0,y.volume-.1));break;case"m":case"M":le.preventDefault(),O();break;case"Home":le.preventDefault(),Y(R?.start||0);break;case"End":le.preventDefault(),Y(R?.end||y.duration);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":le.preventDefault();const He=parseInt(le.key)/10;Y(y.duration*He);break}},[V,O,X,Y,B,y.volume,y.duration,R]),ue=le=>{const we=le.currentTarget.getBoundingClientRect(),He=(le.clientX-we.left)/we.width;Y(He*y.duration)},be=R?.mode==="trim"?(R.end||y.duration)-(R.start||0):y.duration,de=R?.mode==="trim"?y.currentTime-(R.start||0):y.currentTime,ye=be>0?de/be*100:0;return a.jsxs("div",{ref:g,className:`flex flex-col bg-black ${h} focus:outline-none focus-visible:ring-2 focus-visible:ring-iiif-blue focus-visible:ring-inset`,tabIndex:0,onKeyDown:Q,role:"application","aria-label":`${n==="video"?"Video":"Audio"} player. Press Space to play/pause, arrow keys to seek, Up/Down for volume.`,children:[a.jsxs("div",{className:"relative group",onMouseEnter:()=>N(!0),onMouseLeave:()=>!y.isPlaying&&N(!0),children:[j&&z&&n==="video"&&a.jsxs("div",{className:"absolute inset-0 z-10",children:[a.jsx("img",{src:z,alt:"Video poster",className:"w-full h-full object-contain"}),a.jsx("button",{onClick:V,className:"absolute inset-0 flex items-center justify-center bg-black/30 hover:bg-black/40 transition-colors",children:a.jsx("div",{className:"w-20 h-20 rounded-full bg-white/90 flex items-center justify-center text-4xl text-iiif-blue",children:a.jsx($,{name:"play_arrow"})})})]}),G&&a.jsx("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center z-20",children:a.jsxs("div",{className:"text-center text-white p-6",children:[a.jsx($,{name:"error_outline",className:"text-5xl text-red-400 mb-3"}),a.jsx("p",{className:"text-lg font-medium mb-2",children:"Media Error"}),a.jsx("p",{className:"text-sm text-slate-300 mb-4",children:G}),a.jsx("button",{onClick:()=>te(null),className:"px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm",children:"Dismiss"})]})}),n==="video"?a.jsx("video",{ref:p,src:t,className:"w-full aspect-video bg-black",autoPlay:l,muted:o,playsInline:!0,onLoadedMetadata:P,onTimeUpdate:K,onPlay:I,onPause:D,onEnded:E,onWaiting:q,onCanPlay:W,onError:U}):a.jsxs("div",{className:"w-full aspect-video bg-slate-900 flex items-center justify-center",children:[a.jsx("audio",{ref:p,src:t,autoPlay:l,muted:o,onLoadedMetadata:P,onTimeUpdate:K,onPlay:I,onPause:D,onEnded:E,onWaiting:q,onCanPlay:W,onError:U}),a.jsxs("div",{className:"text-white text-center",children:[a.jsx($,{name:"audiotrack",className:"text-6xl opacity-50 mb-4"}),e.label&&a.jsx("p",{className:"text-lg",children:Object.values(e.label)[0]?.[0]||"Audio"})]})]}),y.isBuffering&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 z-20",children:a.jsx("div",{className:"w-12 h-12 border-4 border-white/30 border-t-white rounded-full animate-spin"})}),a.jsxs("div",{className:`absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 transition-opacity ${v?"opacity-100":"opacity-0"}`,children:[a.jsx("div",{className:"h-1 bg-white/30 rounded-full mb-3 cursor-pointer group/progress",onClick:ue,children:a.jsx("div",{className:"h-full bg-iiif-blue rounded-full relative",style:{width:`${ye}%`},children:a.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full opacity-0 group-hover/progress:opacity-100 transition-opacity"})})}),a.jsxs("div",{className:"flex items-center gap-4 text-white",children:[a.jsx("button",{onClick:V,className:"hover:text-iiif-blue transition-colors","aria-label":y.isPlaying?"Pause":"Play",children:a.jsx($,{name:y.isPlaying?"pause":"play_arrow",className:"text-2xl"})}),a.jsx("button",{onClick:()=>X(-10),className:"hover:text-iiif-blue transition-colors","aria-label":"Rewind 10 seconds",children:a.jsx($,{name:"replay_10",className:"text-xl"})}),a.jsx("button",{onClick:()=>X(10),className:"hover:text-iiif-blue transition-colors","aria-label":"Forward 10 seconds",children:a.jsx($,{name:"forward_10",className:"text-xl"})}),a.jsxs("span",{className:"text-sm font-mono",children:[Es.formatTime(de)," / ",Es.formatTime(be)]}),a.jsx("div",{className:"flex-1"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:O,className:"hover:text-iiif-blue transition-colors","aria-label":y.isMuted?"Unmute":"Mute",children:a.jsx($,{name:y.isMuted?"volume_off":y.volume>.5?"volume_up":"volume_down",className:"text-xl"})}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:y.isMuted?0:y.volume,onChange:le=>B(parseFloat(le.target.value)),className:"w-20 h-1 accent-iiif-blue"})]}),R&&a.jsx("span",{className:"text-xs bg-iiif-blue/80 px-2 py-1 rounded",children:R.mode})]})]})]}),u&&k&&a.jsx(hM,{canvas:k,syncPoints:A,currentSyncPoint:T,currentTime:y.currentTime,onSeek:Y})]})},hM=({canvas:e,syncPoints:t,currentSyncPoint:n,currentTime:i,onSeek:l})=>{const o=S.useRef(null);S.useEffect(()=>{o.current&&o.current.scrollIntoView({behavior:"smooth",block:"center"})},[n]);const u=e.label?Object.values(e.label)[0]?.[0]:"Transcript";return a.jsxs("div",{className:"bg-slate-900 text-white max-h-48 overflow-auto",children:[a.jsx("div",{className:"sticky top-0 bg-slate-800 px-4 py-2 text-xs font-medium uppercase tracking-wide border-b border-slate-700",children:u}),a.jsxs("div",{className:"p-4 space-y-2",children:[t.map((d,m)=>{const h=n===d;return a.jsxs("div",{ref:h?o:null,onClick:()=>l(d.mainTime),className:`flex gap-3 p-2 rounded cursor-pointer transition-colors ${h?"bg-iiif-blue/30 border-l-2 border-iiif-blue":"hover:bg-slate-800"}`,children:[a.jsx("span",{className:"text-xs text-slate-400 font-mono shrink-0",children:Es.formatTime(d.mainTime)}),a.jsx("span",{className:`text-sm ${h?"text-white":"text-slate-300"}`,children:typeof d.accompanyingPosition=="string"?d.accompanyingPosition:d.label||""})]},m)}),t.length===0&&a.jsx("p",{className:"text-slate-500 text-sm text-center py-4",children:"No synchronized content available"})]})]})};function Vc(e,t=!0){if(e.length<2)return"";const n=e.map((i,l)=>`${l===0?"M":"L"}${i.x.toFixed(1)},${i.y.toFixed(1)}`);return t&&e.length>=3&&n.push("Z"),n.join(" ")}function mM(e,t,n){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${t} ${n}"><path d="${Vc(e,!0)}"/></svg>`}function pM(e){const t=[],n=e.match(/d="([^"]+)"/);if(!n)return t;const i=n[1].match(/[MLZ][\d.,\s-]*/gi);if(!i)return t;for(const l of i){if(l[0].toUpperCase()==="Z")continue;const u=l.slice(1).trim().split(/[\s,]+/).map(Number);u.length>=2&&!isNaN(u[0])&&!isNaN(u[1])&&t.push({x:u[0],y:u[1]})}return t}function Fv(e){if(e.length===0)return{x:0,y:0,width:0,height:0};const t=e.map(i=>i.x),n=e.map(i=>i.y);return{x:Math.min(...t),y:Math.min(...n),width:Math.max(...t)-Math.min(...t),height:Math.max(...n)-Math.min(...n)}}const hN=({canvas:e,imageUrl:t,onCreateAnnotation:n,onClose:i,existingAnnotations:l=[]})=>{const{showToast:o}=ws(),u=S.useRef(null),d=S.useRef(null),[m,h]=S.useState("polygon"),[p,g]=S.useState([]),[y,x]=S.useState(!1),[v,N]=S.useState(""),[j,C]=S.useState("commenting"),[A,_]=S.useState(!0),[T,L]=S.useState([]),[H,k]=S.useState(null),[R,z]=S.useState(1),[P,K]=S.useState({x:0,y:0});S.useEffect(()=>{const Y=u.current;if(!Y)return;const X=Y.getBoundingClientRect(),Q=48,ue=(X.width-Q)/e.width,be=(X.height-Q)/e.height,de=Math.min(ue,be,1);z(de),K({x:(X.width-e.width*de)/2,y:(X.height-e.height*de)/2})},[e.width,e.height]);const I=S.useCallback(Y=>{const X=u.current;if(!X)return{x:0,y:0};const Q=X.getBoundingClientRect(),ue=Y.clientX-Q.left,be=Y.clientY-Q.top;return{x:(ue-P.x)/R,y:(be-P.y)/R}},[R,P]),D=S.useCallback(Y=>{const X=I(Y);k(X),m==="freehand"&&y&&L(Q=>[...Q,X])},[m,y,I]),E=S.useCallback(Y=>{if(Y.button!==0||m==="select")return;const X=I(Y);if(m==="polygon"){if(p.length>=3){const Q=p[0];if(Math.sqrt(Math.pow(X.x-Q.x,2)+Math.pow(X.y-Q.y,2))<15){x(!1);return}}g(Q=>[...Q,X]),x(!0)}else if(m==="rectangle"){if(p.length===0)g([X]),x(!0);else if(p.length===1){const Q=p[0];g([Q,{x:X.x,y:Q.y},X,{x:Q.x,y:X.y}]),x(!1)}}},[m,p,I]),q=S.useCallback(Y=>{if(m==="freehand"&&Y.button===0){const X=I(Y);L([X]),x(!0)}},[m,I]),W=S.useCallback(()=>{if(m==="freehand"&&y){if(T.length>2){const Y=G(T,3);g(Y)}L([]),x(!1)}},[m,y,T]),G=(Y,X)=>{if(Y.length<=2)return Y;const Q=[Y[0]];for(let ue=1;ue<Y.length-1;ue++){const be=Q[Q.length-1];Math.sqrt(Math.pow(Y[ue].x-be.x,2)+Math.pow(Y[ue].y-be.y,2))>X&&Q.push(Y[ue])}return Q.push(Y[Y.length-1]),Q},te=()=>{g(Y=>{const X=Y.slice(0,-1);return X.length<2&&x(!1),X})},U=()=>{g([]),L([]),x(!1)},V=()=>{if(p.length<3){o("Need at least 3 points","error");return}if(!v.trim()){o("Please enter annotation text","error");return}const Y={id:`${e.id}/annotation/${Date.now()}`,type:"Annotation",motivation:j,body:{type:"TextualBody",value:v.trim(),format:"text/plain"},target:{type:"SpecificResource",source:e.id,selector:{type:"SvgSelector",value:mM(p,e.width,e.height)}}};n(Y),o("Annotation created","success"),U(),N("")};S.useEffect(()=>{const Y=X=>{X.key==="Escape"?y?U():i():(X.metaKey||X.ctrlKey)&&X.key==="z"?(X.preventDefault(),te()):X.key==="Enter"&&p.length>=3&&x(!1)};return window.addEventListener("keydown",Y),()=>window.removeEventListener("keydown",Y)},[y,p.length,i]);const O=l.filter(Y=>Y.target?.selector?.type==="SvgSelector"),B=p.length>=3&&H&&(()=>{const Y=p[0];return Math.sqrt(Math.pow((H?.x||0)-Y.x,2)+Math.pow((H?.y||0)-Y.y,2))<15})();return a.jsxs("div",{className:"absolute inset-0 z-30 bg-slate-950 flex flex-col",children:[a.jsxs("div",{className:"h-12 bg-slate-900 border-b border-white/10 flex items-center justify-between px-4 shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("h2",{className:"text-white font-bold flex items-center gap-2 text-sm",children:[a.jsx($,{name:"pentagon",className:"text-green-400"}),"Annotation Tool"]}),a.jsx("div",{className:"flex bg-white/5 border border-white/10 rounded p-0.5",children:[{mode:"polygon",icon:"pentagon",label:"Polygon"},{mode:"rectangle",icon:"crop_square",label:"Rectangle"},{mode:"freehand",icon:"gesture",label:"Freehand"},{mode:"select",icon:"pan_tool",label:"Pan"}].map(Y=>a.jsxs("button",{onClick:()=>{h(Y.mode),U()},className:`px-2 py-1 text-[10px] font-bold uppercase rounded flex items-center gap-1 ${m===Y.mode?"bg-green-600 text-white":"text-slate-500 hover:text-white"}`,children:[a.jsx($,{name:Y.icon,className:"text-xs"})," ",Y.label]},Y.mode))})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("button",{onClick:()=>_(!A),className:`px-2 py-1 rounded text-[10px] font-bold uppercase ${A?"bg-blue-600 text-white":"bg-white/5 text-white/40"}`,children:[O.length," Existing"]}),a.jsx("button",{onClick:i,className:"px-3 py-1 text-white/40 hover:text-white font-bold text-sm hover:bg-white/10 rounded",children:"Done"})]})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsx("div",{ref:u,className:"flex-1 relative overflow-hidden bg-slate-950 cursor-crosshair",onMouseMove:D,onClick:E,onMouseDown:q,onMouseUp:W,onMouseLeave:W,children:a.jsxs("div",{className:"absolute",style:{left:P.x,top:P.y,width:e.width*R,height:e.height*R},children:[a.jsx("img",{ref:d,src:t,alt:"Canvas",className:"absolute inset-0 w-full h-full object-contain pointer-events-none select-none",draggable:!1}),a.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:`0 0 ${e.width} ${e.height}`,preserveAspectRatio:"none",children:[A&&O.map(Y=>{const X=Y.target?.selector,Q=pM(X?.value||"");return Q.length<3?null:a.jsx("path",{d:Vc(Q,!0),fill:"rgba(59, 130, 246, 0.15)",stroke:"rgba(59, 130, 246, 0.8)",strokeWidth:2},Y.id)}),m==="freehand"&&T.length>1&&a.jsx("path",{d:Vc(T,!1),fill:"none",stroke:"rgba(34, 197, 94, 0.8)",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),p.length>=2&&a.jsxs(a.Fragment,{children:[a.jsx("polyline",{points:p.map(Y=>`${Y.x},${Y.y}`).join(" "),fill:"none",stroke:"rgba(34, 197, 94, 1)",strokeWidth:2,strokeDasharray:y?"5,5":"none"}),p.length>=3&&a.jsx("path",{d:Vc(p,!y),fill:y?"none":"rgba(34, 197, 94, 0.2)",stroke:"rgba(34, 197, 94, 1)",strokeWidth:2,strokeDasharray:y?"5,5":"none"})]}),p.map((Y,X)=>a.jsx("g",{children:a.jsx("circle",{cx:Y.x,cy:Y.y,r:6,fill:X===0?"rgba(34, 197, 94, 1)":"white",stroke:"rgba(34, 197, 94, 1)",strokeWidth:2})},X)),B&&p[0]&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:p[0].x,cy:p[0].y,r:15,fill:"none",stroke:"rgba(34, 197, 94, 0.8)",strokeWidth:2,strokeDasharray:"3,3"}),a.jsx("text",{x:p[0].x+20,y:p[0].y-20,fill:"white",fontSize:14,fontWeight:"bold",style:{textShadow:"0 1px 2px rgba(0,0,0,0.8)"},children:"Click to close"})]})]})]})}),a.jsxs("div",{className:"w-72 bg-slate-900 border-l border-white/10 flex flex-col",children:[a.jsx("div",{className:"p-3 border-b border-white/5",children:a.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Annotation Details"})}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-[10px] font-bold text-white/40 uppercase mb-1.5",children:"Motivation"}),a.jsxs("select",{value:j,onChange:Y=>C(Y.target.value),className:"w-full bg-white/5 text-white text-xs border border-white/10 rounded-lg p-2 outline-none",children:[a.jsx("option",{value:"commenting",children:"Commenting"}),a.jsx("option",{value:"tagging",children:"Tagging"}),a.jsx("option",{value:"describing",children:"Describing"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-[10px] font-bold text-white/40 uppercase mb-1.5",children:"Annotation Text"}),a.jsx("textarea",{value:v,onChange:Y=>N(Y.target.value),placeholder:"Enter your annotation...",rows:4,className:"w-full bg-white/5 text-white text-xs border border-white/10 rounded-lg p-2.5 outline-none resize-none"})]}),a.jsxs("div",{className:"bg-white/5 rounded-lg p-2.5 border border-white/10",children:[a.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[a.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase",children:"Shape"}),a.jsxs("span",{className:"text-xs font-mono text-green-400",children:[p.length," points"]})]}),p.length>=3&&a.jsxs("div",{className:"text-[9px] text-white/30",children:["Bounding Box: ",Math.round(Fv(p).width),"  ",Math.round(Fv(p).height)]})]}),a.jsxs("div",{className:"text-[10px] text-white/30 space-y-1",children:[m==="polygon"&&a.jsxs(a.Fragment,{children:[a.jsx("p",{children:" Click to add points"}),a.jsx("p",{children:" Click first point or press Enter to close"}),a.jsx("p",{children:" Need at least 3 points to save"})]}),m==="rectangle"&&a.jsxs(a.Fragment,{children:[a.jsx("p",{children:" Click two corners to draw"}),a.jsxs("p",{children:[" ",p.length===0?"Click to start":"Click opposite corner"]})]}),m==="freehand"&&a.jsxs(a.Fragment,{children:[a.jsx("p",{children:" Click and drag to draw"}),a.jsx("p",{children:" Release to finish"})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:te,disabled:p.length===0,className:"flex-1 bg-white/5 hover:bg-white/10 disabled:opacity-30 text-white/60 text-[10px] font-bold uppercase py-2 rounded-lg flex items-center justify-center gap-1",children:[a.jsx($,{name:"undo",className:"text-xs"})," Undo"]}),a.jsxs("button",{onClick:U,disabled:p.length===0,className:"flex-1 bg-white/5 hover:bg-white/10 disabled:opacity-30 text-white/60 text-[10px] font-bold uppercase py-2 rounded-lg flex items-center justify-center gap-1",children:[a.jsx($,{name:"clear",className:"text-xs"})," Clear"]})]})]}),a.jsx("div",{className:"p-3 border-t border-white/10",children:a.jsxs("button",{onClick:V,disabled:p.length<3||!v.trim(),className:"w-full bg-green-600 hover:bg-green-500 disabled:bg-slate-700 disabled:text-slate-500 text-white px-4 py-2.5 rounded-lg font-bold uppercase tracking-wider text-xs transition-all",children:[a.jsx($,{name:"save",className:"inline mr-1.5 text-xs"})," Create Annotation"]})})]})]}),a.jsxs("div",{className:"h-7 bg-slate-950 border-t border-white/5 flex items-center justify-between px-4 text-[9px] text-white/30 uppercase font-bold tracking-wider",children:[a.jsx("span",{children:m==="polygon"?"Click to add points, click first point to close":m==="rectangle"?"Click two corners to draw rectangle":m==="freehand"?"Click and drag to draw freehand":"Pan mode - drag to move"}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs("span",{children:[a.jsx("kbd",{className:"bg-white/10 px-1 py-0.5 rounded text-[8px]",children:"Esc"})," Cancel"]}),a.jsxs("span",{children:[a.jsx("kbd",{className:"bg-white/10 px-1 py-0.5 rounded text-[8px]",children:"Cmd+Z"})," Undo"]}),a.jsxs("span",{children:[a.jsx("kbd",{className:"bg-white/10 px-1 py-0.5 rounded text-[8px]",children:"Enter"})," Close"]})]})]})]})},gM=({manifest:e,searchService:t,onResultSelect:n,onResultsChange:i,currentCanvasId:l})=>{const[o,u]=S.useState(""),[d,m]=S.useState([]),[h,p]=S.useState([]),[g,y]=S.useState(!1),[x,v]=S.useState(null),[N,j]=S.useState(0),[C,A]=S.useState(!1),[_,T]=S.useState(-1),L=S.useRef(null),H=S.useRef(null),k=t?Ml.extractAutocompleteService(t):null,R=S.useCallback(async W=>{if(!t||!W.trim()){m([]),j(0),i?.([]);return}y(!0),v(null);try{const G=await Ml.search(t.id,W),te=Ml.parseResults(G);m(te),j(G.partOf?.total||te.length),i?.(te)}catch(G){v(G.message||"Search failed"),m([]),j(0)}finally{y(!1)}},[t,i]),z=S.useCallback(async W=>{if(!k||W.length<2){p([]);return}try{const G=await Ml.autocomplete(k.id,W);p(G.terms),A(!0)}catch{p([])}},[k]),P=W=>{u(W),T(-1),H.current&&clearTimeout(H.current),H.current=setTimeout(()=>{z(W)},200)},K=W=>{W.preventDefault(),A(!1),R(o)},I=W=>{u(W.value),A(!1),R(W.value)},D=W=>{!C||h.length===0||(W.key==="ArrowDown"?(W.preventDefault(),T(G=>Math.min(G+1,h.length-1))):W.key==="ArrowUp"?(W.preventDefault(),T(G=>Math.max(G-1,-1))):W.key==="Enter"&&_>=0?(W.preventDefault(),I(h[_])):W.key==="Escape"&&A(!1))},E=()=>{u(""),m([]),p([]),j(0),v(null),i?.([]),L.current?.focus()},q=d.reduce((W,G)=>(W[G.canvasId]||(W[G.canvasId]=[]),W[G.canvasId].push(G),W),{});return t?a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsx("form",{onSubmit:K,className:"p-3 border-b bg-white sticky top-0 z-10",children:a.jsxs("div",{className:"relative",children:[a.jsx("input",{ref:L,type:"text",value:o,onChange:W=>P(W.target.value),onKeyDown:D,onFocus:()=>h.length>0&&A(!0),placeholder:"Search within manifest...",className:"w-full pl-10 pr-10 py-2.5 border rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-iiif-blue focus:border-transparent","aria-label":"Search within manifest","aria-autocomplete":"list","aria-controls":"search-suggestions","aria-expanded":C}),a.jsx($,{name:"search",className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),o&&a.jsx("button",{type:"button",onClick:E,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600","aria-label":"Clear search",children:a.jsx($,{name:"close"})}),C&&h.length>0&&a.jsx("ul",{id:"search-suggestions",role:"listbox",className:"absolute top-full left-0 right-0 mt-1 bg-white border rounded-lg shadow-lg z-20 max-h-60 overflow-auto",children:h.map((W,G)=>a.jsxs("li",{role:"option","aria-selected":G===_,onClick:()=>I(W),className:`px-4 py-2 cursor-pointer flex items-center justify-between ${G===_?"bg-blue-50 text-iiif-blue":"hover:bg-slate-50"}`,children:[a.jsx("span",{className:"text-sm",children:W.value}),W.count&&a.jsx("span",{className:"text-xs text-slate-400",children:W.count})]},W.value))})]})}),a.jsxs("div",{className:"flex-1 overflow-auto",children:[g&&a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"w-6 h-6 border-2 border-slate-200 border-t-iiif-blue rounded-full animate-spin"})}),x&&a.jsxs("div",{className:"p-4 m-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:[a.jsx($,{name:"error",className:"inline mr-2"}),x]}),!g&&!x&&d.length===0&&o&&a.jsxs("div",{className:"p-8 text-center text-slate-500",children:[a.jsx($,{name:"search_off",className:"text-4xl mb-2 opacity-50"}),a.jsxs("p",{className:"text-sm",children:['No results found for "',o,'"']})]}),!g&&d.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"px-4 py-2 bg-slate-50 border-b text-xs font-medium text-slate-600 sticky top-0",children:[N," result",N!==1?"s":"",' for "',o,'"']}),a.jsx("div",{className:"divide-y",children:Object.entries(q).map(([W,G])=>a.jsxs("div",{className:`${l===W?"bg-blue-50/50":""}`,children:[a.jsxs("div",{className:"px-4 py-2 bg-slate-100/50 text-xs font-medium text-slate-500 flex items-center gap-2",children:[a.jsx($,{name:"image",className:"text-sm"}),a.jsx("span",{className:"truncate flex-1",children:W.split("/").pop()}),a.jsxs("span",{className:"text-slate-400",children:[G.length," hit",G.length!==1?"s":""]})]}),G.map((te,U)=>a.jsx("button",{onClick:()=>n(te),className:"w-full px-4 py-3 text-left hover:bg-slate-50 transition-colors group",children:a.jsx(xM,{result:te,query:o})},`${te.canvasId}-${U}`))]},W))})]})]})]}):a.jsxs("div",{className:"p-4 text-center text-slate-500",children:[a.jsx($,{name:"search_off",className:"text-4xl mb-2 opacity-50"}),a.jsx("p",{className:"text-sm",children:"No search service available for this manifest."})]})},xM=({result:e,query:t})=>{const n=(i,l)=>l?i.split(new RegExp(`(${bM(l)})`,"gi")).map((u,d)=>u.toLowerCase()===l.toLowerCase()?a.jsx("mark",{className:"bg-yellow-200 text-yellow-900 px-0.5 rounded",children:u},d):u):i;return a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:e.selector?a.jsxs(a.Fragment,{children:[e.selector.prefix&&a.jsxs("span",{className:"text-slate-400",children:["...",e.selector.prefix]}),a.jsx("mark",{className:"bg-yellow-200 text-yellow-900 px-0.5 rounded font-medium",children:e.selector.exact}),e.selector.suffix&&a.jsxs("span",{className:"text-slate-400",children:[e.selector.suffix,"..."]})]}):n(e.text.substring(0,200),t)}),a.jsxs("div",{className:"flex items-center gap-3 mt-1.5 text-xs text-slate-400",children:[e.region&&a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx($,{name:"crop",className:"text-sm"}),e.region.x,",",e.region.y]}),e.time&&a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx($,{name:"schedule",className:"text-sm"}),Pv(e.time.start),e.time.end&&` - ${Pv(e.time.end)}`]}),a.jsx($,{name:"arrow_forward",className:"text-sm ml-auto opacity-0 group-hover:opacity-100 transition-opacity"})]})]})};function bM(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Pv(e){const t=Math.floor(e/60),n=Math.floor(e%60);return`${t}:${n.toString().padStart(2,"0")}`}function yM(e){if(typeof e=="string"){const[i,l]=e.split("#");return{source:i,selector:l?mN(l):void 0}}const t=typeof e.source=="string"?e.source:e.source?.id||"";let n;if(e.selector){const i=Array.isArray(e.selector)?e.selector:[e.selector];n=NM(i[0])}return{source:t,selector:n}}function mN(e){const t={type:"fragment",original:`#${e}`};new URLSearchParams(e.replace(/&/g,"&"));const n=e.split("&");for(const i of n){const[l,o]=i.split("=");l==="xywh"&&o?t.spatial=vM(o):l==="t"&&o&&(t.temporal=wM(o))}return t}function vM(e){const t=e.startsWith("percent:"),n=(t?e.slice(8):e).split(",").map(Number);return{x:n[0]||0,y:n[1]||0,width:n[2]||0,height:n[3]||0,unit:t?"percent":"pixel"}}function wM(e){const t=e.split(",");return{start:$v(t[0]),end:t[1]?$v(t[1]):void 0}}function $v(e){const t=e.trim();if(!t.includes(":"))return parseFloat(t)||0;const n=t.split(":").map(Number);return n.length===2?n[0]*60+n[1]:n.length===3?n[0]*3600+n[1]*60+n[2]:0}function NM(e){if(!e)return{type:"unknown",original:""};switch(e.type){case"FragmentSelector":{const t=e.value||"",n=t.startsWith("#")?t.slice(1):t;return mN(n)}case"SvgSelector":return{type:"svg",svgPath:e.value||"",original:e.value||""};case"PointSelector":{const t=e;return{type:"point",point:{x:t.x,y:t.y,t:t.t},original:JSON.stringify(e)}}default:return{type:"unknown",original:JSON.stringify(e)}}}function SM(e){const t=`${e.x},${e.y},${e.width},${e.height}`;return e.unit==="percent"?`xywh=percent:${t}`:`xywh=${t}`}function CM(e){return e.end!==void 0?`t=${e.start},${e.end}`:`t=${e.start}`}function jM(e){const t=[];return e.spatial&&t.push(SM(e.spatial)),e.temporal&&t.push(CM(e.temporal)),t.length===0?"":"#"+t.join("&")}function EM(e){switch(e.type){case"fragment":{const t=jM(e);return t?{type:"FragmentSelector",value:t,conformsTo:"http://www.w3.org/TR/media-frags/"}:null}case"svg":return{type:"SvgSelector",value:e.svgPath||""};case"point":return{type:"PointSelector",...e.point};default:return null}}function AM(e,t){if(!t||t.type==="unknown")return e;const n=EM(t);return n?{type:"SpecificResource",source:e,selector:n}:e}function TM(e){return yM(e).selector?.spatial||null}function _M(e){const t=e.match(/d="([^"]+)"/);return t?t[1]:null}function kM(e){const t=e.match(/d="([^"]+)"/);if(!t)return null;const n=t[1],i=[],l=n.match(/[MLZ][\d.,\s-]*/gi);if(!l)return null;for(const g of l){if(g[0].toUpperCase()==="Z")continue;const x=g.slice(1).trim().split(/[\s,]+/).map(Number);x.length>=2&&!isNaN(x[0])&&!isNaN(x[1])&&i.push({x:x[0],y:x[1]})}if(i.length===0)return null;const o=i.map(g=>g.x),u=i.map(g=>g.y),d=Math.min(...o),m=Math.max(...o),h=Math.min(...u),p=Math.max(...u);return{x:d,y:h,width:m-d,height:p-h}}const pN=An.memo(function({item:t,manifestItems:n,manifest:i,onSelect:l,onUpdate:o,autoOpenComposer:u,onComposerOpened:d}){const{showToast:m}=ws(),h=S.useRef(null),p=S.useRef(null),g=S.useRef(null),[y,x]=S.useState("other"),[v,N]=S.useState([]),[j,C]=S.useState(!1),[A,_]=S.useState(!1),[T,L]=S.useState(!1),[H,k]=S.useState(!1),[R,z]=S.useState([]),[P,K]=S.useState(!1),[I,D]=S.useState(!1),[E,q]=S.useState(!1),[W,G]=S.useState(!1),[te,U]=S.useState(!0),[V,O]=S.useState(null),[B,Y]=S.useState(0),[X,Q]=S.useState(100),ue=S.useMemo(()=>{if(!i?.service)return null;const ve=Array.isArray(i.service)?i.service:[i.service];for(const je of ve){const Ue=Ml.extractSearchService(je);if(Ue)return Ue}return null},[i]);S.useEffect(()=>{u&&t&&(q(!0),d?.())},[u,t]),S.useEffect(()=>()=>{if(h.current){try{h.current.removeAllHandlers(),h.current.destroy()}catch{}h.current=null}},[]);const be=t?.items?.[0]?.items?.[0]?.body,de=be?.format||"",ye=be?.service?.[0]?.id;S.useEffect(()=>{if(!t)return;de.startsWith("video/")?x("video"):de.startsWith("audio/")?x("audio"):de.startsWith("image/")?x("image"):x("other");const ve=[];t.annotations&&t.annotations.forEach(je=>{ve.push(...je.items)}),N(ve)},[t?.id,de]),S.useEffect(()=>{let ve=null;if(t?._blobUrl)O(t._blobUrl);else if(t?._fileRef&&t._fileRef instanceof Blob)try{ve=URL.createObjectURL(t._fileRef),O(ve)}catch(je){console.error("Failed to create object URL",je),O(null)}else be?.id?O(be.id):O(null);return()=>{ve&&URL.revokeObjectURL(ve)}},[t,be?.id]),S.useEffect(()=>{let ve=!0;if(y==="image"&&t&&p.current){if(h.current){try{h.current.destroy()}catch(Ue){console.warn("Error destroying OSD viewer:",Ue)}h.current=null}let je=null;if(ye?je=`${ye}/info.json`:V&&(je={type:"image",url:V}),je&&ve)try{h.current=OpenSeadragon({element:p.current,prefixUrl:"https://openseadragon.github.io/openseadragon/images/",tileSources:je,gestureSettingsMouse:{clickToZoom:!1},showNavigationControl:!1,blendTime:.1,immediateRender:!0,imageLoaderLimit:2,maxImageCacheCount:50})}catch(Ue){console.error("Error initializing OSD viewer:",Ue)}}return()=>{if(ve=!1,h.current){try{h.current.removeAllHandlers(),h.current.destroy()}catch(je){console.warn("Error during OSD cleanup:",je)}h.current=null}}},[t?.id,y,ye,V]);const[le,we]=S.useState(null),He=S.useRef(null);S.useEffect(()=>{if(!h.current||y!=="image"||!t)return;const ve=h.current,je=document.createElementNS("http://www.w3.org/2000/svg","svg");je.style.position="absolute",je.style.left="0",je.style.top="0",je.style.width="100%",je.style.height="100%",je.style.pointerEvents="none",je.setAttribute("viewBox",`0 0 ${t.width||1e3} ${t.height||1e3}`),je.setAttribute("preserveAspectRatio","none");const Ue=ve.canvas?.parentElement||ve.element;return Ue&&(Ue.style.position="relative",Ue.appendChild(je),He.current=je),()=>{je.parentElement&&je.parentElement.removeChild(je),He.current=null}},[t?.id,y,t?.width,t?.height]),S.useEffect(()=>{const ve=He.current;if(!(!ve||!t)){for(;ve.firstChild;)ve.removeChild(ve.firstChild);v.forEach((je,Ue)=>{const ie=je.target?.selector;if(ie){if(ie.type==="SvgSelector"){const Oe=_M(ie.value);if(Oe){const ae=document.createElementNS("http://www.w3.org/2000/svg","path");ae.setAttribute("d",Oe),ae.setAttribute("fill",le===je.id?"rgba(59, 130, 246, 0.3)":"rgba(34, 197, 94, 0.2)"),ae.setAttribute("stroke",le===je.id?"#3b82f6":"#22c55e"),ae.setAttribute("stroke-width","2"),ae.style.pointerEvents="auto",ae.style.cursor="pointer",ae.addEventListener("click",()=>{we(je.id)}),ae.addEventListener("mouseenter",()=>{ae.setAttribute("fill","rgba(59, 130, 246, 0.3)")}),ae.addEventListener("mouseleave",()=>{ae.setAttribute("fill",le===je.id?"rgba(59, 130, 246, 0.3)":"rgba(34, 197, 94, 0.2)")}),ve.appendChild(ae)}}else if(ie.type==="FragmentSelector"||ie.value?.includes("xywh=")){const ae=(ie.value||"").match(/xywh=([^&]+)/);if(ae){const Fe=ae[1].split(",").map(Number);if(Fe.length===4){const Pe=document.createElementNS("http://www.w3.org/2000/svg","rect");Pe.setAttribute("x",String(Fe[0])),Pe.setAttribute("y",String(Fe[1])),Pe.setAttribute("width",String(Fe[2])),Pe.setAttribute("height",String(Fe[3])),Pe.setAttribute("fill",le===je.id?"rgba(59, 130, 246, 0.3)":"rgba(34, 197, 94, 0.2)"),Pe.setAttribute("stroke",le===je.id?"#3b82f6":"#22c55e"),Pe.setAttribute("stroke-width","2"),Pe.style.pointerEvents="auto",Pe.style.cursor="pointer",Pe.addEventListener("click",()=>{we(je.id)}),ve.appendChild(Pe)}}}}}),t.width&&t.height&&ve.setAttribute("viewBox",`0 0 ${t.width} ${t.height}`)}},[v,t,le]);const Ke=ve=>{if(!t)return;const je={manifestId:t._parentId||"root",canvasId:t.id};if(h.current?.viewport){const ft=h.current.viewport.getBounds(),ie=h.current.viewport.viewportToImageRectangle(ft);je.region={x:Math.round(ie.x),y:Math.round(ie.y),w:Math.round(ie.width),h:Math.round(ie.height)}}(ve||le)&&(je.annotationId=ve||le);const Ue=sn.generateLink(window.location.href,je);navigator.clipboard.writeText(Ue),m(ve?"Annotation permalink copied to clipboard":"Shareable view link copied to clipboard","success")},F=(ve="default")=>{if(!h.current||!t)return;const je=h.current.viewport.getBounds(),Ue=h.current.viewport.viewportToImageRectangle(je),ft=Math.round(Ue.x),ie=Math.round(Ue.y),Oe=Math.round(Ue.width),ae=Math.round(Ue.height),Fe=AM(t.id,{type:"fragment",spatial:{x:ft,y:ie,width:Oe,height:ae,unit:"pixel"}}),Pe=ye?`${ye}/${ft},${ie},${Oe},${ae}/max/0/${ve}.jpg`:V,it={id:`${t.id}/annotation/evidence-${crypto.randomUUID()}`,type:"Annotation",motivation:"supplementing",label:{en:[`Evidence Extract (${ve})`]},body:{id:Pe,type:"Image",format:"image/jpeg",label:{en:["Derived Analytical View"]}},target:Fe};ee(it),m("Evidence extract added as annotation","success")},me=S.useCallback(()=>F("default"),[F]),he=S.useCallback(()=>Ke(),[Ke]),ee=ve=>{if(!t)return;const je=[...v,ve];N(je);const Ue=t.annotations?t.annotations.map(ft=>({...ft,items:[...ft.items]})):[];Ue.length===0?Ue.push({id:`${t.id}/page/annotations`,type:"AnnotationPage",items:[ve]}):Ue[0]={...Ue[0],items:[...Ue[0].items,ve]},o({annotations:Ue})},Z=ve=>{if(!h.current||!t)return;const je=TM(`${t.id}#${ve.replace(/^#/,"")}`);if(!je)return;const{x:Ue,y:ft,width:ie,height:Oe}=je,ae=h.current.viewport.imageToViewportRectangle(Ue,ft,ie,Oe);h.current.viewport.fitBounds(ae,!1)},se=S.useCallback(ve=>{if(!h.current)return;const je=(B+ve+360)%360;Y(je),h.current.viewport.setRotation(je)},[B]),Te=S.useCallback(()=>se(-90),[se]),_e=S.useCallback(()=>se(90),[se]),ne=S.useCallback(()=>G(!0),[]),ge=S.useCallback(()=>D(!0),[]),Se=S.useCallback(()=>C(!0),[]);S.useCallback(()=>C(!1),[]);const Ce=S.useCallback(()=>C(ve=>!ve),[]),Me=S.useCallback(()=>_(ve=>!ve),[]),Be=S.useCallback(()=>L(ve=>!ve),[]),We=S.useCallback(()=>U(ve=>!ve),[]),qe=S.useCallback(()=>{h.current&&(Y(0),h.current.viewport.setRotation(0),h.current.viewport.goHome(!1))},[]),Ae=S.useCallback(()=>{h.current&&(h.current.viewport.zoomBy(Ts.ZOOM_STEP),h.current.viewport.applyConstraints())},[]),$e=S.useCallback(()=>{h.current&&(h.current.viewport.zoomBy(1/Ts.ZOOM_STEP),h.current.viewport.applyConstraints())},[]);S.useEffect(()=>{if(!h.current)return;const ve=()=>{if(h.current){const je=h.current.viewport.getZoom(),Ue=h.current.viewport.getHomeZoom();Q(Math.round(je/Ue*100))}};return h.current.addHandler("zoom",ve),h.current.addHandler("open",ve),()=>{h.current&&(h.current.removeHandler("zoom",ve),h.current.removeHandler("open",ve))}},[t?.id,y]),S.useEffect(()=>{const ve=je=>{W||E||I||document.activeElement?.tagName.match(/INPUT|TEXTAREA/)||((je.key==="+"||je.key==="=")&&(je.preventDefault(),Ae()),je.key==="-"&&(je.preventDefault(),$e()),(je.metaKey||je.ctrlKey)&&je.key==="0"&&(je.preventDefault(),qe()),je.key==="r"&&!je.shiftKey&&!je.metaKey&&!je.ctrlKey&&(je.preventDefault(),se(90)),je.key==="R"&&je.shiftKey&&!je.metaKey&&!je.ctrlKey&&(je.preventDefault(),se(-90)))};return window.addEventListener("keydown",ve),()=>window.removeEventListener("keydown",ve)},[Ae,$e,qe,se,W,E,I]);const Qe=S.useCallback(async()=>{if(g.current)try{document.fullscreenElement?(await document.exitFullscreen(),k(!1)):(await g.current.requestFullscreen(),k(!0))}catch{m("Fullscreen not supported","error")}},[m]);S.useEffect(()=>{const ve=()=>{k(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",ve),()=>document.removeEventListener("fullscreenchange",ve)},[]);const Ge=S.useCallback(async()=>{if(!V){m("No image available to download","error");return}try{const je=await(await fetch(V)).blob(),Ue=URL.createObjectURL(je),ft=document.createElement("a");ft.href=Ue,ft.download=`${Le(t?.label,"en")||Le(t?.label,"none")||"canvas"}.jpg`,document.body.appendChild(ft),ft.click(),document.body.removeChild(ft),URL.revokeObjectURL(Ue),m("Image downloaded","success")}catch{window.open(V,"_blank"),m("Opening image in new tab","info")}},[V,t,m]);return t?a.jsxs("div",{ref:g,className:"flex-1 flex flex-col bg-slate-900 overflow-hidden relative",children:[a.jsxs("div",{className:"h-14 bg-slate-950 border-b border-slate-800 flex items-center justify-between px-4 shrink-0 z-20",children:[a.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[a.jsx($,{name:y==="video"?"movie":y==="audio"?"audiotrack":"image",className:"text-blue-400 shrink-0"}),a.jsx("h2",{className:"text-white font-bold truncate",children:Le(t.label)})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[y==="image"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center bg-slate-800 rounded-lg border border-slate-700 p-0.5 mr-2",children:[a.jsx("button",{onClick:$e,disabled:!h.current,className:"p-1.5 text-slate-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed rounded",title:"Zoom Out (-)","aria-label":"Zoom out",children:a.jsx($,{name:"remove",className:"text-sm"})}),a.jsxs("span",{className:"px-2 text-[10px] font-mono text-slate-400 min-w-[44px] text-center",children:[X,"%"]}),a.jsx("button",{onClick:Ae,disabled:!h.current,className:"p-1.5 text-slate-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed rounded",title:"Zoom In (+)","aria-label":"Zoom in",children:a.jsx($,{name:"add",className:"text-sm"})}),a.jsx("div",{className:"w-px h-4 bg-slate-700 mx-1"}),a.jsx("button",{onClick:Te,disabled:!h.current,className:"p-1.5 text-slate-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed rounded",title:"Rotate Counter-Clockwise (Shift+R)","aria-label":"Rotate counter-clockwise",children:a.jsx($,{name:"rotate_left",className:"text-sm"})}),a.jsx("button",{onClick:_e,disabled:!h.current,className:"p-1.5 text-slate-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed rounded",title:"Rotate Clockwise (R)","aria-label":"Rotate clockwise",children:a.jsx($,{name:"rotate_right",className:"text-sm"})}),B!==0&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-px h-4 bg-slate-700 mx-1"}),a.jsxs("span",{className:"text-[10px] text-slate-500 px-1",children:[B,""]}),a.jsx("button",{onClick:qe,disabled:!h.current,className:"p-1.5 text-slate-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed rounded",title:"Reset View (Ctrl/Cmd+0)","aria-label":"Reset view",children:a.jsx($,{name:"restart_alt",className:"text-sm"})})]})]}),a.jsxs("div",{className:"flex items-center bg-slate-800 rounded-lg border border-slate-700 p-0.5 mr-2",children:[a.jsxs("button",{onClick:me,disabled:!h.current,className:"px-2 py-1 text-[10px] font-bold uppercase text-blue-400 hover:text-blue-300 disabled:opacity-30 disabled:cursor-not-allowed flex items-center gap-1 rounded",title:"Extract Evidence from Current View",children:[a.jsx($,{name:"content_cut",className:"text-xs"})," Extract"]}),a.jsx("div",{className:"w-px h-4 bg-slate-700 mx-0.5"}),a.jsxs("button",{onClick:he,disabled:!h.current,className:"px-2 py-1 text-[10px] font-bold uppercase text-slate-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed flex items-center gap-1 rounded",title:"Share Current View",children:[a.jsx($,{name:"share",className:"text-xs"})," Share"]})]}),a.jsxs("button",{onClick:Se,className:`p-2 rounded-lg hover:bg-slate-800 relative ${v.length>0?"text-green-400":"text-slate-400"} hover:text-white`,title:`${v.length} Annotation${v.length!==1?"s":""}`,children:[a.jsx($,{name:"sticky_note_2"}),v.length>0&&a.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 text-white text-[9px] font-bold rounded-full flex items-center justify-center",children:v.length})]}),a.jsx("button",{onClick:ne,className:"p-2 text-slate-400 hover:text-white rounded-lg hover:bg-slate-800",title:"Draw Annotations",children:a.jsx($,{name:"draw"})}),a.jsx("button",{onClick:ge,className:"p-2 text-slate-400 hover:text-white rounded-lg hover:bg-slate-800",title:"Image Request Workbench",children:a.jsx($,{name:"tune"})})]}),ue&&a.jsx("button",{onClick:Me,className:`p-2 rounded-lg hover:bg-slate-800 ${A?"text-blue-400 bg-blue-400/10":"text-slate-400 hover:text-white"}`,title:"Search in Manifest",children:a.jsx($,{name:"search"})}),a.jsx("button",{onClick:Be,className:`p-2 rounded-lg hover:bg-slate-800 ${T?"text-blue-400 bg-blue-400/10":"text-slate-400 hover:text-white"}`,title:"Canvas Metadata","aria-label":"Toggle metadata panel",children:a.jsx($,{name:"info"})}),y==="image"&&a.jsx("button",{onClick:Ge,disabled:!V,className:"p-2 text-slate-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed rounded-lg hover:bg-slate-800",title:"Download Image","aria-label":"Download image",children:a.jsx($,{name:"download"})}),a.jsx("button",{onClick:Qe,className:"p-2 text-slate-400 hover:text-white rounded-lg hover:bg-slate-800",title:"Toggle Fullscreen","aria-label":"Toggle fullscreen",children:a.jsx($,{name:H?"fullscreen_exit":"fullscreen"})}),a.jsx("div",{className:"w-px h-6 bg-slate-700 mx-1"}),a.jsx("button",{onClick:Ce,className:`p-2 rounded-lg hover:bg-slate-800 ${j?"text-blue-400 bg-blue-400/10":"text-slate-400 hover:text-white"}`,title:"Evidence & Notes",children:a.jsx($,{name:"description"})}),n&&n.length>1&&a.jsx("button",{onClick:We,className:`p-2 rounded-lg hover:bg-slate-800 ${te?"text-blue-400 bg-blue-400/10":"text-slate-400 hover:text-white"}`,title:"Toggle Canvas Navigator",children:a.jsx($,{name:"view_carousel"})})]})]}),a.jsxs("div",{className:"flex-1 flex min-h-0 relative",children:[a.jsxs("div",{className:"flex-1 relative bg-black overflow-hidden flex",children:[y==="image"&&a.jsx("div",{ref:p,className:"flex-1 h-full"}),(y==="video"||y==="audio")&&be?.id&&a.jsx(fM,{canvas:t,src:be.id,mediaType:y,poster:t?.thumbnail?.[0]?.id,showAccompanying:!0,className:"flex-1"}),y==="other"&&a.jsx("div",{className:"flex-1 flex items-center justify-center text-slate-500",children:a.jsxs("div",{className:"text-center",children:[a.jsx($,{name:"help_outline",className:"text-4xl mb-2"}),a.jsx("p",{className:"text-sm",children:"Unsupported media type"}),a.jsx("p",{className:"text-xs text-slate-600 mt-1",children:de||"Unknown format"})]})}),te&&n&&n.length>1&&a.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-slate-950/90 backdrop-blur border-t border-slate-800 p-2 z-10",children:[a.jsx("div",{className:"flex gap-2 overflow-x-auto custom-scrollbar pb-1",children:n.map((ve,je)=>{const Ue=ve.thumbnail?.[0]?.id||ve.items?.[0]?.items?.[0]?.body?.id||ve._blobUrl,ft=ve.id===t?.id;return a.jsx("button",{onClick:()=>l?.(ve.id),className:`shrink-0 w-16 h-16 rounded border-2 overflow-hidden transition-all ${ft?"border-blue-500 ring-2 ring-blue-500/50":"border-slate-700 hover:border-slate-500 opacity-70 hover:opacity-100"}`,title:Le(ve.label)||`Canvas ${je+1}`,children:Ue?a.jsx("img",{src:Ue,alt:Le(ve.label)||`Canvas ${je+1}`,className:"w-full h-full object-cover"}):a.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center",children:a.jsx("span",{className:"text-xs text-slate-500",children:je+1})})},ve.id)})}),a.jsx("div",{className:"text-center mt-1",children:a.jsxs("span",{className:"text-[10px] text-slate-500",children:[n.findIndex(ve=>ve.id===t?.id)+1," / ",n.length]})})]})]}),A&&ue&&i&&a.jsxs("div",{className:"w-80 bg-slate-900 border-l border-slate-800 flex flex-col animate-in slide-in-from-right duration-200",children:[a.jsxs("div",{className:"p-4 border-b border-slate-800 flex justify-between items-center bg-slate-950",children:[a.jsx("h3",{className:"text-xs font-bold uppercase tracking-widest text-slate-500",children:"Search in Manifest"}),a.jsx("button",{onClick:()=>_(!1),children:a.jsx($,{name:"close",className:"text-slate-500 text-sm"})})]}),a.jsx(gM,{manifest:i,searchService:ue,currentCanvasId:t?.id,onResultSelect:ve=>{if(ve.canvasId&&l&&(l(ve.canvasId),ve.region)){const je=`xywh=${ve.region.x},${ve.region.y},${ve.region.w},${ve.region.h}`;setTimeout(()=>Z(je),500)}m(`Found: "${ve.text}"`,"info")},onResultsChange:z})]}),j&&a.jsxs("div",{className:"w-80 bg-slate-900 border-l border-slate-800 flex flex-col animate-in slide-in-from-right duration-200",children:[a.jsxs("div",{className:"p-4 border-b border-slate-800 flex justify-between items-center bg-slate-950",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx($,{name:"sticky_note_2",className:"text-slate-400 text-sm"}),a.jsx("h3",{className:"text-xs font-bold uppercase tracking-widest text-slate-500",children:"Annotations"}),a.jsx("span",{className:"text-[10px] bg-slate-800 text-slate-400 px-2 py-0.5 rounded-full",children:v.length})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>G(!0),className:"text-[10px] bg-blue-600 hover:bg-blue-500 text-white px-2 py-1 rounded flex items-center gap-1",title:"Create New Annotation",children:[a.jsx($,{name:"add",className:"text-xs"})," New"]}),a.jsx("button",{onClick:()=>C(!1),className:"p-1 hover:bg-slate-800 rounded",children:a.jsx($,{name:"close",className:"text-slate-500 text-sm"})})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:v.length===0?a.jsxs("div",{className:"text-center py-20 text-slate-600",children:[a.jsx($,{name:"sticky_note_2",className:"text-4xl mb-3 mx-auto opacity-30"}),a.jsx("p",{className:"text-sm italic mb-2",children:"No annotations yet"}),a.jsx("button",{onClick:()=>G(!0),className:"text-xs text-blue-400 hover:text-blue-300 underline",children:"Create your first annotation"})]}):a.jsx("div",{className:"space-y-3",children:v.map(ve=>{const je=ve.body,Ue=ve.target,ft=je?.value||Le(je?.label,"en")||Le(je?.label,"none")||"Untitled Annotation",ie=je?.type||"TextualBody",Oe=je?.format||"text/plain",ae=ve.motivation||"commenting",Fe=Ue?.selector?.type,Pe=Ue?.selector?.value||"",it=Pe.includes("xywh="),rt=Fe==="SvgSelector",Ot=Pe.includes("t="),et=it||rt,Et=je?.id,Vt=ie==="Image"||Et?.includes("/iiif/"),pn=ie==="TextualBody"||je?.value,gn=JSON.stringify({"@context":"http://www.w3.org/ns/anno.jsonld",id:ve.id,type:"Annotation",motivation:ae,body:je,target:Ue},null,2),an=()=>{if(!(!h.current||!t)){if(we(ve.id),it)Z(Pe);else if(rt){const Ut=kM(Pe);if(Ut){const Pn=h.current.viewport.imageToViewportRectangle(Ut.x,Ut.y,Ut.width,Ut.height);h.current.viewport.fitBounds(Pn.scale(1.2),!1)}}}},Kt=Ut=>{Ut.stopPropagation(),Ke(ve.id)},Je=Ut=>{Ut.stopPropagation(),navigator.clipboard.writeText(gn),m("W3C Annotation JSON-LD copied to clipboard","success")},en={commenting:"text-blue-400 bg-blue-400/10",tagging:"text-green-400 bg-green-400/10",describing:"text-purple-400 bg-purple-400/10",identifying:"text-yellow-400 bg-yellow-400/10",painting:"text-pink-400 bg-pink-400/10",supplementing:"text-cyan-400 bg-cyan-400/10"}[ae]||"text-slate-400 bg-slate-400/10";return a.jsxs("div",{className:`bg-slate-800 rounded-lg border transition-all group ${le===ve.id?"border-blue-500 ring-1 ring-blue-500/30":"border-slate-700 hover:border-slate-600"}`,children:[Vt&&Et&&a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:Et,alt:"Annotation content",className:"w-full h-24 object-cover rounded-t-lg",onError:Ut=>{Ut.target.style.display="none"}}),a.jsx("div",{className:"absolute top-2 right-2 flex gap-1",children:a.jsx("button",{onClick:Kt,className:"p-1.5 bg-black/60 hover:bg-black/80 rounded text-white text-xs",title:"Copy annotation permalink",children:a.jsx($,{name:"link",className:"text-xs"})})})]}),a.jsxs("div",{className:"p-3",children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsx("span",{className:`text-[9px] font-black uppercase tracking-tighter px-1.5 py-0.5 rounded ${en}`,children:ae}),et&&a.jsxs("span",{className:"text-[9px] text-slate-500 flex items-center gap-0.5",children:[a.jsx($,{name:rt?"pentagon":"crop_free",className:"text-[10px]"}),rt?"Polygon":"Region"]}),Ot&&a.jsxs("span",{className:"text-[9px] text-slate-500 flex items-center gap-0.5",children:[a.jsx($,{name:"schedule",className:"text-[10px]"}),"Time"]})]}),a.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[et&&a.jsx("button",{onClick:an,className:"p-1 text-slate-400 hover:text-blue-400 rounded",title:"Zoom to annotation",children:a.jsx($,{name:"center_focus_strong",className:"text-xs"})}),a.jsx("button",{onClick:Kt,className:"p-1 text-slate-400 hover:text-blue-400 rounded",title:"Copy permalink",children:a.jsx($,{name:"link",className:"text-xs"})}),a.jsx("button",{onClick:Je,className:"p-1 text-slate-400 hover:text-green-400 rounded",title:"Copy W3C JSON-LD",children:a.jsx($,{name:"code",className:"text-xs"})})]})]}),a.jsx("div",{className:`text-slate-200 text-xs ${pn?"font-mono whitespace-pre-wrap leading-relaxed":"font-medium"}`,children:ft}),pn&&a.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[a.jsx("span",{className:"text-[8px] text-slate-500 uppercase",children:Oe}),a.jsxs("span",{className:"text-[8px] text-slate-600 font-mono truncate",children:[ve.id.split("/").pop()?.slice(0,20),"..."]})]})]})]},ve.id)})})}),a.jsx("div",{className:"p-3 border-t border-slate-800 bg-slate-950",children:a.jsxs("div",{className:"flex items-center justify-between text-[9px] text-slate-500",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx($,{name:"verified",className:"text-xs"}),"W3C Web Annotation compliant"]}),a.jsx("a",{href:"https://www.w3.org/TR/annotation-model/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline",children:"Spec "})]})})]}),T&&t&&a.jsxs("div",{className:"w-80 bg-slate-900 border-l border-slate-800 flex flex-col animate-in slide-in-from-right duration-200",children:[a.jsxs("div",{className:"p-4 border-b border-slate-800 flex justify-between items-center bg-slate-950",children:[a.jsx("h3",{className:"text-xs font-bold uppercase tracking-widest text-slate-500",children:"Canvas Metadata"}),a.jsx("button",{onClick:()=>L(!1),children:a.jsx($,{name:"close",className:"text-slate-500 text-sm"})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600",children:"Basic Information"}),a.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-700 space-y-2",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-[9px] text-slate-500 uppercase",children:"ID"}),a.jsx("p",{className:"text-xs text-slate-300 font-mono break-all",children:t.id})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-[9px] text-slate-500 uppercase",children:"Type"}),a.jsx("p",{className:"text-xs text-slate-300",children:t.type})]}),(t.width||t.height)&&a.jsxs("div",{children:[a.jsx("span",{className:"text-[9px] text-slate-500 uppercase",children:"Dimensions"}),a.jsxs("p",{className:"text-xs text-slate-300",children:[t.width||"?","  ",t.height||"?"," px"]})]}),t.duration&&a.jsxs("div",{children:[a.jsx("span",{className:"text-[9px] text-slate-500 uppercase",children:"Duration"}),a.jsxs("p",{className:"text-xs text-slate-300",children:[t.duration.toFixed(2),"s"]})]})]})]}),t.metadata&&t.metadata.length>0&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600",children:"Properties"}),a.jsx("div",{className:"space-y-2",children:t.metadata.map((ve,je)=>a.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:[a.jsx("span",{className:"text-[9px] text-slate-500 uppercase",children:Le(ve.label)}),a.jsx("p",{className:"text-xs text-slate-300 mt-1",children:Le(ve.value)})]},je))})]}),t.summary&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600",children:"Summary"}),a.jsx("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:a.jsx("p",{className:"text-xs text-slate-300",children:Le(t.summary)})})]}),t.requiredStatement&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600",children:"Required Statement"}),a.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:[a.jsx("span",{className:"text-[9px] text-slate-500 uppercase",children:Le(t.requiredStatement.label)}),a.jsx("p",{className:"text-xs text-slate-300 mt-1",children:Le(t.requiredStatement.value)})]})]}),t.rights&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600",children:"Rights"}),a.jsx("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:a.jsx("a",{href:t.rights,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-400 hover:underline break-all",children:t.rights})})]}),t.seeAlso&&t.seeAlso.length>0&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-600",children:"See Also"}),a.jsx("div",{className:"space-y-2",children:t.seeAlso.map((ve,je)=>a.jsxs("a",{href:ve.id,target:"_blank",rel:"noopener noreferrer",className:"block bg-slate-800 p-3 rounded border border-slate-700 hover:border-blue-500 transition-all",children:[a.jsx("span",{className:"text-[9px] text-slate-500 uppercase",children:ve.format||"Link"}),a.jsx("p",{className:"text-xs text-blue-400 hover:underline break-all mt-1",children:ve.id})]},je))})]})]})]})]}),I&&t&&a.jsx(nN,{canvas:t,onClose:()=>D(!1),onApply:ve=>{const je={id:`${t.id}/annotation/derived-${crypto.randomUUID()}`,type:"Annotation",motivation:"painting",label:{en:["Derived Image"]},body:{id:ve,type:"Image",format:"image/jpeg"},target:t.id};ee(je),m("Derived image applied as new layer","success")}}),E&&t&&a.jsx(fN,{canvas:t,onUpdate:o,onClose:()=>q(!1)}),W&&t&&V&&a.jsx(hN,{canvas:t,imageUrl:V,onCreateAnnotation:ve=>{ee(ve),m("Annotation created successfully","success")},onClose:()=>G(!1),existingAnnotations:v})]}):a.jsx("div",{className:"flex-1 flex items-center justify-center bg-slate-900 text-slate-500 italic",children:"Select a canvas to inspect."})},(e,t)=>{const n=e.item?.id,i=t.item?.id,l=e.manifest?.id,o=t.manifest?.id,u=JSON.stringify({autoOpenComposer:e.autoOpenComposer,hasManifestItems:!!e.manifestItems?.length}),d=JSON.stringify({autoOpenComposer:t.autoOpenComposer,hasManifestItems:!!t.manifestItems?.length});return n===i&&l===o&&u===d}),OM=({x:e,y:t,sections:n,onClose:i,isOpen:l,className:o="",maxHeight:u=400,selectionCount:d=1})=>{const m=S.useRef(null);S.useEffect(()=>{if(!l)return;const x=N=>{m.current&&!m.current.contains(N.target)&&i()},v=setTimeout(()=>{document.addEventListener("click",x),document.addEventListener("contextmenu",x)},0);return()=>{clearTimeout(v),document.removeEventListener("click",x),document.removeEventListener("contextmenu",x)}},[l,i]),S.useEffect(()=>{if(!l)return;const x=v=>{v.key==="Escape"&&i()};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[l,i]);const h=S.useCallback(()=>{if(!m.current)return{x:e,y:t};const v=m.current.getBoundingClientRect(),N=window.innerWidth,j=window.innerHeight;let C=e,A=t;return e+v.width>N&&(C=e-v.width),t+v.height>j&&(A=t-v.height),C=Math.max(8,C),A=Math.max(8,A),{x:C,y:A}},[e,t]);if(S.useEffect(()=>{if(l&&m.current){const x=h();m.current.style.left=`${x.x}px`,m.current.style.top=`${x.y}px`}},[l,h]),!l)return null;const p=n.filter(x=>x.items.some(v=>!v.disabled));if(p.length===0)return null;const g=x=>{const v="w-full px-3 py-2 text-left text-sm flex items-center gap-3 transition-colors rounded-lg mx-1";if(x.disabled)return`${v} opacity-40 cursor-not-allowed text-slate-500`;switch(x.variant){case"danger":return`${v} text-red-600 hover:bg-red-50`;case"primary":return`${v} text-iiif-blue hover:bg-iiif-blue/10`;default:return`${v} text-slate-700 hover:bg-slate-100`}},y=x=>{const v="text-lg";if(x.disabled)return`${v} text-slate-400`;switch(x.variant){case"danger":return`${v} text-red-400`;case"primary":return`${v} text-iiif-blue`;default:return`${v} text-slate-400`}};return a.jsxs("div",{ref:m,className:`
        fixed z-[1000] 
        bg-white border border-slate-200 
        shadow-2xl rounded-xl py-2 min-w-[220px]
        animate-in fade-in zoom-in-95 duration-100
        ${o}
      `,style:{left:e,top:t,maxHeight:u,overflowY:"auto"},onContextMenu:x=>x.preventDefault(),children:[d>1&&a.jsx("div",{className:"px-3 py-1.5 mb-2 mx-1 bg-slate-100 rounded-lg",children:a.jsxs("span",{className:"text-xs font-bold text-slate-600",children:[d," items selected"]})}),p.map((x,v)=>a.jsxs(An.Fragment,{children:[v>0&&a.jsx("div",{className:"h-px bg-slate-200 my-1.5 mx-3"}),x.title&&a.jsx("div",{className:"px-4 py-1.5 text-[10px] font-black uppercase tracking-widest text-slate-400",children:x.title}),a.jsx("div",{className:"px-1",children:x.items.map(N=>a.jsxs("button",{onClick:()=>{N.disabled||(N.onClick(),i())},disabled:N.disabled,className:g(N),title:N.description,children:[N.icon&&a.jsx($,{name:N.icon,className:y(N)}),a.jsx("span",{className:"flex-1",children:N.label}),N.shortcut&&a.jsx("kbd",{className:"text-[10px] font-mono text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded",children:N.shortcut})]},N.id))})]},x.title||`section-${v}`))]})},IM=({items:e,focusedId:t,onFocus:n,onClear:i,fieldMode:l=!1,orientation:o="horizontal"})=>{const u=S.useRef(null),d=S.useRef(null);if(S.useEffect(()=>{t&&d.current&&u.current&&d.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},[t]),e.length===0)return null;const m=o==="horizontal";return a.jsxs("div",{ref:u,className:`${m?"h-full flex flex-row":"h-full flex flex-col"} ${l?"bg-slate-950":"bg-slate-50"}`,children:[a.jsxs("div",{className:`shrink-0 flex items-center justify-between ${m?"px-3 py-2 border-r flex-col h-full":"px-3 py-2 border-b flex-row"} ${l?"border-slate-800 bg-slate-900":"border-slate-200 bg-white"}`,children:[a.jsxs("div",{className:`flex items-center ${m?"flex-col gap-1":"flex-row gap-2"}`,children:[a.jsx("span",{className:`text-xs font-bold ${l?"text-yellow-400":"text-slate-700"}`,children:e.length}),a.jsx("span",{className:`text-[10px] ${l?"text-slate-500":"text-slate-400"}`,children:"selected"})]}),a.jsx("button",{onClick:i,className:`p-1 rounded transition-colors ${l?"text-slate-400 hover:text-white hover:bg-slate-800":"text-slate-400 hover:text-slate-700 hover:bg-slate-100"}`,title:"Clear selection",children:a.jsx($,{name:"close",className:"text-sm"})})]}),a.jsx("div",{className:`flex-1 overflow-x-auto overflow-y-hidden ${m?"flex flex-row items-center py-2 px-2 gap-2":"flex flex-col py-2 space-y-1"}`,children:e.map((h,p)=>{const g=h.id===t,y=Os(h,m?80:120),x=Ht.Canvas;return a.jsxs("button",{ref:g?d:void 0,onClick:()=>n(h),className:`shrink-0 flex items-center transition-all rounded-lg overflow-hidden ${g?l?"bg-yellow-400/10 ring-2 ring-yellow-400":"bg-iiif-blue/10 ring-2 ring-iiif-blue":"hover:bg-black/5"} ${m?"flex-col p-2 gap-1":"flex-row px-2 py-1.5 gap-2 w-full"}`,children:[a.jsx("div",{className:`shrink-0 ${g?m?"w-16 h-16":"w-12 h-12":m?"w-14 h-14":"w-10 h-10"} transition-all`,children:a.jsx(Hs,{urls:y,size:g?"sm":"xs",icon:x.icon,className:"w-full h-full rounded-md"})}),(!m||g)&&a.jsxs("div",{className:`text-left min-w-0 ${g?"opacity-100":"opacity-70"} ${m?"text-center":"flex-1"}`,children:[a.jsx("div",{className:`text-xs font-medium truncate max-w-[80px] ${l?"text-white":"text-slate-700"}`,children:Le(h.label,"none")||Le(h.label,"en")||"Untitled"}),!m&&a.jsxs("div",{className:`text-[10px] ${l?"text-slate-500":"text-slate-400"}`,children:["#",p+1]})]}),g&&m&&a.jsx($,{name:"visibility",className:`text-xs shrink-0 ${l?"text-yellow-400":"text-iiif-blue"}`})]},h.id)})})]})},Fl=e=>{const t={time:!1,location:!1,device:!1};return e.metadata&&((e.navDate||e.metadata.find(o=>Le(o.label).toLowerCase()==="date created")?.value&&Le(e.metadata.find(o=>Le(o.label).toLowerCase()==="date created").value,"en"))&&(t.time=!0),e.metadata.find(o=>Le(o.label).toLowerCase()==="location")?.value&&Le(e.metadata.find(o=>Le(o.label).toLowerCase()==="location").value,"en")&&(t.location=!0),e.metadata.find(o=>Le(o.label).toLowerCase()==="camera")?.value&&Le(e.metadata.find(o=>Le(o.label).toLowerCase()==="camera").value,"en")&&(t.device=!0)),t},DM=({root:e,onSelect:t,onOpen:n,onBatchEdit:i,onUpdate:l,validationIssues:o={},fieldMode:u,onReveal:d,onCatalogSelection:m})=>{const{showToast:h}=ws(),[p,g]=S.useState(!0),[y,x]=S.useState(null);S.useEffect(()=>{e&&g(!1)},[e]);const[v,N]=S.useState(()=>{if(typeof window>"u")return"grid";const ne=localStorage.getItem("field-studio:archive-view-mode");return ne&&["grid","list","map","timeline"].includes(ne)?ne:"grid"});S.useEffect(()=>{localStorage.setItem("field-studio:archive-view-mode",v)},[v]);const[j,C]=S.useState(""),[A,_]=S.useState("name"),[T,L]=S.useState(null),[H,k]=S.useState(null),{selectedIds:R,handleSelectWithModifier:z,toggle:P,select:K,selectAll:I,clear:D,isSelected:E}=hp(),{getAllCanvases:q}=dN(e),[W,G]=S.useState({isSelecting:!1,startX:0,startY:0,currentX:0,currentY:0,containerRect:null}),te=S.useRef(new Map),U=S.useRef(null),{isMobile:V}=rN(),O=S.useMemo(()=>q(),[q]),B=S.useMemo(()=>O.filter(ne=>E(ne.id)),[O,E]),Y=S.useMemo(()=>{const ne={hasGPS:!1,hasTime:!1,commonPrefix:""};return B.length>0&&(ne.hasGPS=B.some(ge=>Fl(ge).location),ne.hasTime=B.some(ge=>Fl(ge).time)),ne},[B]);S.useEffect(()=>{if(R.size===1){const ne=Array.from(R)[0],ge=O.find(Se=>Se.id===ne);L(ge||null)}else if(R.size>1){if(!T||!R.has(T.id)){const ne=Array.from(R)[0],ge=O.find(Se=>Se.id===ne);L(ge||null)}}else L(null)},[R,O,T]);const X=j.toLowerCase(),Q=S.useMemo(()=>O.filter(ne=>Le(ne.label).toLowerCase().includes(X)).sort((ne,ge)=>A==="name"?Le(ne.label).localeCompare(Le(ge.label)):(ge.navDate||"").localeCompare(ne.navDate||"")),[O,X,A]),ue=S.useMemo(()=>T&&!V?{width:160,height:180}:u?{width:200,height:220}:{width:140,height:160},[T,V,u]),{visibleRange:be,columns:de}=lM({totalItems:Q.length,itemSize:ue,containerRef:U,overscan:3}),{visibleRange:ye}=uN({totalItems:Q.length,itemHeight:56,containerRef:U,overscan:10});S.useMemo(()=>v==="grid"?Q.slice(be.start,be.end):v==="list"?Q.slice(ye.start,ye.end):Q,[v,Q,be,ye]);const le=S.useCallback(ne=>{const ge=ne&&ne.length>0?new Set(ne):R;if(!e||!l||ge.size===0)return;const Se=JSON.parse(JSON.stringify(e)),Ce=[],Me=$e=>{const Qe=$e.items||$e.annotations||[];for(let Ge=Qe.length-1;Ge>=0;Ge--){const ve=Qe[Ge];ge.has(ve.id)?Wt(ve)&&Ja("Manifest",ve.type)?Ce.push(Qe.splice(Ge,1)[0]):console.warn(`Cannot move ${ve.type} into Manifest - only Canvas is valid`):(ve.items||ve.annotations)&&Me(ve)}};if(Me(Se),Ce.length===0){h("No Canvases selected - only Canvases can be grouped into a Manifest","error");return}const Be=ct.BASE_URL.DEFAULT,We=ct.ID_PATTERNS.MANIFEST(Be,dn()),qe=Ai("Manifest","Canvas");console.log(`Creating Manifest with ${Ce.length} Canvases (${qe} relationship)`);const Ae={"@context":kt.PRESENTATION_3.CONTEXT,id:We,type:"Manifest",label:vn("Selection Bundle"),items:Ce,behavior:["individuals"]};Se.items||(Se.items=[]),Ja(Se.type,"Manifest")?(Se.items.push(Ae),l(Se),K(We),h(`Grouped ${Ce.length} Canvases into new Manifest`,"success")):h(`Cannot add Manifest to ${Se.type}`,"error")},[e,l,R,K,h]),we=S.useCallback((ne,ge)=>{z(ge.id,ne,Q),!ne.shiftKey&&!ne.metaKey&&!ne.ctrlKey&&t(ge)},[z,Q,t]),He=S.useCallback((ne,ge)=>{ne.preventDefault();const Se=R.size>1&&R.has(ge);k({x:ne.clientX,y:ne.clientY,targetId:ge,isMulti:Se})},[R]),Ke=S.useCallback(()=>N("grid"),[N]),F=S.useCallback(()=>N("list"),[N]),me=S.useCallback(()=>N("map"),[N]),he=S.useCallback(()=>N("timeline"),[N]),ee=S.useCallback(ne=>{C(ne.target.value)},[C]),Z=S.useCallback(()=>{k(null)},[]),se=S.useCallback(ne=>{if(!l||!e||!confirm(`Permanently remove ${ne.length} item(s)?`))return;const ge=JSON.parse(JSON.stringify(e));x({root:ge,ids:ne});const Se=JSON.parse(JSON.stringify(e)),Ce=Me=>{const Be=Me.items||Me.annotations||[];for(let We=Be.length-1;We>=0;We--)ne.includes(Be[We].id)?Be.splice(We,1):(Be[We].items||Be[We].annotations)&&Ce(Be[We])};Ce(Se),l(Se),D(),h(`Deleted ${ne.length} item(s)`,"success",{label:"Undo",onClick:()=>{l(ge),h("Deletion undone","info")},variant:"primary"})},[l,e,h,D]);S.useEffect(()=>{const ne=ge=>{ge.target instanceof HTMLInputElement||ge.target instanceof HTMLTextAreaElement||((ge.ctrlKey||ge.metaKey)&&ge.key==="a"&&(ge.preventDefault(),I(Q.map(Se=>Se.id)),h(`Selected ${Q.length} items`,"info")),ge.key==="Escape"&&R.size>0&&(D(),L(null)),(ge.key==="Delete"||ge.key==="Backspace")&&R.size>0&&(ge.preventDefault(),se(Array.from(R))))};return document.addEventListener("keydown",ne),()=>document.removeEventListener("keydown",ne)},[Q,R,h,se,I,D]),S.useEffect(()=>{const ne=()=>k(null);return window.addEventListener("click",ne),()=>window.removeEventListener("click",ne)},[]);const Te=S.useCallback(ne=>{if(ne.target!==ne.currentTarget&&!ne.target.classList.contains("rubber-band-area")||ne.metaKey||ne.ctrlKey)return;ne.preventDefault();const ge=U.current;if(!ge)return;const Se=ge.getBoundingClientRect(),Ce=ne.clientX-Se.left+ge.scrollLeft,Me=ne.clientY-Se.top+ge.scrollTop;G({isSelecting:!0,startX:Ce,startY:Me,currentX:Ce,currentY:Me,containerRect:Se})},[]);S.useEffect(()=>{if(!W.isSelecting)return;const ne=Se=>{const Ce=U.current;if(!Ce||!W.containerRect)return;const Me=Se.clientX-W.containerRect.left+Ce.scrollLeft,Be=Se.clientY-W.containerRect.top+Ce.scrollTop;G(We=>({...We,currentX:Me,currentY:Be}))},ge=Se=>{const Ce=U.current;if(!Ce){G(Ge=>({...Ge,isSelecting:!1}));return}const Me=W.startX,Be=W.startY,We=W.currentX,qe=W.currentY,Ae={left:Math.min(Me,We),right:Math.max(Me,We),top:Math.min(Be,qe),bottom:Math.max(Be,qe)},$e=Ae.right-Ae.left,Qe=Ae.bottom-Ae.top;if($e>=10||Qe>=10){const Ge=new Set(Se.shiftKey?Array.from(R):[]),ve=Ce.getBoundingClientRect();te.current.forEach((je,Ue)=>{const ft=je.getBoundingClientRect(),ie=ft.left-ve.left+Ce.scrollLeft,Oe=ft.right-ve.left+Ce.scrollLeft,ae=ft.top-ve.top+Ce.scrollTop,Fe=ft.bottom-ve.top+Ce.scrollTop;!(Oe<Ae.left||ie>Ae.right||Fe<Ae.top||ae>Ae.bottom)&&((Se.ctrlKey||Se.metaKey)&&Ge.has(Ue)?Ge.delete(Ue):Ge.add(Ue))}),Se.ctrlKey||Se.metaKey?Ge.forEach(je=>{R.has(je)||P(je)}):(D(),Ge.forEach(je=>K(je)))}G(Ge=>({...Ge,isSelecting:!1}))};return window.addEventListener("mousemove",ne),window.addEventListener("mouseup",ge),()=>{window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",ge)}},[W.isSelecting,W.containerRect,W.startX,W.startY,W.currentX,W.currentY,R,D,P,K]);const _e=S.useMemo(()=>W.isSelecting?{left:Math.min(W.startX,W.currentX),top:Math.min(W.startY,W.currentY),width:Math.abs(W.currentX-W.startX),height:Math.abs(W.currentY-W.startY)}:null,[W]);return a.jsxs("div",{className:`flex-1 flex flex-col h-full relative overflow-hidden ${u?"bg-black text-white":"bg-slate-50 text-slate-900"}`,children:[V&&R.size>0&&a.jsx("div",{className:"absolute z-[100] animate-in slide-in-from-bottom-4 duration-300 bottom-8 left-4 right-4 translate-x-0",children:a.jsx("div",{className:"bg-slate-900/95 backdrop-blur-md border border-slate-700 shadow-2xl rounded-2xl p-1 flex items-center gap-1 ring-4 ring-black/10 overflow-x-auto no-scrollbar max-w-full",children:a.jsxs("div",{className:"flex p-1 gap-1 shrink-0",children:[a.jsxs("button",{onClick:()=>le(),className:"flex items-center gap-2 px-4 py-2 hover:bg-slate-800 rounded-xl transition-all text-white group whitespace-nowrap",children:[a.jsx($,{name:"auto_stories",className:"text-green-400"}),a.jsx("div",{className:"text-left",children:a.jsx("div",{className:"text-xs font-bold",children:"Group"})})]}),Y.hasGPS&&a.jsxs("button",{onClick:()=>N("map"),className:"flex items-center gap-2 px-4 py-2 hover:bg-slate-800 rounded-xl transition-all text-white group whitespace-nowrap",children:[a.jsx($,{name:"explore",className:"text-blue-400"}),a.jsx("div",{className:"text-left",children:a.jsx("div",{className:"text-xs font-bold",children:"Map"})})]}),a.jsxs("button",{onClick:()=>m?.(Array.from(R)),className:"flex items-center gap-2 px-4 py-2 hover:bg-slate-800 rounded-xl transition-all text-white group whitespace-nowrap",children:[a.jsx($,{name:"table_chart",className:"text-amber-400"}),a.jsx("div",{className:"text-left",children:a.jsx("div",{className:"text-xs font-bold",children:"Catalog"})})]}),a.jsx("div",{className:"w-px h-8 bg-slate-700 mx-1"}),a.jsx("button",{onClick:D,className:"p-3 text-slate-500 hover:text-white hover:bg-red-500/20 rounded-xl transition-all",children:a.jsx($,{name:"close"})})]})})}),a.jsxs("div",{className:`h-16 border-b px-6 flex items-center justify-between shadow-sm z-10 shrink-0 ${u?"bg-slate-900 border-slate-700":"bg-white border-slate-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("h2",{className:`font-bold ${u?"text-xl text-yellow-400":"text-lg text-slate-800"}`,children:"Archive"}),!V&&R.size===0&&a.jsx("div",{className:"h-4 w-px bg-slate-500"}),!V&&R.size===0&&a.jsx("div",{className:"flex items-center gap-2 text-[10px] font-black uppercase text-slate-400",children:"Select items to begin synthesis pipeline"})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[!V&&a.jsxs("div",{className:"relative",children:[a.jsx($,{name:"search",className:`absolute left-3 top-2.5 text-lg ${u?"text-slate-500":"text-slate-400"}`}),a.jsx("input",{type:"text",placeholder:"Filter archive...",value:j,onChange:ee,className:`pl-10 pr-3 py-2 border rounded-md text-sm outline-none transition-all w-64 ${u?"bg-slate-800 border-slate-600 text-white focus:border-yellow-400 placeholder:text-slate-600":"bg-slate-100 border-transparent focus:bg-white focus:border-iiif-blue"}`})]}),a.jsxs("div",{className:`flex p-1 rounded-md ${u?"bg-slate-800":"bg-slate-100"}`,children:[a.jsx("button",{onClick:Ke,className:`p-2 rounded ${v==="grid"?u?"bg-yellow-400 text-black font-bold":"bg-white text-iiif-blue shadow-sm":"text-slate-400"}`,children:a.jsx($,{name:"grid_view"})}),a.jsx("button",{onClick:F,className:`p-2 rounded ${v==="list"?u?"bg-yellow-400 text-black font-bold":"bg-white text-iiif-blue shadow-sm":"text-slate-400"}`,children:a.jsx($,{name:"view_list"})}),a.jsx("button",{onClick:me,className:`p-2 rounded ${v==="map"?u?"bg-yellow-400 text-black font-bold":"bg-white text-iiif-blue shadow-sm":"text-slate-400"}`,children:a.jsx($,{name:"map"})}),a.jsx("button",{onClick:he,className:`p-2 rounded ${v==="timeline"?u?"bg-yellow-400 text-black font-bold":"bg-white text-iiif-blue shadow-sm":"text-slate-400"}`,children:a.jsx($,{name:"timeline"})})]})]})]}),!V&&R.size>0&&a.jsxs("div",{className:"w-full px-6 py-2 bg-slate-800 border-b border-slate-700 z-10 animate-in slide-in-from-top-2 flex items-center gap-4",children:[a.jsx("div",{className:"flex items-center gap-2 shrink-0",children:a.jsxs("span",{className:"text-xs font-bold text-white",children:[R.size," selected"]})}),a.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[a.jsxs("button",{onClick:()=>le(),className:"flex items-center gap-1.5 px-3 py-1.5 hover:bg-slate-700 rounded-lg transition-all text-white text-xs font-medium whitespace-nowrap",children:[a.jsx($,{name:"auto_stories",className:"text-green-400 text-sm"}),"Group into Manifest"]}),Y.hasGPS&&a.jsxs("button",{onClick:()=>N("map"),className:"flex items-center gap-1.5 px-3 py-1.5 hover:bg-slate-700 rounded-lg transition-all text-white text-xs font-medium whitespace-nowrap",children:[a.jsx($,{name:"explore",className:"text-blue-400 text-sm"}),"View on Map"]}),a.jsxs("button",{onClick:()=>m?.(Array.from(R)),className:"flex items-center gap-1.5 px-3 py-1.5 hover:bg-slate-700 rounded-lg transition-all text-white text-xs font-medium whitespace-nowrap",children:[a.jsx($,{name:"table_chart",className:"text-amber-400 text-sm"}),"Edit Metadata"]}),a.jsxs("button",{onClick:()=>i(Array.from(R)),className:"flex items-center gap-1.5 px-3 py-1.5 hover:bg-slate-700 rounded-lg transition-all text-white text-xs font-medium whitespace-nowrap",children:[a.jsx($,{name:"edit",className:"text-purple-400 text-sm"}),"Batch Edit"]})]}),a.jsx("div",{className:"flex-1"}),a.jsx("button",{onClick:D,className:"p-1.5 text-slate-400 hover:text-white hover:bg-red-500/20 rounded-lg transition-all",title:"Clear selection",children:a.jsx($,{name:"close",className:"text-sm"})})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsxs("div",{ref:U,className:`flex-1 overflow-y-auto custom-scrollbar pb-24 ${v==="map"||v==="timeline"?"p-0":"p-6"} transition-all duration-300 ${!V&&T?"w-1/3 max-w-sm border-r border-slate-200":""} ${W.isSelecting?"select-none cursor-crosshair":""} relative`,onMouseDown:v==="grid"?Te:void 0,onDragStart:ne=>W.isSelecting&&ne.preventDefault(),children:[_e&&a.jsx("div",{className:"absolute pointer-events-none border-2 border-iiif-blue bg-iiif-blue/10 z-50",style:{left:_e.left,top:_e.top,width:_e.width,height:_e.height}}),v==="grid"&&p&&a.jsx("div",{className:"p-6",children:a.jsx(Iv,{items:12,className:u?"grid-cols-2 md:grid-cols-3 lg:grid-cols-4":""})}),v==="grid"&&!p&&a.jsx("div",{className:"rubber-band-area",children:a.jsx(MM,{items:Q,visibleRange:be,columns:de,itemSize:ue,renderItem:ne=>{const ge=Fl(ne),Se=E(ne.id),Ce=Os(ne,200),Me=Ht.Canvas;return a.jsxs("div",{ref:Be=>{Be?te.current.set(ne.id,Be):te.current.delete(ne.id)},onContextMenu:Be=>He(Be,ne.id),className:`group relative rounded-lg shadow-sm cursor-pointer transition-all ${u?Se?"bg-slate-800 border-4 border-yellow-400 p-2":"bg-slate-800 border border-slate-700 p-3":Se?"bg-blue-50 border border-iiif-blue ring-2 ring-iiif-blue p-2":"bg-white border p-2 hover:shadow-md border-slate-200"}`,onClick:Be=>we(Be,ne),children:[a.jsxs("div",{className:`aspect-square rounded overflow-hidden flex items-center justify-center mb-2 relative ${u?"bg-black":"bg-slate-100"}`,children:[a.jsx(Hs,{urls:Ce,size:"lg",className:"w-full h-full",icon:Me.icon}),a.jsxs("div",{className:"absolute bottom-1 right-1 bg-black/70 backdrop-blur-sm text-white text-[9px] px-1.5 py-0.5 rounded-full flex gap-1.5 font-sans",children:[ge.time&&a.jsx($,{name:"schedule",className:"text-[10px] text-yellow-400",title:"Has Time metadata"}),ge.location&&a.jsx($,{name:"location_on",className:"text-[10px] text-green-400",title:"Has GPS metadata"}),ge.device&&a.jsx($,{name:"photo_camera",className:"text-[10px] text-blue-400",title:"Has Device metadata"})]})]}),a.jsx("div",{className:"px-1 min-w-0",children:a.jsxs("div",{className:`font-medium truncate ${u?"text-white text-sm":"text-slate-700 text-[11px]"}`,children:[a.jsx($,{name:Me.icon,className:`mr-1 text-[10px] opacity-60 ${Me.colorClass}`}),Le(ne.label)]})})]},ne.id)},fieldMode:u,activeItem:T,isMobile:V,filter:j,onClearFilter:()=>C("")})}),v==="list"&&p&&a.jsx("div",{className:"p-6",children:a.jsx(Iv,{items:8})}),v==="list"&&!p&&a.jsx(FM,{assets:Q,visibleRange:ye,onSelect:we,isSelected:E,fieldMode:u}),v==="map"&&a.jsx(H5,{root:e,onSelect:ne=>t(ne)}),v==="timeline"&&a.jsx(Y5,{root:e,onSelect:ne=>t(ne)})]}),!V&&R.size===1&&T&&a.jsxs("div",{className:"flex-1 bg-slate-900 relative z-0 flex flex-col overflow-hidden shadow-2xl border-l border-slate-800",children:[a.jsx(pN,{item:T,onUpdate:()=>{}}),a.jsx("button",{onClick:D,className:"absolute top-3 right-3 z-50 p-2 bg-black/60 text-white/70 hover:text-white rounded-full hover:bg-red-500 transition-all backdrop-blur-md",title:"Close Detail View",children:a.jsx($,{name:"close_fullscreen",className:"text-lg"})})]}),!V&&R.size>1&&a.jsx("div",{className:"h-28 bg-slate-900 border-t border-slate-800 shadow-2xl shrink-0",children:a.jsx(IM,{items:B,focusedId:T?.id||null,onFocus:ne=>{L(ne);const ge=te.current.get(ne.id);ge&&ge.scrollIntoView({behavior:"smooth",block:"center"})},onClear:D,fieldMode:u,orientation:"horizontal"})})]}),H&&(()=>{const ne=H.isMulti?Array.from(R):[H.targetId],ge=O.find(Be=>Be.id===H.targetId),Se=ge?Fl(ge):{location:!1},Ce=H.isMulti||!1,Me=[{items:[{id:"reveal-structure",label:"Reveal in Structure",icon:"account_tree",onClick:()=>d?.(H.targetId,"collections")},{id:"open-workbench",label:"Open in Workbench",icon:"auto_awesome_motion",onClick:()=>d?.(H.targetId,"viewer")},{id:"view-archive",label:"View in Archive",icon:"inventory_2",onClick:()=>d?.(H.targetId,"archive")}]},{title:"Edit",items:[{id:"edit-catalog",label:Ce?"Edit Selected in Catalog":"Edit in Catalog",icon:"table_chart",shortcut:"Ctrl+E",onClick:()=>m?.(ne)},{id:"batch-edit",label:"Batch Edit",icon:"edit_note",disabled:!Ce&&ne.length===1,onClick:()=>i(ne)},{id:"duplicate",label:Ce?`Duplicate ${ne.length} Items`:"Duplicate",icon:"content_copy",onClick:()=>{if(!l||!e)return;const Be=JSON.parse(JSON.stringify(e)),We=qe=>{const Ae=qe.items||qe.annotations||[],$e=[];for(const Qe of Ae){if(ne.includes(Qe.id)){const Ge=JSON.parse(JSON.stringify(Qe));Ge.id=`${Qe.id}_copy_${dn().slice(0,8)}`;const ve=Le(Ge.label);Ge.label=vn(`${ve} (Copy)`),$e.push(Ge)}(Qe.items||Qe.annotations)&&We(Qe)}Ae.push(...$e)};We(Be),l(Be),h(`Duplicated ${ne.length} item(s)`,"success")}}]},{title:"Organize",items:[{id:"group-manifest",label:Ce?"Group into New Manifest":"Add to New Manifest",icon:"auto_stories",onClick:()=>{Ce||K(H.targetId),le()}},{id:"select-all",label:"Select All",icon:"select_all",shortcut:"Ctrl+A",onClick:()=>{I(Q.map(Be=>Be.id)),h(`Selected ${Q.length} items`,"info")}},{id:"clear-selection",label:"Clear Selection",icon:"deselect",disabled:R.size===0,onClick:()=>{D(),L(null)}}]},...Se.location?[{title:"View",items:[{id:"view-map",label:Ce?"View Selected on Map":"View on Map",icon:"explore",onClick:()=>N("map")}]}]:[],{title:"Export",items:[{id:"copy-id",label:"Copy IIIF ID",icon:"link",onClick:()=>{navigator.clipboard.writeText(H.targetId),h("IIIF ID copied to clipboard","success")}},{id:"copy-json",label:Ce?"Copy JSON (First Item)":"Copy JSON",icon:"code",onClick:()=>{const Be=O.find(We=>We.id===H.targetId);Be&&(navigator.clipboard.writeText(JSON.stringify(Be,null,2)),h("JSON copied to clipboard","success"))}}]},{items:[{id:"delete",label:Ce?`Delete ${ne.length} Items`:"Remove from Archive",icon:"delete",variant:"danger",shortcut:"Del",onClick:()=>se(ne)}]}];return a.jsx(OM,{isOpen:!0,x:H.x,y:H.y,onClose:Z,sections:Me,selectionCount:Ce?ne.length:1})})()]})},LM=An.memo(DM,(e,t)=>{const n=e.root?.id,i=t.root?.id,l=e.fieldMode,o=t.fieldMode,u=Object.keys(e.validationIssues||{}).length,d=Object.keys(t.validationIssues||{}).length;return n===i&&l===o&&u===d}),RM=An.memo(({asset:e,isSelected:t,fieldMode:n,onItemClick:i,onContextMenu:l,itemRefCallback:o})=>{const u=Fl(e),d=Os(e,200),m=Ht.Canvas;return a.jsxs("div",{ref:h=>o(h,e.id),onContextMenu:h=>l(h,e.id),className:`group relative rounded-lg shadow-sm cursor-pointer transition-all ${n?t?"bg-slate-800 border-4 border-yellow-400 p-2":"bg-slate-800 border border-slate-700 p-3":t?"bg-blue-50 border border-iiif-blue ring-2 ring-iiif-blue p-2":"bg-white border p-2 hover:shadow-md border-slate-200"}`,onClick:h=>i(h,e),children:[a.jsxs("div",{className:`aspect-square rounded overflow-hidden flex items-center justify-center mb-2 relative ${n?"bg-black":"bg-slate-100"}`,children:[a.jsx(Hs,{urls:d,size:"lg",className:"w-full h-full",icon:m.icon}),a.jsxs("div",{className:"absolute bottom-1 right-1 bg-black/70 backdrop-blur-sm text-white text-[9px] px-1.5 py-0.5 rounded-full flex gap-1.5 font-sans",children:[u.time&&a.jsx($,{name:"schedule",className:"text-[10px] text-yellow-400",title:"Has Time metadata"}),u.location&&a.jsx($,{name:"location_on",className:"text-[10px] text-green-400",title:"Has GPS metadata"}),u.device&&a.jsx($,{name:"photo_camera",className:"text-[10px] text-blue-400",title:"Has Device metadata"})]})]}),a.jsx("div",{className:"px-1 min-w-0",children:a.jsxs("div",{className:`font-medium truncate ${n?"text-white text-sm":"text-slate-700 text-[11px]"}`,children:[a.jsx($,{name:m.icon,className:`mr-1 text-[10px] opacity-60 ${m.colorClass}`}),Le(e.label)]})})]},e.id)},(e,t)=>e.asset.id===t.asset.id&&e.isSelected===t.isSelected&&e.fieldMode===t.fieldMode);RM.displayName="MemoizedArchiveGridItem";const MM=({items:e,visibleRange:t,columns:n,itemSize:i,renderItem:l,fieldMode:o,activeItem:u,isMobile:d,filter:m,onClearFilter:h})=>{const g=i.height+16,y=Math.ceil(e.length/n),v=Math.floor(t.start/n)*g,N=e.slice(t.start,t.end),j=Math.ceil(t.end/n),C=Math.max(0,(y-j)*g),A=!d&&u?"grid-cols-1 lg:grid-cols-2":o?"grid-cols-2 md:grid-cols-3 lg:grid-cols-4":"grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8";return a.jsxs("div",{children:[v>0&&a.jsx("div",{style:{height:v},"aria-hidden":"true"}),a.jsx("div",{className:`grid gap-4 ${A}`,children:N.map(l)}),C>0&&a.jsx("div",{style:{height:C},"aria-hidden":"true"}),e.length===0&&a.jsx(ki,{icon:"inventory_2",title:m?"No items match your filter":"No items in archive",message:m?`Try adjusting your search for "${m}" or clear the filter to see all items.`:"Import files to get started building your archive.",action:m&&h?{label:"Clear Filter",icon:"clear",onClick:h}:void 0,variant:o?"field-mode":"default"})]})},FM=({assets:e,visibleRange:t,onSelect:n,isSelected:i,fieldMode:l})=>{e.length*56;const u=t.start*56,d=e.slice(t.start,t.end),m=Math.max(0,(e.length-t.end)*56);return a.jsxs("div",{className:`border rounded-lg shadow-sm overflow-hidden flex flex-col ${l?"bg-slate-900 border-slate-700":"bg-white border-slate-200"}`,children:[a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-left text-sm",children:[a.jsx("thead",{className:`${l?"bg-slate-800 text-slate-300":"bg-slate-50 text-slate-500"} border-b ${l?"border-slate-700":"border-slate-200"} sticky top-0 z-10`,children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 font-medium w-10",children:a.jsx($,{name:"check_box_outline_blank",className:"opacity-50"})}),a.jsx("th",{className:"px-4 py-3 font-medium",children:"Label"}),a.jsx("th",{className:"px-4 py-3 font-medium w-32",children:"Type"}),a.jsx("th",{className:"px-4 py-3 font-medium w-40",children:"Date"}),a.jsx("th",{className:"px-4 py-3 font-medium w-32 text-right",children:"Dimensions"})]})}),a.jsxs("tbody",{className:`divide-y ${l?"divide-slate-800":"divide-slate-100"}`,children:[u>0&&a.jsx("tr",{"aria-hidden":"true",children:a.jsx("td",{colSpan:5,style:{height:u,padding:0}})}),d.map(h=>{const p=i(h.id),g=Le(h.label)||"Untitled",y=Ht[h.type]||Ht.Canvas,x=h.navDate?new Date(h.navDate).toLocaleDateString():"-",v=h.width&&h.height?`${h.width} x ${h.height}`:h.duration?`${h.duration}s`:"-";return a.jsxs("tr",{className:`cursor-pointer transition-colors group ${l?p?"bg-slate-800 text-white":"text-slate-300 hover:bg-slate-800":p?"bg-blue-50 text-slate-900":"text-slate-600 hover:bg-slate-50"}`,onClick:N=>n(N,h),style:{height:56},children:[a.jsx("td",{className:"px-4 py-3",children:a.jsx($,{name:p?"check_box":"check_box_outline_blank",className:`${p?"text-iiif-blue":l?"text-slate-600":"text-slate-300"} group-hover:text-iiif-blue transition-colors`})}),a.jsx("td",{className:"px-4 py-3 font-medium",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Hs,{urls:Os(h,64),size:"xs",icon:y.icon}),a.jsx("span",{className:"truncate max-w-[200px] md:max-w-md",title:g,children:g})]})}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("span",{className:`text-[10px] uppercase font-black px-2 py-1 rounded border ${l?"bg-slate-950 border-slate-800 text-slate-400":"bg-slate-100 border-slate-200 text-slate-500"}`,children:h.type})}),a.jsx("td",{className:"px-4 py-3 font-mono text-xs opacity-70",children:x}),a.jsx("td",{className:"px-4 py-3 font-mono text-xs opacity-70 text-right",children:v})]},h.id)}),m>0&&a.jsx("tr",{"aria-hidden":"true",children:a.jsx("td",{colSpan:5,style:{height:m,padding:0}})})]})]})}),e.length===0&&a.jsx(ki,{icon:"inventory_2",title:"No items in archive",message:"Import files to get started building your archive.",variant:l?"field-mode":"default"})]})};function PM(e,t=50){const[n,i]=S.useState({past:[],present:e,future:[]}),l=n.past.length>0,o=n.future.length>0,u=S.useCallback(()=>{i(p=>{if(p.past.length===0)return p;const g=[...p.past],y=g.pop();return{past:g,present:y,future:[p.present,...p.future]}})},[]),d=S.useCallback(()=>{i(p=>{if(p.future.length===0)return p;const g=[...p.future],y=g.shift();return{past:[...p.past,p.present],present:y,future:g}})},[]),m=S.useCallback(p=>{i(g=>{const y=typeof p=="function"?p(g.present):p;return JSON.stringify(y)===JSON.stringify(g.present)?g:{past:[...g.past.slice(-t+1),g.present],present:y,future:[]}})},[t]),h=S.useCallback(p=>{i({past:[],present:p,future:[]})},[]);return{state:n.present,update:m,set:h,undo:u,redo:d,canUndo:l,canRedo:o,historyState:n}}const $M=[{value:"straight",label:"Straight",icon:"horizontal_rule"},{value:"elbow",label:"Elbow",icon:"turn_right"},{value:"curved",label:"Curved",icon:"gesture"}],zM=[{value:"#3b82f6",label:"Blue",purpose:"linking"},{value:"#10b981",label:"Green",purpose:"commenting"},{value:"#f59e0b",label:"Amber",purpose:"describing"},{value:"#8b5cf6",label:"Purple",purpose:"tagging"},{value:"#ec4899",label:"Pink",purpose:"identifying"},{value:"#6b7280",label:"Gray",purpose:null}],Qh=[{value:"linking",label:"Links to",color:"#3b82f6"},{value:"commenting",label:"Comments on",color:"#10b981"},{value:"describing",label:"Describes",color:"#f59e0b"},{value:"tagging",label:"Tags",color:"#8b5cf6"},{value:"identifying",label:"Identifies",color:"#ec4899"}],UM=[{value:"none",label:"Hidden"},{value:"purpose-only",label:"Purpose Only"},{value:"full",label:"Full Label"}],BM=({activeItem:e,activeConnection:t,items:n=[],onAlignItem:i,onReorderItem:l,onDuplicateItem:o,onDeleteItem:u,onUpdateItem:d,onUpdateConnection:m,onDeleteConnection:h,onStraightenConnection:p,fieldMode:g=!1})=>{const[y,x]=S.useState(e?.w.toString()||""),[v,N]=S.useState(e?.h.toString()||"");An.useEffect(()=>{e&&(x(e.w.toString()),N(e.h.toString()))},[e?.id,e?.w,e?.h]);const j=g?"bg-black":"bg-white",C=g?"text-white":"text-slate-800",A=g?"text-slate-500":"text-slate-400",_=g?"bg-slate-900 hover:bg-slate-800 border-slate-800":"bg-slate-50 hover:bg-slate-100 border-slate-200",T=g?"bg-slate-900 border-slate-800 text-white":"bg-white border-slate-200 text-slate-800",L=g?"bg-red-900/30 hover:bg-red-900/50 text-red-400":"bg-red-50 hover:bg-red-100 text-red-600",H=()=>{if(!t)return null;const z=n.find(I=>I.id===t.fromId),P=n.find(I=>I.id===t.toId);if(!z||!P)return null;const K=Qh.find(I=>I.value===t.purpose)?.label||"links to";return{from:z.label,to:P.label,purpose:K}},k=(z,P)=>{z==="w"?x(P):N(P);const K=parseInt(P,10);!isNaN(K)&&K>0&&d&&e&&d(e.id,{[z]:K})},R=z=>{const P=Qh.find(K=>K.value===z);m(t.id,{purpose:z,color:P?.color||t?.color})};return a.jsxs("div",{className:`p-4 space-y-6 ${j} ${C}`,children:[e&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase mb-2 block tracking-widest ${A}`,children:"Dimensions"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:`text-[9px] ${A} mb-1 block`,children:"Width"}),a.jsx("input",{type:"number",value:y,onChange:z=>k("w",z.target.value),className:`w-full p-2 rounded-lg text-xs border ${T}`,min:"50",step:"10"})]}),a.jsxs("div",{children:[a.jsx("label",{className:`text-[9px] ${A} mb-1 block`,children:"Height"}),a.jsx("input",{type:"number",value:v,onChange:z=>k("h",z.target.value),className:`w-full p-2 rounded-lg text-xs border ${T}`,min:"50",step:"10"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase mb-2 block tracking-widest ${A}`,children:"Alignment"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("button",{onClick:()=>i(e.id,"center-h"),className:`p-2 rounded-lg text-xs flex items-center justify-center gap-2 border transition-colors ${_}`,children:[a.jsx($,{name:"align_horizontal_center",className:"text-sm"})," Center H"]}),a.jsxs("button",{onClick:()=>i(e.id,"center-v"),className:`p-2 rounded-lg text-xs flex items-center justify-center gap-2 border transition-colors ${_}`,children:[a.jsx($,{name:"align_vertical_center",className:"text-sm"})," Center V"]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase mb-2 block tracking-widest ${A}`,children:"Layer Order"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("button",{onClick:()=>l(e.id,"forward"),className:`p-2 rounded-lg text-xs flex items-center justify-center gap-2 border transition-colors ${_}`,children:[a.jsx($,{name:"flip_to_front",className:"text-sm"})," Bring Forward"]}),a.jsxs("button",{onClick:()=>l(e.id,"backward"),className:`p-2 rounded-lg text-xs flex items-center justify-center gap-2 border transition-colors ${_}`,children:[a.jsx($,{name:"flip_to_back",className:"text-sm"})," Send Back"]})]})]}),d&&a.jsx("div",{children:a.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer border ${_}`,children:[a.jsx("input",{type:"checkbox",checked:e.locked||!1,onChange:z=>d(e.id,{locked:z.target.checked}),className:"w-4 h-4 rounded"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:`text-xs font-medium ${C}`,children:"Lock Position"}),a.jsx("div",{className:`text-[9px] ${A}`,children:"Prevent accidental moves"})]}),a.jsx($,{name:e.locked?"lock":"lock_open",className:`text-sm ${A}`})]})}),a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase mb-2 block tracking-widest ${A}`,children:"Actions"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("button",{onClick:()=>o(e.id),className:`w-full p-2 rounded-lg text-xs flex items-center justify-center gap-2 border transition-colors ${_}`,children:[a.jsx($,{name:"content_copy",className:"text-sm"})," Duplicate"]}),a.jsxs("button",{onClick:()=>u(e.id),className:`w-full p-2 rounded-lg text-xs flex items-center justify-center gap-2 transition-colors ${L}`,children:[a.jsx($,{name:"delete",className:"text-sm"})," Delete"]})]})]})]}),t&&a.jsxs(a.Fragment,{children:[(()=>{const z=H();return z?a.jsxs("div",{className:`p-3 rounded-xl border ${g?"bg-slate-900 border-slate-800":"bg-slate-50 border-slate-200"}`,children:[a.jsx("div",{className:`text-[9px] font-black uppercase tracking-widest mb-2 ${A}`,children:"Connection Summary"}),a.jsxs("div",{className:`text-sm ${C}`,children:[a.jsx("span",{className:"font-bold",children:z.from}),a.jsx("span",{className:"mx-2 px-2 py-0.5 rounded-full text-[10px] font-black uppercase",style:{backgroundColor:t.color||"#3b82f6",color:"#fff"},children:z.purpose}),a.jsx("span",{className:"font-bold",children:z.to})]})]}):null})(),a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase mb-2 block tracking-widest ${A}`,children:"Line Style"}),a.jsx("div",{className:"flex gap-1",children:$M.map(z=>a.jsxs("button",{onClick:()=>m(t.id,{style:z.value}),className:`flex-1 p-2 rounded-lg text-xs flex flex-col items-center justify-center gap-1 border transition-colors ${(t.style||"elbow")===z.value?g?"bg-yellow-400/20 border-yellow-400 text-yellow-400":"bg-blue-50 border-blue-500 text-blue-600":_}`,title:z.label,children:[a.jsx($,{name:z.icon,className:"text-lg"}),a.jsx("span",{className:"text-[9px]",children:z.label})]},z.value))})]}),(t.style==="elbow"||!t.style)&&a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase mb-2 block tracking-widest ${A}`,children:"Direction"}),a.jsx("div",{className:"flex gap-1",children:["auto","horizontal-first","vertical-first"].map(z=>a.jsx("button",{onClick:()=>m(t.id,{direction:z}),className:`flex-1 p-2 rounded-lg text-[9px] text-center border transition-colors ${(t.direction||"auto")===z?g?"bg-yellow-400/20 border-yellow-400 text-yellow-400":"bg-blue-50 border-blue-500 text-blue-600":_}`,children:z==="auto"?"Auto":z==="horizontal-first"?"H First":"V First"},z))})]}),a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase mb-2 block tracking-widest ${A}`,children:"Purpose (IIIF Motivation)"}),a.jsx("div",{className:"space-y-2",children:Qh.map(z=>a.jsxs("button",{onClick:()=>R(z.value),className:`w-full p-2 rounded-lg text-xs flex items-center gap-3 border transition-colors ${t.purpose===z.value?g?"bg-yellow-400/20 border-yellow-400":"bg-blue-50 border-blue-500":_}`,children:[a.jsx("span",{className:"w-4 h-4 rounded-full shrink-0",style:{backgroundColor:z.color}}),a.jsx("span",{className:t.purpose===z.value?g?"text-yellow-400":"text-blue-600":C,children:z.label})]},z.value))})]}),a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase mb-2 block tracking-widest ${A}`,children:"Label Display"}),a.jsx("div",{className:"flex gap-1",children:UM.map(z=>a.jsx("button",{onClick:()=>m(t.id,{displayMode:z.value}),className:`flex-1 p-2 rounded-lg text-[9px] text-center border transition-colors ${(t.displayMode||"full")===z.value?g?"bg-yellow-400/20 border-yellow-400 text-yellow-400":"bg-blue-50 border-blue-500 text-blue-600":_}`,children:z.label},z.value))})]}),a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase mb-2 block tracking-widest ${A}`,children:"Color Override"}),a.jsx("div",{className:"flex gap-1.5 flex-wrap",children:zM.map(z=>a.jsx("button",{onClick:()=>m(t.id,{color:z.value}),className:`w-7 h-7 rounded-full border-2 transition-transform hover:scale-110 ${t.color===z.value?"ring-2 ring-offset-2 ring-blue-500":""}`,style:{backgroundColor:z.value,borderColor:z.value},title:z.label},z.value))})]}),a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase mb-2 block tracking-widest ${A}`,children:"Actions"}),a.jsxs("div",{className:"space-y-2",children:[p&&a.jsxs("button",{onClick:()=>p(t.id),className:`w-full p-2 rounded-lg text-xs flex items-center justify-center gap-2 border transition-colors ${_}`,children:[a.jsx($,{name:"straighten",className:"text-sm"})," Straighten (Remove Waypoints)"]}),a.jsxs("button",{onClick:()=>h(t.id),className:`w-full p-2 rounded-lg text-xs flex items-center justify-center gap-2 transition-colors ${L}`,children:[a.jsx($,{name:"link_off",className:"text-sm"})," Remove Connection"]})]})]})]}),!e&&!t&&a.jsxs("div",{className:`text-center py-8 ${A}`,children:[a.jsx($,{name:"touch_app",className:"text-4xl mb-2 opacity-50"}),a.jsx("p",{className:"text-xs",children:"Select an item or connection to edit its design properties"})]})]})},HM=({item:e,onExpand:t,fieldMode:n=!1})=>{if(!e)return null;const i=n?"bg-slate-900/95":"bg-white/95",l=n?"border-slate-700":"border-slate-200",o=n?"text-white":"text-slate-800",u=n?"text-slate-400":"text-slate-500",d=e.blobUrls?.[0]||e.blobUrl;return a.jsxs("div",{className:`absolute bottom-4 left-4 w-72 rounded-2xl shadow-2xl border backdrop-blur-md z-30 overflow-hidden transition-all animate-in slide-in-from-bottom-4 ${i} ${l}`,children:[a.jsxs("div",{className:`px-4 py-3 border-b ${l} flex items-center justify-between`,children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center ${e.isNote?"bg-yellow-100 text-yellow-600":e.resourceType==="Canvas"?"bg-green-100 text-green-600":e.resourceType==="Manifest"?"bg-blue-100 text-blue-600":"bg-slate-100 text-slate-600"}`,children:a.jsx($,{name:e.isNote?"sticky_note_2":"image",className:"text-xs"})}),a.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${u}`,children:e.isNote?"Note":e.resourceType})]}),a.jsx("button",{onClick:()=>t(e),className:`p-1.5 rounded-lg transition-colors ${n?"hover:bg-slate-800 text-slate-400 hover:text-yellow-400":"hover:bg-slate-100 text-slate-400 hover:text-iiif-blue"}`,title:"Expand to full view",children:a.jsx($,{name:"open_in_full",className:"text-sm"})})]}),a.jsxs("div",{className:"p-4",children:[e.isNote?a.jsx("div",{className:"bg-yellow-50 rounded-xl p-4 min-h-[100px]",children:a.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap font-handwriting",children:e.annotation||"Empty note"})}):d?a.jsx("div",{className:"aspect-video bg-slate-900 rounded-xl overflow-hidden cursor-pointer hover:ring-2 hover:ring-iiif-blue transition-all",onClick:()=>t(e),children:a.jsx("img",{src:d,alt:e.label,className:"w-full h-full object-contain"})}):a.jsx("div",{className:"aspect-video bg-slate-100 rounded-xl flex items-center justify-center",children:a.jsx($,{name:"image_not_supported",className:`text-4xl ${u}`})}),a.jsx("h3",{className:`mt-3 font-bold text-sm truncate ${o}`,children:e.label}),e.summary&&a.jsx("p",{className:`mt-1 text-xs line-clamp-2 ${u}`,children:Le(e.summary)}),e.metadata&&e.metadata.length>0&&a.jsx("div",{className:`mt-3 pt-3 border-t ${l}`,children:a.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.metadata.slice(0,3).map((m,h)=>a.jsx("span",{className:`text-[9px] px-2 py-0.5 rounded-full ${n?"bg-slate-800 text-slate-400":"bg-slate-100 text-slate-500"}`,children:Le(m.label)},h)),e.metadata.length>3&&a.jsxs("span",{className:`text-[9px] px-2 py-0.5 ${u}`,children:["+",e.metadata.length-3," more"]})]})})]}),a.jsx("div",{className:`px-4 py-2 border-t ${l} ${n?"bg-slate-800/50":"bg-slate-50"}`,children:a.jsxs("button",{onClick:()=>t(e),className:`w-full flex items-center justify-center gap-2 text-[10px] font-bold uppercase tracking-widest transition-colors ${n?"text-yellow-400 hover:text-yellow-300":"text-iiif-blue hover:text-blue-700"}`,children:[a.jsx($,{name:"visibility",className:"text-sm"}),"View Full Details"]})})]})},WM=({item:e,onClose:t,fieldMode:n=!1})=>{const[i,l]=S.useState(!0),[o,u]=S.useState(1),d=n?"bg-slate-900":"bg-white",m=n?"text-white":"text-slate-800",h=n?"text-slate-400":"text-slate-500",p=n?"border-slate-700":"border-slate-200",g=e.blobUrls?.[0]||e.blobUrl,y=()=>u(N=>Math.min(N+.25,4)),x=()=>u(N=>Math.max(N-.25,.25)),v=()=>u(1);return a.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-black/70 backdrop-blur-sm animate-in fade-in",onClick:t,children:a.jsxs("div",{className:`relative w-[90vw] h-[90vh] max-w-7xl rounded-2xl shadow-2xl overflow-hidden flex ${d}`,onClick:N=>N.stopPropagation(),children:[a.jsxs("div",{className:`flex-1 relative ${e.isNote?"bg-yellow-50":"bg-slate-900"} overflow-hidden`,children:[e.isNote?a.jsx("div",{className:"h-full flex items-center justify-center p-12",children:a.jsxs("div",{className:"max-w-xl w-full bg-white rounded-2xl shadow-xl p-8",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx($,{name:"sticky_note_2",className:"text-3xl text-yellow-500"}),a.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:e.label})]}),a.jsx("p",{className:"text-lg text-slate-700 whitespace-pre-wrap leading-relaxed font-handwriting",children:e.annotation||"Empty note"})]})}):g?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"absolute inset-0 flex items-center justify-center overflow-auto",style:{cursor:o>1?"move":"default"},children:a.jsx("img",{src:g,alt:e.label,className:"max-w-none transition-transform duration-200",style:{transform:`scale(${o})`},draggable:!1})}),a.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-1 bg-black/60 rounded-xl p-1 backdrop-blur-sm",children:[a.jsx("button",{onClick:x,className:"p-2 text-white hover:bg-white/10 rounded-lg transition-colors",title:"Zoom out",children:a.jsx($,{name:"remove"})}),a.jsxs("button",{onClick:v,className:"px-3 py-2 text-white text-xs font-bold min-w-[60px] hover:bg-white/10 rounded-lg transition-colors",children:[Math.round(o*100),"%"]}),a.jsx("button",{onClick:y,className:"p-2 text-white hover:bg-white/10 rounded-lg transition-colors",title:"Zoom in",children:a.jsx($,{name:"add"})})]})]}):a.jsx("div",{className:"h-full flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx($,{name:"image_not_supported",className:"text-6xl text-slate-600 mb-4"}),a.jsx("p",{className:"text-slate-500",children:"No image available"})]})}),a.jsx("button",{onClick:t,className:"absolute top-4 right-4 p-2 bg-black/60 hover:bg-black/80 text-white rounded-lg backdrop-blur-sm transition-colors",children:a.jsx($,{name:"close"})}),a.jsx("button",{onClick:()=>l(!i),className:`absolute top-4 left-4 p-2 rounded-lg backdrop-blur-sm transition-colors ${i?"bg-white/20 text-white":"bg-black/60 hover:bg-black/80 text-white"}`,title:i?"Hide metadata":"Show metadata",children:a.jsx($,{name:i?"chevron_right":"info"})})]}),i&&a.jsxs("div",{className:`w-96 border-l ${p} flex flex-col animate-in slide-in-from-right`,children:[a.jsxs("div",{className:`p-6 border-b ${p}`,children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${e.resourceType==="Canvas"?"bg-green-100 text-green-600":e.resourceType==="Manifest"?"bg-blue-100 text-blue-600":"bg-slate-100 text-slate-600"}`,children:a.jsx($,{name:"image"})}),a.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${h}`,children:e.resourceType})]}),a.jsx("h2",{className:`text-xl font-bold ${m}`,children:e.label}),e.summary&&a.jsx("p",{className:`mt-2 text-sm ${h}`,children:Le(e.summary)})]}),a.jsx("div",{className:`flex-1 overflow-y-auto custom-scrollbar ${d}`,children:a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase tracking-widest ${h} mb-1 block`,children:"Resource ID"}),a.jsx("code",{className:`text-xs break-all block p-2 rounded-lg ${n?"bg-slate-800 text-slate-300":"bg-slate-100 text-slate-600"}`,children:e.resourceId})]}),e.rights&&a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase tracking-widest ${h} mb-1 block`,children:"Rights"}),a.jsxs("a",{href:e.rights,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-iiif-blue hover:underline flex items-center gap-1",children:[e.rights.includes("creativecommons")?"Creative Commons":e.rights.includes("rightsstatements")?"Rights Statement":e.rights,a.jsx($,{name:"open_in_new",className:"text-xs"})]})]}),e.requiredStatement&&a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase tracking-widest ${h} mb-1 block`,children:Le(e.requiredStatement.label)||"Attribution"}),a.jsx("p",{className:`text-sm ${m}`,children:Le(e.requiredStatement.value)})]}),e.behavior&&e.behavior.length>0&&a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase tracking-widest ${h} mb-2 block`,children:"Behaviors"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:e.behavior.map((N,j)=>a.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${n?"bg-purple-900/50 text-purple-300":"bg-purple-100 text-purple-700"}`,children:N},j))})]}),e.metadata&&e.metadata.length>0&&a.jsxs("div",{children:[a.jsxs("label",{className:`text-[10px] font-black uppercase tracking-widest ${h} mb-3 block`,children:["Metadata (",e.metadata.length,")"]}),a.jsx("div",{className:"space-y-3",children:e.metadata.map((N,j)=>a.jsxs("div",{className:`p-3 rounded-lg ${n?"bg-slate-800":"bg-slate-50"}`,children:[a.jsx("div",{className:`text-[10px] font-bold uppercase ${h} mb-1`,children:Le(N.label)}),a.jsx("div",{className:`text-sm ${m}`,children:Le(N.value)})]},j))})]}),e.provider&&e.provider.length>0&&a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase tracking-widest ${h} mb-2 block`,children:"Provider"}),e.provider.map((N,j)=>a.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg ${n?"bg-slate-800":"bg-slate-50"}`,children:[N.logo?.[0]?.id&&a.jsx("img",{src:N.logo[0].id,alt:"",className:"w-8 h-8 object-contain"}),a.jsx("span",{className:`text-sm font-medium ${m}`,children:Le(N.label)})]},j))]}),a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase tracking-widest ${h} mb-1 block`,children:"Board Position"}),a.jsxs("div",{className:`grid grid-cols-2 gap-2 text-xs ${n?"text-slate-400":"text-slate-500"}`,children:[a.jsxs("div",{className:`p-2 rounded ${n?"bg-slate-800":"bg-slate-100"}`,children:[a.jsx("span",{className:"font-bold",children:"X:"})," ",Math.round(e.x)]}),a.jsxs("div",{className:`p-2 rounded ${n?"bg-slate-800":"bg-slate-100"}`,children:[a.jsx("span",{className:"font-bold",children:"Y:"})," ",Math.round(e.y)]}),a.jsxs("div",{className:`p-2 rounded ${n?"bg-slate-800":"bg-slate-100"}`,children:[a.jsx("span",{className:"font-bold",children:"W:"})," ",Math.round(e.w)]}),a.jsxs("div",{className:`p-2 rounded ${n?"bg-slate-800":"bg-slate-100"}`,children:[a.jsx("span",{className:"font-bold",children:"H:"})," ",Math.round(e.h)]})]})]})]})})]})]})})},GM=[{value:"transparent",label:"Transparent"},{value:"#ffffff",label:"White"},{value:"#f8fafc",label:"Slate 50"},{value:"#1e293b",label:"Slate 800"},{value:"#0f172a",label:"Slate 900"}],YM=({items:e,connections:t,onClose:n,onSaveToCollection:i,fieldMode:l=!1})=>{const{showToast:o}=ws(),[u,d]=S.useState({format:"iiif",includeMetadata:!0,includeConnections:!0,embedImages:!1,linkImages:!1,backgroundColor:"#ffffff",includeLabels:!0,scale:2}),[m,h]=S.useState(!1),p=l?"bg-slate-900":"bg-white",g=l?"text-white":"text-slate-800",y=l?"text-slate-400":"text-slate-500",x=l?"border-slate-700":"border-slate-200",v=l?"bg-slate-800 hover:bg-slate-700 border-slate-700":"bg-slate-50 hover:bg-slate-100 border-slate-200",N=()=>{const L=Math.min(...e.map(U=>U.x))-100,H=Math.min(...e.map(U=>U.y))-100,k=Math.max(...e.map(U=>U.x+U.w))+100,R=Math.max(...e.map(U=>U.y+U.h))+100,z=Math.max(k-L,Qt.defaultCanvasWidth),P=Math.max(R-H,Qt.defaultCanvasHeight),K=ct.BASE_URL.DEFAULT,I=ct.ID_PATTERNS.MANIFEST(K,`board-${crypto.randomUUID()}`),D=`${I}/canvas/1`,E=e.map((U,V)=>{const O=U.x-L,B=U.y-H,Y=U.isNote?{type:"TextualBody",value:U.annotation||U.label,format:"text/plain"}:U.blobUrl?{id:U.blobUrl,type:"Image",format:"image/jpeg",width:U.w,height:U.h}:{type:"TextualBody",value:U.label,format:"text/plain"},X={id:`${D}/annotation/item-${V}`,type:"Annotation",motivation:"painting",label:{none:[U.label]},body:Y,target:`${D}#xywh=${Math.round(O)},${Math.round(B)},${Math.round(U.w)},${Math.round(U.h)}`};return u.includeMetadata&&(U.metadata&&(X.metadata=U.metadata),U.summary&&(X.summary=U.summary),U.requiredStatement&&(X.requiredStatement=U.requiredStatement),U.rights&&(X.rights=U.rights),U.provider&&(X.provider=U.provider),U.behavior&&(X.behavior=U.behavior)),X}),q=u.includeConnections?t.map((U,V)=>{const O=e.find(X=>X.id===U.fromId),B=e.find(X=>X.id===U.toId);if(!O||!B)return null;const Y={x:O.x+O.w/2-L,y:O.y+O.h/2-H};return{id:`${D}/annotation/link-${V}`,type:"Annotation",motivation:"linking",label:{none:[U.label||U.type]},body:{type:"TextualBody",value:JSON.stringify({relationshipType:U.type,label:U.label,fromAnchor:U.fromAnchor,toAnchor:U.toAnchor,waypoints:U.waypoints,style:U.style,color:U.color}),format:"application/json"},target:`${D}#xywh=${Math.round(Y.x)},${Math.round(Y.y)},1,1`}}).filter(Boolean):[],W={id:`${D}/page/painting`,type:"AnnotationPage",items:E},G=q.length>0?{id:`${D}/page/linking`,type:"AnnotationPage",items:q}:null,te={id:D,type:"Canvas",label:{none:["Research Board"]},width:z,height:P,items:[W],annotations:G?[G]:void 0};return{"@context":kt.PRESENTATION_3.CONTEXT,id:I,type:"Manifest",label:{none:[`Research Board - ${new Date().toLocaleDateString()}`]},items:[te]}},j=async(T=!1)=>{const H=Math.min(...e.map(q=>q.x))-50,k=Math.min(...e.map(q=>q.y))-50,R=Math.max(...e.map(q=>q.x+q.w))+50,z=Math.max(...e.map(q=>q.y+q.h))+50,P=R-H,K=z-k,I=[];let D=0,E=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${P}" height="${K}" viewBox="0 0 ${P} ${K}">
  <defs>
    <style>
      .board-label { font-family: system-ui, sans-serif; font-size: 12px; font-weight: bold; }
      .board-note { font-family: 'Comic Sans MS', cursive; font-size: 14px; }
    </style>
  </defs>
  ${u.backgroundColor!=="transparent"?`<rect width="100%" height="100%" fill="${u.backgroundColor}"/>`:""}
`;for(const q of t){const W=e.find(Y=>Y.id===q.fromId),G=e.find(Y=>Y.id===q.toId);if(!W||!G)continue;const te=W.x+W.w/2-H,U=W.y+W.h-k,V=G.x+G.w/2-H,O=G.y-k,B=q.color||"#3b82f6";if(q.style==="elbow"){const Y=(U+O)/2;E+=`  <path d="M${te},${U} L${te},${Y} L${V},${Y} L${V},${O}" fill="none" stroke="${B}" stroke-width="2.5" stroke-linejoin="round" stroke-linecap="round"/>
`}else if(q.style==="curved"){const Y=(U+O)/2;E+=`  <path d="M${te},${U} Q${te},${Y} ${(te+V)/2},${Y} T${V},${O}" fill="none" stroke="${B}" stroke-width="2.5"/>
`}else E+=`  <line x1="${te}" y1="${U}" x2="${V}" y2="${O}" stroke="${B}" stroke-width="2.5"/>
`;E+=`  <circle cx="${V}" cy="${O}" r="4" fill="${B}"/>
`}for(const q of e){const W=q.x-H,G=q.y-k;if(q.isNote)E+=`  <rect x="${W}" y="${G}" width="${q.w}" height="${q.h}" fill="#fef9c3" stroke="#fbbf24" stroke-width="2" rx="8"/>
`,u.includeLabels&&q.annotation&&(E+=`  <text x="${W+16}" y="${G+30}" class="board-note" fill="#78350f">${C(q.annotation.slice(0,50))}${q.annotation.length>50?"...":""}</text>
`);else{if(E+=`  <rect x="${W}" y="${G}" width="${q.w}" height="${q.h}" fill="#ffffff" stroke="#e2e8f0" stroke-width="2" rx="12"/>
`,q.blobUrl)if(T){const te=q.blobUrl.includes(".png")?"png":"jpg",U=`image-${D}.${te}`;I.push({url:q.blobUrl,filename:U}),E+=`  <image x="${W+4}" y="${G+4}" width="${q.w-8}" height="${q.h-40}" href="images/${U}" preserveAspectRatio="xMidYMid meet"/>
`,D++}else u.embedImages?E+=`  <image x="${W+4}" y="${G+4}" width="${q.w-8}" height="${q.h-40}" href="${C(q.blobUrl)}" preserveAspectRatio="xMidYMid meet"/>
`:E+=`  <image x="${W+4}" y="${G+4}" width="${q.w-8}" height="${q.h-40}" href="${C(q.blobUrl)}" preserveAspectRatio="xMidYMid meet"/>
`;u.includeLabels&&(E+=`  <rect x="${W}" y="${G+q.h-32}" width="${q.w}" height="32" fill="#f8fafc" rx="0 0 12 12"/>
`,E+=`  <text x="${W+12}" y="${G+q.h-12}" class="board-label" fill="#1e293b">${C(q.label.slice(0,25))}${q.label.length>25?"...":""}</text>
`)}}return E+="</svg>",{svg:E,imageUrls:I}},C=T=>T.replace(/[<>&'"]/g,L=>{switch(L){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;";default:return L}}),A=async()=>{if(e.length===0){o("No items on board to export","warning");return}h(!0);try{if(u.format==="iiif"){const T=N(),L=new Blob([JSON.stringify(T,null,2)],{type:"application/ld+json"});Er.saveAs(L,`board-export-${new Date().toISOString().split("T")[0]}.json`),o("Board exported as IIIF Manifest","success")}else if(u.format==="svg")if(u.linkImages){const{svg:T,imageUrls:L}=await j(!0),H=new Zl;H.file("board.svg",T);const k=H.folder("images");if(k&&L.length>0){o("Fetching images...","info");for(const{url:z,filename:P}of L)try{const K=await fetch(z);if(K.ok){const I=await K.blob();k.file(P,I)}}catch(K){console.warn(`Could not fetch image: ${z}`,K)}}const R=await H.generateAsync({type:"blob"});Er.saveAs(R,`board-export-${new Date().toISOString().split("T")[0]}.zip`),o("Board exported as SVG with linked images","success")}else{const{svg:T}=await j(!1),L=new Blob([T],{type:"image/svg+xml"});Er.saveAs(L,`board-export-${new Date().toISOString().split("T")[0]}.svg`),o("Board exported as SVG","success")}else if(u.format==="png"){const{svg:T}=await j(!1),L=new Blob([T],{type:"image/svg+xml"}),H=URL.createObjectURL(L),k=new Image;k.onload=()=>{const R=document.createElement("canvas");R.width=k.width*u.scale,R.height=k.height*u.scale;const z=R.getContext("2d");z&&(z.scale(u.scale,u.scale),z.drawImage(k,0,0),R.toBlob(P=>{P&&(Er.saveAs(P,`board-export-${new Date().toISOString().split("T")[0]}.png`),o("Board exported as PNG","success")),URL.revokeObjectURL(H)},"image/png"))},k.src=H}n()}catch(T){console.error("Export failed:",T),o("Export failed","error")}finally{h(!1)}},_=()=>{if(!i)return;const T=N();i(T),o("Board saved to collection","success"),n()};return a.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in",onClick:n,children:a.jsxs("div",{className:`w-full max-w-md rounded-2xl shadow-2xl ${p} animate-in zoom-in-95`,onClick:T=>T.stopPropagation(),children:[a.jsxs("div",{className:`px-6 py-4 border-b ${x} flex items-center justify-between`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${l?"bg-yellow-400/20 text-yellow-400":"bg-iiif-blue/10 text-iiif-blue"}`,children:a.jsx($,{name:"file_download",className:"text-xl"})}),a.jsxs("div",{children:[a.jsx("h2",{className:`font-bold ${g}`,children:"Export Board"}),a.jsxs("p",{className:`text-xs ${y}`,children:[e.length," items, ",t.length," connections"]})]})]}),a.jsx("button",{onClick:n,className:`p-2 rounded-lg ${v}`,children:a.jsx($,{name:"close"})})]}),a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase tracking-widest ${y} mb-3 block`,children:"Export Format"}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"iiif",label:"IIIF",icon:"data_object",desc:"Manifest JSON"},{value:"svg",label:"SVG",icon:"image",desc:"Vector graphic"},{value:"png",label:"PNG",icon:"photo_camera",desc:"Raster image"}].map(T=>a.jsxs("button",{onClick:()=>d({...u,format:T.value}),className:`p-3 rounded-xl border text-center transition-all ${u.format===T.value?l?"bg-yellow-400/20 border-yellow-400 text-yellow-400":"bg-blue-50 border-blue-500 text-blue-600":`${v} border`}`,children:[a.jsx($,{name:T.icon,className:"text-2xl mb-1"}),a.jsx("div",{className:"text-xs font-bold",children:T.label}),a.jsx("div",{className:`text-[9px] ${y}`,children:T.desc})]},T.value))})]}),u.format==="iiif"&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer ${v}`,children:[a.jsx("input",{type:"checkbox",checked:u.includeMetadata,onChange:T=>d({...u,includeMetadata:T.target.checked}),className:"w-4 h-4 rounded"}),a.jsxs("div",{children:[a.jsx("div",{className:`text-sm font-medium ${g}`,children:"Include Metadata"}),a.jsx("div",{className:`text-xs ${y}`,children:"Embed item metadata in annotations"})]})]}),a.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer ${v}`,children:[a.jsx("input",{type:"checkbox",checked:u.includeConnections,onChange:T=>d({...u,includeConnections:T.target.checked}),className:"w-4 h-4 rounded"}),a.jsxs("div",{children:[a.jsx("div",{className:`text-sm font-medium ${g}`,children:"Include Connections"}),a.jsx("div",{className:`text-xs ${y}`,children:"Export linking annotations"})]})]})]}),u.format==="svg"&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer ${v}`,children:[a.jsx("input",{type:"checkbox",checked:u.linkImages,onChange:T=>d({...u,linkImages:T.target.checked,embedImages:!1}),className:"w-4 h-4 rounded"}),a.jsxs("div",{children:[a.jsx("div",{className:`text-sm font-medium ${g}`,children:"Export as ZIP with Linked Images"}),a.jsx("div",{className:`text-xs ${y}`,children:"SVG + images folder (recommended)"})]})]}),!u.linkImages&&a.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer ${v}`,children:[a.jsx("input",{type:"checkbox",checked:u.embedImages,onChange:T=>d({...u,embedImages:T.target.checked}),className:"w-4 h-4 rounded"}),a.jsxs("div",{children:[a.jsx("div",{className:`text-sm font-medium ${g}`,children:"Embed Images in SVG"}),a.jsx("div",{className:`text-xs ${y}`,children:"References external URLs (may not work offline)"})]})]}),a.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer ${v}`,children:[a.jsx("input",{type:"checkbox",checked:u.includeLabels,onChange:T=>d({...u,includeLabels:T.target.checked}),className:"w-4 h-4 rounded"}),a.jsxs("div",{children:[a.jsx("div",{className:`text-sm font-medium ${g}`,children:"Include Labels"}),a.jsx("div",{className:`text-xs ${y}`,children:"Show item labels in export"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase tracking-widest ${y} mb-2 block`,children:"Background Color"}),a.jsx("div",{className:"flex gap-2",children:GM.map(T=>a.jsx("button",{onClick:()=>d({...u,backgroundColor:T.value}),className:`w-8 h-8 rounded-lg border-2 transition-transform hover:scale-110 ${u.backgroundColor===T.value?"ring-2 ring-offset-2 ring-blue-500":""}`,style:{backgroundColor:T.value==="transparent"?"#fff":T.value,backgroundImage:T.value==="transparent"?"linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%)":"none",backgroundSize:"8px 8px",backgroundPosition:"0 0, 0 4px, 4px -4px, -4px 0px"},title:T.label},T.value))})]})]}),u.format==="png"&&a.jsxs("div",{children:[a.jsx("label",{className:`text-[10px] font-black uppercase tracking-widest ${y} mb-2 block`,children:"Scale Factor"}),a.jsx("div",{className:"flex gap-2",children:[1,2,3,4].map(T=>a.jsxs("button",{onClick:()=>d({...u,scale:T}),className:`flex-1 p-2 rounded-lg border text-sm font-bold transition-all ${u.scale===T?l?"bg-yellow-400/20 border-yellow-400 text-yellow-400":"bg-blue-50 border-blue-500 text-blue-600":`${v} border`}`,children:[T,"x"]},T))}),a.jsx("p",{className:`text-xs mt-2 ${y}`,children:"Higher scale = larger, sharper image"})]})]}),a.jsxs("div",{className:`px-6 py-4 border-t ${x} flex gap-3`,children:[i&&u.format==="iiif"&&a.jsxs("button",{onClick:_,className:`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${v} border`,children:[a.jsx($,{name:"add_to_photos",className:"mr-2"}),"Save to Collection"]}),a.jsx("button",{onClick:A,disabled:m,className:`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${l?"bg-yellow-400 text-black hover:bg-yellow-300":"bg-iiif-blue text-white hover:bg-blue-700"} disabled:opacity-50`,children:m?a.jsxs(a.Fragment,{children:[a.jsx($,{name:"hourglass_empty",className:"mr-2 animate-spin"}),"Exporting..."]}):a.jsxs(a.Fragment,{children:[a.jsx($,{name:"file_download",className:"mr-2"}),"Export ",u.format.toUpperCase()]})})]})]})})},qM=({root:e,settings:t})=>{const{showToast:n}=ws(),{state:i,update:l,undo:o,redo:u,canUndo:d,canRedo:m}=PM({items:[],connections:[]}),{items:h,connections:p}=i,[g,y]=S.useState("select"),[x,v]=S.useState(null),[N,j]=S.useState(null),[C,A]=S.useState(null),[_,T]=S.useState(null),[L,H]=S.useState({x:0,y:0}),[k,R]=S.useState("edit"),z=lN({minScale:.1,maxScale:5,initialScale:1}),P=z.viewport,[K,I]=S.useState(!1),[D,E]=S.useState(!1),[q,W]=S.useState(!1),[G,te]=S.useState(!1),[U,V]=S.useState(!1),[O,B]=S.useState(!1),[Y,X]=S.useState(!1),[Q,ue]=S.useState(null),[be,de]=S.useState(!1),ye=S.useRef(null),le=S.useRef(null),we=oN(ye,z,{enabled:!0,panButton:"middle",requireCtrlForZoom:!0,enableWheelPan:!0}),He=we.isPanning,Ke=S.useCallback(ie=>{const Oe=ye.current?.getBoundingClientRect();if(!Oe)return{x:0,y:0};let ae=(ie.clientX-Oe.left-P.x)/P.scale,Fe=(ie.clientY-Oe.top-P.y)/P.scale;return K&&(ae=Math.round(ae/24)*24,Fe=Math.round(Fe/24)*24),{x:ae,y:Fe}},[P,K]),F=ie=>{ie.preventDefault();const Oe=ie.dataTransfer.getData("application/iiif-item-id");if(!Oe||!e)return;const ae=Ke(ie),Fe=et=>{if(et.id===Oe)return et;if(et.items)for(const Et of et.items){const Vt=Fe(Et);if(Vt)return Vt}return null},Pe=Fe(e),it=Pe?.label?new pa(Pe.label).get():"New Item";let rt=Pe._blobUrl;if(!rt&&Pe&&Wt(Pe)){const et=Pe.items?.[0]?.items?.[0]?.body;et?.id&&(rt=et.id)}rt||(rt=Pe.thumbnail?.[0]?.id);const Ot=Os(Pe,400);l(et=>({...et,items:[...et.items,{id:dn(),resourceId:Oe,resourceType:Pe?.type||"Resource",label:it,blobUrl:rt,blobUrls:Ot,x:ae.x-100,y:ae.y-75,w:200,h:150}]})),n("Resource pinned to research board","success")},me=ie=>{if(ie.button===1||ie.shiftKey||we.isPanModeActive){we.handlers.onMouseDown(ie);return}if(k!=="view")if(g==="note"){const Oe=Ke(ie);l(ae=>({...ae,items:[...ae.items,{id:dn(),resourceId:`urn:note:${dn()}`,resourceType:"Annotation",label:"New Note",annotation:"Double click to edit...",isNote:!0,x:Oe.x-100,y:Oe.y-75,w:200,h:150}]})),y("select")}else j(null),A(null)},he=S.useCallback(ie=>{if(we.isPanning){we.handlers.onMouseMove(ie);return}if(!x&&!_&&ie.type!=="mousemove")return;const Oe=Ke(ie);H(Oe),x&&g==="select"&&l(ae=>({...ae,items:ae.items.map(Fe=>Fe.id===x?{...Fe,x:Oe.x,y:Oe.y}:Fe)}))},[x,_,g,Ke,we,l]),ee=S.useCallback(()=>{v(null),T(null)},[]);S.useEffect(()=>{if(x||_)return window.addEventListener("mousemove",he),window.addEventListener("mouseup",ee),()=>{window.removeEventListener("mousemove",he),window.removeEventListener("mouseup",ee)}},[x,_,he,ee]);const[Z,se]=S.useState(null),Te=(ie,Oe)=>{ie.stopPropagation(),k!=="view"&&(j(Oe),A(null),g==="select"&&v(Oe))},_e=ie=>{g==="connect"&&_&&_!==ie&&(p.some(ae=>ae.fromId===_&&ae.toId===ie&&ae.fromAnchor===Z?.side)||(l(ae=>({...ae,connections:[...ae.connections,{id:dn(),fromId:_,toId:ie,type:"relatesTo",fromAnchor:Z?.side||"B",toAnchor:"T",style:"elbow",direction:"auto",color:"#3b82f6",purpose:"linking",displayMode:"full"}]})),n("Archive connection synthesized","success"))),v(null),T(null),se(null)},ne=ie=>{const Oe=[],ae=-P.x/P.scale+100,Fe=-P.y/P.scale+100;if(ie==="grid")for(let Pe=0;Pe<4;Pe++)Oe.push({id:dn(),resourceId:`urn:placeholder:${dn()}`,resourceType:"Canvas",label:`Grid Item ${Pe+1}`,x:ae+Pe%2*220,y:Fe+Math.floor(Pe/2)*170,w:200,h:150});else if(ie==="sequence")for(let Pe=0;Pe<3;Pe++)Oe.push({id:dn(),resourceId:`urn:placeholder:${dn()}`,resourceType:"Canvas",label:`Step ${Pe+1}`,x:ae+Pe*250,y:Fe,w:200,h:150});else ie==="comparison"&&(Oe.push({id:dn(),resourceId:`urn:p1:${dn()}`,resourceType:"Canvas",label:"Object A",x:ae,y:Fe,w:300,h:400}),Oe.push({id:dn(),resourceId:`urn:p2:${dn()}`,resourceType:"Canvas",label:"Object B",x:ae+320,y:Fe,w:300,h:400}));l(Pe=>({...Pe,items:[...Pe.items,...Oe]})),E(!1),n("Template applied","success")},ge=24,Se=(ie,Oe="B")=>{const ae=h.find(Fe=>Fe.id===ie);if(!ae)return{x:0,y:0};switch(Oe){case"T":return{x:ae.x+ae.w/2,y:ae.y-ge};case"R":return{x:ae.x+ae.w+ge,y:ae.y+ae.h/2};case"B":return{x:ae.x+ae.w/2,y:ae.y+ae.h+ge};case"L":return{x:ae.x-ge,y:ae.y+ae.h/2}}},Ce=ie=>{l(Oe=>({items:Oe.items.filter(ae=>ae.id!==ie),connections:Oe.connections.filter(ae=>ae.fromId!==ie&&ae.toId!==ie)})),N===ie&&j(null)},Me=ie=>{const Oe=h.find(Fe=>Fe.id===ie);if(!Oe)return;const ae={...Oe,id:dn(),x:Oe.x+20,y:Oe.y+20};l(Fe=>({...Fe,items:[...Fe.items,ae]})),j(ae.id)},Be=(ie,Oe)=>{const ae=h.findIndex(Pe=>Pe.id===ie);if(ae===-1)return;const Fe=[...h];Oe==="backward"&&ae>0?[Fe[ae],Fe[ae-1]]=[Fe[ae-1],Fe[ae]]:Oe==="forward"&&ae<h.length-1&&([Fe[ae],Fe[ae+1]]=[Fe[ae+1],Fe[ae]]),l(Pe=>({...Pe,items:Fe}))},We=(ie,Oe)=>{const ae=h.find(rt=>rt.id===ie);if(!ae)return;const Fe={x:-P.x/P.scale+window.innerWidth/(2*P.scale),y:-P.y/P.scale+window.innerHeight/(2*P.scale)};let Pe=ae.x,it=ae.y;Oe==="center-h"&&(Pe=Fe.x-ae.w/2),Oe==="center-v"&&(it=Fe.y-ae.h/2),l(rt=>({...rt,items:rt.items.map(Ot=>Ot.id===ie?{...Ot,x:Pe,y:it}:Ot)}))},qe=h.find(ie=>ie.id===N),Ae=p.find(ie=>ie.id===C),$e=S.useCallback(async()=>{try{le.current&&(await le.current.requestFullscreen(),de(!0))}catch(ie){console.error("Fullscreen failed:",ie)}},[]),Qe=S.useCallback(async()=>{try{document.fullscreenElement&&(await document.exitFullscreen(),de(!1))}catch(ie){console.error("Exit fullscreen failed:",ie)}},[]);S.useEffect(()=>{const ie=()=>{de(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",ie),()=>document.removeEventListener("fullscreenchange",ie)},[]);const Ge=S.useCallback((ie,Oe)=>{l(ae=>({...ae,connections:ae.connections.map(Fe=>Fe.id===ie?{...Fe,...Oe}:Fe)}))},[l]),ve=S.useCallback(ie=>{l(Oe=>({...Oe,connections:Oe.connections.filter(ae=>ae.id!==ie)})),C===ie&&A(null)},[C,l]),je=S.useCallback(ie=>{l(Oe=>({...Oe,connections:Oe.connections.map(ae=>ae.id===ie?{...ae,waypoints:[]}:ae)}))},[l]),Ue=S.useCallback((ie,Oe,ae,Fe="straight",Pe="auto")=>{if(ae&&ae.length>0){let it=`M ${ie.x} ${ie.y}`;return ae.forEach(rt=>{it+=` L ${rt.x} ${rt.y}`}),it+=` L ${Oe.x} ${Oe.y}`,it}if(Fe==="elbow"){const it=(ie.x+Oe.x)/2,rt=(ie.y+Oe.y)/2;return Pe==="horizontal-first"||Pe==="auto"&&Math.abs(Oe.x-ie.x)>Math.abs(Oe.y-ie.y)?`M ${ie.x} ${ie.y} L ${it} ${ie.y} L ${it} ${Oe.y} L ${Oe.x} ${Oe.y}`:`M ${ie.x} ${ie.y} L ${ie.x} ${rt} L ${Oe.x} ${rt} L ${Oe.x} ${Oe.y}`}if(Fe==="curved"){const it=(ie.x+Oe.x)/2,rt=ie.y,Ot=Oe.y;return`M ${ie.x} ${ie.y} C ${it} ${rt}, ${it} ${Ot}, ${Oe.x} ${Oe.y}`}return`M ${ie.x} ${ie.y} L ${Oe.x} ${Oe.y}`},[]);S.useEffect(()=>{const ie=ae=>{document.activeElement?.tagName.match(/INPUT|TEXTAREA/)||(ae.key.toLowerCase()==="v"&&y("select"),ae.key.toLowerCase()==="c"&&y("connect"),ae.key.toLowerCase()==="t"&&y("note"),ae.code==="Space"&&!ae.repeat&&(ae.preventDefault(),we.setPanModeActive(!0)),ae.key==="\\"&&(k==="edit"?(R("view"),$e()):(R("edit"),Qe())),ae.key==="Escape"&&k==="view"&&(R("edit"),Qe()),(ae.key==="="||ae.key==="+")&&z.zoomIn(),ae.key==="-"&&z.zoomOut(),(ae.metaKey||ae.ctrlKey)&&ae.key==="0"&&(ae.preventDefault(),z.reset()),(ae.metaKey||ae.ctrlKey)&&ae.key==="z"&&(ae.preventDefault(),ae.shiftKey?u():o()),(ae.metaKey||ae.ctrlKey)&&ae.key==="d"&&N&&(ae.preventDefault(),Me(N)),(ae.key==="Delete"||ae.key==="Backspace")&&N&&Ce(N),ae.key==="["&&N&&Be(N,"backward"),ae.key==="]"&&N&&Be(N,"forward"),ae.altKey&&N&&(ae.key.toLowerCase()==="h"&&We(N,"center-h"),ae.key.toLowerCase()==="v"&&We(N,"center-v")))},Oe=ae=>{ae.code==="Space"&&we.setPanModeActive(!1)};return window.addEventListener("keydown",ie),window.addEventListener("keyup",Oe),()=>{window.removeEventListener("keydown",ie),window.removeEventListener("keyup",Oe)}},[o,u,N,Ce,z,Me,Be,We,we,k,$e,Qe]),S.useCallback(()=>{if(h.length===0){n("No items on board to export","info");return}const ie=100,Oe=Math.min(...h.map(Je=>Je.x))-ie,ae=Math.min(...h.map(Je=>Je.y))-ie,Fe=Math.max(...h.map(Je=>Je.x+Je.w))+ie,Pe=Math.max(...h.map(Je=>Je.y+Je.h))+ie,it=Math.max(Fe-Oe,Qt.defaultCanvasWidth),rt=Math.max(Pe-ae,Qt.defaultCanvasHeight),Ot=ct.BASE_URL.DEFAULT,et=ct.ID_PATTERNS.MANIFEST(Ot,`board-${dn()}`),Et=`${et}/canvas/1`,Vt=h.map((Je,Gt)=>{const en=Je.x-Oe,Ut=Je.y-ae,Pn=Je.isNote?{type:"TextualBody",value:Je.annotation||Je.label,format:"text/plain"}:Je.blobUrl?{id:Je.blobUrl,type:"Image",format:"image/jpeg",width:Je.w,height:Je.h}:{type:"TextualBody",value:Je.label,format:"text/plain"},rn={id:`${Et}/annotation/item-${Gt}`,type:"Annotation",motivation:"painting",label:vn(Je.label),body:Pn,target:`${Et}#xywh=${Math.round(en)},${Math.round(Ut)},${Math.round(Je.w)},${Math.round(Je.h)}`,metadata:Je.metadata,summary:Je.summary,requiredStatement:Je.requiredStatement,rights:Je.rights,provider:Je.provider};return Je.behavior&&(rn.behavior=Je.behavior),rn});p.map((Je,Gt)=>{const en=h.find(It=>It.id===Je.fromId),Ut=h.find(It=>It.id===Je.toId);if(!en||!Ut)return null;const Pn=Se(Je.fromId,Je.fromAnchor||"B"),rn=(Pn?.x||0)-Oe,Xt=(Pn?.y||0)-ae;return{id:`${Et}/annotation/link-${Gt}`,type:"Annotation",motivation:"linking",label:vn(Je.label||Je.type),body:{type:"TextualBody",value:JSON.stringify({relationshipType:Je.type,label:Je.label,fromAnchor:Je.fromAnchor,toAnchor:Je.toAnchor,waypoints:Je.waypoints}),format:"application/json"},target:`${Et}#xywh=${Math.round(rn)},${Math.round(Xt)},1,1`,metadata:Je.metadata,summary:Je.summary,requiredStatement:Je.requiredStatement,rights:Je.rights}}).filter(Boolean);const pn={id:`${Et}/page/painting`,type:"AnnotationPage",items:Vt},gn={id:Et,type:"Canvas",label:{none:["Research Board"]},width:it,height:rt,items:[pn]},an={"@context":kt.PRESENTATION_3.CONTEXT,id:et,type:"Manifest",label:{none:[`Research Board - ${new Date().toLocaleDateString()}`]},items:[gn]},Kt=new Blob([JSON.stringify(an,null,2)],{type:"application/ld+json"});Er.saveAs(Kt,`board-export-${new Date().toISOString().split("T")[0]}.json`),n("Board exported as IIIF Manifest","success")},[h,p,n,Se]);const ft=k==="view"?"bg-slate-900":"bg-slate-100";return a.jsxs("div",{ref:le,className:`flex flex-col h-full overflow-hidden relative font-sans ${ft}`,role:"application","aria-label":"Research Board - Spatial canvas for organizing IIIF resources",children:[!(k==="view"&&be)&&a.jsxs("div",{className:"h-16 bg-white border-b flex items-center justify-between px-6 shrink-0 z-20 shadow-sm",children:[a.jsxs("div",{className:"flex items-center gap-6",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx($,{name:"dashboard",className:"text-amber-500 text-2xl"}),a.jsxs("div",{children:[a.jsx("h1",{className:"font-black text-slate-800 uppercase tracking-tighter text-lg leading-none",children:"Boards"}),a.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1",children:"Spatial Synthesis"})]})]}),a.jsx("div",{className:"h-8 w-px bg-slate-200"}),k==="edit"&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"flex bg-slate-100 rounded-xl p-1 border border-slate-200",children:a.jsxs("button",{onClick:()=>y("select"),className:`px-4 py-2 text-xs font-black uppercase tracking-widest rounded-lg flex items-center gap-2 transition-all ${g==="select"?"bg-white shadow-md text-iiif-blue":"text-slate-500 hover:text-slate-800"}`,title:"Select & Pan (V) - Hold Space to pan",children:[a.jsx($,{name:"near_me",className:"text-sm"})," Select"]})}),a.jsx("div",{className:"w-px h-8 bg-slate-300"}),a.jsxs("div",{className:"flex bg-slate-100 rounded-xl p-1 border border-slate-200 gap-1",children:[a.jsxs("button",{onClick:()=>y("connect"),className:`px-4 py-2 text-xs font-black uppercase tracking-widest rounded-lg flex items-center gap-2 transition-all ${g==="connect"?"bg-white shadow-md text-iiif-blue":"text-slate-500 hover:text-slate-800"}`,title:"Connect items (C)",children:[a.jsx($,{name:"mediation",className:"text-sm"})," Connect"]}),a.jsxs("button",{onClick:()=>y("note"),className:`px-4 py-2 text-xs font-black uppercase tracking-widest rounded-lg flex items-center gap-2 transition-all relative ${g==="note"?"bg-yellow-100 shadow-md text-yellow-700 border border-yellow-300":"text-slate-500 hover:text-slate-800 hover:bg-yellow-50"}`,title:"Add sticky note (T)",children:[a.jsx($,{name:"sticky_note_2",className:"text-sm"}),a.jsx("span",{children:"Note"}),g==="note"&&a.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-yellow-400 rounded-full border-2 border-white"})]})]})]}),k==="edit"&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>I(!K),className:`p-2 rounded-lg transition-all ${K?"bg-indigo-100 text-indigo-600":"text-slate-400 hover:bg-slate-100"}`,title:"Snap to Grid",children:a.jsx($,{name:"grid_4x4"})}),a.jsxs("div",{className:"relative",children:[a.jsx("button",{onClick:()=>E(!D),className:"p-2 rounded-lg text-slate-400 hover:bg-slate-100 hover:text-slate-600",title:"Templates",children:a.jsx($,{name:"grid_view"})}),D&&a.jsxs("div",{className:"absolute top-full left-0 mt-2 bg-white border border-slate-200 rounded-xl shadow-xl w-48 py-2 z-50",children:[a.jsx("div",{className:"px-4 py-2 text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Layouts"}),a.jsxs("button",{onClick:()=>ne("grid"),className:"w-full text-left px-4 py-2 hover:bg-slate-50 text-sm flex items-center gap-2",children:[a.jsx($,{name:"grid_on",className:"text-xs"})," 2x2 Grid"]}),a.jsxs("button",{onClick:()=>ne("sequence"),className:"w-full text-left px-4 py-2 hover:bg-slate-50 text-sm flex items-center gap-2",children:[a.jsx($,{name:"linear_scale",className:"text-xs"})," Sequence"]}),a.jsxs("button",{onClick:()=>ne("comparison"),className:"w-full text-left px-4 py-2 hover:bg-slate-50 text-sm flex items-center gap-2",children:[a.jsx($,{name:"compare",className:"text-xs"})," Comparison"]})]})]})]}),a.jsxs("div",{className:"flex gap-1 ml-2",children:[a.jsx("button",{onClick:o,disabled:!d,className:`p-2 rounded-lg ${d?"text-slate-500 hover:bg-slate-100":"text-slate-300"}`,children:a.jsx($,{name:"undo"})}),a.jsx("button",{onClick:u,disabled:!m,className:`p-2 rounded-lg ${m?"text-slate-500 hover:bg-slate-100":"text-slate-300"}`,children:a.jsx($,{name:"redo"})})]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("button",{onClick:()=>W(!q),className:`p-2 rounded-lg transition-all ${q?"bg-slate-200 text-slate-800":"text-slate-400 hover:bg-slate-100"}`,title:"Keyboard Shortcuts",children:a.jsx($,{name:"keyboard"})}),a.jsxs("button",{onClick:()=>R(k==="edit"?"view":"edit"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold uppercase transition-all ${k==="view"?"bg-green-100 text-green-700":"text-slate-500 hover:bg-slate-100"}`,children:[a.jsx($,{name:k==="view"?"visibility":"edit",className:"text-sm"}),k==="view"?"View Mode":"Edit Mode"]}),a.jsx("div",{className:"text-xs font-bold text-slate-400 border-l pl-4",children:a.jsxs("span",{children:[z.scalePercent,"% Zoom"]})}),a.jsxs("button",{onClick:()=>X(!0),className:"flex items-center gap-2 px-4 py-2 bg-iiif-blue text-white text-xs font-black uppercase tracking-widest rounded-lg hover:bg-blue-700 transition-all",children:[a.jsx($,{name:"file_download",className:"text-sm"})," Export"]})]})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsxs("div",{ref:ye,className:`flex-1 relative overflow-hidden bg-slate-100 ${He||we.isPanModeActive?"cursor-grab active:cursor-grabbing":g==="connect"?"cursor-crosshair":g==="note"?"cursor-cell":"cursor-default"}`,onDrop:F,onDragOver:ie=>ie.preventDefault(),onMouseDown:me,onMouseMove:ie=>{we.isPanning&&we.handlers.onMouseMove(ie)},onMouseUp:we.handlers.onMouseUp,onMouseLeave:we.handlers.onMouseLeave,onWheel:we.handlers.onWheel,style:{backgroundImage:"radial-gradient(#e2e8f0 1.5px, transparent 1.5px)",backgroundSize:`${24*P.scale}px ${24*P.scale}px`,backgroundPosition:`${P.x}px ${P.y}px`},role:"region","aria-label":"Board canvas","aria-describedby":"board-instructions",children:[a.jsx("div",{id:"board-instructions",className:"sr-only",children:"Use mouse to pan and zoom. Press V for select tool, H for pan, C for connect, T for note. Drag items from archive to add them to the board."}),a.jsxs("div",{style:{transform:`translate(${P.x}px, ${P.y}px) scale(${P.scale})`,transformOrigin:"0 0",width:"100%",height:"100%"},role:"group","aria-label":"Board items container",children:[a.jsxs("svg",{className:"absolute inset-0 overflow-visible pointer-events-none z-10",style:{width:"10000px",height:"10000px"},children:[p.map(ie=>{const Oe=Se(ie.fromId,ie.fromAnchor||"B"),ae=Se(ie.toId,ie.toAnchor||"T"),Fe=C===ie.id,Pe=ie.color||(Fe?"#005596":"#3b82f6"),it=Ue(Oe||{x:0,y:0},ae||{x:0,y:0},ie.waypoints,ie.style||"elbow",ie.direction);return a.jsxs("g",{className:"pointer-events-auto cursor-pointer",onClick:rt=>{rt.stopPropagation(),A(ie.id),j(null)},children:[a.jsx("path",{d:it,fill:"none",stroke:"transparent",strokeWidth:"20"}),a.jsx("path",{d:it,fill:"none",stroke:Pe,strokeWidth:Fe?"4":"2.5",strokeDasharray:"none",strokeLinejoin:"round",strokeLinecap:"round",className:"transition-all"}),a.jsx("circle",{cx:ae?.x||0,cy:ae?.y||0,r:"4",fill:Pe}),Fe&&(!ie.waypoints||ie.waypoints.length<10)&&(()=>{const rt=[Oe,...ie.waypoints||[],ae].filter(Boolean),Ot=[];for(let et=0;et<rt.length-1;et++)Ot.push({x:(rt[et].x+rt[et+1].x)/2,y:(rt[et].y+rt[et+1].y)/2,insertAfter:et});return Ot.map((et,Et)=>a.jsxs("g",{children:[a.jsx("circle",{cx:et.x,cy:et.y,r:"22",fill:"transparent",className:"cursor-pointer",onMouseDown:Vt=>{Vt.stopPropagation();const pn={x:et.x,y:et.y};l(gn=>({...gn,connections:gn.connections.map(an=>{if(an.id!==ie.id)return an;const Kt=[...an.waypoints||[]];return Kt.splice(et.insertAfter,0,pn),{...an,waypoints:Kt}})}))}}),a.jsx("circle",{cx:et.x,cy:et.y,r:"5",fill:"white",stroke:Pe,strokeWidth:"2",strokeDasharray:"2,2",className:"pointer-events-none"})]},`seg-${Et}`))})(),Fe&&ie.waypoints?.map((rt,Ot)=>a.jsxs("g",{children:[a.jsx("circle",{cx:rt.x,cy:rt.y,r:"22",fill:"transparent",className:"cursor-move",onMouseDown:et=>{et.stopPropagation();const Et=pn=>{let gn=Ke(pn);if(pn.shiftKey){const an=Ot>0?ie.waypoints[Ot-1]:Oe,Kt=an?.x||0,Je=an?.y||0,Gt=gn.x-Kt,en=gn.y-Je,Ut=Math.sqrt(Gt*Gt+en*en),Pn=Math.atan2(en,Gt),rn=Math.round(Pn/(Math.PI/4))*(Math.PI/4);gn={x:Kt+Math.cos(rn)*Ut,y:Je+Math.sin(rn)*Ut}}l(an=>({...an,connections:an.connections.map(Kt=>{if(Kt.id!==ie.id||!Kt.waypoints)return Kt;const Je=[...Kt.waypoints];return Je[Ot]=gn,{...Kt,waypoints:Je}})}))},Vt=()=>{window.removeEventListener("mousemove",Et),window.removeEventListener("mouseup",Vt)};window.addEventListener("mousemove",Et),window.addEventListener("mouseup",Vt)},onDoubleClick:et=>{et.stopPropagation(),l(Et=>({...Et,connections:Et.connections.map(Vt=>Vt.id===ie.id?{...Vt,waypoints:Vt.waypoints?.filter((pn,gn)=>gn!==Ot)}:Vt)}))}}),a.jsx("circle",{cx:rt.x,cy:rt.y,r:"6",fill:Pe,stroke:"white",strokeWidth:"2",className:"pointer-events-none"})]},Ot)),(ie.label||ie.purpose)&&ie.displayMode!=="none"&&a.jsxs("g",{children:[a.jsx("rect",{x:((Oe?.x||0)+(ae?.x||0))/2-40,y:((Oe?.y||0)+(ae?.y||0))/2-22,width:"80",height:"16",fill:"white",rx:"4",opacity:"0.9"}),a.jsx("text",{x:((Oe?.x||0)+(ae?.x||0))/2,y:((Oe?.y||0)+(ae?.y||0))/2-10,textAnchor:"middle",className:"text-[9px] font-bold uppercase",fill:Pe,children:ie.displayMode==="purpose-only"?ie.purpose:ie.label||ie.purpose})]})]},ie.id)}),_&&a.jsx("line",{x1:Se(_,Z?.side||"B")?.x||0,y1:Se(_,Z?.side||"B")?.y||0,x2:L.x,y2:L.y,stroke:"#3b82f6",strokeWidth:"2",strokeDasharray:"4,4"})]}),h.map(ie=>{const Oe=ie.resourceType==="Canvas"?"from-green-500 to-emerald-600":ie.resourceType==="Manifest"?"from-blue-500 to-indigo-600":ie.resourceType==="Collection"?"from-amber-500 to-orange-600":"from-slate-500 to-slate-600";return a.jsxs("div",{onMouseDown:ae=>Te(ae,ie.id),onMouseUp:()=>_e(ie.id),onDoubleClick:()=>{k==="view"?(R("edit"),Qe()):ue(ie)},className:`absolute shadow-2xl rounded-2xl overflow-hidden group select-none transition-all duration-200 ${N===ie.id?"ring-4 ring-iiif-blue/30 shadow-iiif-blue/20":"hover:shadow-3xl"} ${ie.isNote?"bg-yellow-50 border-2 border-yellow-300":ie.isMetadataNode?"bg-purple-50 border-2 border-dashed border-purple-400":"bg-white border border-slate-200/50"} z-20 backdrop-blur-sm`,style:{left:ie.x,top:ie.y,width:ie.w,height:ie.h},role:"button","aria-label":`${ie.isNote?"Note":ie.resourceType}: ${ie.label}`,"aria-selected":N===ie.id,tabIndex:0,onKeyDown:ae=>{(ae.key==="Delete"||ae.key==="Backspace")&&(ae.preventDefault(),Ce(ie.id)),(ae.key==="Enter"||ae.key===" ")&&(ae.preventDefault(),j(ie.id))},children:[(g==="connect"||N===ie.id)&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-4 rounded-full bg-iiif-blue border-2 border-white z-50 cursor-crosshair hover:scale-150 transition-transform",onMouseDown:ae=>{ae.stopPropagation(),T(ie.id),se({id:ie.id,side:"T"})},onMouseUp:ae=>{if(_&&_!==ie.id){ae.stopPropagation();const Fe=Z?.side||"B";l(Pe=>({...Pe,connections:[...Pe.connections,{id:dn(),fromId:_,toId:ie.id,type:"relatesTo",fromAnchor:Fe,toAnchor:"T",style:"elbow",direction:"auto",color:"#3b82f6",purpose:"linking",displayMode:"full"}]})),T(null),se(null)}}}),a.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 w-4 h-4 rounded-full bg-iiif-blue border-2 border-white z-50 cursor-crosshair hover:scale-150 transition-transform",onMouseDown:ae=>{ae.stopPropagation(),T(ie.id),se({id:ie.id,side:"B"})},onMouseUp:ae=>{if(_&&_!==ie.id){ae.stopPropagation();const Fe=Z?.side||"B";l(Pe=>({...Pe,connections:[...Pe.connections,{id:dn(),fromId:_,toId:ie.id,type:"relatesTo",fromAnchor:Fe,toAnchor:"B",style:"elbow",direction:"auto",color:"#3b82f6",purpose:"linking",displayMode:"full"}]})),T(null),se(null)}}}),a.jsx("div",{className:"absolute left-0 top-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-4 rounded-full bg-iiif-blue border-2 border-white z-50 cursor-crosshair hover:scale-150 transition-transform",onMouseDown:ae=>{ae.stopPropagation(),T(ie.id),se({id:ie.id,side:"L"})},onMouseUp:ae=>{if(_&&_!==ie.id){ae.stopPropagation();const Fe=Z?.side||"B";l(Pe=>({...Pe,connections:[...Pe.connections,{id:crypto.randomUUID(),fromId:_,toId:ie.id,type:"relatesTo",fromAnchor:Fe,toAnchor:"L",style:"elbow",direction:"auto",color:"#3b82f6",purpose:"linking",displayMode:"full"}]})),T(null),se(null)}}}),a.jsx("div",{className:"absolute right-0 top-1/2 translate-x-1/2 -translate-y-1/2 w-4 h-4 rounded-full bg-iiif-blue border-2 border-white z-50 cursor-crosshair hover:scale-150 transition-transform",onMouseDown:ae=>{ae.stopPropagation(),T(ie.id),se({id:ie.id,side:"R"})},onMouseUp:ae=>{if(_&&_!==ie.id){ae.stopPropagation();const Fe=Z?.side||"B";l(Pe=>({...Pe,connections:[...Pe.connections,{id:crypto.randomUUID(),fromId:_,toId:ie.id,type:"relatesTo",fromAnchor:Fe,toAnchor:"R",style:"elbow",direction:"auto",color:"#3b82f6",purpose:"linking",displayMode:"full"}]})),T(null),se(null)}}})]}),ie.isNote?a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsx("div",{className:"h-6 bg-gradient-to-r from-yellow-400 to-amber-400 flex items-center px-2",children:a.jsx($,{name:"drag_indicator",className:"text-yellow-800/50 text-xs"})}),a.jsx("div",{className:"flex-1 p-3",children:a.jsx("textarea",{value:ie.annotation,onChange:ae=>l(Fe=>({...Fe,items:Fe.items.map(Pe=>Pe.id===ie.id?{...Pe,annotation:ae.target.value}:Pe)})),className:"w-full h-full bg-transparent border-none outline-none resize-none font-handwriting text-slate-800 text-sm leading-relaxed rounded-lg p-2 focus:bg-yellow-100/50 transition-colors",placeholder:"Type your note here...",onMouseDown:ae=>ae.stopPropagation()})})]}):ie.isMetadataNode?a.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-4",children:[a.jsx($,{name:"sell",className:"text-4xl text-purple-400 mb-2"}),a.jsx("div",{className:"text-xs font-bold text-purple-600 text-center",children:ie.label}),a.jsx("div",{className:"text-[9px] text-purple-400 mt-1",children:"Metadata Value"})]}):a.jsxs("div",{className:"h-full flex flex-col relative",children:[a.jsx("div",{className:`h-1.5 bg-gradient-to-r ${Oe}`}),a.jsxs("div",{className:"flex-1 bg-slate-900 flex items-center justify-center relative overflow-hidden",children:[ie.blobUrls&&ie.blobUrls.length>0?a.jsx(Hs,{urls:ie.blobUrls,size:"xl",className:"w-full h-full",icon:"description"}):ie.blobUrl?a.jsx("img",{src:ie.blobUrl,className:"w-full h-full object-contain pointer-events-none",alt:"Pin"}):a.jsx($,{name:"description",className:"text-5xl text-slate-700 opacity-50"}),a.jsx("div",{className:`absolute top-2 left-2 bg-gradient-to-r ${Oe} text-white text-[8px] px-2 py-0.5 rounded-full font-black uppercase tracking-widest shadow-lg`,children:ie.resourceType})]}),a.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/80 via-black/50 to-transparent",children:a.jsx("div",{className:"text-[11px] font-bold text-white truncate drop-shadow-md",children:ie.label})})]}),ie.annotations&&ie.annotations.map((ae,Fe)=>{const Pe=ae.target.selector?.value;if(!Pe)return null;const it=tE(Pe);return a.jsxs("div",{className:"absolute inset-0 pointer-events-auto group/anno",title:Le(ae.body),children:[a.jsx("div",{className:"w-full h-full [&>svg]:w-full [&>svg]:h-full",dangerouslySetInnerHTML:{__html:it}}),a.jsx("div",{className:"absolute bottom-2 left-2 bg-black/80 text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover/anno:opacity-100 transition-opacity whitespace-pre-wrap max-w-[150px] z-50",children:Le(ae.body)})]},Fe)}),N===ie.id&&!ie.isNote&&a.jsxs("div",{className:"absolute top-2 right-2 flex flex-col gap-1 z-40",children:[a.jsx("button",{onClick:ae=>{ae.stopPropagation(),te(!0)},className:"p-1.5 bg-white text-slate-500 rounded hover:text-iiif-blue shadow-sm",title:"Annotate",children:a.jsx($,{name:"draw",className:"text-xs"})}),a.jsx("button",{onClick:ae=>{ae.stopPropagation(),V(!0)},className:"p-1.5 bg-white text-slate-500 rounded hover:text-iiif-blue shadow-sm",title:"Adjust",children:a.jsx($,{name:"tune",className:"text-xs"})}),a.jsx("button",{onClick:ae=>{ae.stopPropagation(),B(!0)},className:"p-1.5 bg-white text-slate-500 rounded hover:text-iiif-blue shadow-sm",title:"Compose",children:a.jsx($,{name:"auto_awesome_motion",className:"text-xs"})})]}),a.jsx("button",{onClick:ae=>{ae.stopPropagation(),Ce(ie.id)},className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 hover:bg-red-600 z-30 shadow-lg",children:a.jsx($,{name:"close",className:"text-xs"})})]},ie.id)})]}),h.length===0&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-10",children:a.jsxs("div",{className:`text-center p-10 rounded-3xl ${k==="view"?"bg-slate-800/95":"bg-white/95"} backdrop-blur-md shadow-2xl border ${k==="view"?"border-slate-700":"border-slate-200"} max-w-lg`,children:[a.jsx($,{name:"dashboard",className:`text-6xl mb-6 ${k==="view"?"text-slate-500":"text-amber-500"}`}),a.jsx("h2",{className:`text-2xl font-black mb-3 ${k==="view"?"text-white":"text-slate-800"}`,children:"Start Your Research Board"}),a.jsx("p",{className:`text-sm mb-8 ${k==="view"?"text-slate-400":"text-slate-500"}`,children:"Create spatial connections between your archival materials"}),a.jsxs("div",{className:`space-y-3 text-left ${k==="view"?"text-slate-300":"text-slate-600"}`,children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("kbd",{className:`px-3 py-1.5 rounded-lg text-xs font-mono font-bold ${k==="view"?"bg-slate-700 text-slate-300":"bg-slate-100 text-slate-600"}`,children:"Drag"}),a.jsx("span",{className:"text-sm",children:"Drag media from the Archive panel"})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("kbd",{className:`px-3 py-1.5 rounded-lg text-xs font-mono font-bold min-w-[48px] text-center ${k==="view"?"bg-yellow-900/50 text-yellow-400":"bg-yellow-100 text-yellow-700"}`,children:"T"}),a.jsx("span",{className:"text-sm",children:"Add sticky notes for annotations"})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("kbd",{className:`px-3 py-1.5 rounded-lg text-xs font-mono font-bold min-w-[48px] text-center ${k==="view"?"bg-slate-700 text-slate-300":"bg-slate-100 text-slate-600"}`,children:"C"}),a.jsx("span",{className:"text-sm",children:"Connect items to show relationships"})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("kbd",{className:`px-3 py-1.5 rounded-lg text-xs font-mono font-bold min-w-[48px] text-center ${k==="view"?"bg-slate-700 text-slate-300":"bg-slate-100 text-slate-600"}`,children:"Space"}),a.jsx("span",{className:"text-sm",children:"Hold to pan around the board"})]})]})]})}),a.jsxs("div",{className:`absolute bottom-4 right-4 flex items-center gap-1 rounded-xl shadow-lg z-30 ${k==="view"?"bg-slate-800/90":"bg-white/90"} backdrop-blur-sm p-1`,children:[a.jsx("button",{onClick:z.zoomOut,className:`p-2 rounded-lg transition-colors ${k==="view"?"text-slate-300 hover:bg-slate-700":"text-slate-600 hover:bg-slate-100"}`,title:"Zoom out (-)",children:a.jsx($,{name:"remove"})}),a.jsxs("button",{onClick:z.reset,className:`px-3 py-2 rounded-lg text-xs font-bold min-w-[60px] transition-colors ${k==="view"?"text-white hover:bg-slate-700":"text-slate-700 hover:bg-slate-100"}`,title:"Reset zoom (Cmd+0)",children:[z.scalePercent,"%"]}),a.jsx("button",{onClick:z.zoomIn,className:`p-2 rounded-lg transition-colors ${k==="view"?"text-slate-300 hover:bg-slate-700":"text-slate-600 hover:bg-slate-100"}`,title:"Zoom in (+)",children:a.jsx($,{name:"add"})}),a.jsx("div",{className:`w-px h-6 mx-1 ${k==="view"?"bg-slate-700":"bg-slate-200"}`}),a.jsx("button",{onClick:z.reset,className:`p-2 rounded-lg transition-colors ${k==="view"?"text-slate-300 hover:bg-slate-700":"text-slate-600 hover:bg-slate-100"}`,title:"Reset zoom",children:a.jsx($,{name:"fit_screen"})})]}),k==="view"&&a.jsxs("button",{onClick:()=>{R("edit"),Qe()},className:"absolute top-4 right-4 flex items-center gap-2 px-4 py-2 bg-white/90 text-slate-800 rounded-xl shadow-lg z-30 font-bold text-sm hover:bg-white transition-colors",children:[a.jsx($,{name:"edit"}),"Exit View Mode"]})]}),qe&&!Q&&k==="edit"&&a.jsx(HM,{item:qe,onExpand:ie=>ue(ie),fieldMode:t.fieldMode}),(qe||Ae)&&k==="edit"&&a.jsx(V1,{resource:qe?{id:qe.resourceId,type:qe.resourceType,label:{none:[qe.label]},metadata:qe.metadata,summary:qe.summary,requiredStatement:qe.requiredStatement,rights:qe.rights,provider:qe.provider,behavior:qe.behavior}:Ae?{id:Ae.id,type:"Annotation",label:{none:[Ae.label||"Connection"]},metadata:Ae.metadata,summary:Ae.summary,requiredStatement:Ae.requiredStatement,rights:Ae.rights}:null,onUpdateResource:ie=>{qe?l(Oe=>({...Oe,items:Oe.items.map(ae=>ae.id===N?{...ae,label:ie.label?Le(ie.label):ae.label,metadata:ie.metadata||ae.metadata,summary:ie.summary||ae.summary,requiredStatement:ie.requiredStatement||ae.requiredStatement,rights:ie.rights||ae.rights,provider:ie.provider||ae.provider,behavior:ie.behavior||ae.behavior}:ae)})):Ae&&l(Oe=>({...Oe,connections:Oe.connections.map(ae=>ae.id===C?{...ae,label:ie.label?Le(ie.label):ae.label,metadata:ie.metadata||ae.metadata,summary:ie.summary||ae.summary,requiredStatement:ie.requiredStatement||ae.requiredStatement,rights:ie.rights||ae.rights}:ae)}))},settings:t,visible:!0,onClose:()=>{j(null),A(null)},designTab:a.jsx(BM,{activeItem:qe||null,activeConnection:Ae||null,items:h,onAlignItem:We,onReorderItem:Be,onDuplicateItem:Me,onDeleteItem:Ce,onUpdateItem:(ie,Oe)=>{l(ae=>({...ae,items:ae.items.map(Fe=>Fe.id===ie?{...Fe,...Oe}:Fe)}))},onUpdateConnection:Ge,onDeleteConnection:ve,onStraightenConnection:je,fieldMode:t.fieldMode})})]}),G&&qe&&qe.blobUrl&&a.jsx(hN,{canvas:{id:qe.resourceId,width:Qt.defaultCanvasWidth,height:Qt.defaultCanvasHeight,type:"Canvas",items:[]},imageUrl:qe.blobUrl,onCreateAnnotation:ie=>{l(Oe=>({...Oe,items:Oe.items.map(ae=>ae.id===N?{...ae,annotations:[...ae.annotations||[],ie]}:ae)})),n("Annotation added to board item","success")},onClose:()=>te(!1),existingAnnotations:qe.annotations}),U&&qe&&a.jsx(nN,{canvas:{id:qe.resourceId,type:"Canvas",items:[{items:[{body:{id:qe.blobUrl}}]}]},onClose:()=>V(!1),onApply:ie=>{l(Oe=>({...Oe,items:Oe.items.map(ae=>ae.id===N?{...ae,blobUrl:ie}:ae)})),n("Image adjustment applied","success")}}),O&&qe&&a.jsx(fN,{root:e,canvas:{id:qe.resourceId,width:Qt.defaultCanvasWidth,height:Qt.defaultCanvasHeight,type:"Canvas",items:qe.layers?[{type:"AnnotationPage",items:qe.layers}]:[]},onUpdate:ie=>{const Oe=ie.items?.[0]?.items||[];l(ae=>({...ae,items:ae.items.map(Fe=>Fe.id===N?{...Fe,layers:Oe}:Fe)})),n("Composition updated","success")},onClose:()=>B(!1)}),Q&&a.jsx(WM,{item:Q,onClose:()=>ue(null),fieldMode:t.fieldMode}),Y&&a.jsx(YM,{items:h,connections:p,onClose:()=>X(!1),fieldMode:t.fieldMode}),q&&a.jsxs("div",{className:"absolute top-16 right-6 bg-white border border-slate-200 rounded-xl shadow-2xl p-6 z-50 w-80 animate-in slide-in-from-top-2",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("h3",{className:"text-sm font-black uppercase text-slate-800 tracking-widest flex items-center gap-2",children:[a.jsx($,{name:"keyboard",className:"text-iiif-blue"})," Shortcuts"]}),a.jsx("button",{onClick:()=>W(!1),className:"text-slate-400 hover:text-slate-600",children:a.jsx($,{name:"close",className:"text-sm"})})]}),a.jsxs("div",{className:"space-y-4 text-xs",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-bold text-slate-500 mb-2 uppercase tracking-tight text-[10px]",children:"Tools"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-slate-700",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Select"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"V"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Pan"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"Space"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Connect"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"C"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Note"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"T"})]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-bold text-slate-500 mb-2 uppercase tracking-tight text-[10px]",children:"Editing"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-slate-700",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Duplicate"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"Cmd+D"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Delete"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"Del"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Undo"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"Cmd+Z"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Redo"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"Shift+Cmd+Z"})]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-bold text-slate-500 mb-2 uppercase tracking-tight text-[10px]",children:"View & Arrange"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-slate-700",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Zoom In/Out"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"+/-"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Reset Zoom"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"Cmd+0"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Send Back"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"["})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Bring Front"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"]"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Align H/V"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"Alt+H/V"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Toggle UI"})," ",a.jsx("kbd",{className:"bg-slate-100 px-1.5 rounded font-mono",children:"\\"})]})]})]})]})]})]})},VM=({path:e,onNavigate:t,maxVisible:n=4,className:i="",onHomeClick:l})=>{const[o,u]=S.useState(!1),d=S.useRef(null);S.useEffect(()=>{const x=v=>{d.current&&!d.current.contains(v.target)&&u(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const m=e.length>n;let h,p=[];if(m){const x=e[0],v=e.slice(-2);p=e.slice(1,-2),h=[x,...v]}else h=e;const g=x=>{switch(x){case"Collection":return"folder";case"Manifest":return"menu_book";case"Canvas":return"crop_original";case"Range":return"list";default:return"folder"}},y=x=>{switch(x){case"Collection":return"text-amber-600";case"Manifest":return"text-emerald-600";case"Canvas":return"text-blue-600";case"Range":return"text-purple-600";default:return"text-slate-500"}};return a.jsxs("nav",{className:`flex items-center gap-1 text-sm ${i}`,"aria-label":"Breadcrumb",children:[a.jsx("button",{onClick:l,className:"p-1.5 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-colors focus:outline-none focus:ring-2 focus:ring-iiif-blue/50 focus:ring-offset-1",title:"Go to root",tabIndex:0,onKeyDown:x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),l?.())},children:a.jsx($,{name:"home",className:"text-lg"})}),e.length>0&&a.jsx("span",{className:"text-slate-300 mx-1",children:a.jsx($,{name:"chevron_right",className:"text-sm"})}),h.map((x,v)=>{const N=v===0;h.length-1;const j=m&&v===1;return j?a.jsxs(An.Fragment,{children:[a.jsxs("div",{className:"relative",ref:d,children:[a.jsx("button",{onClick:()=>u(!o),className:"px-2 py-1 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-colors font-medium focus:outline-none focus:ring-2 focus:ring-iiif-blue/50 focus:ring-offset-1",title:"Show more",tabIndex:0,"aria-expanded":o,"aria-haspopup":"menu",onKeyDown:C=>{C.key==="Enter"||C.key===" "?(C.preventDefault(),u(!o)):C.key==="Escape"&&o&&u(!1)},children:"..."}),o&&a.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-slate-200 rounded-xl shadow-xl py-2 min-w-[200px] z-50",role:"menu",children:p.map((C,A)=>a.jsxs("button",{onClick:()=>{t(C.id),u(!1)},className:"w-full px-4 py-2 text-left hover:bg-slate-50 flex items-center gap-2 text-sm focus:outline-none focus:bg-slate-100 focus:ring-2 focus:ring-inset focus:ring-iiif-blue/30",title:C.fullLabel||C.label,role:"menuitem",tabIndex:0,onKeyDown:_=>{_.key==="Enter"||_.key===" "?(_.preventDefault(),t(C.id),u(!1)):_.key==="Escape"?u(!1):_.key==="ArrowDown"?(_.preventDefault(),d.current?.querySelectorAll('button[role="menuitem"]')[A+1]?.focus()):_.key==="ArrowUp"&&(_.preventDefault(),A===0?u(!1):d.current?.querySelectorAll('button[role="menuitem"]')[A-1]?.focus())},children:[a.jsx($,{name:g(C.type),className:`text-xs ${y(C.type)}`}),a.jsx("span",{className:"truncate",children:C.label})]},C.id))})]}),a.jsx("span",{className:"text-slate-300 mx-1",children:a.jsx($,{name:"chevron_right",className:"text-sm"})})]},`ellipsis-${x.id}`):a.jsxs(An.Fragment,{children:[!N&&!j&&a.jsx("span",{className:"text-slate-300 mx-1",children:a.jsx($,{name:"chevron_right",className:"text-sm"})}),a.jsxs("button",{onClick:()=>!x.isCurrent&&t(x.id),disabled:x.isCurrent,tabIndex:x.isCurrent?-1:0,className:`
                flex items-center gap-1.5 px-2 py-1 rounded-lg transition-all
                focus:outline-none focus:ring-2 focus:ring-iiif-blue/50 focus:ring-offset-1
                ${x.isCurrent?"font-semibold text-slate-800 bg-slate-100 cursor-default":"text-slate-600 hover:bg-slate-100 hover:text-slate-800"}
              `,title:x.fullLabel||x.label,"aria-current":x.isCurrent?"page":void 0,onKeyDown:C=>{(C.key==="Enter"||C.key===" ")&&(C.preventDefault(),x.isCurrent||t(x.id))},children:[a.jsx($,{name:g(x.type),className:`text-xs ${y(x.type)}`}),a.jsx("span",{className:"truncate max-w-[120px] sm:max-w-[160px] md:max-w-[200px]",children:x.label})]})]},x.id)})]})},KM=({item:e,onReorder:t,onSelect:n,onMultiSelect:i,selectedIds:l,viewMode:o="grid",onViewModeChange:u,onRemove:d,onDuplicate:m})=>{const[h,p]=S.useState({draggedId:null,dragOverIndex:null}),[g,y]=S.useState(null),x=S.useMemo(()=>e?zt(e)?e.items||[]:Mt(e)?e.items||[]:[]:[],[e]),v=S.useCallback((k,R)=>{k.dataTransfer.setData("text/plain",R),k.dataTransfer.effectAllowed="move",p(z=>({...z,draggedId:R}))},[]),N=S.useCallback((k,R)=>{k.preventDefault(),k.dataTransfer.dropEffect="move",p(z=>({...z,dragOverIndex:R}))},[]),j=S.useCallback(()=>{p(k=>({...k,dragOverIndex:null}))},[]),C=S.useCallback((k,R)=>{k.preventDefault();const z=k.dataTransfer.getData("text/plain"),P=x.findIndex(K=>K.id===z);P!==-1&&P!==R&&t(P,R),p({draggedId:null,dragOverIndex:null})},[x,t]),A=S.useCallback(()=>{p({draggedId:null,dragOverIndex:null})},[]),_=S.useCallback((k,R,z)=>{if(k.shiftKey&&i&&g!==null){const P=Math.min(g,z),K=Math.max(g,z),I=x.slice(P,K+1).map(D=>D.id);i(I,!0)}else(k.ctrlKey||k.metaKey)&&i?i([R],!0):(n(R),y(z))},[x,g,i,n]),T=S.useCallback((k,R,z)=>{k.key==="Enter"||k.key===" "?(k.preventDefault(),n(R)):(k.key==="Delete"||k.key==="Backspace")&&d&&l.size>0&&(k.preventDefault(),d(Array.from(l)))},[d,n,l]);if(!e)return a.jsx("div",{className:"h-full flex items-center justify-center bg-slate-50 text-slate-400",children:a.jsxs("div",{className:"text-center space-y-2",children:[a.jsx($,{name:"account_tree",className:"text-4xl"}),a.jsx("p",{className:"text-sm font-medium",children:"Select a Manifest or Collection to view its structure"})]})});const L=Ht[e.type]||Ht.Content,H=zt(e)?"Canvas":Mt(e)?"Manifest/Collection":"Item";return a.jsxs("div",{className:"h-full flex flex-col bg-slate-50",children:[a.jsxs("div",{className:"h-12 bg-white border-b flex items-center justify-between px-4 shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:`text-[10px] font-black uppercase px-2 py-0.5 rounded ${L.bgClass} ${L.colorClass}`,children:e.type}),a.jsx("h2",{className:"font-bold text-slate-700 text-sm truncate max-w-xs",children:Le(e.label)||"Untitled"}),a.jsxs("span",{className:"text-xs text-slate-400",children:[x.length," ",H,x.length!==1?"s":""]})]}),a.jsx("div",{className:"flex items-center gap-2",children:u&&a.jsxs("div",{className:"flex items-center bg-slate-100 rounded-lg p-0.5",children:[a.jsx("button",{onClick:()=>u("grid"),className:`p-1.5 rounded ${o==="grid"?"bg-white shadow-sm text-iiif-blue":"text-slate-400 hover:text-slate-600"}`,title:"Grid view",children:a.jsx($,{name:"grid_view",className:"text-sm"})}),a.jsx("button",{onClick:()=>u("list"),className:`p-1.5 rounded ${o==="list"?"bg-white shadow-sm text-iiif-blue":"text-slate-400 hover:text-slate-600"}`,title:"List view",children:a.jsx($,{name:"view_list",className:"text-sm"})})]})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:x.length===0?a.jsx("div",{className:"h-full flex items-center justify-center text-slate-400",children:a.jsxs("div",{className:"text-center space-y-2",children:[a.jsx($,{name:"add_photo_alternate",className:"text-4xl"}),a.jsxs("p",{className:"text-sm font-medium",children:["No ",H.toLowerCase(),"s yet"]}),a.jsx("p",{className:"text-xs",children:"Drag items here or add new ones"})]})}):o==="grid"?a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:x.map((k,R)=>a.jsx(XM,{item:k,index:R,isSelected:l.has(k.id),isDragging:h.draggedId===k.id,isDragOver:h.dragOverIndex===R,onDragStart:v,onDragOver:N,onDragLeave:j,onDrop:C,onDragEnd:A,onClick:_,onKeyDown:T},k.id))}):a.jsx("div",{className:"space-y-1",children:x.map((k,R)=>a.jsx(ZM,{item:k,index:R,isSelected:l.has(k.id),isDragging:h.draggedId===k.id,isDragOver:h.dragOverIndex===R,onDragStart:v,onDragOver:N,onDragLeave:j,onDrop:C,onDragEnd:A,onClick:_,onKeyDown:T},k.id))})})]})},XM=({item:e,index:t,isSelected:n,isDragging:i,isDragOver:l,onDragStart:o,onDragOver:u,onDragLeave:d,onDrop:m,onDragEnd:h,onClick:p,onKeyDown:g})=>{const y=Ht[e.type]||Ht.Content,x=Os(e,200),v=Le(e.label)||`${e.type} ${t+1}`,N=Wt(e)&&e.items?.reduce((j,C)=>j+(C.items?.length||0),0)||0;return a.jsxs("div",{draggable:!0,tabIndex:0,role:"button","aria-selected":n,className:`
        group relative rounded-xl overflow-hidden border-2 cursor-pointer transition-all
        focus:outline-none focus:ring-2 focus:ring-iiif-blue focus:ring-offset-2
        ${i?"opacity-50 scale-95":""}
        ${l?"border-iiif-blue bg-blue-50 scale-105":""}
        ${n?"border-iiif-blue shadow-lg ring-2 ring-iiif-blue/30":"border-slate-200 hover:border-slate-300 hover:shadow-md"}
      `,onDragStart:j=>o(j,e.id),onDragOver:j=>u(j,t),onDragLeave:d,onDrop:j=>m(j,t),onDragEnd:h,onClick:j=>p(j,e.id,t),onKeyDown:j=>g(j,e.id,t),children:[a.jsxs("div",{className:"aspect-square bg-slate-100 relative flex items-center justify-center",children:[a.jsx(Hs,{urls:x,size:"xl",className:"w-full h-full",icon:y.icon}),n&&a.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-iiif-blue rounded-full flex items-center justify-center shadow-lg",children:a.jsx($,{name:"check",className:"text-white text-sm"})}),a.jsx("div",{className:"absolute bottom-2 left-2 bg-black/60 backdrop-blur-sm text-white text-[10px] font-bold px-2 py-0.5 rounded",children:t+1}),a.jsx("div",{className:`absolute top-2 left-2 text-[8px] font-black uppercase px-1.5 py-0.5 rounded ${y.bgClass} ${y.colorClass}`,children:Wt(e)?"CVS":zt(e)?"MAN":Mt(e)?"COLL":e.type.slice(0,3)})]}),a.jsxs("div",{className:"p-2 bg-white",children:[a.jsx("p",{className:"text-xs font-medium text-slate-700 truncate",title:v,children:v}),N>0&&a.jsxs("p",{className:"text-[10px] text-slate-400 flex items-center gap-1 mt-0.5",children:[a.jsx($,{name:"chat_bubble",className:"text-[10px]"}),N," annotation",N!==1?"s":""]})]})]})},ZM=({item:e,index:t,isSelected:n,isDragging:i,isDragOver:l,onDragStart:o,onDragOver:u,onDragLeave:d,onDrop:m,onDragEnd:h,onClick:p,onKeyDown:g})=>{const y=Ht[e.type]||Ht.Content,x=Os(e,80),v=Le(e.label)||`${e.type} ${t+1}`,N=Wt(e)&&e.items?.reduce((j,C)=>j+(C.items?.length||0),0)||0;return a.jsxs("div",{draggable:!0,tabIndex:0,role:"button","aria-selected":n,className:`
        group flex items-center gap-3 p-2 rounded-lg border-2 cursor-pointer transition-all
        focus:outline-none focus:ring-2 focus:ring-iiif-blue focus:ring-offset-1
        ${i?"opacity-50":""}
        ${l?"border-iiif-blue bg-blue-50":""}
        ${n?"border-iiif-blue bg-blue-50/50":"border-transparent hover:bg-white hover:border-slate-200"}
      `,onDragStart:j=>o(j,e.id),onDragOver:j=>u(j,t),onDragLeave:d,onDrop:j=>m(j,t),onDragEnd:h,onClick:j=>p(j,e.id,t),onKeyDown:j=>g(j,e.id,t),children:[a.jsx("div",{className:"text-slate-300 cursor-grab active:cursor-grabbing",children:a.jsx($,{name:"drag_indicator",className:"text-lg"})}),a.jsx("span",{className:"text-xs font-mono text-slate-400 w-6 text-right",children:t+1}),a.jsx(Hs,{urls:x,size:"sm",icon:y.icon}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-slate-700 truncate",children:v}),a.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[a.jsx("span",{className:`text-[9px] font-black uppercase px-1.5 py-0.5 rounded ${y.bgClass} ${y.colorClass}`,children:e.type}),N>0&&a.jsxs("span",{className:"text-[10px] text-slate-400 flex items-center gap-0.5",children:[a.jsx($,{name:"chat_bubble",className:"text-[10px]"}),N]})]})]}),a.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${n?"bg-iiif-blue border-iiif-blue":"border-slate-300 group-hover:border-slate-400"}`,children:n&&a.jsx($,{name:"check",className:"text-white text-sm"})})]})},gN=An.memo(({node:e,isSelected:t,referenceCount:n,onSelect:i,onToggle:l,onDragStart:o,onDragOver:u,onDragLeave:d,onDrop:m,isDragOver:h,canAcceptDrop:p})=>{const g=Ht[e.node.type]||Ht.Content,y=Os(e.node,40),x=Mt(e.node),v=zt(e.node),N=e.level*12;return a.jsxs("div",{role:"treeitem","aria-level":e.aria.level,"aria-setsize":e.aria.setSize,"aria-posinset":e.aria.posInSet,"aria-expanded":e.hasChildren?e.isExpanded:void 0,"aria-selected":t,tabIndex:t?0:-1,"data-node-id":e.id,draggable:!0,onDragStart:j=>o(j,e.id),onDragOver:j=>p&&u(j,e.id),onDragLeave:d,onDrop:j=>m(j,e.id),className:`
        flex items-center gap-2 p-2 rounded-lg cursor-pointer 
        transition-all select-none border
        ${h?"bg-blue-100 border-blue-500":""}
        ${t?"bg-white border-blue-400 shadow-md font-bold":"hover:bg-slate-50 text-slate-700 border-transparent"}
      `,style:{paddingLeft:`${16+N}px`,height:"40px"},onClick:()=>i(e.id),children:[a.jsx("div",{className:`
          p-0.5 rounded hover:bg-black/10 
          ${e.hasChildren?"":"invisible"}
          ${t?"text-slate-800":"text-slate-500"}
        `,onClick:l,role:"button","aria-label":e.isExpanded?"Collapse":"Expand",children:a.jsx($,{name:e.isExpanded?"expand_more":"chevron_right",className:"text-[14px]"})}),a.jsx(Hs,{urls:y,size:"xs",icon:g.icon,placeholderBg:"bg-transparent"}),a.jsx("span",{className:"text-sm truncate flex-1",children:Le(e.node.label)||"Untitled"}),n>1&&a.jsx("span",{className:"text-[9px] bg-purple-100 text-purple-600 px-1.5 py-0.5 rounded-full font-bold",title:`Referenced in ${n} Collections`,children:n}),a.jsx("span",{className:`text-[9px] font-bold uppercase px-1.5 py-0.5 rounded ${x?"bg-amber-100 text-amber-600":v?"bg-emerald-100 text-emerald-600":"bg-slate-100 text-slate-500"}`,children:Mt(e.node)?"COLL":zt(e.node)?"MAN":Wt(e.node)?"CVS":""})]})});gN.displayName="MemoizedTreeItem";const JM=({root:e,selectedId:t,onSelect:n,onDrop:i,referenceMap:l,rowHeight:o=40,overscan:u=5,maxDepth:d=15,className:m="",enableKeyboardNav:h=!0})=>{const p=S.useRef(null),[g,y]=S.useState(t),[x,v]=S.useState(null),{visibleNodes:N,topSpacer:j,bottomSpacer:C,toggleExpanded:A,handleKeyNavigation:_,findNode:T}=uM({root:e,containerRef:p,estimatedRowHeight:o,overscan:u,maxDepth:d,defaultExpanded:!0});S.useEffect(()=>{y(t)},[t]);const L=S.useCallback(I=>{if(!h)return;const D=_(I,g);if(D){y(D),n(D);const E=T(D);if(E&&p.current){const q=E.index*o,W=p.current.scrollTop,G=p.current.clientHeight;q<W?p.current.scrollTop=q:q+o>W+G&&(p.current.scrollTop=q+o-G)}}},[h,_,g,n,T,o]),H=S.useCallback((I,D)=>{I.stopPropagation(),A(D)},[A]),k=S.useCallback((I,D)=>{I.dataTransfer.setData("resourceId",D),I.dataTransfer.effectAllowed="move"},[]),R=S.useCallback((I,D)=>{I.preventDefault(),I.dataTransfer.dropEffect="move",v(D)},[]),z=S.useCallback(()=>{v(null)},[]),P=S.useCallback((I,D)=>{I.preventDefault(),v(null);const E=I.dataTransfer.getData("resourceId");E&&E!==D&&i?.(E,D)},[i]),K=S.useCallback(I=>{const D=Mt(I.node),E=zt(I.node);return(D||E)&&I.level<d},[d]);return a.jsxs("div",{ref:p,role:"tree","aria-label":"Archive structure",onKeyDown:L,className:`overflow-y-auto outline-none ${m}`,tabIndex:0,children:[a.jsx("div",{style:{height:j},"aria-hidden":"true"}),N.map(I=>{const D=I.id===t,E=l.get(I.id)?.length||0,q=x===I.id;return a.jsx(gN,{node:I,isSelected:D,referenceCount:E,onSelect:n,onToggle:W=>H(W,I.id),onDragStart:k,onDragOver:R,onDragLeave:z,onDrop:P,isDragOver:q,canAcceptDrop:K(I)},I.id)}),a.jsx("div",{style:{height:C},"aria-hidden":"true"})]})},QM=An.memo(KM,(e,t)=>{const n=e.item?.id,i=t.item?.id,l=e.selectedIds.size,o=t.selectedIds.size,u=e.viewMode,d=t.viewMode;return n===i&&l===o&&u===d}),e4=({root:e,onUpdate:t,abstractionLevel:n="standard",onReveal:i,onSynthesize:l,onSelect:o,selectedId:u,inspectorVisible:d=!1,onToggleInspector:m})=>{const{showToast:h}=ws(),[p,g]=S.useState(null),[y,x]=S.useState(!1),[v,N]=S.useState("grid"),{isCollapsed:j,isResizing:C,toggleCollapse:A,handleProps:_,panelStyle:T}=qm({id:"collections-tree",defaultSize:288,minSize:200,maxSize:500,direction:"horizontal",side:"right",collapseThreshold:100,persist:!0}),{selectedIds:L,select:H,toggle:k,clear:R}=hp(),{findNode:z,getAllManifests:P,getAllCollections:K}=dN(e);S.useEffect(()=>{e&&!p?g(e.id):e&&p?z(p)||(g(e.id),R()):e||(g(null),R())},[e?.id,z,p,R]);const I=u!==void 0?u:p,D=S.useCallback(de=>{g(de),L.has(de)||(R(),H(de)),o?.(de)},[o,L,R,H]),E=S.useCallback((de,ye)=>{ye?de.forEach(le=>k(le)):(R(),de.forEach(le=>H(le)))},[k,H,R]),q=S.useMemo(()=>{if(!e)return{collections:0,manifests:0,canvases:0};const de=th(e,"Collection").length,ye=th(e,"Manifest").length,le=th(e,"Canvas").length;return{collections:de,manifests:ye,canvases:le}},[e]),W=S.useMemo(()=>e?QC(e):new Map,[e]),G=S.useMemo(()=>{const de=new Map;if(!e)return de;const ye=le=>{de.set(le.id,le),(le.items||le.annotations||[]).forEach(He=>ye(He))};return ye(e),de},[e]),te=dM(I,W,G);S.useMemo(()=>P(),[P]),S.useMemo(()=>K(),[K]);const U=S.useCallback(de=>JSON.parse(JSON.stringify(de)),[]),V=S.useCallback(()=>{if(!I||!e)return;const de=U(e),ye=z(I);if(ye&&zt(ye)){const le=kD.generateRangesFromPatterns(ye);Object.assign(ye,le),t(de),h("Auto-generated Table of Contents","success")}else h("Select a Manifest to auto-structure","info")},[I,e,U,z,t,h]),O=S.useCallback((de,ye)=>{if(!e)return;const le=U(e),we=ye?z(ye):le;if(!we){h("Target not found","error");return}if(!Ja(we.type,de)){const ee=Kc(we.type);h(`Cannot add ${de} to ${we.type}. Valid children: ${ee.join(", ")||"none"}`,"error");return}const He=dn(),Ke=ct.BASE_URL.DEFAULT,F={"@context":kt.PRESENTATION_3.CONTEXT,id:ct.ID_PATTERNS[de==="Manifest"?"MANIFEST":"COLLECTION"](Ke,He),type:de,label:vn(`New ${de}`),summary:vn(`${de} created in ${Le(we.label)||"archive"}`),items:[],behavior:de==="Manifest"?["individuals"]:void 0},me=Os(we,200);me.length>0&&(F.thumbnail=[{id:me[0],type:"Image",format:"image/jpeg"}]);const he=Ai(we.type,de);console.log(`Creating ${he} relationship: ${we.type}  ${de}`),we.items||(we.items=[]),we.items.push(F),t(le),h(`New ${de} added (${he} relationship)`,"success")},[e,U,z,t,h]);S.useCallback((de,ye)=>{if(!e)return;const le=U(e),we=z(de);we&&(Object.assign(we,ye),t(le))},[e,U,z,t]),S.useCallback((de,ye)=>{if(!e)return;const le=U(e),we=z(ye),He=z(de);if(!we||!He||!Mt(we)){h("Cannot add to collection","error");return}if(we.items?.find(F=>F.id===de)){h("Manifest is already in this Collection","info");return}we.items||(we.items=[]),we.items.push(JSON.parse(JSON.stringify(He))),t(le),h(`Added "${Le(He.label)}" to "${Le(we.label)}"`,"success"),x(!1)},[e,U,z,t,h]),S.useCallback((de,ye)=>{if(!e)return;const le=U(e),we=z(ye);if(!we||!Mt(we))return;const He=we,Ke=He.items?.findIndex(F=>F.id===de)??-1;Ke>-1&&(He.items.splice(Ke,1),t(le),h("Removed from Collection","success"))},[e,U,z,t,h]);const B=S.useCallback((de,ye)=>{if(!e||de===ye)return;const le=U(e);let we=null;const He=F=>{const me=F.items||F.annotations||[],he=me.findIndex(ee=>ee.id===de);if(he>-1)return we=me.splice(he,1)[0],!0;for(const ee of me)if(He(ee))return!0;return!1},Ke=F=>{if(F.id===ye){if(!we)return!1;if(!Ja(F.type,we.type)){const ee=Kc(F.type);return h(`Cannot move ${we.type} into ${F.type}. Valid children: ${ee.join(", ")||"none"}`,"error"),!1}const he=Ai(F.type,we.type);return console.log(`Creating ${he} relationship: ${F.type}  ${we.type}`),F.items||(F.items=[]),F.items.push(we),!0}const me=F.items||F.annotations||[];for(const he of me)if(Ke(he))return!0;return!1};He(le),we&&Ke(le)&&(t(le),h("Structure reorganized","success"))},[e,U,t,h]),Y=S.useCallback((de,ye)=>{if(!e||!I)return;const le=U(e),we=z(I);if(!we||!we.items)return;const[He]=we.items.splice(de,1);we.items.splice(ye,0,He),t(le)},[e,I,U,z,t]),X=S.useCallback(de=>{if(!e||!I)return;const ye=JSON.parse(JSON.stringify(e)),le=U(e),we=z(I);!we||!we.items||(we.items=we.items.filter(He=>!de.includes(He.id)),t(le),R(),h(`Removed ${de.length} item(s)`,"success",{label:"Undo",onClick:()=>{t(ye),h("Removal undone","info")},variant:"primary"}))},[e,I,U,z,t,h,R]),Q=S.useCallback(de=>{if(!e||!I)return;const ye=U(e),le=z(I);if(!le||!le.items)return;const we=[];de.forEach(He=>{const Ke=le.items.find(F=>F.id===He);if(Ke){const F=JSON.parse(JSON.stringify(Ke));if(F.id=`${Ke.id}_copy_${dn().slice(0,8)}`,F.label){const me=Le(F.label);F.label=vn(`${me} (Copy)`)}we.push(F)}}),le.items.push(...we),t(ye),h(`Duplicated ${de.length} item(s)`,"success")},[e,I,U,z,t,h]),ue=e&&I?z(I):null,be=ue&&Ht[ue.type]||Ht.Content;return S.useMemo(()=>!e||!ue||ue.type!=="Manifest"?[]:JC(e,ue.id),[e,ue]),ue&&W.get(ue.id)?.length,a.jsxs("div",{className:"flex flex-col h-full bg-slate-100",children:[a.jsxs("div",{className:"h-16 bg-white border-b flex items-center justify-between px-6 shrink-0 shadow-sm z-20",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("button",{onClick:A,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",title:j?"Show sidebar":"Hide sidebar",children:a.jsx($,{name:j?"menu":"menu_open",className:"text-slate-500"})}),a.jsx("div",{className:"p-2 bg-iiif-blue/10 rounded-lg text-iiif-blue",children:a.jsx($,{name:"account_tree",className:"text-2xl"})}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("h1",{className:"text-lg font-bold text-slate-800 leading-tight",children:"Structure"}),te.length>0&&a.jsx(VM,{path:te,onNavigate:D,onHomeClick:()=>e&&D(e.id),maxVisible:4}),te.length===0&&a.jsxs("p",{className:"text-xs text-slate-500",children:[q.collections," Collections  ",q.manifests," Manifests  ",q.canvases," Canvases"]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[ue?.type==="Manifest"&&a.jsxs("button",{onClick:V,className:"flex items-center gap-2 px-4 py-2 bg-amber-50 text-amber-700 border border-amber-200 rounded-lg text-sm font-bold hover:bg-amber-100 transition-all mr-4",children:[a.jsx($,{name:"auto_awesome",className:"text-amber-500"})," Build TOC"]}),a.jsxs("button",{onClick:()=>O("Collection",I),className:"flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 rounded-lg text-sm font-bold text-slate-700 hover:bg-slate-50 shadow-sm transition-all",children:[a.jsx($,{name:"create_new_folder",className:"text-amber-600"})," Collection"]}),a.jsxs("button",{onClick:()=>O("Manifest",I),className:"flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 rounded-lg text-sm font-bold text-slate-700 hover:bg-slate-50 shadow-sm transition-all",children:[a.jsx($,{name:"note_add",className:"text-emerald-600"})," Manifest"]}),m&&a.jsx("button",{onClick:m,className:`p-2 rounded-lg transition-colors ${d?"bg-iiif-blue text-white":"hover:bg-slate-100 text-slate-500"}`,title:d?"Hide Inspector":"Show Inspector",children:a.jsx($,{name:"info"})})]})]}),a.jsxs("div",{className:"flex-1 flex min-h-0",children:[a.jsxs("div",{className:"flex flex-col border-r border-slate-200 bg-white shadow-inner relative shrink-0",style:T,children:[!j&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"h-10 border-b bg-slate-50 flex items-center px-3 shrink-0",children:a.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:"Archive Tree"})}),a.jsx(JM,{root:e,selectedId:I,onSelect:D,onDrop:B,referenceMap:W,rowHeight:40,overscan:5,className:"flex-1 p-3 custom-scrollbar",enableKeyboardNav:!0})]}),a.jsx("div",{..._,className:`
              absolute right-0 top-0 bottom-0 w-1 z-30 group
              cursor-col-resize
              transition-colors duration-150
              hover:bg-slate-500/20
              ${C?"bg-iiif-blue/30":""}
              ${_.className}
            `,children:a.jsx("div",{className:`
                absolute right-0 top-1/2 -translate-y-1/2
                w-1 h-12 rounded-full
                transition-all duration-150
                opacity-0 group-hover:opacity-100 group-focus:opacity-100
                ${C?"bg-iiif-blue opacity-100":"bg-slate-400 group-hover:bg-iiif-blue"}
              `})})]}),a.jsx("div",{className:"flex-1 flex flex-col min-w-0",children:ue&&(zt(ue)||Mt(ue))?a.jsxs(a.Fragment,{children:[a.jsx(QM,{item:ue,onReorder:Y,onSelect:D,onMultiSelect:E,selectedIds:L,viewMode:v,onViewModeChange:N,onRemove:X,onDuplicate:Q}),L.size>1&&a.jsxs("div",{className:"h-14 bg-white border-t flex items-center justify-between px-4 shrink-0 shadow-lg",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("span",{className:"text-sm font-bold text-slate-700",children:[L.size," items selected"]}),a.jsx("button",{onClick:R,className:"text-xs text-slate-400 hover:text-slate-600",children:"Clear selection"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>Q(Array.from(L)),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-bold text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:[a.jsx($,{name:"content_copy",className:"text-sm"})," Duplicate"]}),a.jsxs("button",{onClick:()=>X(Array.from(L)),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-bold text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[a.jsx($,{name:"delete",className:"text-sm"})," Remove"]})]})]})]}):ue?a.jsxs("div",{className:"flex-1 flex flex-col bg-slate-50 overflow-hidden",children:[a.jsxs("div",{className:"h-14 bg-white border-b px-6 flex items-center justify-between shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("span",{className:`text-[10px] font-black uppercase px-2 py-0.5 rounded flex items-center gap-1 ${be.bgClass} ${be.colorClass}`,children:[a.jsx($,{name:be.icon,className:"text-xs"}),ue.type]}),a.jsx("h2",{className:"font-bold text-slate-800 truncate",children:Le(ue.label)})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:()=>i?.(ue.id,"archive"),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-slate-500 hover:text-iiif-blue hover:bg-slate-100 rounded-lg transition-all",title:"Show this item in the Archive grid view",children:[a.jsx($,{name:"inventory_2",className:"text-sm"})," Archive"]}),Wt(ue)&&a.jsxs("button",{onClick:()=>i?.(ue.id,"viewer"),className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-slate-500 hover:text-iiif-blue hover:bg-slate-100 rounded-lg transition-all",title:"Open this canvas in the image viewer",children:[a.jsx($,{name:"visibility",className:"text-sm"})," View"]})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-10 bg-slate-100/50",children:a.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[Wt(ue)&&a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-slate-200 p-8",children:[a.jsx("div",{className:"aspect-video bg-slate-900 rounded-xl overflow-hidden mb-4 flex items-center justify-center",children:a.jsx(Hs,{urls:Os(ue,800),size:"xl",className:"w-full h-full",icon:"image"})}),a.jsx("h3",{className:"font-bold text-lg text-slate-800",children:Le(ue.label)}),Wt(ue)&&a.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[ue.width," x ",ue.height,"px",ue.items&&`  ${ue.items.reduce((de,ye)=>de+(ye.items?.length||0),0)} annotations`]})]}),a.jsxs(Kv,{title:"IIIF Hierarchy Model",type:"field-note",children:[a.jsx("strong",{children:"Collections"})," are curated lists that reference resources.",a.jsx("strong",{children:"Manifests"})," own their Canvases exclusively. A Manifest can appear in multiple Collections - think of it like a book that can be in multiple reading lists."]})]})})]}):a.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-400 bg-slate-50",children:[a.jsx($,{name:"account_tree",className:"text-6xl mb-4 opacity-20"}),a.jsx("p",{className:"font-bold uppercase tracking-widest text-xs",children:"Select a structural node to view its contents"})]})})]})]})},t4=An.memo(e4,(e,t)=>{const n=e.root?.id,i=t.root?.id,l=e.selectedId,o=t.selectedId,u=e.inspectorVisible,d=t.inspectorVisible;return n===i&&l===o&&u===d}),n4=({root:e,onSelect:t,onRevealMap:n})=>{const[i,l]=S.useState(""),[o,u]=S.useState([]),[d,m]=S.useState("All"),[h,p]=S.useState(!1),[g,y]=S.useState(!1),[x,v]=S.useState([]),[N,j]=S.useState(-1),C=S.useRef(null),A=S.useRef(null);S.useEffect(()=>{e&&(p(!0),setTimeout(()=>{Ni.buildIndex(e),p(!1)},100))},[e]),S.useEffect(()=>{if(i.trim().length>1){const L=d==="All"?void 0:d,H=Ni.searchWithSyntax(i),k=L&&!i.startsWith("type:")?H.filter(R=>R.type===L):H;u(k),y(!1)}else u([])},[i,d]),S.useEffect(()=>{const L=Ni.autocomplete(i);v(L),j(-1)},[i]),S.useEffect(()=>{const L=H=>{A.current&&!A.current.contains(H.target)&&C.current&&!C.current.contains(H.target)&&y(!1)};return document.addEventListener("mousedown",L),()=>document.removeEventListener("mousedown",L)},[]);const _=L=>{l(L),y(!1),C.current?.focus()},T=L=>{!g||x.length===0||(L.key==="ArrowDown"?(L.preventDefault(),j(H=>Math.min(H+1,x.length-1))):L.key==="ArrowUp"?(L.preventDefault(),j(H=>Math.max(H-1,-1))):L.key==="Enter"&&N>=0?(L.preventDefault(),_(x[N].value)):L.key==="Escape"&&y(!1))};return a.jsxs("div",{className:"flex flex-col h-full bg-slate-50",children:[a.jsx("div",{className:"bg-white border-b p-6 shadow-sm z-10",children:a.jsxs("div",{className:"max-w-3xl mx-auto w-full",children:[a.jsxs("h2",{className:"text-xl font-bold text-slate-800 mb-4 flex items-center gap-2",children:[a.jsx($,{name:"search",className:"text-iiif-blue"}),"Global Search"]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{ref:C,type:"text",value:i,onChange:L=>l(L.target.value),onFocus:()=>y(!0),onKeyDown:T,placeholder:"Search for manifests, annotations, content...",className:"w-full text-lg p-4 pl-12 bg-slate-100 border-2 border-transparent focus:bg-white focus:border-iiif-blue rounded-xl outline-none transition-all shadow-inner",autoFocus:!0}),a.jsx($,{name:"search",className:"absolute left-4 top-5 text-slate-400 text-xl"}),i&&a.jsx("button",{onClick:()=>l(""),className:"absolute right-4 top-4 text-slate-400 hover:text-slate-600",children:a.jsx($,{name:"close"})}),g&&x.length>0&&a.jsxs("div",{ref:A,className:"absolute top-full left-0 right-0 mt-1 bg-white border border-slate-200 rounded-xl shadow-lg z-20 overflow-hidden",children:[x.map((L,H)=>a.jsxs("button",{onClick:()=>_(L.value),className:`w-full flex items-center gap-3 px-4 py-3 text-left transition-colors ${H===N?"bg-iiif-blue text-white":"hover:bg-slate-50 text-slate-700"}`,children:[a.jsx($,{name:L.icon||"search",className:H===N?"text-white":"text-slate-400"}),a.jsx("span",{className:"flex-1 font-medium",children:L.value}),L.type==="recent"&&a.jsx("span",{className:`text-[10px] uppercase font-bold ${H===N?"text-white/70":"text-slate-400"}`,children:"Recent"}),L.type==="type"&&L.count!==void 0&&a.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${H===N?"bg-white/20 text-white":"bg-slate-100 text-slate-500"}`,children:L.count})]},`${L.type}-${L.value}`)),Ni.getRecentSearches().length>0&&a.jsx("button",{onClick:()=>{Ni.clearRecentSearches(),v(Ni.autocomplete(i))},className:"w-full px-4 py-2 text-[10px] uppercase font-bold text-slate-400 hover:text-slate-600 hover:bg-slate-50 border-t",children:"Clear Recent Searches"})]})]}),a.jsx("div",{className:"flex gap-2 mt-4",children:["All","Manifest","Canvas","Annotation"].map(L=>a.jsx("button",{onClick:()=>m(L),className:`px-3 py-1 rounded-full text-xs font-bold transition-colors border ${d===L?"bg-iiif-blue text-white border-iiif-blue":"bg-white text-slate-500 border-slate-200 hover:border-slate-300"}`,children:L},L))})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6 custom-scrollbar",children:a.jsx("div",{className:"max-w-3xl mx-auto w-full space-y-4",children:h?a.jsxs("div",{className:"text-center py-10 text-slate-400 animate-pulse",children:[a.jsx($,{name:"sync",className:"mb-2 animate-spin"}),a.jsx("p",{children:"Updating Search Index..."})]}):o.length>0?a.jsxs(a.Fragment,{children:[a.jsxs("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4",children:["Found ",o.length," results"]}),o.map(L=>{const H=Ht[L.type]||Ht.Content;return a.jsx("div",{onClick:()=>t(L.id),className:"bg-white p-4 rounded-lg border border-slate-200 shadow-sm hover:shadow-md hover:border-iiif-blue cursor-pointer transition-all group",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:`p-2 rounded shrink-0 ${H.bgClass} ${H.colorClass}`,children:a.jsx($,{name:H.icon})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h3",{className:"font-bold text-slate-800 truncate group-hover:text-iiif-blue flex-1",children:L.label}),a.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[n&&a.jsx("button",{onClick:k=>{k.stopPropagation(),n(L.id)},className:"p-1 hover:bg-blue-50 rounded text-slate-400 hover:text-blue-500 transition-colors",title:"Reveal on Map",children:a.jsx($,{name:"place",className:"text-xs"})}),a.jsx("span",{className:"text-[10px] font-mono bg-slate-50 px-1.5 py-0.5 rounded text-slate-400 border border-slate-100",children:L.type})]})]}),a.jsxs("p",{className:"text-xs text-slate-400 mt-1 flex items-center gap-1 truncate",children:[a.jsx($,{name:"folder_open",className:"text-[10px]"}),L.context]})]})]})},L.id)})]}):i.length>1?a.jsx(ki,{...Q1.noResults({onAction:()=>l("")}),message:`No results found for "${i}". Try different search terms or adjust your filters.`}):a.jsx(ki,{icon:"manage_search",title:"Search Your Archive",message:"Start typing to search for manifests, annotations, and content across your entire archive."})})})]})},s4=({isOpen:e,message:t="You have unsaved changes. Are you sure you want to leave?",onConfirm:n,onCancel:i,title:l="Unsaved Changes"})=>e?a.jsx("div",{className:"fixed inset-0 z-[1000] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"nav-guard-title",children:a.jsxs("div",{className:"bg-white max-w-md w-full rounded-2xl shadow-2xl overflow-hidden animate-in zoom-in-95",children:[a.jsxs("div",{className:"bg-amber-50 p-6 flex items-center gap-4 border-b border-amber-100",children:[a.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-full flex items-center justify-center text-amber-600",children:a.jsx($,{name:"warning",className:"text-2xl"})}),a.jsxs("div",{children:[a.jsx("h2",{id:"nav-guard-title",className:"text-lg font-bold text-amber-900",children:l}),a.jsx("p",{className:"text-amber-700 text-sm",children:"Your changes will be lost."})]})]}),a.jsx("div",{className:"p-6",children:a.jsx("p",{className:"text-slate-600",children:t})}),a.jsxs("div",{className:"p-6 bg-slate-50 flex justify-end gap-3",children:[a.jsx("button",{onClick:i,className:"px-4 py-2 text-slate-600 font-medium hover:bg-slate-200 rounded-lg transition-colors",children:"Stay Here"}),a.jsx("button",{onClick:n,className:"px-4 py-2 bg-amber-500 text-white font-bold rounded-lg hover:bg-amber-600 transition-colors",children:"Leave Without Saving"})]})]})}):null,zv=["Title","Creator","Date","Description","Subject","Rights","Source","Type","Format","Identifier","Language","Coverage","Publisher","Contributor","Relation"],a4=({root:e,onUpdate:t,filterIds:n,onClearFilter:i,onNavigateAway:l})=>{const{showToast:o}=ws(),[u,d]=S.useState([]),[m,h]=S.useState([]),[p,g]=S.useState(""),[y,x]=S.useState("All"),[v,N]=S.useState(null),[j,C]=S.useState(!1),[A,_]=S.useState(!1),[T,L]=S.useState(null),[H,k]=S.useState(!1),[R,z]=S.useState(null),[P,K]=S.useState(!0),I=S.useRef(null),[D,E]=S.useState(!1),[q,W]=S.useState(null);iM({hasUnsavedChanges:j,confirmMessage:"You have unsaved changes in the catalog. Save before leaving?"}),S.useEffect(()=>{const X=Q=>{if(j)return Q.preventDefault(),Q.returnValue="You have unsaved changes. Are you sure you want to leave?",Q.returnValue};return window.addEventListener("beforeunload",X),()=>window.removeEventListener("beforeunload",X)},[j]),S.useEffect(()=>{l&&l(!j)},[j,l]),S.useCallback(X=>j?(W(()=>X),E(!0),!1):!0,[j]);const G=()=>{if(U.length===0){o("No items to export","error");return}const X=["ID","Type","Title","Summary","Rights","Date",...m.filter(de=>!["Title","Summary","Date","Rights"].includes(de))],Q=U.map(de=>[de.id,de.type,`"${(de.label||"").replace(/"/g,'""')}"`,`"${(de.summary||"").replace(/"/g,'""')}"`,de.rights,de.navDate,...m.filter(le=>!["Title","Summary","Date","Rights"].includes(le)).map(le=>`"${(de.metadata[le]||"").replace(/"/g,'""')}"`)].join(",")),ue=[X.join(","),...Q].join(`
`),be=new Blob([ue],{type:"text/csv;charset=utf-8"});Yc.saveAs(be,`metadata-export-${new Date().toISOString().split("T")[0]}.csv`),o(`Exported ${U.length} items to CSV`,"success")},te=async X=>{const Q=X.target.files?.[0];if(Q){if(!Q.name.endsWith(".csv")&&!Q.type.includes("csv")){o("Please select a valid CSV file","error"),I.current&&(I.current.value="");return}if(Q.size>10*1024*1024){o("CSV file too large (max 10MB)","error"),I.current&&(I.current.value="");return}z({message:"Reading CSV file...",percent:10});try{const ue=await new Promise((Z,se)=>{const Te=new FileReader;Te.onload=_e=>Z(_e.target?.result),Te.onerror=()=>se(new Error("Failed to read file")),Te.readAsText(Q)});z({message:"Parsing CSV data...",percent:30});const be=ue.split(`
`).filter(Z=>Z.trim());if(be.length<2)throw new Error("CSV must have header and at least one data row");const de=be[0].split(",").map(Z=>Z.trim().replace(/^"|"$/g,"")),ye=de.findIndex(Z=>Z.toLowerCase()==="id"),le=de.findIndex(Z=>Z.toLowerCase()==="title"),we=de.findIndex(Z=>Z.toLowerCase()==="summary");if(ye===-1)throw new Error("CSV must have an ID column");z({message:`Processing ${be.length-1} rows...`,percent:50});const He=["id","type","title","summary","rights","date","viewingdirection"],Ke=de.filter(Z=>{const se=Z.toLowerCase();return!He.includes(se)&&!zv.some(Te=>Te.toLowerCase()===se)});Ke.length>0&&console.warn("CSV import: Unknown headers detected:",Ke);let F=0;const me=[...u],he=JSON.stringify(u),ee=be.length-1;try{for(let Z=1;Z<be.length;Z++){if(Z%10===0){const Se=50+Math.floor(Z/ee*40);z({message:`Processing row ${Z} of ${ee}...`,percent:Se}),await new Promise(Ce=>setTimeout(Ce,0))}const se=[];let Te="",_e=!1;for(const Se of be[Z])Se==='"'?_e=!_e:Se===","&&!_e?(se.push(Te.trim().replace(/^"|"$/g,"")),Te=""):Te+=Se;se.push(Te.trim().replace(/^"|"$/g,""));const ne=se[ye];if(!ne)continue;if(!ne.includes("/")&&!ne.includes(":")){console.warn(`CSV import: Invalid ID format at row ${Z}: ${ne}`);continue}const ge=me.findIndex(Se=>Se.id===ne);ge!==-1&&(le!==-1&&se[le]&&(me[ge].label=se[le].slice(0,500)),we!==-1&&se[we]&&(me[ge].summary=se[we].slice(0,2e3)),de.forEach((Se,Ce)=>{if(!["id","type","title","summary","rights","date"].includes(Se.toLowerCase())&&se[Ce]){const Me=Se.replace(/[^a-zA-Z0-9\s]/g,"").slice(0,100);Me&&(me[ge].metadata[Me]=se[Ce].slice(0,1e3))}}),F++)}z({message:"Finalizing...",percent:95}),d(me),C(!0),z(null),o(`Updated ${F} items from CSV`,"success")}catch(Z){throw d(JSON.parse(he)),Z}}catch(ue){z(null),o(`CSV import failed: ${ue.message}`,"error")}I.current&&(I.current.value="")}};S.useEffect(()=>{const X=Q=>{document.activeElement?.tagName.match(/INPUT|TEXTAREA|SELECT/)||(Q.key==="?"&&(Q.preventDefault(),k(ue=>!ue)),Q.key==="Escape"&&k(!1))};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},[]),S.useEffect(()=>{if(!e){d([]),K(!1);return}K(!0);const X=[],Q=new Set,ue=new Set,be=le=>{if(!le||ue.has(le.id))return;ue.add(le.id);const we=["AnnotationPage","Annotation","Range"].includes(le.type);(A||!we)&&X.push({id:le.id,type:le.type,label:Le(le.label),summary:Le(le.summary),rights:le.rights||"",navDate:le.navDate||"",viewingDirection:le.viewingDirection||"",metadata:(le.metadata||[]).reduce((Ke,F)=>{const me=Le(F.label,"en")||"Unknown";return Ke[me]=Le(F.value,"en"),Q.add(me),Ke},{}),_blobUrl:le._blobUrl||le.thumbnail?.[0]?.id||(Wt(le)?le.items?.[0]?.items?.[0]?.body?.id:void 0)});const He=le.items||le.annotations||[];Array.isArray(He)&&He.forEach(Ke=>{Ke&&typeof Ke=="object"&&be(Ke)})};be(e),d(X);const de=["Title","Summary","Date","Rights"],ye=Array.from(Q).filter(le=>!de.includes(le));h([...de,...ye]),K(!1)},[e,A]);const U=S.useMemo(()=>u.filter(X=>{const Q=(X.label||"").toLowerCase(),ue=(X.type||"").toLowerCase(),be=p.toLowerCase(),de=n?n.includes(X.id):!0,ye=Q.includes(be)||ue.includes(be),le=y==="All"||X.type===y;return de&&ye&&le}),[u,p,y,n]),V=(X,Q,ue,be)=>{C(!0),d(de=>de.map(ye=>{if(ye.id!==X)return ye;if(be)return{...ye,metadata:{...ye.metadata,[Q]:ue}};const le=Q.toLowerCase();return le==="title"?{...ye,label:ue}:le==="summary"?{...ye,summary:ue}:le==="date"?{...ye,navDate:ue}:le==="rights"?{...ye,rights:ue}:le==="viewingdirection"?{...ye,viewingDirection:ue}:{...ye,[Q]:ue}}))},O=(X,Q)=>{C(!0),d(ue=>ue.map(be=>be.id!==X?be:{...be,metadata:{...be.metadata,[Q]:""}})),m.includes(Q)||h([...m,Q]),L(null)},B=()=>{if(!e)return;const X=JSON.parse(JSON.stringify(e)),Q=new Map(u.map(de=>[de.id,de])),ue=new Set,be=de=>{if(ue.has(de.id))return;ue.add(de.id);const ye=Q.get(de.id);ye&&(de.label={none:[ye.label]},de.summary={none:[ye.summary]},de.rights=ye.rights,de.navDate=ye.navDate,de.viewingDirection=ye.viewingDirection,de.metadata=Object.entries(ye.metadata).map(([we,He])=>({label:{en:[we]},value:{en:[He]}})));const le=de.items||de.annotations||[];Array.isArray(le)&&le.forEach(we=>be(we))};be(X),t(X),C(!1),o("Archive metadata synchronized","success")},Y=X=>{const Q=X.toLowerCase(),ue=Object.keys(fb).find(be=>be.toLowerCase()===Q);return ue?fb[ue]:null};return e?a.jsxs("div",{className:"flex flex-col h-full bg-white text-slate-900",children:[a.jsxs("div",{className:"h-16 border-b px-6 flex items-center justify-between bg-slate-50 shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("h2",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[a.jsx($,{name:"table_chart",className:"text-green-600"})," Catalog"]}),a.jsxs("div",{className:"relative",children:[a.jsx($,{name:"search",className:"absolute left-3 top-2.5 text-slate-400"}),a.jsx("input",{type:"text",placeholder:"Filter current view...",value:p,onChange:X=>g(X.target.value),className:"pl-9 pr-3 py-2 text-sm border border-slate-300 rounded-lg outline-none w-64 bg-white text-slate-900 shadow-sm focus:ring-2 focus:ring-iiif-blue/20"})]}),n&&a.jsxs("button",{onClick:i,className:"px-3 py-1.5 bg-iiif-blue/10 text-iiif-blue rounded-full text-[10px] font-black uppercase tracking-widest flex items-center gap-2 animate-in zoom-in-95",children:["Showing ",n.length," Selection Items ",a.jsx($,{name:"close",className:"text-xs"})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[j&&a.jsxs("span",{className:"text-[10px] font-black text-amber-500 uppercase tracking-widest animate-pulse flex items-center gap-1",children:[a.jsx($,{name:"warning",className:"text-xs"})," Pending Sync"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:G,className:"px-4 py-2 bg-slate-100 text-slate-700 rounded-lg text-sm font-bold hover:bg-slate-200 flex items-center gap-2 transition-all",title:"Export to CSV",children:[a.jsx($,{name:"download"})," Export CSV"]}),a.jsxs("button",{onClick:()=>I.current?.click(),className:"px-4 py-2 bg-slate-100 text-slate-700 rounded-lg text-sm font-bold hover:bg-slate-200 flex items-center gap-2 transition-all",title:"Import from CSV",children:[a.jsx($,{name:"upload"})," Import CSV"]}),a.jsx("input",{ref:I,type:"file",accept:".csv",onChange:te,className:"hidden"}),a.jsxs("button",{onClick:B,className:"px-6 py-2 bg-slate-800 text-white rounded-lg text-sm font-bold hover:bg-slate-700 shadow-md flex items-center gap-2 transition-all active:scale-95",children:[a.jsx($,{name:"save"})," Commit Changes"]})]})]})]}),a.jsx("div",{className:"flex border-b bg-white px-6 shrink-0 overflow-x-auto no-scrollbar",children:["All","Collection","Manifest","Canvas"].map(X=>a.jsxs("button",{onClick:()=>x(X),className:`px-4 py-3 text-[10px] font-black uppercase tracking-widest relative border-b-2 transition-all ${y===X?"text-iiif-blue border-b-2 border-iiif-blue bg-blue-50/20":"text-slate-400 border-transparent hover:text-slate-600"}`,children:[X,"s"]},X))}),a.jsx("div",{className:"flex-1 overflow-auto bg-slate-100 custom-scrollbar",children:P?a.jsx("div",{className:"p-6",children:a.jsx(K5,{rows:8,cols:5})}):U.length===0?a.jsx(ki,{...Q1.noResults({onAction:p||n?()=>{g(""),i?.()}:void 0}),message:p||n?"No items match your current filters. Try adjusting your search or clearing filters.":"No items in the catalog. Import files to populate the catalog."}):a.jsxs("table",{className:"w-full border-collapse text-sm bg-white",children:[a.jsx("thead",{className:"bg-slate-50 sticky top-0 z-10 shadow-sm border-b-2 border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"border-r px-4 py-3 text-left font-black uppercase text-[10px] text-slate-500 w-12 tracking-tighter bg-slate-50",children:"#"}),a.jsx("th",{className:"border-r px-4 py-3 text-left font-black uppercase text-[10px] text-slate-500 w-32 tracking-widest bg-slate-50",children:"Type"}),m.map(X=>{const Q=Y(X);return a.jsxs("th",{className:"border-r px-4 py-3 text-left font-black uppercase text-[10px] text-slate-600 min-w-[200px] whitespace-nowrap tracking-wider bg-slate-50",children:[X,Q&&a.jsx("span",{className:"ml-2 bg-slate-200 text-slate-500 px-1 rounded text-[8px] font-mono lowercase",children:Q})]},X)}),a.jsx("th",{className:"px-4 py-3 text-left font-black uppercase text-[10px] text-slate-500 w-12 bg-slate-50 tracking-tighter"})]})}),a.jsx("tbody",{children:U.map((X,Q)=>{const ue=Ht[X.type]||Ht.Content;return a.jsxs(An.Fragment,{children:[a.jsxs("tr",{className:`hover:bg-blue-50 transition-colors group cursor-pointer ${v===X.id?"bg-blue-50 ring-1 ring-iiif-blue ring-inset":""}`,onClick:()=>N(v===X.id?null:X.id),children:[a.jsx("td",{className:"border-b border-r px-4 py-2 text-slate-400 text-[10px] font-mono",children:Q+1}),a.jsx("td",{className:"border-b border-r px-4 py-2",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx($,{name:v===X.id?"expand_less":"expand_more",className:`text-xs transition-transform ${v===X.id?"text-iiif-blue":"text-slate-300"}`}),a.jsxs("span",{className:`text-[9px] uppercase font-black px-1.5 py-0.5 rounded border flex items-center gap-1 ${ue.bgClass} ${ue.colorClass} ${ue.borderClass}`,children:[a.jsx($,{name:ue.icon,className:"text-[10px]"}),X.type]})]})}),m.map(be=>{const de=["Title","Summary","Rights","Date","ViewingDirection"].includes(be);let ye="";return be==="Title"?ye=X.label:be==="Summary"?ye=X.summary:be==="Rights"?ye=X.rights:be==="Date"?ye=X.navDate:be==="ViewingDirection"?ye=X.viewingDirection:ye=X.metadata[be]||"",be==="Rights"?a.jsx("td",{className:"border-b border-r p-0 bg-white",onClick:le=>le.stopPropagation(),children:a.jsxs("select",{value:ye,onChange:le=>V(X.id,"rights",le.target.value,!1),className:"w-full h-full px-4 py-3 bg-transparent text-slate-800 focus:bg-white focus:ring-2 focus:ring-inset focus:ring-iiif-blue outline-none transition-all font-medium border-none shadow-none text-xs",children:[a.jsx("option",{value:"",children:"(None)"}),$C.map(le=>a.jsx("option",{value:le.value,children:le.label},le.value))]})},be):be==="Date"?a.jsx("td",{className:"border-b border-r p-0 bg-white",onClick:le=>le.stopPropagation(),children:a.jsx("input",{type:"datetime-local",value:ye?ye.slice(0,16):"",onChange:le=>V(X.id,"date",le.target.value?new Date(le.target.value).toISOString():"",!1),className:"w-full h-full px-4 py-3 bg-transparent text-slate-800 focus:bg-white focus:ring-2 focus:ring-inset focus:ring-iiif-blue outline-none transition-all font-medium border-none shadow-none text-xs"})},be):be==="ViewingDirection"?a.jsx("td",{className:"border-b border-r p-0 bg-white",onClick:le=>le.stopPropagation(),children:a.jsxs("select",{value:ye,onChange:le=>V(X.id,"viewingDirection",le.target.value,!1),className:"w-full h-full px-4 py-3 bg-transparent text-slate-800 focus:bg-white focus:ring-2 focus:ring-inset focus:ring-iiif-blue outline-none transition-all font-medium border-none shadow-none text-xs",children:[a.jsx("option",{value:"",children:"(Default)"}),zC.map(le=>a.jsx("option",{value:le,children:le},le))]})},be):a.jsx("td",{className:"border-b border-r p-0 bg-white",onClick:le=>le.stopPropagation(),children:a.jsx("input",{type:"text",value:ye,onChange:le=>V(X.id,be,le.target.value,!de),className:"w-full h-full px-4 py-3 bg-transparent text-slate-800 focus:bg-white focus:ring-2 focus:ring-inset focus:ring-iiif-blue outline-none transition-all placeholder:text-slate-200 font-medium border-none shadow-none"})},be)}),a.jsx("td",{className:"border-b p-2 text-center",onClick:be=>be.stopPropagation(),children:a.jsxs("div",{className:"relative",children:[a.jsx("button",{onClick:()=>L(T?.id===X.id?null:{id:X.id}),className:"p-1 hover:bg-slate-100 rounded text-slate-400 hover:text-iiif-blue",children:a.jsx($,{name:"add_circle"})}),T?.id===X.id&&a.jsx("div",{className:"absolute right-0 top-full mt-1 bg-white border border-slate-200 shadow-xl rounded-lg py-2 z-50 min-w-[140px] max-h-[200px] overflow-y-auto custom-scrollbar",children:zv.map(be=>a.jsx("button",{onClick:()=>O(X.id,be),className:"w-full px-4 py-1.5 text-left text-[10px] font-bold text-slate-600 hover:bg-blue-50 transition-colors",children:be},be))})]})})]}),v===X.id&&a.jsx("tr",{className:"bg-slate-50 border-b shadow-inner animate-in fade-in slide-in-from-top-1",children:a.jsx("td",{colSpan:m.length+3,className:"p-6",children:a.jsxs("div",{className:"flex gap-8",children:[a.jsxs("div",{className:"w-72 aspect-square bg-slate-900 rounded-2xl overflow-hidden border-4 border-white shadow-2xl relative ring-1 ring-slate-200",children:[X._blobUrl?a.jsx("img",{src:X._blobUrl,className:"w-full h-full object-contain",alt:"Proof"}):a.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-600 bg-slate-50",children:a.jsx($,{name:"image_not_supported",className:"text-5xl opacity-20"})}),a.jsx("div",{className:"absolute bottom-3 left-3 bg-black/70 backdrop-blur-md text-white text-[8px] px-2 py-1 rounded-full font-black uppercase tracking-widest shadow-lg",children:"Archive Reference Preview"})]}),a.jsxs("div",{className:"flex-1 space-y-6",children:[a.jsxs("div",{children:[a.jsxs("h4",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1.5 flex items-center gap-1",children:[a.jsx($,{name:"fingerprint",className:"text-xs"})," Archival ID (URI)"]}),a.jsx("code",{className:"text-[10px] text-iiif-blue bg-blue-50 px-3 py-1.5 rounded border border-blue-100 break-all block font-mono leading-relaxed",children:X.id})]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:Object.entries(X.metadata).map(([be,de])=>a.jsxs("div",{className:"p-3 bg-white rounded-xl border border-slate-200 shadow-sm",children:[a.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase block mb-1 tracking-tighter",children:be}),a.jsx("span",{className:"text-xs text-slate-700 font-bold leading-tight block",children:de||a.jsx("span",{className:"opacity-20 italic",children:"Empty"})})]},be))}),a.jsxs("div",{className:"bg-amber-50 p-4 rounded-xl border border-amber-100 flex items-start gap-3",children:[a.jsx($,{name:"info",className:"text-amber-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-bold text-amber-900 uppercase tracking-tight",children:"Archival Catalog Mode"}),a.jsx("p",{className:"text-[11px] text-amber-800 opacity-80 mt-0.5 italic leading-snug",children:"Data edited here is instantly projected into the IIIF semantic model."})]})]})]})]})})})]},X.id)})})]})}),a.jsxs("div",{className:"h-8 bg-slate-900 border-t border-slate-700 flex items-center justify-between px-6 text-[10px] text-slate-500 uppercase font-black tracking-widest shrink-0 z-10",children:[a.jsx("div",{className:"flex gap-4",children:a.jsx("span",{children:"Catalog Sync Enabled"})}),a.jsxs("span",{children:[U.length," Archive items listed"]})]}),a.jsx(s4,{isOpen:D,title:"Unsaved Changes",message:"You have unsaved changes in the catalog. Save before leaving?",onConfirm:()=>{B(),q&&q(),E(!1),W(null)},onCancel:()=>{C(!1),q&&q(),E(!1),W(null)}})]}):a.jsx("div",{className:"flex-1 flex items-center justify-center bg-slate-50 text-slate-400",children:a.jsxs("div",{className:"text-center",children:[a.jsx($,{name:"table_chart",className:"text-6xl mb-4 opacity-20"}),a.jsx("p",{className:"font-bold uppercase tracking-widest text-xs",children:"Load an archive to view catalog"})]})})};function Uv(e){const t=Math.floor((Date.now()-e)/1e3);return t<60?"just now":t<3600?`${Math.floor(t/60)} min ago`:t<86400?`${Math.floor(t/3600)} hr ago`:t<604800?`${Math.floor(t/86400)} days ago`:`${Math.floor(t/604800)} wks ago`}function i4(e){const t=Le(e.label,"en");if(t)return t;const n=e.id.split("/");return n[n.length-1]||e.id}function Bv(e){switch(e){case"Collection":return"collections";case"Manifest":return"menu_book";case"Canvas":return"image";case"Range":return"format_list_bulleted";case"AnnotationPage":return"chat";case"Annotation":return"comment";default:return"inventory_2"}}const r4=({state:e,onRestore:t,onDelete:n,onEmptyTrash:i,onSelectionChange:l,variant:o="default",className:u=""})=>{const[d,m]=S.useState(new Set),[h,p]=S.useState(""),[g,y]=S.useState("list"),[x,v]=S.useState(null),[N,j]=S.useState(!1),C=S.useMemo(()=>{const D=Object.entries(e.trashedEntities||{}),E=30;return D.map(([q,W])=>{const G=Math.floor((Date.now()-W.trashedAt)/864e5),te=Math.max(0,E-G);return{id:q,entity:W,displayLabel:i4(W.entity),type:W.entity.type,trashedAt:new Date(W.trashedAt),daysRemaining:te}}).sort((q,W)=>W.trashedAt.getTime()-q.trashedAt.getTime())},[e.trashedEntities]),A=S.useMemo(()=>{if(!h.trim())return C;const D=h.toLowerCase();return C.filter(E=>E.displayLabel.toLowerCase().includes(D)||E.type.toLowerCase().includes(D))},[C,h]),_=S.useMemo(()=>{const D=C,E=D.reduce((G,te)=>{try{return G+new Blob([JSON.stringify(te.entity.entity)]).size}catch{return G+1024}},0),q={};let W=0;for(const G of D)q[G.type]=(q[G.type]||0)+1,G.daysRemaining<=7&&W++;return{itemCount:D.length,totalSize:E,oldestItem:D.length>0?D[D.length-1].entity.trashedAt:null,newestItem:D.length>0?D[0].entity.trashedAt:null,itemsByType:q,expiringSoon:W}},[C]),T=S.useCallback(D=>{m(E=>{const q=new Set(E);return q.has(D)?q.delete(D):q.add(D),l?.(Array.from(q)),q})},[l]),L=S.useCallback(()=>{m(D=>{if(D.size===A.length)return l?.([]),new Set;const E=A.map(q=>q.id);return l?.(E),new Set(E)})},[A,l]),H=S.useCallback(D=>{t(D),m(E=>{const q=new Set(E);for(const W of D)q.delete(W);return q}),v(null)},[t]),k=S.useCallback(D=>{n(D),m(E=>{const q=new Set(E);for(const W of D)q.delete(W);return q}),v(null)},[n]),R=S.useCallback(()=>{i?.(),j(!1),m(new Set)},[i]),z=D=>{if(D===0)return"0 B";const E=1024,q=["B","KB","MB","GB"],W=Math.floor(Math.log(D)/Math.log(E));return`${parseFloat((D/Math.pow(E,W)).toFixed(1))} ${q[W]}`},P=o==="field-mode",K=P?"bg-slate-900 text-slate-100":"bg-white text-slate-900",I=P?"border-b border-slate-700 bg-slate-800":"border-b border-slate-200 bg-slate-50";return C.length===0?a.jsx("div",{className:`h-full ${K} ${u}`,children:a.jsx(ki,{icon:"delete_outline",title:"Trash is Empty",message:"Deleted items will appear here and can be restored within 30 days.",variant:P?"field-mode":"default"})}):a.jsxs("div",{className:`h-full flex flex-col ${K} ${u}`,children:[a.jsxs("div",{className:`flex items-center justify-between px-4 py-3 ${I}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx($,{name:"delete_outline",className:"text-xl opacity-60"}),a.jsx("h2",{className:"font-semibold",children:"Trash"}),a.jsx("span",{className:`text-sm px-2 py-0.5 rounded-full ${P?"bg-slate-700 text-slate-300":"bg-slate-200 text-slate-600"}`,children:_.itemCount})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("div",{className:`flex rounded-lg overflow-hidden ${P?"bg-slate-700":"bg-white border"}`,children:[a.jsx("button",{onClick:()=>y("list"),className:`p-1.5 transition-colors ${g==="list"?P?"bg-slate-600":"bg-slate-100":P?"hover:bg-slate-600/50":"hover:bg-slate-50"}`,title:"List view",children:a.jsx($,{name:"view_list",className:"text-sm"})}),a.jsx("button",{onClick:()=>y("grid"),className:`p-1.5 transition-colors ${g==="grid"?P?"bg-slate-600":"bg-slate-100":P?"hover:bg-slate-600/50":"hover:bg-slate-50"}`,title:"Grid view",children:a.jsx($,{name:"grid_view",className:"text-sm"})})]})})]}),a.jsxs("div",{className:`flex items-center gap-3 px-4 py-2 border-b ${P?"border-slate-700 bg-slate-800/50":"border-slate-200 bg-slate-50/50"}`,children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx($,{name:"search",className:"absolute left-3 top-1/2 -translate-y-1/2 text-sm text-slate-400"}),a.jsx("input",{type:"text",placeholder:"Search trash...",value:h,onChange:D=>p(D.target.value),className:`w-full pl-9 pr-3 py-1.5 text-sm rounded-lg outline-none transition-colors ${P?"bg-slate-700 text-slate-100 placeholder-slate-400 focus:ring-1 focus:ring-yellow-400":"bg-white border border-slate-200 focus:border-iiif-blue focus:ring-1 focus:ring-iiif-blue"}`})]}),d.size>0&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:`text-sm ${P?"text-slate-400":"text-slate-500"}`,children:[d.size," selected"]}),a.jsxs("button",{onClick:()=>H(Array.from(d)),className:`flex items-center gap-1.5 px-3 py-1.5 text-sm rounded-lg transition-colors ${P?"bg-green-600 hover:bg-green-500 text-white":"bg-green-500 hover:bg-green-600 text-white"}`,children:[a.jsx($,{name:"restore",className:"text-sm"}),"Restore"]}),a.jsxs("button",{onClick:()=>k(Array.from(d)),className:`flex items-center gap-1.5 px-3 py-1.5 text-sm rounded-lg transition-colors ${P?"bg-red-600 hover:bg-red-500 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,children:[a.jsx($,{name:"delete_forever",className:"text-sm"}),"Delete"]})]}),i&&C.length>0&&a.jsxs("button",{onClick:()=>j(!0),className:`flex items-center gap-1.5 px-3 py-1.5 text-sm rounded-lg transition-colors ${P?"bg-slate-700 hover:bg-slate-600 text-slate-300":"bg-slate-100 hover:bg-slate-200 text-slate-600"}`,children:[a.jsx($,{name:"delete_sweep",className:"text-sm"}),"Empty Trash"]})]}),a.jsxs("div",{className:`flex items-center gap-4 px-4 py-2 text-xs border-b ${P?"border-slate-700 bg-slate-800/30 text-slate-400":"border-slate-200 bg-slate-50/30 text-slate-500"}`,children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx($,{name:"data_usage",className:"text-xs"}),z(_.totalSize)]}),_.expiringSoon>0&&a.jsxs("span",{className:`flex items-center gap-1 ${P?"text-yellow-400":"text-orange-500"}`,children:[a.jsx($,{name:"warning",className:"text-xs"}),_.expiringSoon," expiring soon"]}),a.jsx("span",{className:"ml-auto",children:"Items kept for 30 days"})]}),a.jsxs("div",{className:"flex-1 overflow-auto p-4",children:[A.length>0&&a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx("input",{type:"checkbox",checked:d.size===A.length&&A.length>0,onChange:L,className:`rounded ${P?"bg-slate-700 border-slate-600":""}`}),a.jsx("span",{className:`text-sm ${P?"text-slate-400":"text-slate-500"}`,children:"Select all"})]}),a.jsx("div",{className:g==="grid"?"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3":"space-y-2",children:A.map(D=>a.jsxs("div",{onClick:()=>v(D),className:`group relative p-3 rounded-lg border cursor-pointer transition-all ${g==="grid"?"flex flex-col items-center text-center":"flex items-center gap-3"} ${d.has(D.id)?P?"border-yellow-400 bg-yellow-400/10":"border-iiif-blue bg-iiif-blue/5":P?"border-slate-700 hover:border-slate-600 bg-slate-800/50":"border-slate-200 hover:border-slate-300 bg-white"}`,children:[a.jsx("input",{type:"checkbox",checked:d.has(D.id),onChange:E=>{E.stopPropagation(),T(D.id)},className:`${g==="grid"?"absolute top-2 left-2":""} rounded ${P?"bg-slate-700 border-slate-600":""}`}),a.jsx("div",{className:`${g==="grid"?"mb-2":""}`,children:a.jsx($,{name:Bv(D.type),className:"text-2xl text-slate-400"})}),a.jsxs("div",{className:"flex-1 min-w-0 ",children:[a.jsx("p",{className:`font-medium truncate ${P?"text-slate-200":"text-slate-800"}`,children:D.displayLabel}),a.jsxs("p",{className:`text-xs ${P?"text-slate-400":"text-slate-500"}`,children:[D.type,"  ",Uv(D.entity.trashedAt)]}),D.daysRemaining<=7&&a.jsxs("p",{className:`text-xs mt-1 ${P?"text-yellow-400":"text-orange-500"}`,children:["Expires in ",D.daysRemaining," days"]})]}),a.jsxs("div",{className:`flex items-center gap-1 ${g==="grid"?"mt-2":""}`,children:[a.jsx("button",{onClick:E=>{E.stopPropagation(),H([D.id])},className:`p-1.5 rounded transition-colors ${P?"hover:bg-green-600/20 text-green-400":"hover:bg-green-50 text-green-600"}`,title:"Restore",children:a.jsx($,{name:"restore",className:"text-sm"})}),a.jsx("button",{onClick:E=>{E.stopPropagation(),k([D.id])},className:`p-1.5 rounded transition-colors ${P?"hover:bg-red-600/20 text-red-400":"hover:bg-red-50 text-red-600"}`,title:"Delete permanently",children:a.jsx($,{name:"delete_forever",className:"text-sm"})})]})]},D.id))}),A.length===0&&h&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[a.jsx($,{name:"search_off",className:`text-4xl mb-2 ${P?"text-slate-600":"text-slate-300"}`}),a.jsxs("p",{className:P?"text-slate-400":"text-slate-500",children:['No items match "',h,'"']})]})]}),x&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`max-w-md w-full rounded-xl shadow-xl ${P?"bg-slate-800":"bg-white"}`,children:[a.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${P?"border-slate-700":"border-slate-200"}`,children:[a.jsx("h3",{className:`font-semibold ${P?"text-slate-100":""}`,children:"Preview Item"}),a.jsx("button",{onClick:()=>v(null),className:`p-1 rounded transition-colors ${P?"hover:bg-slate-700 text-slate-400":"hover:bg-slate-100 text-slate-500"}`,children:a.jsx($,{name:"close",className:"text-lg"})})]}),a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx($,{name:Bv(x.type),className:"text-3xl text-iiif-blue"}),a.jsxs("div",{children:[a.jsx("p",{className:`font-medium ${P?"text-slate-100":""}`,children:x.displayLabel}),a.jsxs("p",{className:`text-sm ${P?"text-slate-400":"text-slate-500"}`,children:["Type: ",x.type]})]})]}),a.jsxs("div",{className:`text-sm space-y-2 ${P?"text-slate-300":""}`,children:[a.jsxs("p",{children:[a.jsx("span",{className:P?"text-slate-400":"text-slate-500",children:"Deleted:"})," ",x.trashedAt.toLocaleString()]}),a.jsxs("p",{children:[a.jsx("span",{className:P?"text-slate-400":"text-slate-500",children:"Time in trash:"})," ",Uv(x.entity.trashedAt)]}),a.jsxs("p",{children:[a.jsx("span",{className:P?"text-slate-400":"text-slate-500",children:"Days remaining:"})," ",x.daysRemaining," days"]}),x.entity.originalParentId&&a.jsxs("p",{children:[a.jsx("span",{className:P?"text-slate-400":"text-slate-500",children:"Original parent:"})," ",x.entity.originalParentId]})]}),a.jsxs("div",{className:`flex gap-2 pt-2 ${P?"border-t border-slate-700":"border-t border-slate-100"}`,children:[a.jsxs("button",{onClick:()=>H([x.id]),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${P?"bg-green-600 hover:bg-green-500 text-white":"bg-green-500 hover:bg-green-600 text-white"}`,children:[a.jsx($,{name:"restore"}),"Restore"]}),a.jsxs("button",{onClick:()=>k([x.id]),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${P?"bg-red-600 hover:bg-red-500 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,children:[a.jsx($,{name:"delete_forever"}),"Delete Forever"]})]})]})]})}),N&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:`max-w-sm w-full rounded-xl shadow-xl ${P?"bg-slate-800":"bg-white"}`,children:a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:`p-2 rounded-full ${P?"bg-red-600/20":"bg-red-100"}`,children:a.jsx($,{name:"warning",className:"text-red-500 text-xl"})}),a.jsx("h3",{className:`font-semibold ${P?"text-slate-100":""}`,children:"Empty Trash?"})]}),a.jsxs("p",{className:`text-sm mb-4 ${P?"text-slate-300":"text-slate-600"}`,children:["This will permanently delete all ",_.itemCount," items in the trash. This action cannot be undone."]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>j(!1),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${P?"bg-slate-700 hover:bg-slate-600 text-slate-200":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:"Cancel"}),a.jsx("button",{onClick:R,className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${P?"bg-red-600 hover:bg-red-500 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,children:"Empty Trash"})]})]})})})]})},l4=({currentMode:e,root:t,selectedItem:n,selectedId:i,validationIssuesMap:l,fieldMode:o,abstractionLevel:u,isMobile:d,filterIds:m,preloadedManifest:h,onUpdateRoot:p,onUpdateItem:g,onSelect:y,onSelectId:x,onOpenItem:v,onBatchEdit:N,onReveal:j,onSynthesize:C,onCatalogSelection:A,onClearFilter:_,onComposerOpened:T,onModeChange:L,onShowInspector:H,settings:k,coreMode:R})=>{const z=()=>L("archive"),P=()=>L("collections"),K=Hv.USE_SIMPLIFIED_UI;return a.jsxs(a.Fragment,{children:[K,K,K,e==="archive"&&a.jsx(ma,{fallback:(I,D)=>a.jsx(yi,{viewName:"Archive",error:I,onRetry:D,onSwitchView:P}),children:a.jsx(LM,{root:t,onUpdate:p,onSelect:I=>{y(I),d||H()},onOpen:v,onBatchEdit:N,validationIssues:l,fieldMode:o,onReveal:j,onCatalogSelection:A})},"archive-view"),e==="collections"&&a.jsx(ma,{fallback:(I,D)=>a.jsx(yi,{viewName:"Structure",error:I,onRetry:D,onSwitchView:z}),children:a.jsx(t4,{root:t,onUpdate:p,abstractionLevel:u,onReveal:j,onSynthesize:C,selectedId:i,onSelect:I=>{x(I),H()}})},"collections-view"),e==="metadata"&&a.jsx(ma,{fallback:(I,D)=>a.jsx(yi,{viewName:"Metadata Catalog",error:I,onRetry:D,onSwitchView:z}),children:a.jsx(a4,{root:t,onUpdate:p,filterIds:m,onClearFilter:_})},"metadata-view"),e==="boards"&&a.jsx(ma,{fallback:(I,D)=>a.jsx(yi,{viewName:"Boards",error:I,onRetry:D,onSwitchView:z}),children:a.jsx(qM,{root:t,settings:k})},"boards-view"),e==="viewer"&&a.jsx(ma,{fallback:(I,D)=>a.jsx(yi,{viewName:"Viewer",error:I,onRetry:D,onSwitchView:z}),children:a.jsx(pN,{item:n&&Wt(n)?n:null,onUpdate:g,autoOpenComposer:h===i,onComposerOpened:T})},"viewer-view"),e==="search"&&a.jsx(ma,{fallback:(I,D)=>a.jsx(yi,{viewName:"Search",error:I,onRetry:D,onSwitchView:z}),children:a.jsx(n4,{root:t,onSelect:I=>j(I,"archive"),onRevealMap:I=>{x(I),j(I,"archive")}})},"search-view"),e==="trash"&&a.jsx(ma,{fallback:(I,D)=>a.jsx(yi,{viewName:"Trash",error:I,onRetry:D,onSwitchView:z}),children:a.jsx(r4,{state:{entities:{Collection:{},Manifest:{},Canvas:{},Range:{},AnnotationPage:{},Annotation:{}},trashedEntities:{},references:{},reverseRefs:{},collectionMembers:{},memberOfCollections:{},rootId:null,typeIndex:{},extensions:{}},onRestore:I=>console.log("Restore items:",I),onDelete:I=>console.log("Delete items:",I),onEmptyTrash:()=>console.log("Empty trash"),variant:o?"field-mode":"default"})},"trash-view")]})},o4=()=>{const{state:e,dispatch:t,loadRoot:n,exportRoot:i,rootId:l}=Q5(),{batchUpdate:o}=tM(),u=S.useMemo(()=>i(),[e]),{isMobile:d}=rN(),{settings:m,updateSettings:h,toggleFieldMode:p}=sM(),{showToast:g}=ws(),y=fa(),x=fa(),v=fa(!localStorage.getItem("iiif-field-setup-complete")),N=fa(),j=fa(),C=fa(),A=fa(),_=fa(),T=fa(),[L,H]=S.useState(!d),[k,R]=S.useState(!1),[z,P]=S.useState("archive"),[K,I]=S.useState("iiif"),[D,E]=S.useState(null),[q,W]=S.useState(null),[G,te]=S.useState([]),[U,V]=S.useState(null),[O,B]=S.useState("saved"),[Y,X]=S.useState({}),[Q,ue]=S.useState({}),[be,de]=S.useState(null),[ye,le]=S.useState(!1),we=S.useRef(g);we.current=g;const He=S.useRef(!1),Ke=S.useRef(!1);S.useEffect(()=>{const Ae=()=>{const Qe=window.location.hash.slice(1);if(!Qe)return;const Ge=new URLSearchParams(Qe),ve=Ge.get("mode"),je=Ge.get("id");ve&&["archive","collections","metadata","search","viewer","boards"].includes(ve)&&P(ve),je&&E(je)};Ae();const $e=()=>Ae();return window.addEventListener("popstate",$e),()=>window.removeEventListener("popstate",$e)},[]),S.useEffect(()=>{const Ae=new URLSearchParams;Ae.set("mode",z),D&&Ae.set("id",D);const $e=`#${Ae.toString()}`;window.location.hash!==$e&&window.history.pushState(null,"",$e)},[z,D]),nM(),S.useEffect(()=>{const Ae=$e=>{if(($e.metaKey||$e.ctrlKey)&&$e.key==="k"&&($e.preventDefault(),A.toggle()),($e.metaKey||$e.ctrlKey)&&$e.key==="?"&&($e.preventDefault(),_.toggle()),$e.key==="?"&&!$e.metaKey&&!$e.ctrlKey&&!$e.altKey){const Qe=$e.target;Qe.tagName!=="INPUT"&&Qe.tagName!=="TEXTAREA"&&!Qe.isContentEditable&&($e.preventDefault(),_.toggle())}};return window.addEventListener("keydown",Ae),()=>window.removeEventListener("keydown",Ae)},[A,_]);const F=S.useMemo(()=>[{id:"archive",label:"Go to Archive",icon:"inventory_2",shortcut:"1",onExecute:()=>P("archive"),section:"Navigation",description:"Switch to Archive view"},{id:"collections",label:"Go to Collections",icon:"folder_special",shortcut:"2",onExecute:()=>P("collections"),section:"Navigation",description:"Switch to Collections/Structure view"},{id:"metadata",label:"Go to Metadata",icon:"table_chart",shortcut:"3",onExecute:()=>P("metadata"),section:"Navigation",description:"Switch to Metadata spreadsheet view"},{id:"search",label:"Go to Search",icon:"search",shortcut:"4",onExecute:()=>P("search"),section:"Navigation",description:"Switch to Search view"},{id:"export",label:"Export Archive",icon:"download",shortcut:"E",onExecute:y.open,section:"Actions",description:"Export archive to IIIF package"},{id:"import",label:"Import External IIIF",icon:"cloud_download",onExecute:N.open,section:"Actions",description:"Import from external IIIF manifest or collection"},{id:"settings",label:"Open Settings",icon:"settings",shortcut:",",onExecute:C.open,section:"Actions",description:"Open application settings"},{id:"qc",label:"Quality Control Dashboard",icon:"fact_check",onExecute:x.open,section:"Actions",description:"View and fix validation issues"},{id:"fieldmode",label:"Toggle Field Mode",icon:"contrast",onExecute:p,section:"View",description:"Toggle high-contrast field mode"},{id:"sidebar",label:"Toggle Sidebar",icon:"side_navigation",onExecute:()=>H(Ae=>!Ae),section:"View",description:"Show or hide the sidebar"},{id:"inspector",label:"Toggle Inspector",icon:"info",onExecute:()=>R(Ae=>!Ae),section:"View",description:"Show or hide the inspector panel"}],[y.open,N.open,C.open,x.open,p]);S.useEffect(()=>{if(Ke.current)return;Ke.current=!0,("ontouchstart"in window||navigator.maxTouchPoints>0)&&!m.fieldMode&&!localStorage.getItem("iiif-field-mode-prompted")&&(g("Touch device detected. Field Mode activated for tactile archiving.","info"),h({fieldMode:!0}),localStorage.setItem("iiif-field-mode-prompted","true"))},[m.fieldMode,g,h]),S.useEffect(()=>{if(He.current)return;He.current=!0,qt.setWarningCallback($e=>{$e.type==="quota_critical"||$e.type==="save_failed"?we.current($e.message,"error"):$e.type==="quota_warning"&&we.current($e.message,"info")}),qt.loadProject().then(async $e=>{$e&&n($e);const Qe=sn.parseFromUrl();if(Qe){console.log("[App] Content State detected:",Qe);const Ge=(je,Ue)=>{if(!je)return null;if(je.id===Ue)return je;const ft=je.items||[];for(const ie of ft){const Oe=Ge(ie,Ue);if(Oe)return Oe}return null};($e?Ge($e,Qe.canvasId):null)?(E(Qe.canvasId),P("viewer"),R(!0)):(console.warn("[App] Content State canvas not found:",Qe.canvasId),we.current("The shared item could not be found in this archive","info"),window.history.replaceState({},"",window.location.pathname))}}),localStorage.getItem("iiif-field-setup-complete")||v.open(),me();const Ae=setInterval(me,3e4);return()=>clearInterval(Ae)},[n,v]),S.useEffect(()=>{const Ae=setInterval(()=>{if(l&&O==="saved"){const $e=i();$e&&qt.saveProject($e)}},m.autoSaveInterval*1e3);return()=>clearInterval(Ae)},[l,i,m.autoSaveInterval,O]),S.useEffect(()=>{u&&ue(Jl.validateTree(u))},[u]);const me=async()=>{const Ae=await qt.getEstimate();de(Ae)},he=S.useCallback(Ae=>{n(Ae),B("saving"),qt.saveProject(Ae).then(()=>{B("saved"),me()}).catch(()=>{B("error"),g("Failed to save project!","error")})},[n,g]),ee=S.useCallback((Ae,$e)=>{if(!Ae)return null;if(Ae.id===$e)return Ae;const Qe=Ae.items||Ae.annotations||[];for(const Ge of Qe){const ve=ee(Ge,$e);if(ve)return ve}return null},[]),Z=S.useCallback(Ae=>{if(!D)return;if(t(iu.batchUpdate([{id:D,changes:Ae}]))){B("saving");const Qe=i();Qe&&qt.saveProject(Qe).then(()=>{B("saved"),me()}).catch(()=>{B("error"),g("Failed to save project!","error")})}},[D,t,i,g]),se=S.useCallback((Ae,$e)=>{E(Ae),P($e),$e!=="viewer"&&R(!0),d&&(H(!1),$e==="viewer"&&R(!1)),$e!=="metadata"&&X(Qe=>({...Qe,filterIds:null}))},[d]),Te=S.useCallback(Ae=>{X($e=>({...$e,filterIds:Ae})),P("metadata"),d&&H(!1),g(`Anticipating cataloging for ${Ae.length} items`,"info")},[d,g]),_e=S.useCallback(Ae=>{E(Ae),X($e=>({...$e,preloadedManifest:Ae})),P("viewer")},[]),ne=S.useCallback((Ae,$e)=>{W({resourceId:Ae,authServices:$e}),T.open()},[T]),ge=S.useCallback(Ae=>{Ae.status==="authenticated"?g("Authentication successful. Please retry your request.","success"):Ae.status==="degraded"&&g("Limited access granted. Some content may be unavailable.","info"),T.close(),W(null)},[g,T]),Se=S.useCallback(()=>{T.close(),W(null)},[T]),Ce=S.useCallback(Ae=>{const $e=Ae==="simple"?Ps.RESEARCHER:Ae==="standard"?Ps.ARCHIVIST:Ps.DEVELOPER;h({abstractionLevel:Ae,fieldMode:Ae==="simple",metadataTemplate:$e,metadataComplexity:Ae==="simple"?"simple":Ae==="advanced"?"advanced":"standard",showTechnicalIds:Ae!=="simple"}),localStorage.setItem("iiif-field-setup-complete","true"),v.close()},[h,v]),Me=S.useCallback(Ae=>{const $e=Ae==="simple"?Ps.RESEARCHER:Ae==="standard"?Ps.ARCHIVIST:Ps.DEVELOPER;h({abstractionLevel:Ae,metadataTemplate:$e,metadataComplexity:Ae==="simple"?"simple":Ae==="advanced"?"advanced":"standard",showTechnicalIds:Ae!=="simple",fieldMode:Ae==="simple"}),g(`Switched to ${Ae==="simple"?"Simple (Album/Photo)":Ae==="standard"?"Standard":"Advanced"} mode`,"info")},[h,g]),Be=S.useCallback((Ae,$e,Qe)=>{const Ge=Ae.map((je,Ue)=>{const ft={...$e[je]};if(Qe){const ie=ee(u,je);if(ie){const Oe=Le(ie.label);ft.label={none:[Qe.replace("{orig}",Oe).replace("{nnn}",(Ue+1).toString().padStart(3,"0"))]}}}return{id:je,changes:ft}});if(o(Ge)){B("saving");const je=i();je&&qt.saveProject(je).then(()=>{B("saved"),me()}).catch(()=>{B("error"),g("Failed to save project!","error")})}},[u,ee,o,i,g]),We=S.useCallback(Ae=>{n(Ae),B("saving"),qt.saveProject(Ae).then(()=>{B("saved"),me()}).catch(()=>{B("error"),g("Failed to save rollback!","error")})},[n,g]),qe=D?ee(u,D):null;return a.jsxs("div",{className:`flex flex-col h-screen w-screen overflow-hidden font-sans ${m.theme==="dark"?"dark text-slate-100 bg-slate-950":"text-slate-900 bg-slate-100"}`,children:[a.jsx(Xh,{targetId:"main-content",label:"Skip to main content"}),a.jsx(Xh,{targetId:"sidebar",label:"Skip to sidebar navigation",position:"top-left",className:"mt-14"}),a.jsx(Xh,{targetId:"command-palette-trigger",label:"Skip to Command Palette",shortcut:"K",position:"top-left",className:"mt-24"}),a.jsx("div",{className:`fixed top-4 right-4 z-[2000] pointer-events-none transition-all duration-300 ${O==="saving"?"translate-y-0 opacity-100":"-translate-y-4 opacity-0"}`,children:a.jsxs("div",{className:"bg-white/90 backdrop-blur shadow-lg border border-slate-200 rounded-full px-3 py-1.5 flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 rounded-full bg-iiif-blue animate-pulse"}),a.jsx("span",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-wider",children:"Saving..."})]})}),a.jsxs("div",{className:"flex-1 flex min-h-0 relative",children:[d&&a.jsxs("header",{className:"absolute top-0 left-0 right-0 h-14 bg-slate-900 z-[100] flex items-center px-4 justify-between shadow-lg",children:[a.jsx("button",{onClick:()=>H(!0),"aria-label":"Open sidebar",className:"text-white p-2",children:a.jsx($,{name:"menu"})}),a.jsx("div",{className:"text-yellow-400 font-black tracking-tighter uppercase text-xs",children:"Field Studio"}),a.jsx("button",{onClick:()=>qe&&R(!0),"aria-label":"Open inspector",className:`text-white p-2 ${qe?"":"opacity-20"}`,children:a.jsx($,{name:"info"})})]}),a.jsx(nj,{root:u,selectedId:D,currentMode:z,viewType:K,fieldMode:m.fieldMode,abstractionLevel:m.abstractionLevel,visible:L,isMobile:d,onSelect:Ae=>{E(Ae),d||R(!0),d&&H(!1)},onClose:()=>H(!1),onModeChange:Ae=>{P(Ae),d&&H(!1)},onViewTypeChange:I,onImport:Ae=>Ae.target.files&&V(P1(Array.from(Ae.target.files))),onExportTrigger:y.open,onToggleFieldMode:p,onOpenExternalImport:N.open,onStructureUpdate:he,onOpenSettings:C.open,onToggleQuickHelp:()=>le(Ae=>!Ae),onAbstractionLevelChange:Me}),a.jsxs("main",{id:"main-content",className:`flex-1 flex flex-col min-w-0 relative shadow-xl z-0 ${m.fieldMode?"bg-black":"bg-white"} ${d?"pt-14":""}`,children:[a.jsx(l4,{currentMode:z,root:u,selectedItem:qe,selectedId:D,validationIssuesMap:Q,fieldMode:m.fieldMode,abstractionLevel:m.abstractionLevel,isMobile:d,filterIds:Y.filterIds,preloadedManifest:Y.preloadedManifest,onUpdateRoot:he,onUpdateItem:Z,onSelect:Ae=>{E(Ae.id),d||R(!0)},onSelectId:E,onOpenItem:Ae=>{E(Ae.id),P("viewer")},onBatchEdit:Ae=>{te(Ae),j.open()},onReveal:se,onSynthesize:_e,onCatalogSelection:Te,onClearFilter:()=>X(Ae=>({...Ae,filterIds:null})),onComposerOpened:()=>X(Ae=>({...Ae,preloadedManifest:null})),onModeChange:P,onShowInspector:()=>R(!0),settings:m}),a.jsx(h5,{mode:z,isInspectorOpen:k&&!!qe&&!m.fieldMode})]}),a.jsx(V1,{resource:qe,onUpdateResource:Z,settings:m,visible:k&&!!D,isMobile:d,onClose:()=>{R(!1),E(null)},annotations:qe&&Wt(qe)?qe.annotations?.flatMap(Ae=>Ae.items)||[]:[]},D||"none")]}),!d&&a.jsx(hR,{totalItems:u?.items?.length||0,selectedItem:qe,validationIssues:Object.values(Q).flat(),storageUsage:be,onOpenQC:x.open,saveStatus:O}),U&&a.jsx(JR,{initialTree:U,existingRoot:u,onIngest:async(Ae,$e,Qe)=>{const{root:Ge}=await vD(Ae,$e?u:null,Qe);he(Ge),V(null)},onCancel:()=>V(null)}),y.isOpen&&u&&a.jsx(r5,{root:u,onClose:y.close}),x.isOpen&&a.jsx(g5,{root:u,onUpdate:he,issuesMap:Q,totalItems:u?.items?.length||0,onSelect:Ae=>se(Ae,"archive"),onClose:x.close}),v.isOpen&&a.jsx(x5,{onComplete:Ce}),N.isOpen&&a.jsx(y5,{onImport:Ae=>he(u&&Mt(u)?{...u,items:[...u.items||[],Ae]}:Ae),onClose:N.close,onAuthRequired:ne}),j.isOpen&&u&&a.jsx(C5,{ids:G,root:u,onApply:Be,onRollback:We,onClose:j.close}),C.isOpen&&a.jsx(j5,{settings:m,onUpdate:h,onClose:C.close}),a.jsx(O5,{isOpen:A.isOpen,onClose:A.close,commands:F}),a.jsx(U5,{isOpen:_.isOpen,onClose:_.close,currentContext:z}),a.jsx(n5,{title:z==="archive"?"Archive View":z==="collections"?"Structure View":z==="viewer"?"Viewer":"Board View",items:z==="archive"?l5:z==="collections"?o5:z==="viewer"?c5:z==="boards"?u5:d5,isOpen:ye,onToggle:()=>le(Ae=>!Ae)}),T.isOpen&&q&&a.jsx(B5,{authServices:q.authServices,resourceId:q.resourceId,onComplete:ge,onClose:Se})]})},c4=()=>a.jsx(J5,{children:a.jsx(GC,{children:a.jsx(ma,{children:a.jsx(o4,{})})})});let u4=!1;try{document.cookie,u4=!0}catch{}window.onerror=function(e,t,n,i,l){console.error("[Global Error]",e,t,n,i,l);const o=document.getElementById("root");if(o){const u=m=>m==null?"":String(m).replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"').replace(/'/g,"&#x27;");o.innerHTML=`
      <div style="padding: 20px; color: #7f1d1d; background: #fef2f2; border: 1px solid #fecaca; margin: 20px; font-family: sans-serif; border-radius: 8px;">
        <h2 style="margin-top:0">Startup Error</h2>
        <p><strong>Message:</strong> ${u(e)}</p>
        <p><strong>Source:</strong> ${u(t)}:${u(n)}:${u(i)}</p>
        <pre style="background: #fff; padding: 10px; overflow: auto; font-size: 11px;">${u(l?.stack)||"No stack trace"}</pre>
        <button id="reload-btn" style="padding: 8px 16px; background: #333; color: white; border: none; border-radius: 4px; cursor: pointer;">Reload</button>
      </div>
    `;const d=document.getElementById("reload-btn");d&&d.addEventListener("click",()=>window.location.reload())}return!1};window.addEventListener("unhandledrejection",e=>{console.error("[Unhandled Rejection]",e.reason)});console.log("[Index] Starting application bootstrap...");"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("message",async e=>{if(e.data&&e.data.type==="SEARCH_QUERY"){const{query:t,url:n}=e.data,i=Ni.search(t),l={"@context":kt.SEARCH_2.CONTEXT,id:n,type:"AnnotationPage",items:i.map(o=>({id:`${o.id}/annotation/${crypto.randomUUID()}`,type:"Annotation",motivation:"supplementing",body:{type:"TextualBody",value:o.match,format:"text/plain"},target:o.id}))};e.ports&&e.ports[0]&&e.ports[0].postMessage(l);return}if(e.data&&e.data.type==="TILE_REQUEST"){const{requestId:t,assetId:n,level:i,x:l,y:o,format:u}=e.data;try{const d=await qt.tiles.getTile(n,i,l,o);if(d){const m=await d.arrayBuffer();navigator.serviceWorker.controller?.postMessage({type:"TILE_RESPONSE",requestId:t,blob:m,contentType:u==="png"?"image/png":"image/jpeg"},[m])}else navigator.serviceWorker.controller?.postMessage({type:"TILE_RESPONSE",requestId:t,blob:null})}catch(d){console.error("[Main] Error fetching tile:",d),navigator.serviceWorker.controller?.postMessage({type:"TILE_RESPONSE",requestId:t,error:d instanceof Error?d.message:"Unknown error"})}return}if(e.data&&e.data.type==="TILE_MANIFEST_REQUEST"){const{requestId:t,assetId:n}=e.data;try{const i=await qt.tiles.getTileManifest(n);navigator.serviceWorker.controller?.postMessage({type:"TILE_MANIFEST_RESPONSE",requestId:t,manifest:i||null})}catch(i){console.error("[Main] Error fetching tile manifest:",i),navigator.serviceWorker.controller?.postMessage({type:"TILE_MANIFEST_RESPONSE",requestId:t,error:i instanceof Error?i.message:"Unknown error"})}return}}),window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").then(e=>{console.log("[SW] Registered successfully with scope:",e.scope)}).catch(e=>{console.warn("[SW] Registration failed:",e)})}));try{const e=document.getElementById("root");if(!e)throw new Error("Could not find root element to mount to");MC.createRoot(e).render(a.jsx(An.StrictMode,{children:a.jsx(ma,{children:a.jsx(c4,{})})}))}catch(e){console.error("[Index] Fatal error during mount:",e)}export{wu as g};
