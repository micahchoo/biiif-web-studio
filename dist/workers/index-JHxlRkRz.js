function M(t,i){return typeof t>"u"?i:t}function S(t){const i=Array(t);for(let e=0;e<t;e++)i[e]=_();return i}function T(t){return Object.keys(t)}function _(){return Object.create(null)}function E(t){return[].concat.apply([],t)}function L(t,i){return i.length-t.length}function R(t){return t.constructor===Array}function O(t){return typeof t=="string"}function I(t){return typeof t=="object"}function Z(t){return typeof t=="function"}function B(t,i,e,n){if(t&&(i&&(t=A(t,i)),this.matcher&&(t=A(t,this.matcher)),this.stemmer&&1<t.length&&(t=A(t,this.stemmer)),n&&1<t.length&&(t=G(t)),e||e==="")){const s=t.split(e);return this.filter?H(s,this.filter):s}return t}const D=/[\p{Z}\p{S}\p{P}\p{C}]+/u;function F(t){const i=_();for(let e=0,n=t.length;e<n;e++)i[t[e]]=1;return i}function b(t,i){const e=T(t),n=e.length,s=[];let o="",r=0;for(let h,d,u=0;u<n;u++)h=e[u],d=t[h],d?(s[r++]=J(i?"(?!\\b)"+h+"(\\b|_)":h),s[r++]=d):o+=(o?"|":"")+h;return o&&(s[r++]=J(i?"(?!\\b)("+o+")(\\b|_)":"("+o+")"),s[r]=""),s}function A(t,i){for(let e=0,n=i.length;e<n&&(t=t.replace(i[e],i[e+1]),!!t);e+=2);return t}function J(t){return new RegExp(t,"g")}function G(t){let i="",e="";for(let n,s=0,o=t.length;s<o;s++)(n=t[s])!==e&&(i+=e=n);return i}function H(t,i){const e=t.length,n=[];for(let s=0,o=0;s<e;s++){const r=t[s];r&&!i[r]&&(n[o++]=r)}return n}function K(t){return B.call(this,(""+t).toLowerCase(),!1,D,!1)}const Q={},U={};function V(t){j(t,"add"),j(t,"append"),j(t,"search"),j(t,"update"),j(t,"remove")}function j(t,i){t[i+"Async"]=function(){const e=this,n=arguments,s=n[n.length-1];let o;Z(s)&&(o=s,delete n[n.length-1]);const r=new Promise(function(h){setTimeout(function(){e.async=!0;const d=e[i].apply(e,n);e.async=!1,h(d)})});return o?(r.then(o),this):r}}function W(t,i,e,n){const s=t.length;let o,r,h=[],d=0;n&&(n=[]);for(let u=s-1;0<=u;u--){const c=t[u],l=c.length,g=_();let f=!o;for(let p=0;p<l;p++){const m=c[p],a=m.length;if(a)for(let k,y,q=0;q<a;q++)if(y=m[q],o){if(o[y]){if(!u){if(e)e--;else if(h[d++]=y,d===i)return h}(u||n)&&(g[y]=1),f=!0}if(n&&(k=(r[y]||0)+1,r[y]=k,k<s)){const z=n[k-2]||(n[k-2]=[]);z[z.length]=y}}else g[y]=1}if(n)o||(r=g);else if(!f)return[];o=g}if(n)for(let u,c,l=n.length-1;0<=l;l--){u=n[l],c=u.length;for(let g,f=0;f<c;f++)if(g=u[f],!o[g]){if(e)e--;else if(h[d++]=g,d===i)return h;o[g]=1}}return h}function v(t){this.limit=t!==!0&&t,this.cache=_(),this.queue=[]}function X(t,i,e){I(t)&&(t=t.query);let n=this.cache.get(t);return n||(n=this.search(t,i,e),this.cache.set(t,n)),n}v.prototype.set=function(t,i){if(!this.cache[t]){let e=this.queue.length;e===this.limit?delete this.cache[this.queue[e-1]]:e++;for(let n=e-1;0<n;n--)this.queue[n]=this.queue[n-1];this.queue[0]=t}this.cache[t]=i},v.prototype.get=function(t){const i=this.cache[t];if(this.limit&&i){const e=this.queue.indexOf(t);if(e){const n=this.queue[e-1];this.queue[e-1]=this.queue[e],this.queue[e]=n}}return i},v.prototype.del=function(t){for(let i,e,n=0;n<this.queue.length;n++)e=this.queue[n],i=this.cache[e],i.includes(t)&&(this.queue.splice(n--,1),delete this.cache[e])};const Y={memory:{charset:"latin:extra",resolution:3,minlength:4,fastupdate:!1},performance:{resolution:3,minlength:3,optimize:!1,context:{depth:2,resolution:1}},match:{charset:"latin:extra",tokenize:"reverse"},score:{charset:"latin:advanced",resolution:20,minlength:3,context:{depth:3,resolution:9}},default:{}};function $(t){if(O(t))t=Y[t];else{const i=t.preset;i&&(t=Object.assign({},i[i],t))}return t}function tt(t,i,e,n,s,o,r){setTimeout(function(){const h=t(e?e+"."+n:n,JSON.stringify(r));h&&h.then?h.then(function(){i.export(t,i,e,s,o+1)}):i.export(t,i,e,s,o+1)})}function et(t,i,e,n,s){let o,r;switch(s||(s=0)){case 0:if(o="reg",this.fastupdate)for(let h in r=_(),this.register)r[h]=1;else r=this.register;break;case 1:o="cfg",r={doc:0,opt:this.optimize?1:0};break;case 2:o="map",r=this.map;break;case 3:o="ctx",r=this.ctx;break;default:return}return tt(t,i||this,e,o,n,s,r),!0}function it(t,i){i&&(O(i)&&(i=JSON.parse(i)),t==="cfg"?this.optimize=!!i.opt:t==="reg"?(this.fastupdate=!1,this.register=i):t==="map"?this.map=i:t==="ctx"&&(this.ctx=i))}function x(t,i){if(!(this instanceof x))return new x(t);let e,n,s;t?(t=$(t),e=t.charset,n=t.lang,O(e)&&(e.indexOf(":")===-1&&(e+=":default"),e=U[e]),O(n)&&(n=Q[n])):t={};let o,r,h=t.context||{};this.encode=t.encode||e&&e.encode||K,this.register=i||_(),this.resolution=o=t.resolution||9,this.tokenize=s=e&&e.tokenize||t.tokenize||"strict",this.depth=s==="strict"&&h.depth,this.bidirectional=M(h.bidirectional,!0),this.optimize=r=M(t.optimize,!0),this.fastupdate=M(t.fastupdate,!0),this.minlength=t.minlength||1,this.boost=t.boost,this.map=r?S(o):_(),this.resolution_ctx=o=h.resolution||1,this.ctx=r?S(o):_(),this.rtl=e&&e.rtl||t.rtl,this.matcher=(s=t.matcher||n&&n.matcher)&&b(s,!1),this.stemmer=(s=t.stemmer||n&&n.stemmer)&&b(s,!0),this.filter=(s=t.filter||n&&n.filter)&&F(s),this.cache=(s=t.cache)&&new v(s)}x.prototype.append=function(t,i){return this.add(t,i,!0)},x.prototype.add=function(t,i,e,n){if(i&&(t||t===0)){if(!n&&!e&&this.register[t])return this.update(t,i);i=this.encode(""+i);const s=i.length;if(s){const o=_(),r=_(),h=this.depth,d=this.resolution;for(let u=0;u<s;u++){let c=i[this.rtl?s-1-u:u],l=c.length;if(c&&l>=this.minlength&&(h||!r[c])){let g=w(d,s,u),f="";switch(this.tokenize){case"full":if(2<l){for(let p=0;p<l;p++)for(let m=l;m>p;m--)if(m-p>=this.minlength){const a=w(d,s,u,l,p);f=c.substring(p,m),this.push_index(r,f,a,t,e)}break}case"reverse":if(1<l){for(let p=l-1;0<p;p--)if(f=c[p]+f,f.length>=this.minlength){const m=w(d,s,u,l,p);this.push_index(r,f,m,t,e)}f=""}case"forward":if(1<l){for(let p=0;p<l;p++)f+=c[p],f.length>=this.minlength&&this.push_index(r,f,g,t,e);break}default:if(this.boost&&(g=Math.min(0|g/this.boost(i,c,u),d-1)),this.push_index(r,c,g,t,e),h&&1<s&&u<s-1){const p=_(),m=this.resolution_ctx,a=c,k=Math.min(h+1,s-u);p[a]=1;for(let y=1;y<k;y++)if(c=i[this.rtl?s-1-u-y:u+y],c&&c.length>=this.minlength&&!p[c]){p[c]=1;const q=w(m+(s/2>m?0:1),s,u,k-1,y-1),z=this.bidirectional&&c>a;this.push_index(o,z?a:c,q,t,e,z?c:a)}}}}}this.fastupdate||(this.register[t]=1)}}return this};function w(t,i,e,n,s){return e&&1<t?i+(n||0)<=t?e+(s||0):0|(t-1)/(i+(n||0))*(e+(s||0))+1:0}x.prototype.push_index=function(t,i,e,n,s,o){let r=o?this.ctx:this.map;if((!t[i]||o&&!t[i][o])&&(this.optimize&&(r=r[e]),o?(t=t[i]||(t[i]=_()),t[o]=1,r=r[o]||(r[o]=_())):t[i]=1,r=r[i]||(r[i]=[]),this.optimize||(r=r[e]||(r[e]=[])),(!s||!r.includes(n))&&(r[r.length]=n,this.fastupdate))){const h=this.register[n]||(this.register[n]=[]);h[h.length]=r}},x.prototype.search=function(t,i,e){e||(!i&&I(t)?(e=t,t=e.query):I(i)&&(e=i));let n,s,o,r=[],h=0;if(e&&(t=e.query||t,i=e.limit,h=e.offset||0,s=e.context,o=e.suggest),t&&(t=this.encode(""+t),n=t.length,1<n)){const l=_(),g=[];for(let f,p=0,m=0;p<n;p++)if(f=t[p],f&&f.length>=this.minlength&&!l[f]){if(!this.optimize&&!o&&!this.map[f])return r;g[m++]=f,l[f]=1}t=g,n=t.length}if(!n)return r;i||(i=100);let d,u=this.depth&&1<n&&s!==!1,c=0;u?(d=t[0],c=1):1<n&&t.sort(L);for(let l,g;c<n;c++){if(g=t[c],u?(l=this.add_result(r,o,i,h,n===2,g,d),(!o||l!==!1||!r.length)&&(d=g)):l=this.add_result(r,o,i,h,n===1,g),l)return l;if(o&&c==n-1){let f=r.length;if(!f){if(u){u=0,c=-1;continue}return r}if(f===1)return N(r[0],i,h)}}return W(r,i,h,o)},x.prototype.add_result=function(t,i,e,n,s,o,r){let h=[],d=r?this.ctx:this.map;if(this.optimize||(d=P(d,o,r,this.bidirectional)),d){let u=0;const c=Math.min(d.length,r?this.resolution_ctx:this.resolution);for(let l,g,f=0,p=0;f<c&&(l=d[f],!(l&&(this.optimize&&(l=P(l,o,r,this.bidirectional)),n&&l&&s&&(g=l.length,g<=n?(n-=g,l=null):(l=l.slice(n),n=0)),l&&(h[u++]=l,s&&(p+=l.length,p>=e)))));f++);if(u)return s?N(h,e,0):void(t[t.length]=h)}return!i&&h};function N(t,i,e){return t=t.length===1?t[0]:E(t),e||t.length>i?t.slice(e,e+i):t}function P(t,i,e,n){if(e){const s=n&&i>e;t=t[s?i:e],t=t&&t[s?e:i]}else t=t[i];return t}x.prototype.contain=function(t){return!!this.register[t]},x.prototype.update=function(t,i){return this.remove(t).add(t,i)},x.prototype.remove=function(t,i){const e=this.register[t];if(e){if(this.fastupdate)for(let n,s=0;s<e.length;s++)n=e[s],n.splice(n.indexOf(t),1);else C(this.map,t,this.resolution,this.optimize),this.depth&&C(this.ctx,t,this.resolution_ctx,this.optimize);i||delete this.register[t],this.cache&&this.cache.del(t)}return this};function C(t,i,e,n,s){let o=0;if(R(t))if(s){const r=t.indexOf(i);r===-1?o++:1<t.length&&(t.splice(r,1),o++)}else{s=Math.min(t.length,e);for(let r,h=0;h<s;h++)r=t[h],r&&(o=C(r,i,e,n,s),!n&&!o&&delete t[h])}else for(let r in t)o=C(t[r],i,e,n,s),o||delete t[r];return o}x.prototype.searchCache=X,x.prototype.export=et,x.prototype.import=it,V(x.prototype);export{x as default};
